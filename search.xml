<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Abstract Class</title>
    <url>/2020/08/24/Abstract-Class/</url>
    <content><![CDATA[<img data-src="https://cdn.journaldev.com/wp-content/uploads/2013/07/abstract-class-in-java.jpg" width="100%"/>

<a id="more"></a>

<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>使用 <code>abstract</code> 关键字修饰的方法称之为<strong>抽象方法</strong>，使用 <code>abstract</code> 关键字修饰的类称之为<strong>抽象类</strong>。</p>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ol>
<li>单独定义方法签名</li>
<li>强制子类重写方法</li>
<li>限制创建实例</li>
</ol>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ol>
<li><p>抽象类无法实例化</p>
<p>因为抽象方法本身是无法执行的，所以，抽象类类也无法被实例化。</p>
<p>无法实例化的抽象类有什么用？</p>
<p>因为抽象类本身被设计成只能用于被继承，因此，抽象类可以强迫子类实现其定义的抽象方法。因此，抽象方法实际上相当于定义了“规范”。</p>
</li>
<li><p>不能使用 <code>private</code> 修饰抽象方法</p>
<p>抽象方法必须对子类可见，而 private 修饰的方法对子类不可见，因此不能使用 private 修饰符。</p>
<p>如果不带修饰符，那么就是包内访问。这种情况下，不一定能保证对子类可见。如果子类和父类不在一个包下面，子类是无法访问（无法覆盖）父类的方法。因此，抽象方法的访问权限不应该是包内访问。可以使用 public 和 protected，大多数情况下都是使用 public。</p>
</li>
</ol>
<h2 id="抽象类与接口的区别"><a href="#抽象类与接口的区别" class="headerlink" title="抽象类与接口的区别"></a>抽象类与接口的区别</h2><h3 id="语法层面"><a href="#语法层面" class="headerlink" title="语法层面"></a>语法层面</h3><ol>
<li>抽象类可以有构造方法，接口中不能有构造方法。</li>
<li>抽象类可以拥有任意范围的成员数据，接口仅能够有常量。</li>
<li>可以拥有非抽象方法，但是接口所有的方法都必须是抽象方法(1.8 增加了默认方法和静态方法)。</li>
<li>抽象类中抽象方法的访问类型除了 private 以外都可以，但接口中的抽象方法只能是 public 类型，并且默认即为public abstract类型。</li>
<li>抽象类中可以包含静态方法，接口中不能包含静态方法(1.8 之后可以)</li>
<li>一个类可以实现多个接口，但只能继承一个抽象类。</li>
</ol>
<h3 id="设计层面"><a href="#设计层面" class="headerlink" title="设计层面"></a>设计层面</h3><p>1、抽象对象不同</p>
<p>抽象类是对类抽象，而接口是对行为的抽象。</p>
<p>抽象类是对整个类整体进行抽象，包括属性、行为，但是接口却是对类局部（行为）进行抽象。</p>
<p>2、父子关系不同</p>
<p>抽象类与子类之间是“is-a”的关系（ArrayList is a AbstractList），接口与实现类之间则不一定是“is-a“的关系，还可以是“could-be”的关系（XXX could be Serializable）</p>
<p>我们知道抽象类是从子类中发现公共部分，然后泛化成抽象类，子类继承该父类即可，但是接口不同，实现它的子类可以不存在任何关系。例如猫、狗可以抽象成一个动物类抽象类，具备叫的方法。鸟、飞机可以实现飞Fly接口，具备飞的行为，这里我们总不能将鸟、飞机共用一个父类吧！所以说<strong>抽象类所体现的是一种继承关系</strong>，要想使得继承关系合理，父类和派生类之间必须存在”is-a” 关系，即父类和派生类在概念本质上应该是相同的。对于接口则不然，并不要求接口的实现者和接口定义在概念本质上是一致的， 仅仅是实现了接口定义的契约而已。</p>
<p>3、开发模式不同</p>
<p>抽象类是自底向上抽象而来的，接口是自顶向下设计出来的。</p>
<p>对于抽象类而言，它是自下而上来设计的，我们要先知道子类才能抽象出父类，而接口则不同，它根本就不需要知道子类的存在，只需要定义一个规则即可，至于什么子类、什么时候怎么实现它一概不知。比如我们只有一个猫类在这里，如果你这是就抽象成一个动物类，是不是设计有点儿过度？我们起码要有两个动物类，猫、狗在这里，我们再抽象他们的共同点形成动物抽象类吧！所以说抽象类往往都是通过重构而来的！但是接口就不同，比如说飞，我们根本就不知道会有什么东西来实现这个飞接口，怎么实现也不得而知，我们要做的就是事前定义好飞的行为接口。所以说抽象类是自底向上抽象而来的，接口是自顶向下设计出来的。</p>
<h2 id="抽象类实际应用"><a href="#抽象类实际应用" class="headerlink" title="抽象类实际应用"></a>抽象类实际应用</h2><p><a href="http://libo9527.github.io/2020/08/26/Design-Pattern-Template-Method/" target="_blank" rel="noopener">模版方法模式</a></p>
<blockquote>
<p>模版方法模式在一个方法中定义一个算法的骨架，而将一些步骤延迟到子类中。模版方法使得子类可以在不改变算法结构的情况下，重新定义算法中的某些步骤。——《Head First 设计模式（中文版）》</p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>AccessDeniedHandler of Spring Security not Working While GlobalExceptionHandler existing</title>
    <url>/2019/12/10/AccessDeniedHandler-of-Spring-Security-not-Working-While-GlobalExceptionHandler-existing/</url>
    <content><![CDATA[<img data-src="https://previews.123rf.com/images/asiln/asiln1408/asiln140800037/30823194-access-denied-stamp.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://github.com/spring-projects/spring-security/issues/6908" target="_blank" rel="noopener">AccessDeniedHandler and AuthenticationEntryPoint does not work Because of the global exception handler</a></p>
</blockquote>
<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在学习 Spring Security 的过程中，配置了权限异常处理器，但没有起作用，查找后发现是因为全局异常处理器已经处理了该异常，导致异常并没有传递到该处理器。</p>
<h3 id="全局异常处理器"><a href="#全局异常处理器" class="headerlink" title="全局异常处理器"></a>全局异常处理器</h3><figure class="highlight java"><figcaption><span>GlobalExceptionHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ReturnVo</span> <span class="title">unknownExceptionHandler</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Exception</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ReturnVo.error(CodeEnum.UNKNOWN_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="权限异常处理器"><a href="#权限异常处理器" class="headerlink" title="权限异常处理器"></a>权限异常处理器</h3><figure class="highlight java"><figcaption><span>SecurityConfig.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(securedEnabled = <span class="keyword">true</span>, prePostEnabled = <span class="keyword">true</span>, jsr250Enabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ......</span><br><span class="line">          </span><br><span class="line">        http.exceptionHandling().accessDeniedHandler(<span class="keyword">new</span> AccessDeniedHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                httpServletResponse.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">                httpServletResponse.getWriter().write(<span class="string">"&#123;\"code\": \"402\", \"msg\": \"权限不足\"&#125;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><h3 id="方法一：全局异常处理器中将该异常继续抛出"><a href="#方法一：全局异常处理器中将该异常继续抛出" class="headerlink" title="方法一：全局异常处理器中将该异常继续抛出"></a>方法一：全局异常处理器中将该异常继续抛出</h3><figure class="highlight java"><figcaption><span>GlobalExceptionHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ReturnVo</span> <span class="title">unknownExceptionHandler</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Exception</span> <span class="title">e</span>) <span class="title">throws</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> AccessDeniedException)&#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ReturnVo.error(CodeEnum.UNKNOWN_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="方法二：将该异常处理器定义到全局异常处理器对应的类中"><a href="#方法二：将该异常处理器定义到全局异常处理器对应的类中" class="headerlink" title="方法二：将该异常处理器定义到全局异常处理器对应的类中"></a>方法二：将该异常处理器定义到全局异常处理器对应的类中</h3><figure class="highlight java"><figcaption><span>GlobalExceptionHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(AccessDeniedException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">loginExceptionHandler</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">HttpServletResponse</span> <span class="title">response</span>, <span class="title">AccessDeniedException</span> <span class="title">e</span>) <span class="title">throws</span> <span class="title">IOException</span>, <span class="title">ServletException</span> </span>&#123;</span><br><span class="line">        response.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">        response.getWriter().write(<span class="string">"&#123;\"code\": \"402\", \"msg\": \"权限不足\"&#125;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ReturnVo</span> <span class="title">unknownExceptionHandler</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Exception</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ReturnVo.error(CodeEnum.UNKNOWN_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Sprint-Security</category>
      </categories>
      <tags>
        <tag>Sprint-Security</tag>
      </tags>
  </entry>
  <entry>
    <title>Account Management in Git</title>
    <url>/2020/12/09/Account-Management-in-Git/</url>
    <content><![CDATA[<img data-src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR47zQflbjfccDWmMhgzZ6Na_e2jNfmWLhWHYSmZbjcySYzqnVTbw" width="100%"/>

<a id="more"></a>

<h2 id="Git-中-GitHub-账号的管理"><a href="#Git-中-GitHub-账号的管理" class="headerlink" title="Git 中 GitHub 账号的管理"></a>Git 中 GitHub 账号的管理</h2><p>本文记录关于 Git 中管理账号时可能遇到的一些问题，使用的远程仓库托管平台是 GitHub。</p>
<h3 id="单账号管理"><a href="#单账号管理" class="headerlink" title="单账号管理"></a>单账号管理</h3><blockquote>
<p>假设 GitHub 的账号信息如下：</p>
<p>账号：username</p>
<p>密码：password</p>
<p>假设 GitHub 中托管的仓库地址如下：</p>
<p>HTTPS：<code>https://github.com/username/repository.git</code></p>
<p>SSH：<code>git@github.com:username/repository.git</code></p>
</blockquote>
<p>Git 中链接远程仓库有 HTTPS 和 SSH 两种方式，HTTPS 相对比较简单，而 SSH 则具有更高的安全性。</p>
<h4 id="HTTPS-方式"><a href="#HTTPS-方式" class="headerlink" title="HTTPS 方式"></a>HTTPS 方式</h4><p>使用 HTTPS 的方式时，会遇到每次提交都要输入 GitHub 的账号密码的问题，可以通过将账号密码缓存到内存或者保存到本地磁盘来解决这个问题。具体详情可查看【<a href="https://git-scm.com/book/zh/v2/Git-工具-凭证存储" target="_blank" rel="noopener">凭证存储 - Git</a>】</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将账号密码保存到磁盘，默认存储位置是 ~/.git-credentials</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --global credential.helper store</span></span><br></pre></td></tr></table></figure>

<p>但这种方式是明文存储的，查看 <code>~/.git-credentials</code> 可以看到具体的账号信息。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;username:password@github.com</span><br></pre></td></tr></table></figure>

<h4 id="SSH-方式"><a href="#SSH-方式" class="headerlink" title="SSH 方式"></a>SSH 方式</h4><p>通过 SSH 方式链接 GitHub 时需要通过密钥来实现，所以 SSH 具有比较高的安全性。</p>
<ol>
<li><p>生成密钥对</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -t 指定密钥类型，默认是 rsa</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -C 注释</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f 指定文件名，默认是 ~/.ssh/id_rsa（私钥）和 ~/.ssh/id_rsa.pub（公钥）</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="string">"username@email.com"</span></span></span><br></pre></td></tr></table></figure>

<p>生成密钥时会提示让输入密码，此时的密码是以后 Git 提交时需要输入的密码，可以不填直接回车，那在提交的时候就不需要再输入密码了。</p>
</li>
<li><p>GitHub 中添加公钥</p>
<p>登陆 GitHub，在 <code>Personal settings &gt; SSH and GPG keys &gt; New SSH key</code> 将 <code>~/.ssh/id_rsa.pub</code> 文件中公钥添加进去。</p>
</li>
<li><p>设置本地仓库中的远程仓库地址为 SSH 格式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git remote <span class="built_in">set</span>-url origin <span class="string">"git@github.com:username/repository.git"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config remote.origin.url <span class="string">"git@github.com:username/repository.git"</span></span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="多账号管理"><a href="#多账号管理" class="headerlink" title="多账号管理"></a>多账号管理</h3><blockquote>
<p>假设 GitHub 的账号信息如下：</p>
<p>账号A</p>
<ul>
<li>账号：usernameA</li>
<li>密码：passwordA</li>
<li>邮箱：<a href="mailto:usernameA@163.com">usernameA@163.com</a></li>
</ul>
<p>账号B</p>
<ul>
<li>账号：usernameB</li>
<li>密码：passwordB</li>
<li>邮箱：<a href="mailto:usernameB@163.com">usernameB@163.com</a></li>
</ul>
<p>假设 GitHub 中托管的仓库地址如下：</p>
<p>仓库A</p>
<ul>
<li><p>HTTPS：<code>https://github.com/usernameA/repositoryA.git</code></p>
</li>
<li><p>SSH：<code>git@github.com:usernameA/repositoryA.git</code></p>
</li>
</ul>
<p>仓库B</p>
<ul>
<li><p>HTTPS：<code>https://github.com/usernameB/repositoryB.git</code></p>
</li>
<li><p>SSH：<code>git@github.com:usernameB/repositoryB.git</code></p>
</li>
</ul>
</blockquote>
<h4 id="账号切换"><a href="#账号切换" class="headerlink" title="账号切换"></a>账号切换</h4><blockquote>
<p>假设账号A和账号B都有权限管理仓库A，此时想将本地仓库原本的账号A切换到账号B。</p>
</blockquote>
<ol>
<li><p>查看本机是否缓存或保存了账号A的账号信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 <span class="built_in">local</span> 级别的配置中是否有关于 credential.helper 的配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> --get credential.helper</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 global 级别的配置中是否有关于 credential.helper 的配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --global --get credential.helper</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 system 级别的配置中是否有关于 credential.helper 的配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --system --get credential.helper</span></span><br></pre></td></tr></table></figure>

<p>如果返回结果为：<code>cache</code> /  <code>store</code> /  <code>osxkeychain</code> /  <code>winstore</code> 则表示本地存在账号A的账号信息</p>
</li>
<li><p>如果存在账号A的信息则清除掉其账号信息</p>
<p>删除 <code>~/.git-credentials</code> 文件中账号A的账号信息</p>
</li>
<li><p>切换本地仓库中的 Git 用户名和邮箱</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.name <span class="string">"usernameB"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.email <span class="string">"usernameB@163.com"</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将账号B的账号信息保存到本机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> credential.helper store</span></span><br></pre></td></tr></table></figure>

<p>下一次提交时会提示让输入用户名和密码，输入账号B的用户名和密码即可。</p>
</li>
</ol>
<p>经过以上 4 步之后就完成了账号的切换工作，之后再提交时使用的就是账号B了。</p>
<h4 id="多账号共存"><a href="#多账号共存" class="headerlink" title="多账号共存"></a>多账号共存</h4><p>以上情况都是本机中只存在一个 GitHub 账号，如果需要使用不同的账号管理不同的仓库时则需要对每个仓库和账号进行相应的配置以达到理想的匹配作用。</p>
<h5 id="HTTPS-方式-1"><a href="#HTTPS-方式-1" class="headerlink" title="HTTPS 方式"></a>HTTPS 方式</h5><p>如果想要本机中同时保存账号A和账号B的账号信息，对于本地仓库A，可能随时想要选用账号A或账号B中的一个来提交时。只需要在本地仓库的远程仓库地址中加上相应的用户名，然后再将 Git 用户名和密码切换到相应的用户即可。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 先设置保存密码的配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> credential.helper store</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 想要切换到账号A时</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote <span class="built_in">set</span>-url origin <span class="string">"https://usernameA@github.com/usernameA/repositoryA.git"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.name <span class="string">"usernameA"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.email <span class="string">"usernameA@163.com"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 想要切换到账号B时</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote <span class="built_in">set</span>-url origin <span class="string">"https://usernameB@github.com/usernameA/repositoryA.git"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.name <span class="string">"usernameB"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.email <span class="string">"usernameB@163.com"</span></span></span><br></pre></td></tr></table></figure>

<h5 id="SSH-方式-1"><a href="#SSH-方式-1" class="headerlink" title="SSH 方式"></a>SSH 方式</h5><blockquote>
<p>假设要通过 SSH 的方式来让账户A和账户B再本地仓库A中自由的切换</p>
</blockquote>
<p>使用 SSH 方式时需要对不用的账号生成不同的密钥，并配置账号与 GitHub 域名的匹配信息。</p>
<ol>
<li><p>生成各自密钥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -t 指定密钥类型，默认是 rsa</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -C 注释</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f 指定文件名，默认是 ~/.ssh/id_rsa（私钥）和 ~/.ssh/id_rsa.pub（公钥）</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="string">"usernameA@email.com"</span> -f <span class="string">"id_rsa_A"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="string">"usernameB@email.com"</span> -f <span class="string">"id_rsa_B"</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将密钥全部添加到 SSH Agent 中</p>
<blockquote>
<p>部分终端中需要手动开启 ssh-agent</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh-agent bash</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh-add ~/.ssh/id_rsa_A</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-add ~/.ssh/id_rsa_B</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加配置文件 <code>~/.ssh/config</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> usernameA</span></span><br><span class="line">Host hostA #别名，之后配置本地仓库的远程仓库地址时需要使用</span><br><span class="line">  HostName github.com</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa</span><br><span class="line">  User usernameA</span><br><span class="line"><span class="meta">#</span><span class="bash"> usernameB</span></span><br><span class="line">Host hostB</span><br><span class="line">  HostName github.com</span><br><span class="line">  IdentityFile ~/.ssh/id_rea2</span><br><span class="line">  User usernameB</span><br></pre></td></tr></table></figure>
</li>
<li><p>远程仓库托管平台中添加对应的公钥</p>
<p>登陆相应的远程仓库托管平台，将公钥添加上去。</p>
</li>
<li><p>修改本地仓库对应的远程仓库地址</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 想要切换到账户A时</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote <span class="built_in">set</span>-url origin <span class="string">"git@hostA:usernameA/repositoryA.git"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.name <span class="string">"usernameA"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.email <span class="string">"usernameA@163.com"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 想要切换到账号B时</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote <span class="built_in">set</span>-url origin <span class="string">"git@hostB:usernameA/repositoryA.git"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.name <span class="string">"usernameB"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --<span class="built_in">local</span> user.email <span class="string">"usernameB@163.com"</span></span></span><br></pre></td></tr></table></figure>

</li>
</ol>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Adapting height in Mini-Program of WeChat</title>
    <url>/2019/11/19/Adapting-height-in-Mini-Program-of-WeChat/</url>
    <content><![CDATA[<img data-src="cover" width="100%"/>

<a id="more"></a>

<blockquote>
<p>小程序中设置图片的 width：100%，但高度并没有自适应</p>
</blockquote>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><blockquote>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html" target="_blank" rel="noopener">image | 微信开放文档 - 微信开放社区 - 腾讯</a></p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;image class="img" src="/image/xxx.png" mode="widthFix"&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>WeChat-Mini-Program</category>
      </categories>
      <tags>
        <tag>WeChat-Mini-Program</tag>
      </tags>
  </entry>
  <entry>
    <title>Advanced Google Search</title>
    <url>/2020/03/27/Advanced-Google-Search/</url>
    <content><![CDATA[<img data-src="https://www.google.cn/landing/cnexp/google-search.png" width="100%"/>

<a id="more"></a>

<h2 id="指定网站内搜索"><a href="#指定网站内搜索" class="headerlink" title="指定网站内搜索"></a>指定网站内搜索</h2><p><code>site:xxx.xxx.xxx key</code></p>
<h2 id="完整搜索"><a href="#完整搜索" class="headerlink" title="完整搜索"></a>完整搜索</h2><p><code>&quot;key1 key2&quot;</code></p>
<h2 id="指定文件格式"><a href="#指定文件格式" class="headerlink" title="指定文件格式"></a>指定文件格式</h2><p><code>key filetype:xxx</code></p>
<h2 id="占位符"><a href="#占位符" class="headerlink" title="占位符"></a>占位符</h2><p><code>key1*key2</code></p>
<p><img data-src="https://drleon.net/wp-content/uploads/2014/06/searching-example-10.png" alt=""></p>
<h2 id="排除关键字"><a href="#排除关键字" class="headerlink" title="排除关键字"></a>排除关键字</h2><p><code>key1 -key2</code></p>
<p><img data-src="https://drleon.net/wp-content/uploads/2014/06/searching-example-6.png" alt=""></p>
<h2 id="地址中查找"><a href="#地址中查找" class="headerlink" title="地址中查找"></a>地址中查找</h2><p><code>inurl:key</code></p>
<p><code>allinurl:key1 key2</code></p>
<h2 id="标题中查找"><a href="#标题中查找" class="headerlink" title="标题中查找"></a>标题中查找</h2><p><code>intitle:key</code></p>
<p><code>allintitle:key1 key2</code></p>
<h2 id="同义字"><a href="#同义字" class="headerlink" title="同义字"></a>同义字</h2><p><code>~key</code></p>
<h2 id="数字范围"><a href="#数字范围" class="headerlink" title="数字范围"></a>数字范围</h2><p><code>num1..num2</code></p>
<h2 id="单位换算"><a href="#单位换算" class="headerlink" title="单位换算"></a>单位换算</h2><p><code>num unit1 to unit2</code></p>
<h2 id="直接翻译"><a href="#直接翻译" class="headerlink" title="直接翻译"></a>直接翻译</h2><p><code>key translate to languange</code> / <code>key trans to languange</code></p>
]]></content>
  </entry>
  <entry>
    <title>Annotation in Java</title>
    <url>/2020/10/22/Annotation-in-Java/</url>
    <content><![CDATA[<img data-src="https://ditchthattextbook.com/wp-content/uploads/2018/03/redefining-annotation-ditch-that-pdf-and-hyper-annotate-1-1.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://juejin.im/post/6844903636733001741" target="_blank" rel="noopener">JAVA 注解的基本原理 - 掘金</a></p>
</blockquote>
<h3 id="注解的本质"><a href="#注解的本质" class="headerlink" title="注解的本质"></a>注解的本质</h3><p>反编译后可以看到注解就是继承自 <code>java.lang.annotation.Annotation</code> 的一个接口。</p>
<p>注解只不过是一种特殊的注释而已，如果没有解析它的代码，可能连注释都不如。</p>
<p>而解析一个类或者方法的注解往往有两种形式，一种是编译期直接的扫描，一种是运行期反射。</p>
<p>反射的事情我们待会说，而编译器的扫描指的是编译器在对 java 代码编译字节码的过程中会检测到某个类或者方法被一些注解修饰，这时它就会对于这些注解进行某些处理。</p>
<p>典型的就是注解 <code>@Override</code>，一旦编译器检测到某个方法被修饰了 <code>@Override</code> 注解，编译器就会检查当前方法的方法签名是否真正重写了父类的某个方法，也就是比较父类中是否具有一个同样的方法签名。这一种情况只适用于那些编译器已经熟知的注解类，比如 JDK 内置的几个注解，而自定义的注解，编译器是不知道你这个注解的作用的，当然也不知道该如何处理，往往只是会根据该注解的作用范围来选择是否编译进字节码文件，仅此而已。</p>
]]></content>
  </entry>
  <entry>
    <title>Big Front-end</title>
    <url>/2020/08/18/Big-Front-end/</url>
    <content><![CDATA[<img data-src="https://reactchina.sxlcdn.com/uploads/default/original/2X/7/781984d9a4005d8e930f3e4d6a662077481ee48b.png" width="100%"/>

<a id="more"></a>

<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="查看Linux内核版本信息"><a href="#查看Linux内核版本信息" class="headerlink" title="查看Linux内核版本信息"></a>查看Linux内核版本信息</h3><ol>
<li><p>使用<code>lab_reldase -a</code>查看内核版本信息</p>
<blockquote>
<p><strong>Linux标准规范</strong>（英语：Linux Standard Base，缩写为 LSB）是一个在<a href="https://zh.wikipedia.org/wiki/Linux基金會" target="_blank" rel="noopener">Linux基金会</a>结构下对<a href="https://zh.wikipedia.org/wiki/Linux發行版" target="_blank" rel="noopener">Linux发行版</a>的联合项目，其目标使<a href="https://zh.wikipedia.org/wiki/Linux" target="_blank" rel="noopener">Linux</a><a href="https://zh.wikipedia.org/wiki/作業系統" target="_blank" rel="noopener">操作系统</a>符合软件系统架构，或文件系统架构标准的规范及标准。</p>
</blockquote>
<p>Centos 7下找不到<code>lab_release</code>命令，使用<code>yum install redhat-lsb -y</code>安装，注意Centos下的<code>lib_release</code>命令的安装包的名字是<code>redhat-lsb</code>。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ~]<span class="comment"># lsb_release</span></span><br><span class="line">LSB Version:	:core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ~]<span class="comment"># lsb_release -a</span></span><br><span class="line">LSB Version:	:core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch</span><br><span class="line">Distributor ID:	CentOS</span><br><span class="line">Description:	CentOS Linux release 7.5.1804 (Core) </span><br><span class="line">Release:	7.5.1804</span><br><span class="line">Codename:	Core</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>unman -a</code>查看Linux内核版本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux VM-0-10-centos 3.10.0-862.el7.x86_64 <span class="comment">#1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="查看磁盘占用情况"><a href="#查看磁盘占用情况" class="headerlink" title="查看磁盘占用情况"></a>查看磁盘占用情况</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ~]<span class="comment"># df -Th</span></span><br><span class="line">文件系统       类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/vda1      ext4       50G  1.9G   45G    4% /</span><br><span class="line">devtmpfs       devtmpfs  909M     0  909M    0% /dev</span><br><span class="line">tmpfs          tmpfs     920M   24K  920M    1% /dev/shm</span><br><span class="line">tmpfs          tmpfs     920M  500K  919M    1% /run</span><br><span class="line">tmpfs          tmpfs     920M     0  920M    0% /sys/fs/cgroup</span><br><span class="line">tmpfs          tmpfs     184M     0  184M    0% /run/user/0</span><br></pre></td></tr></table></figure>

<p>-T, –print-type   print file system type</p>
<p>-h, –human-readable print sizes in human readable format (e.g., 1K 234M 2G)</p>
<h3 id="Linux-目录结构"><a href="#Linux-目录结构" class="headerlink" title="Linux 目录结构"></a>Linux 目录结构</h3><blockquote>
<p><a href="https://www.runoob.com/linux/linux-system-contents.html" target="_blank" rel="noopener">Linux 系统目录结构| 菜鸟教程</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos /]<span class="comment"># ls -la</span></span><br><span class="line">总用量 80</span><br><span class="line">dr-xr-xr-x. 19 root root  4096 8月  18 12:14 .</span><br><span class="line">dr-xr-xr-x. 19 root root  4096 8月  18 12:14 ..</span><br><span class="line">lrwxrwxrwx.  1 root root     7 8月   8 2018 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x  19 root root  2980 8月  17 19:35 dev</span><br><span class="line">drwxr-xr-x. 93 root root 12288 8月  18 12:07 etc</span><br><span class="line">drwxr-xr-x.  2 root root  4096 4月  11 2018 home</span><br><span class="line">lrwxrwxrwx.  1 root root     7 8月   8 2018 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.  1 root root     8 8月   8 2018 sbin -&gt; usr/sbin</span><br><span class="line">dr-xr-xr-x  13 root root     0 8月  17 19:34 sys</span><br><span class="line">drwxrwxrwt.  8 root root  4096 8月  18 12:07 tmp</span><br><span class="line">drwxr-xr-x. 13 root root  4096 8月   8 2018 usr</span><br><span class="line">drwxr-xr-x. 19 root root  4096 1月  21 2019 var</span><br></pre></td></tr></table></figure>

<p>第一列是文件/目录及权限信息，前面的<code>d</code>代表目录，后面九位是权限信息， <code>r</code>代表读，<code>w</code>代表写，<code>x</code>代表可执行，分为三组，第一组是用户权限，第二组是组权限，第三组是其他用户权限。</p>
<h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>/home：用户目录</p>
<p>/etc：配置目录</p>
<p>/sys：系统目录</p>
<p>/usr：存放用户应用程序</p>
<p>/usr/sbin：存放超级用户使用的比较高级的管理程序和系统守护程序</p>
<p>/var：这个目录中存放着在不断扩充着的东西，习惯将那些经常被修改的目录放在这个目录下，包括各种日志文件</p>
<h3 id="CPU-内存-进程"><a href="#CPU-内存-进程" class="headerlink" title="CPU/内存/进程"></a>CPU/内存/进程</h3><h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ~]<span class="comment"># top</span></span><br><span class="line"></span><br><span class="line">top - 12:27:26 up 16:52,  2 users,  load average: 0.01, 0.02, 0.05</span><br><span class="line">Tasks:  73 total,   1 running,  72 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :  1882752 total,   724016 free,    99704 used,  1059032 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  1599800 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     </span><br><span class="line">  538 root      20   0  588564  11116   3240 S  0.3  0.6   1:26.72 YDService   </span><br><span class="line"> 1418 root      20   0  611520  13664   2364 S  0.3  0.7   3:21.65 barad_agent </span><br><span class="line">    1 root      20   0   43424   3712   2536 S  0.0  0.2   0:04.43 systemd</span><br></pre></td></tr></table></figure>

<p><code>Tasks:  73 total,   1 running,  72 sleeping,   0 stopped,   0 zombie</code></p>
<p>总共73个进程</p>
<h4 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:PORT</span><br></pre></td></tr></table></figure>

<p>查看端口占用情况</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ~]<span class="comment"># lsof -i:22</span></span><br><span class="line">COMMAND  PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">sshd    1330 root    3u  IPv4   16009      0t0  TCP *:ssh (LISTEN)</span><br><span class="line">sshd    3044 root    3u  IPv4 5509477      0t0  TCP VM-0-10-centos:ssh-&gt;113.89.97.17:44541 (ESTABLISHED)</span><br></pre></td></tr></table></figure>



<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><h4 id="编辑后不保存"><a href="#编辑后不保存" class="headerlink" title="编辑后不保存"></a>编辑后不保存</h4><p><code>:q!</code></p>
<h4 id="追加内容"><a href="#追加内容" class="headerlink" title="追加内容"></a>追加内容</h4><p><code>echo &#39;xxxxx&#39; &gt;&gt; filename</code></p>
<h4 id="覆盖"><a href="#覆盖" class="headerlink" title="覆盖"></a>覆盖</h4><p><code>echo &#39;xxxx&#39; &gt; filename</code></p>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p><code>wget url</code></p>
<h4 id="解压缩"><a href="#解压缩" class="headerlink" title="解压缩"></a>解压缩</h4><p>解压<code>apache-tomcat-8.5.57.tar.gz</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar zxvf apache-tomcat-8.5.57.tar.gz</span><br></pre></td></tr></table></figure>

<p>-z, –gzip, –gunzip, –ungzip  通过 gzip 过滤归档（<code>.gz</code>结尾）</p>
<p>-x, –extract, –get    从归档中解出文件</p>
<p>-f, –file=ARCHIVE     使用归档文件或 ARCHIVE 设备</p>
<p>​     –force-local</p>
<p>-v, –verbose       详细地列出处理的文件</p>
<p>​     –warning=KEYWORD   警告控制:</p>
<p>压缩</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar zcvf apache-tomcat-8.5.57</span><br></pre></td></tr></table></figure>

<p>-c, –create        创建一个新归档</p>
<h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><p>查看名字中包含<code>docker</code>的进程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep docker</span><br></pre></td></tr></table></figure>

<h4 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h4><p>终止进程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 PID</span><br></pre></td></tr></table></figure>

<h4 id="查看服务运行状态"><a href="#查看服务运行状态" class="headerlink" title="查看服务运行状态"></a>查看服务运行状态</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ssh]<span class="comment"># service sshd status</span></span><br><span class="line">Redirecting to /bin/systemctl status sshd.service</span><br><span class="line">● sshd.service - OpenSSH server daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since 一 2020-08-17 19:35:09 CST; 1 weeks 1 days ago</span><br><span class="line">     Docs: man:sshd(8)</span><br><span class="line">           man:sshd_config(5)</span><br><span class="line"> Main PID: 1330 (sshd)</span><br><span class="line">   CGroup: /system.slice/sshd.service</span><br><span class="line">           └─1330 /usr/sbin/sshd -D</span><br><span class="line"></span><br><span class="line">8月 26 18:20:39 VM-0-10-centos sshd[3137]: Disconnected from 45.84.196.88 p...]</span><br><span class="line">8月 26 18:20:42 VM-0-10-centos sshd[3143]: Invalid user usuario from 45.84....4</span><br><span class="line">8月 26 18:20:42 VM-0-10-centos sshd[3143]: input_userauth_request: invalid ...]</span><br><span class="line">8月 26 18:20:42 VM-0-10-centos sshd[3143]: Received disconnect from 45.84.1...]</span><br><span class="line">8月 26 18:20:42 VM-0-10-centos sshd[3143]: Disconnected from 45.84.196.88 p...]</span><br><span class="line">8月 26 18:20:44 VM-0-10-centos sshd[3151]: Invalid user support from 45.84....0</span><br><span class="line">8月 26 18:20:44 VM-0-10-centos sshd[3151]: input_userauth_request: invalid ...]</span><br><span class="line">8月 26 18:20:44 VM-0-10-centos sshd[3151]: Received disconnect from 45.84.1...]</span><br><span class="line">8月 26 18:20:44 VM-0-10-centos sshd[3151]: Disconnected from 45.84.196.88 p...]</span><br><span class="line">8月 26 18:21:41 VM-0-10-centos sshd[3269]: Connection reset by 40.121.0.183...]</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure>

<h3 id="关闭服务"><a href="#关闭服务" class="headerlink" title="关闭服务"></a>关闭服务</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service sshd stop</span><br></pre></td></tr></table></figure>

<h3 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>

<h4 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h4><p>systemctl 命令是系统服务管理器指令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br></pre></td></tr></table></figure>

<h5 id="systemctl-和-service、chkconfig-命令的关系"><a href="#systemctl-和-service、chkconfig-命令的关系" class="headerlink" title="systemctl 和 service、chkconfig 命令的关系"></a>systemctl 和 service、chkconfig 命令的关系</h5><ul>
<li>systemctl命令：是一个systemd工具，主要负责控制systemd系统和服务管理器。</li>
<li>service命令：可以启动、停止、重新启动和关闭系统服务，还可以显示所有系统服务的当前状态。</li>
<li>chkconfig命令：是管理系统服务(service)的命令行工具。所谓系统服务(service)，就是随系统启动而启动，随系统关闭而关闭的程序。</li>
</ul>
<p>systemctl命令是系统服务管理器指令，它实际上将 service 和 chkconfig 这两个命令组合到一起。</p>
<p><strong>所以systemctl命令是service命令和chkconfig命令的集合和代替。</strong></p>
<p>如何改ssh端口？</p>
<h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -anlp | grep sshd</span><br></pre></td></tr></table></figure>

<p>-a, –all        display all sockets (default: connected)</p>
<p>-n, –numeric      don’t resolve names</p>
<p>-l, –listening     display listening server sockets</p>
<p>-p, –programs      display PID/Program name for sockets</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ssh]<span class="comment"># netstat -anlp | grep sshd</span></span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1330/sshd           </span><br><span class="line">tcp        0     36 172.17.0.10:22          113.89.97.17:44541      ESTABLISHED 3044/sshd: root@pts </span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16005    1330/sshd            </span><br><span class="line">unix  2      [ ]         DGRAM                    5509550  3044/sshd: root@pts</span><br></pre></td></tr></table></figure>

<h4 id="semanage"><a href="#semanage" class="headerlink" title="semanage"></a>semanage</h4><blockquote>
<p>semanage 命令是用来查询与修改 SELinux 默认目录的安全上下文。</p>
<p>SELinux(Security-Enhanced Linux) 是一个Linux内核的安全模块，其提供了访问控制安全策略机制，包括了强制访问控制。</p>
</blockquote>
<p>添加端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">semanage port -a -t ssh_port_t -p tcp 10022</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">semanage port -l | grep ssh</span><br></pre></td></tr></table></figure>



<h4 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum whatprovides semanage</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y policycoreutils-python</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">docker-client \</span><br><span class="line">docker-client-latest \</span><br><span class="line">docker-common \</span><br><span class="line">docekr-latest \</span><br><span class="line">docker-latest-logrotate \</span><br><span class="line">docker-logrotate \</span><br><span class="line">docker-engine</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils \</span><br><span class="line">device-mapper-persistent-data \</span><br><span class="line">lvm2</span><br></pre></td></tr></table></figure>

<h3 id="Centos-7-修改-SSH-端口"><a href="#Centos-7-修改-SSH-端口" class="headerlink" title="Centos 7 修改 SSH 端口"></a>Centos 7 修改 SSH 端口</h3><ol>
<li><p>修改ssh配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--- old ---</span><br><span class="line">#Port 22</span><br><span class="line">--- new ---</span><br><span class="line">Port 22</span><br><span class="line">Port 10022</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启ssh服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>

<p>查看端口是否生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -anlp | grep sshd</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果开启了防火墙，需要将新端口添加进去</p>
<p>查看防火墙是否开启</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ssh]<span class="comment"># firewall-cmd --state</span></span><br><span class="line">not running</span><br></pre></td></tr></table></figure>

<p>开启防火墙</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start firewall.service</span><br></pre></td></tr></table></figure>

<p>防火墙添加端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=10022/tcp --permanent</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">--permanent          Set an option permanently</span><br><span class="line">                     Usable <span class="keyword">for</span> options marked with [P]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">                     Load zone default settings [P only] [Z]</span><br><span class="line">--zone=&lt;zone&gt;        Use this zone to <span class="built_in">set</span> or query options, <span class="keyword">else</span> default zone</span><br><span class="line">                     Usable <span class="keyword">for</span> options marked with [Z]</span><br></pre></td></tr></table></figure>

<p>重载防火墙</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果开启了SELinux，也需要将新端口添加进去</p>
<p>查看 SELinux 状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-0-10-centos ~]<span class="comment"># sestatus -v | grep SELinux</span></span><br><span class="line">SELinux status:                 disabled</span><br></pre></td></tr></table></figure>

<p>开启 SELinux</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br><span class="line"></span><br><span class="line">SELINUX=enforcing</span><br></pre></td></tr></table></figure>

<p>重启服务器即可生效</p>
<p>查看 SELinux 允许的 ssh 端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">semanage port -l | grep ssh</span><br></pre></td></tr></table></figure>

<p>SELinux 添加端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">semanage port -a -t ssh_port_t -p tcp 10022</span><br></pre></td></tr></table></figure>

<p>然后确认一下是否添加进去</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">semanage port -l | grep ssh</span><br></pre></td></tr></table></figure>

<p>如果成功会输出</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh_port_t          tcp  10022, 22</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><blockquote>
<p><a href="http://www.toimc.com" target="_blank" rel="noopener">www.toimc.com</a></p>
</blockquote>
<h4 id="Docker-VS-虚拟机"><a href="#Docker-VS-虚拟机" class="headerlink" title="Docker VS 虚拟机"></a>Docker VS 虚拟机</h4><h4 id="Docker主要特性"><a href="#Docker主要特性" class="headerlink" title="Docker主要特性"></a>Docker主要特性</h4><p>对文件、资源、网络进行隔离</p>
<p>变更管理、日志记录</p>
<p>写时复制</p>
<p>Docker Compose</p>
<p>Docker hub、Harbor</p>
<h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h2><p>什么是nodejs？</p>
<ul>
<li><p>免费、开源、跨平台</p>
</li>
<li><p>服务器上的javascript运行环境</p>
</li>
<li><p>基于Chrome V8引擎，事件驱动，非阻塞式I/O</p>
<p>事件驱动：餐厅举手叫服务员(事件)，服务员(函数)响应</p>
<p>非阻塞式I/O：排队叫号</p>
</li>
</ul>
<h3 id="包管理工具"><a href="#包管理工具" class="headerlink" title="包管理工具"></a>包管理工具</h3><p>npm、cnpm</p>
<p>yarn</p>
<h3 id="node版本管理工具"><a href="#node版本管理工具" class="headerlink" title="node版本管理工具"></a>node版本管理工具</h3><p>nvm、nvm-windows</p>
<p>如何发布一个自己的node模块</p>
<p><code>npm add user</code></p>
<p><code>yarn add xxx</code>等同于<code>nom install xxx -S</code></p>
]]></content>
  </entry>
  <entry>
    <title>Build Your Blog with GitHub Pages+Hexo+NexT</title>
    <url>/2018/12/15/Build-Your-Blog-with-GitHub-Pages-Hexo-NexT/</url>
    <content><![CDATA[<p><img data-src="https://i.loli.net/2018/12/26/5c231d3ac8a4c.jpg" alt="NexT"></p>
<a id="more"></a>

<blockquote>
<p>环境：</p>
<p>Windows 10，x64</p>
<p>node.js v10.14.2</p>
<p>npm 6.5.0</p>
</blockquote>
<h2 id="GitHub创建Github-Pages项目"><a href="#GitHub创建Github-Pages项目" class="headerlink" title="GitHub创建Github Pages项目"></a>GitHub创建Github Pages项目</h2><p>创建一个名称为<code>username.github.io</code>的新仓库。username为你的GitHub账号用户名。</p>
<h2 id="搭建Hexo环境"><a href="#搭建Hexo环境" class="headerlink" title="搭建Hexo环境"></a>搭建Hexo环境</h2><h3 id="安装node-js"><a href="#安装node-js" class="headerlink" title="安装node.js"></a>安装node.js</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><blockquote>
<p><a href="https://www.zhihu.com/question/33578075" target="_blank" rel="noopener">Node.js是用来做什么的？ - 知乎</a></p>
</blockquote>
<p><strong>Node.js</strong>是一个 JavaScript 运行环境。</p>
<h4 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h4><p>去<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener">官网</a>下载对应版本</p>
<p>下载完后双击傻瓜式安装即可</p>
<p>安装完后<strong>win+R</strong> 输入<strong>cmd</strong>打开终端，然后输入<code>node -v</code>即可查看Node版本</p>
<h3 id="安装npm"><a href="#安装npm" class="headerlink" title="安装npm"></a>安装npm</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><p>npm是Node.js的包管理工具</p>
<blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/00143450141843488beddae2a1044cab5acb5125baf0882000" target="_blank" rel="noopener">npm安装 - 安装Node.js和npm - 廖雪峰的官方网站</a></p>
<p>为啥我们需要一个包管理工具呢？因为我们在Node.js上开发时，会用到很多别人写的JavaScript代码。如果我们要使用别人写的某个包，每次都根据名称搜索一下官方网站，下载代码，解压，再使用，非常繁琐。于是一个集中管理的工具应运而生：大家都把自己开发的模块打包后放到npm官网上，如果要使用，直接通过npm安装就可以直接用，不用管代码存在哪，应该从哪下载。</p>
<p>更重要的是，如果我们要使用模块A，而模块A又依赖于模块B，模块B又依赖于模块X和模块Y，npm可以根据依赖关系，把所有依赖的包都下载下来并管理起来。否则，靠我们自己手动管理，肯定既麻烦又容易出错。</p>
</blockquote>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>安装完Node.js以后npm已经顺带被安装了。</p>
<p>命令行输入<code>npm -v</code>即可查看npm版本信息。</p>
<h3 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure>

<h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>新建一个空文件夹，在该目录下右键选择<code>Git Bash Here</code>（需要安装<a href="https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%AE%89%E8%A3%85-Git" target="_blank" rel="noopener">Git客户端</a>）</p>
<p>执行命令（需要注意的是该命令必须在空目录下执行）：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>

<p>安装依赖：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<h2 id="利用Travis-CI自动发布博客"><a href="#利用Travis-CI自动发布博客" class="headerlink" title="利用Travis-CI自动发布博客"></a>利用Travis-CI自动发布博客</h2><blockquote>
<p>hexo生成的静态文件统一存放在public目录下，其余的文件都是hexo用来生成静态网页的。</p>
<p>为了能够适应不同环境（不同主机、不同系统、甚至在GitHub网页端操作等），可以利用Travis-CI对hexo进行<a href="http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html" target="_blank" rel="noopener">持续集成</a> 。</p>
</blockquote>
<h3 id="远程仓库创建hexo分支对hexo源码进行版本控制"><a href="#远程仓库创建hexo分支对hexo源码进行版本控制" class="headerlink" title="远程仓库创建hexo分支对hexo源码进行版本控制"></a>远程仓库创建hexo分支对hexo源码进行版本控制</h3><ol>
<li><p>将远程仓库clone到本地</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/username/username.github.io.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建本地分支hexo并切换到该分支</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -b hexo</span><br></pre></td></tr></table></figure>
</li>
<li><p>将本地仓库里的文件清空（除了<code>.git</code>文件），替换为hexo源码文件（即<code>hexo init</code>生成的那些文件）。</p>
</li>
<li><p>添加并提交到本地仓库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m "提交信息"</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建并提交到远程hexo分支</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push --set-upstream origin hexo</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="GitHub生成Access-Token"><a href="#GitHub生成Access-Token" class="headerlink" title="GitHub生成Access Token"></a>GitHub生成Access Token</h3><p>头像&gt;Settings&gt;Developer settings&gt;Personal access tokens</p>
<p>点击Generate new token生成一个token</p>
<p><img data-src="https://i.loli.net/2018/12/15/5c14c217c5fb9.jpg" alt=""></p>
<p>注意：token生成后只又一次查看的机会，一定要保存好，否则要删掉重新生成</p>
<h3 id="设置Travis-CI"><a href="#设置Travis-CI" class="headerlink" title="设置Travis-CI"></a>设置Travis-CI</h3><p>使用GitHub账号登录<a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis-CI</a></p>
<p><img data-src="https://i.loli.net/2018/12/15/5c14c08f2392e.jpg" alt=""></p>
<p>点击Settings，将GitHub生成的token添加到里面</p>
<p><img data-src="https://i.loli.net/2018/12/15/5c14c305516b7.jpg" alt=""></p>
<h3 id="hexo源码仓库中添加Travis-CI的配置文件-travis-yml"><a href="#hexo源码仓库中添加Travis-CI的配置文件-travis-yml" class="headerlink" title="hexo源码仓库中添加Travis-CI的配置文件.travis.yml"></a>hexo源码仓库中添加Travis-CI的配置文件<code>.travis.yml</code></h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">node_js</span>  <span class="comment">#设置语言</span></span><br><span class="line"></span><br><span class="line"><span class="attr">node_js:</span> <span class="string">stable</span>  <span class="comment">#设置相应的版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 开始构建</span></span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">export</span> <span class="string">TZ='Asia/Shanghai'</span>  <span class="comment">#统一构建环境和博客配置的时区, 防止文章时间错误</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span>  <span class="comment">#配置Hexo环境</span></span><br><span class="line"></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">cl</span>  <span class="comment">#清除</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">g</span>  <span class="comment">#生成</span></span><br><span class="line"></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">clone</span> <span class="string">https://$&#123;GH_REF&#125;</span> <span class="string">.deploy_git</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cd</span> <span class="string">.deploy_git</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">checkout</span> <span class="string">master</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cd</span> <span class="string">../</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mv</span> <span class="string">.deploy_git/.git/</span> <span class="string">./public/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cd</span> <span class="string">./public</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">user.name</span> <span class="string">"username"</span>  <span class="comment">#github用户名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">user.email</span> <span class="string">"email@xxx.com"</span>  <span class="comment">#邮箱</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">commit</span> <span class="string">-m</span> <span class="string">"Travis CI Auto Builder at `date +"</span><span class="string">%Y-%m-%d</span> <span class="string">%H:%M"`"</span>  <span class="comment">#提交时的说明</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">push</span> <span class="string">--force</span> <span class="string">--quiet</span> <span class="string">"https://$&#123;GH_TOKEN&#125;@$&#123;GH_REF&#125;"</span> <span class="string">master:master</span>  <span class="comment">#GH_TOKEN是在Travis中配置Token的名称</span></span><br><span class="line"><span class="comment">## 结束构建</span></span><br><span class="line"></span><br><span class="line"><span class="attr">branches:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hexo</span>  <span class="comment">#只监测master之外新增的hexo分支</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line"> <span class="attr">global:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">GH_REF:</span> <span class="string">github.com/username/username.github.io.git</span>  <span class="comment">#设置GH_REF</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">directories:</span>  <span class="comment">#缓存特定目录, 加快构建速度</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node_modules</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理图</p>
<p><img data-src="https://i.loli.net/2018/12/25/5c219ecc93bcd.png" alt=""></p>
</blockquote>
<h2 id="主题优化"><a href="#主题优化" class="headerlink" title="主题优化"></a>主题优化</h2><blockquote>
<p><a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">NexT使用文档</a></p>
</blockquote>
<h3 id="文章预览"><a href="#文章预览" class="headerlink" title="文章预览"></a>文章预览</h3><blockquote>
<p><a href="http://theme-next.iissnan.com/faqs.html#read-more" target="_blank" rel="noopener">如何设置「阅读全文」？</a></p>
</blockquote>
<h4 id="文章封面"><a href="#文章封面" class="headerlink" title="文章封面"></a>文章封面</h4><ol>
<li><p>关闭<strong>主体配置文件</strong>中的<code>Automatically Excerpt</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Automatically excerpt description in homepage as preamble text.</span></span><br><span class="line"><span class="attr">excerpt_description:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatically Excerpt. Not recommend.</span></span><br><span class="line"><span class="comment"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</span></span><br><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">150</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>手动截断标签</code>上只放一张图片即可</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">![NexT](https://i.loli.net/2018/12/26/5c231d3ac8a4c.jpg)</span><br><span class="line"><span class="comment">&lt;!-- more --&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="评论系统"><a href="#评论系统" class="headerlink" title="评论系统"></a>评论系统</h3><blockquote>
<p><a href="https://ryanluoxu.github.io/2017/11/27/Hexo-Next-%E6%B7%BB%E5%8A%A0-Gitment-%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/" target="_blank" rel="noopener">Hexo-Next 添加 Gitment 评论系统</a></p>
<p><a href="https://xiaotiandi.github.io/publicBlog/2018-09-19-d196c9ad.html" target="_blank" rel="noopener">hexo博客配置-添加评论系统-gitment和valine-需注册</a></p>
<p><a href="https://meesong.github.io/StaticBlog/2017/NexT+Gitment/" target="_blank" rel="noopener">为 hexo NexT 添加 Gitment 评论插件</a></p>
<p><a href="https://github.com/gitalk/gitalk/wiki/%E5%9C%A8hexo-next%E4%B8%BB%E9%A2%98%E4%B8%8A%E4%BD%BF%E7%94%A8gitalk" target="_blank" rel="noopener">在hexo next主题上使用gitalk</a></p>
<p><a href="https://www.bluelzy.com/articles/use_valine_for_your_blog.html" target="_blank" rel="noopener">为你的Hexo加上评论系统-Valine</a></p>
</blockquote>
<p><img data-src="https://i.loli.net/2018/12/17/5c171d0e2a281.jpg" alt=""></p>
<p><img data-src="https://i.loli.net/2018/12/17/5c171f261cf6c.jpg" alt=""></p>
<p>由于gitment长期未维护,所有最后使用gitalk,之后可以增加其他三方的评论插件更加灵活.</p>
<p>如需取消某个 页面/文章 的评论，在 md 文件的 <a href="https://hexo.io/docs/front-matter.html" target="_blank" rel="noopener">front-matter </a>中增加 <code>comments: false</code></p>
<h3 id="自定义内建标签"><a href="#自定义内建标签" class="headerlink" title="自定义内建标签"></a>自定义内建标签</h3><blockquote>
<p><a href="https://blog.rmiao.top/hexo-fold-block/" target="_blank" rel="noopener">Hexo next博客添加折叠块功能添加折叠代码块</a></p>
</blockquote>
<h3 id="进度条"><a href="#进度条" class="headerlink" title="进度条"></a>进度条</h3><blockquote>
<p><a href="https://github.com/theme-next/theme-next-pace" target="_blank" rel="noopener"><strong>theme-next-pace</strong></a></p>
</blockquote>
<h3 id="自定义页面样式"><a href="#自定义页面样式" class="headerlink" title="自定义页面样式"></a>自定义页面样式</h3><blockquote>
<p><a href="http://www.cduyzh.com/hexo-settings-3/" target="_blank" rel="noopener">2017年最新基于hexo搭建个人免费博客——自定义页面样式一</a></p>
<p><a href="https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html#%E4%BC%98%E5%8C%96-%E7%BD%91%E9%A1%B5%E6%A0%B7%E5%BC%8F%E5%B8%83%E5%B1%80" target="_blank" rel="noopener">优化 网页样式布局</a></p>
</blockquote>
<h4 id="调整文章元信息区域离文章主体的间距"><a href="#调整文章元信息区域离文章主体的间距" class="headerlink" title="调整文章元信息区域离文章主体的间距"></a>调整文章元信息区域离文章主体的间距</h4><p>一般文章都会添加<code>description</code>和一张图片作为封面，但元信息离正文太远视野上不舒服，故做如下调整。</p>
<p><img data-src="https://i.loli.net/2018/12/26/5c23347219069.jpg" alt="Before"></p>
<p>修改<code>themes\next\source\css\_common\components\post\post-meta.styl</code>如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// before</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-meta</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">3px</span> <span class="number">0</span> <span class="number">60px</span> <span class="number">0</span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// after</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-meta</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">3px</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="显示文章更新时间"><a href="#显示文章更新时间" class="headerlink" title="显示文章更新时间"></a>显示文章更新时间</h3><blockquote>
<p><a href="https://blog.csdn.net/ganzhilin520/article/details/79053399" target="_blank" rel="noopener"><del>hexo添加文章更新时间</del></a></p>
</blockquote>
<p>修改主题配置文件的</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">post_meta:</span></span><br><span class="line">  <span class="attr">updated_at:</span> </span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>要想具体显示到时分秒,则修改站点配置文件的</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>

<h3 id="复制代码按钮"><a href="#复制代码按钮" class="headerlink" title="复制代码按钮"></a>复制代码按钮</h3><blockquote>
<p><a href="https://www.ofind.cn/blog/HEXO/HEXO%E4%BC%98%E5%8C%96%E4%B9%8B%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%B7%BB%E5%8A%A0%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD.html" target="_blank" rel="noopener"><del>HEXO优化之（二）—-添加复制功能</del></a></p>
<p><a href="http://www.missfli.com/2018/06/19/github-hexo-next-08.html" target="_blank" rel="noopener">Hexo NexT主题代码块添加复制功能</a></p>
</blockquote>
<h3 id="显示当前浏览进度"><a href="#显示当前浏览进度" class="headerlink" title="显示当前浏览进度"></a>显示当前浏览进度</h3><blockquote>
<p><a href="https://www.jianshu.com/p/3ff20be8574c" target="_blank" rel="noopener">7.浏览页面的时候显示当前浏览进度</a></p>
</blockquote>
<h3 id="背景图片"><a href="#背景图片" class="headerlink" title="背景图片"></a>背景图片</h3><blockquote>
<p><a href="https://www.simon96.online/2018/10/12/hexo-tutorial/#%E6%B7%BB%E5%8A%A0%E8%83%8C%E6%99%AF%E5%9B%BE" target="_blank" rel="noopener">添加背景图</a></p>
</blockquote>
<h3 id="文章加密"><a href="#文章加密" class="headerlink" title="文章加密"></a>文章加密</h3><blockquote>
<p><a href="https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md" target="_blank" rel="noopener">hexo-blog-encrypt</a></p>
</blockquote>
<p>注意实在<strong>站点配置文件</strong>中添加</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Security</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="attr">encrypt:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="给文章添加密码："><a href="#给文章添加密码：" class="headerlink" title="给文章添加密码："></a>给文章添加密码：</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: hello world</span><br><span class="line">date: 2016-03-30 21:18:02</span><br><span class="line">tags:</span><br><span class="line">    - fdsfadsfa</span><br><span class="line">    - fdsafsdaf</span><br><span class="line">password: Mike</span><br><span class="line">abstract: Welcome to my blog, enter password to read.</span><br><span class="line">message: Welcome to my blog, enter password to read.</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<ul>
<li>password: 是该博客加密使用的密码</li>
<li>abstract: 是该博客的摘要，会显示在博客的列表页</li>
<li>message: 这个是博客查看时，密码输入框上面的描述性文字</li>
</ul>
<h3 id="二次元看板娘"><a href="#二次元看板娘" class="headerlink" title="二次元看板娘"></a>二次元看板娘</h3><blockquote>
<p><a href="https://github.com/EYHN/hexo-helper-live2d/blob/master/README.zh-CN.md" target="_blank" rel="noopener">hexo-helper-live2d</a></p>
</blockquote>
<h3 id="站内搜索"><a href="#站内搜索" class="headerlink" title="站内搜索"></a>站内搜索</h3><blockquote>
<p><a href="https://github.com/theme-next/hexo-generator-searchdb" target="_blank" rel="noopener">theme-next/<strong>hexo-generator-searchdb</strong></a></p>
</blockquote>
<ol>
<li><p><code>npm install hexo-generator-searchdb --save</code></p>
</li>
<li><p><strong>站点配置文件</strong>中添加如下配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>主题配置文件</strong>中打开如下配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/theme-next/hexo-generator-searchdb</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="文章置顶-置顶标签"><a href="#文章置顶-置顶标签" class="headerlink" title="文章置顶+置顶标签"></a>文章置顶+置顶标签</h3><blockquote>
<p><a href="https://blog.csdn.net/qwerty200696/article/details/79010629" target="_blank" rel="noopener">hexo博客优化之文章置顶+置顶标签</a></p>
<p><a href="https://github.mayuxiao.com/swig.zh-CN/docs/index.html#comments" target="_blank" rel="noopener">Swig » 文档 » 注释</a></p>
</blockquote>
<ol>
<li><p>使用插件<a href="https://github.com/netcan/hexo-generator-index-pin-top" target="_blank" rel="noopener">hexo-generator-index-pin-top</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm uninstall hexo-generator-index --save</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install hexo-generator-index-pin-top --save</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在需要置顶的文章的<code>Front-matter</code>中加上<code>top: true</code></p>
</li>
<li><p><code>/blog/themes/next/layout/_macro</code> 目录下的<code>post.swig</code>文件，定位到<code>&lt;div class=&quot;post-meta&quot;&gt;</code>标签下，做如下修改：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"post-meta"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"post-time"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            &#123;% set date_diff = date(post.date) != date(post.updated) %&#125;</span><br><span class="line">            &#123;% set time_diff = time(post.date) != time(post.updated) %&#125;</span><br><span class="line">            &#123;% set datetime_diff = date_diff or time_diff %&#125;</span><br><span class="line"></span><br><span class="line">            &#123;# 置顶标签 #&#125;</span><br><span class="line">            &#123;% if post.top %&#125;</span><br><span class="line">              <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-thumb-tack"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">FFC0CB</span>&gt;</span>置顶<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"post-meta-divider"</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            &#123;# 置顶标签 #&#125;</span><br><span class="line">            ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="版权声明"><a href="#版权声明" class="headerlink" title="版权声明"></a>版权声明</h3><blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/20641764" target="_blank" rel="noopener">“知识共享”（CC协议）简单介绍</a></p>
</blockquote>
<ol>
<li><p>修改<strong>主题配置文件</strong>中如下配置：</p>
 <figure class="highlight yaml"><figcaption><span>\source\_data</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># Creative Commons 4.0 International License.</span></span><br><span class="line"><span class="comment"># https://creativecommons.org/share-your-work/licensing-types-examples</span></span><br><span class="line"><span class="comment"># Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</span></span><br><span class="line"><span class="attr">creative_commons:</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">by-nc-sa</span></span><br><span class="line">  <span class="attr">sidebar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">post:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<strong>站点配置文件</strong>中如下配置：</p>
<figure class="highlight yml"><figcaption><span>_config.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">http://username.github.io</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="首页隐藏指定文章"><a href="#首页隐藏指定文章" class="headerlink" title="首页隐藏指定文章"></a>首页隐藏指定文章</h3><blockquote>
<p><a href="https://blog.csdn.net/m0_37323771/article/details/80672271" target="_blank" rel="noopener">Hexo 设置首页隐藏指定文章</a></p>
</blockquote>
<ol>
<li><p>对主题 index.swig 文件做如下修改</p>
<figure class="highlight javascript"><figcaption><span>Hexo\themes\next\layout</span></figcaption><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> post <span class="keyword">in</span> page.posts %&#125;</span><br><span class="line">	&#123;# 首页隐藏指定文章 #&#125;</span><br><span class="line">	&#123;% <span class="keyword">if</span> post.hidden != <span class="literal">true</span> %&#125;</span><br><span class="line">        &#123;&#123; post_template.render(post, <span class="literal">true</span>) &#125;&#125;</span><br><span class="line">	&#123;% endif %&#125;</span><br><span class="line">	&#123;# 首页隐藏指定文章 #&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在需要首页隐藏的文章 front-matter 中添加 <code>hidden: true</code></p>
</li>
</ol>
<h3 id="Emoji-表情"><a href="#Emoji-表情" class="headerlink" title="Emoji 表情"></a>Emoji 表情</h3><blockquote>
<p><a href="https://chaxiaoniu.oschina.io/2017/07/10/HexoAddEmoji/" target="_blank" rel="noopener">Hexo中添加emoji表情</a></p>
<p>Hexo默认采用 <a href="https://github.com/hexojs/hexo-renderer-marked" target="_blank" rel="noopener">hexo-renderer-marked</a> 这个渲染器，但其不支持插件扩展。还有一个支持插件扩展的是 <a href="https://github.com/hexojs/hexo-renderer-markdown-it" target="_blank" rel="noopener">hexo-renderer-markdown-it</a>，可以使用 <a href="https://github.com/markdown-it/markdown-it-emoji" target="_blank" rel="noopener">markdwon-it-emoji</a> 插件来支持 emoji。</p>
</blockquote>
<ol>
<li><p>替换渲染器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm un hexo-renderer-marked --save</span><br><span class="line">npm i hexo-renderer-markdown-it --save</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装<code>markdown-it-emoji</code>插件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i markdown-it-emoji --save</span><br></pre></td></tr></table></figure>
</li>
<li><p>站点配置文件添加 markdown-it 配置</p>
<figure class="highlight shell"><figcaption><span>_config.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># hexo-renderer-markdown-it</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Markdown-it config</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Docs: https://github.com/celsomiranda/hexo-renderer-markdown-it/wiki</span></span></span><br><span class="line">markdown:</span><br><span class="line">  render:</span><br><span class="line">    html: true</span><br><span class="line">    xhtmlOut: false</span><br><span class="line">    breaks: true</span><br><span class="line">    linkify: true</span><br><span class="line">    typographer: true</span><br><span class="line">    quotes: '“”‘’'</span><br><span class="line">  plugins:</span><br><span class="line">    - markdown-it-abbr</span><br><span class="line">    - markdown-it-footnote</span><br><span class="line">    - markdown-it-ins</span><br><span class="line">    - markdown-it-sub</span><br><span class="line">    - markdown-it-sup</span><br><span class="line">    - markdown-it-emoji  ## add emoji</span><br><span class="line">  anchors:</span><br><span class="line">    level: 2</span><br><span class="line">    collisionSuffix: 'v'</span><br><span class="line">    # If `true`, creates an anchor tag with a permalink besides the heading.</span><br><span class="line">    permalink: false</span><br><span class="line">    permalinkClass: header-anchor</span><br><span class="line">    # The symbol used to make the permalink</span><br><span class="line">    permalinkSymbol: ¶</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<p>在 <a href="https://www.webfx.com/tools/emoji-cheat-sheet/" target="_blank" rel="noopener">EMOJI CHEAT SHEET</a> 中找你想要的表情，点击即可复制。:smile:</p>
</li>
</ol>
<h3 id="文件下载功能"><a href="#文件下载功能" class="headerlink" title="文件下载功能"></a>文件下载功能</h3><ol>
<li>在 <code>source</code> 目录下，新建 <code>download</code> 目录</li>
<li>通过诸如 <code>[点击下载 xxx.pdf](/download/xxx.pdf)</code> 这样的链接，提供下载功能。</li>
</ol>
<h2 id="填坑记录"><a href="#填坑记录" class="headerlink" title="填坑记录"></a>填坑记录</h2><h3 id="选用主题后页面空白"><a href="#选用主题后页面空白" class="headerlink" title="选用主题后页面空白"></a>选用主题后页面空白</h3><p>原因：themes目录下主题相关文件未正确提交到远程仓库</p>
<p>解决：</p>
<ol>
<li><p>删除主题目录下的<code>.git</code>目录和<code>.gitignore</code>文件</p>
</li>
<li><p><code>git rm --cached 主题目录</code></p>
</li>
<li><p><code>git add 主题目录</code></p>
</li>
<li><p><code>git push</code></p>
</li>
</ol>
<h2 id="写作"><a href="#写作" class="headerlink" title="写作"></a>写作</h2><h3 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h3><blockquote>
<p><a href="https://hexo.io/zh-cn/docs/writing.html" target="_blank" rel="noopener">布局</a></p>
</blockquote>
<p>Hexo 有三种默认布局：<code>post</code>、<code>page</code> 和 <code>draft</code>，它们分别对应不同的路径，而您自定义的其他布局和 <code>post</code> 相同，都将储存到 <code>source/_posts</code> 文件夹。</p>
<table>
<thead>
<tr>
<th>布局</th>
<th>路径</th>
</tr>
</thead>
<tbody><tr>
<td>post</td>
<td>source/_posts</td>
</tr>
<tr>
<td>page</td>
<td>source</td>
</tr>
<tr>
<td>draft</td>
<td>source/_drafts</td>
</tr>
</tbody></table>
<h4 id="草稿"><a href="#草稿" class="headerlink" title="草稿"></a>草稿</h4><p>Hexo 的一种特殊布局：<code>draft</code>，这种布局在建立文章时会被保存到 <code>source/_drafts</code> 文件夹，您可通过 <code>publish</code> 命令将草稿移动到 <code>source/_posts</code> 文件夹。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo publish [layout] &lt;filename&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li><p><code>hexo new</code>命令新建文章时会将特殊字符（空格、加号等）转化为<code>-</code></p>
<p>eg：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo new <span class="string">"GitHub Pages+Hexo+NexT"</span></span></span><br><span class="line">INFO  Created: E:\xxx\Hexo\source\_posts\GitHub-Pages-Hexo-NexT.md</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2. 在使用&#96;publish&#96;命令发布草稿时需要用**文件名**，而不是文章标题</span><br><span class="line"></span><br><span class="line">   eg：</span><br><span class="line"></span><br><span class="line">   &#96;&#96;&#96;shell</span><br><span class="line">   $ hexo publish post GitHub-Pages-Hexo-NexT # post可以省略，因为layout默认就是post</span><br><span class="line">   INFO  Published: E:\Github\Hexo\source\_posts\GitHub-Pages-Hexo-NexT.md</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件名为空时默认发布第一篇草稿</p>
<p>eg：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo publish post .</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo publish post <span class="string">""</span></span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h3><p><a href="https://hexo.io/zh-cn/docs/tag-plugins.html#%E4%BB%A3%E7%A0%81%E5%9D%97" target="_blank" rel="noopener"><strong>指定语言，附加说明和网址</strong></a></p>
<ol>
<li><p>Hexo 格式</p>
<p>代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;% codeblock lang:java title http:<span class="comment">//www.baidu.com link test %&#125;</span></span><br><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="built_in">String</span>[] args) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">&#123;% endcodeblock %&#125;</span><br></pre></td></tr></table></figure>

<p>样式：</p>
<p><img data-src="https://i.loli.net/2019/01/04/5c2ec9c02da97.jpg" alt=""></p>
</li>
<li><p>Markdown 格式</p>
<p>代码：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">​<span class="code">```</span> java title http://www.baidu.com link test</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line"><span class="code">	...</span></span><br><span class="line">&#125;</span><br><span class="line">​</span><br></pre></td></tr></table></figure>

<p>样式：</p>
<p><img data-src="https://i.loli.net/2019/01/04/5c2ec9c02da97.jpg" alt=""></p>
</li>
</ol>
<h3 id="引用站内文章"><a href="#引用站内文章" class="headerlink" title="引用站内文章"></a>引用站内文章</h3><blockquote>
<p><a href="https://www.jibing57.com/2017/10/30/how-to-use-post-link-on-hexo/" target="_blank" rel="noopener">Hexo引用站内文章</a></p>
</blockquote>
<h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% post_link slug [title] %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>slug </p>
<p>_posts 文件夹下需要引用的文章的 markdown 文件的名字，不带后缀</p>
</li>
<li><p>title</p>
<p>链接显示的文字</p>
</li>
</ul>
<h4 id="eg："><a href="#eg：" class="headerlink" title="eg："></a>eg：</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% post_link Comments 留言板 %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h4><a href="/2019/01/03/Comments/" title="留言板">留言板</a>

<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><blockquote>
<p><a href="https://www.jianshu.com/p/c5d333e6353c" target="_blank" rel="noopener">next主题的模板引擎swig语法介绍</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>GitHub Pages</tag>
        <tag>Hexo</tag>
        <tag>NexT</tag>
      </tags>
  </entry>
  <entry>
    <title>Can not specify local image directly in Mini-Program of WeChat</title>
    <url>/2019/11/19/Can-not-specify-local-image-directly-in-Mini-Program-of-WeChat/</url>
    <content><![CDATA[<img data-src="http://static.chiefmore.com/u/cms/www/201806/15094709cpct.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p>微信小程序使用本地图片作为 background-image 时报错</p>
<p>background-image: url(“/images/bg.jpg”);</p>
<p><img data-src="http://code.py40.com/wp-content/uploads/2017/05/QQ_20170511110600.png" alt=""></p>
</blockquote>
<h2 id="设计理念"><a href="#设计理念" class="headerlink" title="设计理念"></a>设计理念</h2><p>小程序倡导的是“轻应用”，本身只允许 2M 大小的程序，图片又比较占空间，所以小程序不推荐使用本地图片。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="外链"><a href="#外链" class="headerlink" title="外链"></a>外链</h3><p>将图片放在服务器上，用远程图片链接地址代替。</p>
<h3 id="BASE64-编码"><a href="#BASE64-编码" class="headerlink" title="BASE64 编码"></a>BASE64 编码</h3><p>将图片进行 BASE64 编码，然后再使用。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">background-image: url("data:image/jpg;base64,iVBORw0KGgo=...");</span><br></pre></td></tr></table></figure>

<h3 id="image-标签"><a href="#image-标签" class="headerlink" title="image 标签"></a>image 标签</h3><blockquote>
<p><a href="https://www.zhangxinxu.com/wordpress/2017/08/css-percent-padding-image-layout/" target="_blank" rel="noopener">CSS百分比padding实现比例固定图片自适应布局« 张鑫旭-鑫 …</a></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"wapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"/images/bg.jpg"</span> <span class="attr">mode</span>=<span class="string">"widthFix"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wapper</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">  	<span class="comment">/* 图片高宽比 */</span></span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">56%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wapper</span> &gt; <span class="selector-tag">image</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>WeChat-Mini-Program</category>
      </categories>
      <tags>
        <tag>WeChat-Mini-Program</tag>
      </tags>
  </entry>
  <entry>
    <title>Circule Reference in Fastjson</title>
    <url>/2019/08/17/Circule-Reference-in-Fastjson/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2019/08/17/YvAZiPnxFgtGj6X.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://github.com/alibaba/fastjson/wiki/SerializerFeature_DisableCircularReferenceDetect_cn" target="_blank" rel="noopener">SerializerFeature_DisableCircularReferenceDetect_cn | fastjson-GitHub</a></p>
<p>在 fastjson 中，会自动检测循环引用，并且输出为 fastjson 专有的引用表示格式。但这个不能被其他 JSON 库识别，也不能被浏览器识别，所以 fastjson 提供了关闭循环引用检测的功能。</p>
</blockquote>
<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>项目中的一个接口返回的 json 数据出现引用格式：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"lastDoneCollectTask":&#123;</span><br><span class="line">  "$ref":"$.data.lastCreateCollectTask"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>项目中将 Spring Boot 内置的 JSON 改成了 fastjson，而 fastjson 会自动进行重复引用/循环引用检测，并将循环应用改为自己定义的引用格式。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>关闭 fastjson 循环引用检测的功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JSON.toJSONString(obj, SerializerFeature.DisableCircularReferenceDetect);</span><br></pre></td></tr></table></figure>

<h2 id="疑问🤔️"><a href="#疑问🤔️" class="headerlink" title="疑问🤔️"></a><del>疑问🤔️</del></h2><blockquote>
<p>引用分为两种，重复引用和循环引用</p>
<p>重复引用指一个对象重复出现多次，循环引用指相互引用，，这个问题比较严重，如果处理不好就会出现StackOverflowError异常</p>
</blockquote>
<p>举个例子，有两个类分别如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> B b1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> B b2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行如下代码返回的结果中依然存在引用，难道这也属于循环引用吗</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  A a = <span class="keyword">new</span> A();</span><br><span class="line">  B b = <span class="keyword">new</span> B();</span><br><span class="line">  b.setId(<span class="number">123</span>);</span><br><span class="line">  a.setB1(b);</span><br><span class="line">  a.setB2(a.getB1());</span><br><span class="line"></span><br><span class="line">  System.out.println(JSON.toJSONString(a));</span><br><span class="line">  <span class="comment">// &#123;"b1":&#123;"id":123&#125;,"b2":&#123;"$ref":"$.b1"&#125;,"id":0&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Fastjson</category>
      </categories>
      <tags>
        <tag>Fastjson</tag>
      </tags>
  </entry>
  <entry>
    <title>Comments</title>
    <url>/2019/01/03/Comments/</url>
    <content><![CDATA[<img data-src="https://neilpatel.com/wp-content/uploads/2015/03/comments.jpg" width="100%"/>

<a id="more"></a>

]]></content>
      <categories>
        <category>comment</category>
      </categories>
  </entry>
  <entry>
    <title>Config ssh for Tencent Server login</title>
    <url>/2019/08/17/Config-ssh-for-Tencent-Server-login/</url>
    <content><![CDATA[<img data-src="https://blog.yangerxiao.com/images/ssh.png" width="100%"/>

<a id="more"></a>

<h2 id="SSH-连接服务器"><a href="#SSH-连接服务器" class="headerlink" title="SSH 连接服务器"></a>SSH 连接服务器</h2><h3 id="使用密码登陆"><a href="#使用密码登陆" class="headerlink" title="使用密码登陆"></a>使用密码登陆</h3><p><code>ssh username@ip</code></p>
<p>输入密码后回车</p>
<h3 id="使用密钥登陆"><a href="#使用密钥登陆" class="headerlink" title="使用密钥登陆"></a>使用密钥登陆</h3><ol>
<li><p>生成密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -t 指定加密算法；</span></span><br><span class="line"><span class="comment"># -b 指定生成的密钥长度；</span></span><br><span class="line"><span class="comment"># -C 一段字符，一般都填邮箱地址。</span></span><br><span class="line"><span class="comment"># 更多参数说明可以在终端输入：ssh-keygen --help 查看</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"你的邮箱地址"</span></span><br></pre></td></tr></table></figure>

<p>这条命令执行完之后，会提示你指定公钥和私钥的存储位置。默认文件名是<code>id_rsa</code>和<code>id_rsa.pub</code>，可以通过<code>-f</code>指定文件名</p>
</li>
<li><p>将共钥上传到远程主机</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-copy-id -i id_rsa.pub username@ip</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置别名</p>
<p>在<code>~/.ssh/config</code>文件(没有就创建一个)中添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Home nickname</span><br><span class="line">	HostName ip</span><br><span class="line">	User username</span><br><span class="line">	Port 22</span><br><span class="line">	IdentityFile ~&#x2F;.ssh&#x2F;id_rsa</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>至此，就可以使用<code>ssh nickname</code>直接免密登陆服务器了</p>
<h3 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h3><h4 id="远程主机标识已更改"><a href="#远程主机标识已更改" class="headerlink" title="远程主机标识已更改"></a>远程主机标识已更改</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class="line">It is also possible that a host key has just been changed.</span><br><span class="line">The fingerprint <span class="keyword">for</span> the ECDSA key sent by the remote host is</span><br><span class="line">SHA256:Ym+3hql3pLFI1Lkxbpym4xQ7RvHTTQWh+ZCxHJR247Q.</span><br><span class="line">Please contact your system administrator.</span><br><span class="line">Add correct host key <span class="keyword">in</span> /c/Users/Administrator/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending ECDSA key <span class="keyword">in</span> /c/Users/Administrator/.ssh/known_hosts:3</span><br><span class="line">ECDSA host key <span class="keyword">for</span> 39.108.83.12 has changed and you have requested strict checking.</span><br><span class="line">Host key verification failed.</span><br></pre></td></tr></table></figure>

<p>原因：以前使用别的密钥登陆过，需要在<code>~/.ssh/known_hosts</code>文件中更新相关信息</p>
<p>方法：使用命令<code>ssh-keygen -R ip</code>即可删除<code>known_hosts</code>文件中该 IP 相关的旧纪录</p>
]]></content>
  </entry>
  <entry>
    <title>Configing Procy of Network in Mac Terminal</title>
    <url>/2020/03/03/Configing-Procy-of-Network-in-Mac-Terminal/</url>
    <content><![CDATA[<img data-src="https://i.ytimg.com/vi/dMLK0cx7V_Y/maxresdefault.jpg" width="100%"/>

<a id="more"></a>

<div class="note ">
            <p>在用 IDEA 调用 Google Calendar API 的时候，报 <code>Connect time out</code> 的错，但电脑已经打开了 shadowsocks，浏览器也可以正常访问 Google。搜索后发现是终端中的代理需要另外设置。</p><p>浏览器的翻墙通过 <a href="https://github.com/shadowsocks/ShadowsocksX-NG" target="_blank" rel="noopener">shadowsocks</a> 实现，但是终端中还是会走默认的网关。</p>
          </div>

<h2 id="查看当前公网网关"><a href="#查看当前公网网关" class="headerlink" title="查看当前公网网关"></a>查看当前公网网关</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl ip.cn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl cip.cc</span></span><br></pre></td></tr></table></figure>

<h2 id="当前窗口中配置"><a href="#当前窗口中配置" class="headerlink" title="当前窗口中配置"></a>当前窗口中配置</h2><p>打开一个终端窗口，输入一下命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> http_proxy=http://ip:port</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> https_proxy=http://ip:port</span></span><br></pre></td></tr></table></figure>

<p>ip 和 port 可以从 <code>shadowsocks&gt;HTTP代理设置</code> 中查看。</p>
<p>这种方式只对当前窗口有效，关闭后失效。每次打开新的窗口时需要重新输入配置命令。</p>
<h2 id="将配置写入用户脚本文件中"><a href="#将配置写入用户脚本文件中" class="headerlink" title="将配置写入用户脚本文件中"></a>将配置写入用户脚本文件中</h2><ol>
<li><p>在 <code>~/.bash_profile</code> 中添加以下代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">proxy_on</span></span>()&#123;</span><br><span class="line">    <span class="built_in">export</span> http_proxy=http://127.0.0.1:1087</span><br><span class="line">    <span class="built_in">export</span> https_proxy=http://127.0.0.1:1087</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"已开启代理"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">proxy_off</span></span>()&#123;</span><br><span class="line">    <span class="built_in">unset</span> http_proxy</span><br><span class="line">    <span class="built_in">unset</span> https_proxy</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"已关闭代理"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新执行刚修改的脚本文件，使之立即生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启代理</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> proxy_on</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭代理</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> proxy_off</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="IDEA-配置代理"><a href="#IDEA-配置代理" class="headerlink" title="IDEA 配置代理"></a>IDEA 配置代理</h2><p><code>Preferences&gt;Appearance &amp; Behavior&gt;System Settings&gt;HTTP Proxy&gt;Manual proxy configurationation</code></p>
<p>填写相应的 Host 和 Port 即可。</p>
<p><img data-src="https://img2018.cnblogs.com/blog/478956/201810/478956-20181019112723115-194000758.png" alt=""></p>
]]></content>
  </entry>
  <entry>
    <title>Daily Note</title>
    <url>/2018/12/25/Daily-Note/</url>
    <content><![CDATA[<h3 id="艾力老师34枚金币时间管理法"><a href="#艾力老师34枚金币时间管理法" class="headerlink" title="艾力老师34枚金币时间管理法"></a><a href="https://www.baidu.com/link?url=5SuFx-9NWub2CCof8stm6CHhcoJ5cePsHcUkAUcd5dlnrxPsLNtsDGKdZmraf1FddnPuCjhghquaa99zBjpW3T8_Vwb4fek_-ADEIilBvyG&wd=&eqid=faf3fc3a00046acc000000065b99be7a" target="_blank" rel="noopener"><em>艾力老师</em>34枚金币<em>时间管理</em>法</a></h3><h1 id="SqlSessionTemplate"><a href="#SqlSessionTemplate" class="headerlink" title="SqlSessionTemplate"></a>SqlSessionTemplate</h1><h1 id="排名算法"><a href="#排名算法" class="headerlink" title="排名算法"></a>排名算法</h1><p><a href="http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html</a></p>
<p><a href="https://www.cnblogs.com/zhengyun_ustc/archive/2010/12/15/amir.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhengyun_ustc/archive/2010/12/15/amir.html</a></p>
<h1 id="BootstrapValidator的使用"><a href="#BootstrapValidator的使用" class="headerlink" title="BootstrapValidator的使用"></a>BootstrapValidator的使用</h1><blockquote>
<p><a href="https://blog.csdn.net/fengsheng5210/article/details/78753329" target="_blank" rel="noopener">https://blog.csdn.net/fengsheng5210/article/details/78753329</a></p>
<p><a href="https://blog.csdn.net/u013938465/article/details/53507109" target="_blank" rel="noopener">BootstrapValidator超详细教程</a></p>
<p><a href="http://wenda.bootcss.com/question/491" target="_blank" rel="noopener">http://wenda.bootcss.com/question/491</a></p>
</blockquote>
<h1 id="正确匹配URL的正则表达式"><a href="#正确匹配URL的正则表达式" class="headerlink" title="正确匹配URL的正则表达式"></a><a href="https://www.cnblogs.com/speeding/p/5097790.html" target="_blank" rel="noopener">正确匹配URL的正则表达式</a></h1><blockquote>
<p><a href="https://blog.csdn.net/yu447338063/article/details/56014600" target="_blank" rel="noopener">近乎完美的金额正则表达式两位小数</a></p>
<p><a href="http://tool.oschina.net/regex/" target="_blank" rel="noopener">在线测试</a></p>
</blockquote>
<h1 id="Guns日志系统的流程"><a href="#Guns日志系统的流程" class="headerlink" title="Guns日志系统的流程"></a>Guns日志系统的流程</h1><blockquote>
<p><a href="https://blog.csdn.net/zerolaw/article/details/81236996" target="_blank" rel="noopener">Guns第九节日志系统</a></p>
</blockquote>
<h1 id="使用Fiddler的AutoResponder转发请求"><a href="#使用Fiddler的AutoResponder转发请求" class="headerlink" title="使用Fiddler的AutoResponder转发请求"></a>使用Fiddler的AutoResponder转发请求</h1><blockquote>
<p><a href="https://blog.csdn.net/panda_m/article/details/77892468" target="_blank" rel="noopener">https://blog.csdn.net/panda_m/article/details/77892468</a></p>
<p><a href="https://blog.csdn.net/willcaty/article/details/70209074" target="_blank" rel="noopener">Fiddler 之AutoResponder</a></p>
</blockquote>
<h1 id="Spring-boot-激活-profile的几种方式"><a href="#Spring-boot-激活-profile的几种方式" class="headerlink" title="Spring boot 激活 profile的几种方式"></a>Spring boot 激活 profile的几种方式</h1><blockquote>
<p><a href="https://my.oschina.net/u/1469495/blog/1522784" target="_blank" rel="noopener">https://my.oschina.net/u/1469495/blog/1522784</a></p>
<p><a href="https://blog.csdn.net/wu2374633583/article/details/80073271" target="_blank" rel="noopener">SpringBoot（7）–配置文件占位符，profile</a></p>
</blockquote>
<h1 id="怎么更改Guns项目名称？"><a href="#怎么更改Guns项目名称？" class="headerlink" title="怎么更改Guns项目名称？"></a>怎么更改Guns项目名称？</h1><h3 id="mybatis在mapper-xml中处理大于、小于、不等于号的方法-CSDN博客"><a href="#mybatis在mapper-xml中处理大于、小于、不等于号的方法-CSDN博客" class="headerlink" title="mybatis在mapper.xml中处理大于、小于、不等于号的方法 - CSDN博客"></a><a href="https://www.baidu.com/link?url=uHo9Ne-h0E-JX0TyGSGrehCtM7QBqG_340mSrOmw4_0FAZ9U5ik2N4-G1dmsOXNpqRJmXTc_USwS3NCjBmIGp_&wd=&eqid=fe1386000002198c000000065bab02cb" target="_blank" rel="noopener"><em>mybatis</em>在mapper.<em>xml</em>中处理<em>大于</em>、小于、<em>不等于</em>号的方法 - CSDN博客</a></h3><h3 id="JQuery-改变input-的placeholder的值-CSDN博客"><a href="#JQuery-改变input-的placeholder的值-CSDN博客" class="headerlink" title="JQuery 改变input 的placeholder的值 - CSDN博客"></a><a href="https://www.baidu.com/link?url=EG2hJrW7s-G50P73w-tbuNpJ5LubDhAEumDNe8B_jzlJZF82P8aVARFUV8dwyUWR7jieETGfnUJ3TAQXe7kZEavnYEW14-FUbwWvZDClRY_&wd=&eqid=9bc5498500024aca000000065bbc5397" target="_blank" rel="noopener"><em>JQuery</em> 改变<em>input</em> 的<em>placeholder</em>的值 - CSDN博客</a></h3><h1 id="JS正则表达式验证数字非常全"><a href="#JS正则表达式验证数字非常全" class="headerlink" title="JS正则表达式验证数字非常全"></a><a href="https://www.cnblogs.com/xinwusuo/p/5948908.html" target="_blank" rel="noopener">JS正则表达式验证数字非常全</a></h1><h3 id="正则表达式校验金额最多两位小数的实数-CSDN博客"><a href="#正则表达式校验金额最多两位小数的实数-CSDN博客" class="headerlink" title="正则表达式校验金额最多两位小数的实数 - CSDN博客"></a><a href="https://www.baidu.com/link?url=k3wj5Lgdd8s2KcLelhEz1JLwpQd1te8oTY7JLG94-BHHQgcc0pE9C1indmPl-4HF2YBYYoZGJxeN19RgiBvMQdjb569cBPd5PgSLBp6M_8y&wd=&eqid=e86bf6570000045b000000065bbc5d55" target="_blank" rel="noopener">正则表达式<em>校验<em>金额最多</em>两位小数的实数</em> - CSDN博客</a></h3><h3 id="JS比较两个数值的大小实例-javascript技巧-脚本之家"><a href="#JS比较两个数值的大小实例-javascript技巧-脚本之家" class="headerlink" title="JS比较两个数值的大小实例_javascript技巧_脚本之家"></a><a href="https://www.baidu.com/link?url=h5k8T-Yjh_yBzO8b47wzZiKYC5_gjRkIIjscdvX5HwRt9DiCJP84PSyX1B-xE7TY&wd=&eqid=e7dfe4fe000008a8000000065bbc5c57" target="_blank" rel="noopener"><em>JS比较</em>两个数值的<em>大小</em>实例_javascript技巧_脚本之家</a></h3><p><a href="https://www.jianshu.com/p/127dd30cf75f" target="_blank" rel="noopener">第9章Spring Boot开发者工具- 简书</a></p>
<p><a href="https://blog.csdn.net/yaomingyang/article/details/78241988" target="_blank" rel="noopener">spring boot项目中使用spring-boot-devtools模块进行代码热部署，避免 …</a></p>
<h1 id="自动部署"><a href="#自动部署" class="headerlink" title="自动部署"></a>自动部署</h1><p><a href="https://blog.csdn.net/java_and_json/article/details/79358764" target="_blank" rel="noopener">maven的wagon-maven-plugin插件详解</a></p>
<p><a href="https://blog.csdn.net/alibert/article/details/78912523" target="_blank" rel="noopener">Maven插件wagon-maven-plugin自动化部署</a></p>
<p><a href="https://ddnode.com/2015/04/14/git-modify-remote-responsity-url.html" target="_blank" rel="noopener">git修改远程仓库地址| Drupal 笔记</a></p>
<p><a href="https://blog.csdn.net/u011136197/article/details/79429000" target="_blank" rel="noopener">IDEA git修改远程仓库地址- bozi - CSDN博客</a></p>
<p><a href="https://segmentfault.com/a/1190000012930393" target="_blank" rel="noopener">使用 IDEA 远程 Debug</a></p>
<h1 id="Guns-Shiro放行接口"><a href="#Guns-Shiro放行接口" class="headerlink" title="Guns Shiro放行接口"></a>Guns Shiro放行接口</h1><p>com.stylefeng.guns.config.web</p>
<p>ShiroConfig</p>
<p>/<strong>Shiro的过滤器链</strong>/<br>@Bean</p>
<p>public ShiroFilterFactoryBean shiroFilter(DefaultWebSecurityManager securityManager) </p>
<h3 id="根据HttpServletRequest获取用户真实IP地址-YancyMauno-博客园"><a href="#根据HttpServletRequest获取用户真实IP地址-YancyMauno-博客园" class="headerlink" title="根据HttpServletRequest获取用户真实IP地址 - YancyMauno - 博客园"></a><a href="https://www.baidu.com/link?url=7Egil4dN2mNUQhI7NBE8uEJ_VrD8b6oOki6aH348AV5-N_scPoNWzVr-uXIlZZMpd9uwj8M2at5wf60treSKja&wd=&eqid=a891ee5300080693000000065bbef451" target="_blank" rel="noopener">根据<em>HttpServletRequest获取</em>用户真实<em>IP</em>地址 - YancyMauno - 博客园</a></h3><h3 id="Java-通过Request请求获取IP地址-大大的微笑的专栏-CSDN博客"><a href="#Java-通过Request请求获取IP地址-大大的微笑的专栏-CSDN博客" class="headerlink" title="Java 通过Request请求获取IP地址 - 大大的微笑的专栏 - CSDN博客"></a><a href="https://www.baidu.com/link?url=fe8H26WJ66zz5V-LtkLrcfnuj3koG-frpJZUN04BKr4kfWb3V4dzzZAB8Ac12L2fhjATILdKPlN-jdVLosUx0xq1ijzTJwflrsDIiDews_u&wd=&eqid=a891ee5300080693000000065bbef451" target="_blank" rel="noopener">Java 通过<em>Request</em>请求<em>获取IP</em>地址 - 大大的微笑的专栏 - CSDN博客</a></h3><h3 id="java替换指定url里的参数值"><a href="#java替换指定url里的参数值" class="headerlink" title="java替换指定url里的参数值"></a><a href="http://asflex.iteye.com/blog/2002047" target="_blank" rel="noopener">java替换指定url里的参数值</a></h3><p><a href="http://blog.csdn.net/qq_27093465/article/details/77449117" target="_blank" rel="noopener">IntelliJ IDEA使用教程 （总目录篇）</a></p>
<p><a href="https://blog.csdn.net/qq_27093465/article/details/64124330" target="_blank" rel="noopener">Intellij IDEA 2017 debug断点调试技巧与总结详解篇- 请叫我大师兄 …</a></p>
<p><a href="https://blog.csdn.net/zsg88/article/details/65045353" target="_blank" rel="noopener">mybatis xml中的数组</a></p>
<p>注意：collection=”list” 不是  collection=”#{list}”</p>
<h3 id="ps-ef和ps-aux的区别-CSDN博客"><a href="#ps-ef和ps-aux的区别-CSDN博客" class="headerlink" title="ps -ef和ps aux的区别 - CSDN博客"></a><a href="https://www.baidu.com/link?url=kpG0FIj0msBUz0C2TxI8m_vgSQ9KLde2HyBYDkqK1Bczmik5pF2Iwvg3pZr4x1vu1djJ7So4mHSHzZLk_aQxNENsUqvHjsnlZW7waE-9BYq&wd=&eqid=d140e50b0001bdd3000000065bc47265" target="_blank" rel="noopener"><em>ps</em> -<em>ef<em>和</em>ps</em> <em>aux<em>的</em>区别</em> - CSDN博客</a></h3><h3 id="linux-如何查看应用程序进程号、端口-Hurpe-CSDN博客"><a href="#linux-如何查看应用程序进程号、端口-Hurpe-CSDN博客" class="headerlink" title="linux 如何查看应用程序进程号、端口 - Hurpe - CSDN博客"></a><a href="https://www.baidu.com/link?url=DP0WLcCk-HdBm_Tt41FRfav0g2VysltZM-CDt2RnIepqU_GxCLpcDxAnDGriqTrA-0PQmBeG8AMqHpWcci1rCMLoUQ88CXzk_IFZFV_i-Mq&wd=&eqid=ae7a6afe00022137000000065bc4731a" target="_blank" rel="noopener"><em>linux</em> 如何<em>查看<em>应用</em>程序进程<em>号、</em>端口</em> - Hurpe - CSDN博客</a></h3><p><a href="https://blog.csdn.net/isea533/article/details/50281151" target="_blank" rel="noopener">Spring Boot 属性配置和使用</a></p>
<h3 id="SpringBoot进阶教程-第一篇-YML多文档块实现多环境配…-CSDN博客"><a href="#SpringBoot进阶教程-第一篇-YML多文档块实现多环境配…-CSDN博客" class="headerlink" title="SpringBoot进阶教程 | 第一篇:YML多文档块实现多环境配…_CSDN博客"></a><a href="https://www.baidu.com/link?url=UiQqy6aQw9SmSXshLbYzDsBpIUAvLuFWMnGIlYQO2pD4valwRrG9sJdHclbW_rep_t3o2t-Z2m44Yy7Z1SGjmh6y4YT_nLJi09EidPzcoze&wd=&eqid=b5277c960005d14b000000065bc5481f" target="_blank" rel="noopener">SpringBoot进阶教程 | 第一篇:<em>YML多</em>文档块实现<em>多环境</em>配…_CSDN博客</a></h3><p>注意配置项的顺序问题！</p>
<h3 id="js-定时器-菜鸟教程"><a href="#js-定时器-菜鸟教程" class="headerlink" title="js 定时器 | 菜鸟教程"></a><a href="https://www.baidu.com/link?url=muZp44FHk6oHM7dAinnPFnSgRQSxeIxUAwkAYU_iE0Q57APKPjVMnVXzqddVl-8yC0XIb2pNVM7kpHLNRHmlja&wd=&eqid=b4d230ad0000fbf4000000065bc5552c" target="_blank" rel="noopener"><em>js 定时器</em> | 菜鸟教程</a></h3><h3 id="Springboot循环依赖解决办法-dx125806的博客-CSDN博客"><a href="#Springboot循环依赖解决办法-dx125806的博客-CSDN博客" class="headerlink" title="Springboot循环依赖解决办法 - dx125806的博客 - CSDN博客"></a><a href="https://www.baidu.com/link?url=Yp5OmgS23RJvWWPVMIg1WYW6NRKjRhPfs2Lq5vSso0H7gF6ORtrRYuhnQyy4kzrw7TX4U4wTPIFFIesIKD6GqWOmWSLHluOiBFUJUhqC0vm&wd=&eqid=ee2d9bb70000356f000000065bc6d513" target="_blank" rel="noopener"><em>Springboot循环</em>依赖解决办法 - dx125806的博客 - CSDN博客</a></h3><h3 id="Mysql清空表-truncate-与删除表中数据-delete-的区别-x…-博客园"><a href="#Mysql清空表-truncate-与删除表中数据-delete-的区别-x…-博客园" class="headerlink" title="Mysql清空表(truncate)与删除表中数据(delete)的区别 - x…_博客园"></a><a href="https://www.baidu.com/link?url=oNXwQpejM6cZVr1z2zaNwSIUjnegIdF6KMyrUUmZ_37ddMn34ZuZAxYUUqr_IYeVS8pi4K-ykscv3ibOAntEja&wd=&eqid=ea21812400019ad0000000065bc718d9" target="_blank" rel="noopener"><em>Mysql清空表</em>(truncate)与删除表中数据(delete)的区别 - x…_博客园</a></h3><h3 id="Srping-MVC中Controller的void方法声明误区-yh-zeng2…-CSDN博客"><a href="#Srping-MVC中Controller的void方法声明误区-yh-zeng2…-CSDN博客" class="headerlink" title="Srping MVC中Controller的void方法声明误区 - yh_zeng2…_CSDN博客"></a><a href="https://www.baidu.com/link?url=cR2xRUnWgrxyNQBmdOaIC0NKg8Fl4Hfbsry_zy24LIPnlKlbNg2roOHgRnSGaKWF9KyORy0tMiXOF2_4YC9Ks2BazMURWpCOjVIe75hce8C&wd=&eqid=9667ad240001c75c000000065bc732ab" target="_blank" rel="noopener">Srping MVC中<em>Controller</em>的<em>void</em>方法声明误区 - yh_zeng2…_CSDN博客</a></h3><h3 id="springMVC对于controller处理方法返回值的可选类型-CSDN博客"><a href="#springMVC对于controller处理方法返回值的可选类型-CSDN博客" class="headerlink" title="springMVC对于controller处理方法返回值的可选类型 - CSDN博客"></a><a href="https://www.baidu.com/link?url=-obpxigJVzDGRTi2EEPE1brUBNCm8SJ7EwGvyUoKh_sk4y9q5pKgRf3-mJP1e1tfYLISQGIaD1oRRes1BSQwN6oEqd56zgsEIqllEaViPP7&wd=&eqid=af04f30a0001dcff000000065bc734d0" target="_blank" rel="noopener">springMVC对于<em>controller</em>处理方法<em>返回值</em>的可选类型 - CSDN博客</a></h3><h3 id="StringUtils中isEmpty-和isBlank的区别-程序猿001-博客园"><a href="#StringUtils中isEmpty-和isBlank的区别-程序猿001-博客园" class="headerlink" title="StringUtils中isEmpty 和isBlank的区别 - 程序猿001 - 博客园"></a><a href="https://www.baidu.com/link?url=GcV6MrUFbyKGU6NyUb5DozJj8-Z9WTr9x9iJ0H1sOLoA-iCugfMI2J-LymHjb-iqe_EHyDqoM0M9tTbzkmDQqa&wd=&eqid=a45e1b9a000487b5000000065bc749b7" target="_blank" rel="noopener"><em>StringUtils</em>中isEmpty 和<em>isBlank</em>的区别 - 程序猿001 - 博客园</a></h3><h1 id="初识Jsoup之解析HTML"><a href="#初识Jsoup之解析HTML" class="headerlink" title="初识Jsoup之解析HTML"></a><a href="https://www.cnblogs.com/boy1025/p/5040495.html" target="_blank" rel="noopener">初识Jsoup之解析HTML</a></h1><p><a href="https://blog.csdn.net/river_continent/article/details/74177781" target="_blank" rel="noopener">Jsoup处理Url与解析Html</a></p>
<h3 id="mysql格式化日期-kongweiteng-博客园"><a href="#mysql格式化日期-kongweiteng-博客园" class="headerlink" title="mysql格式化日期 - kongweiteng - 博客园"></a><a href="https://www.baidu.com/link?url=i2e1alTF2KIAhtWRVT6r6yS8HdObjl9Sb2h9LtslSEwjD5k_Q7pI1iAsht0ng9I9GhXax-v2ua1HYUc7KmvM2K&wd=&eqid=8068370800015d39000000065bc94e7d" target="_blank" rel="noopener"><em>mysql格式化日期</em> - kongweiteng - 博客园</a></h3><h3 id="架构设计之参数化与配置化"><a href="#架构设计之参数化与配置化" class="headerlink" title="架构设计之参数化与配置化"></a><a href="https://www.baidu.com/link?url=YxQXMY9oIfW3C8FYUFh7VVkyIHTIgfcUkK7zGBwzMDu_Slx2WANBArk2dN7gCjMGOyZ4szbC9xlExqy8fo3U7uYbAN1erM7TzPcDIv2QVf3&wd=&eqid=8de7d37d0000967b000000065bc9c302" target="_blank" rel="noopener"><em>架构设计之参数化与配置化</em></a></h3><p><a href="https://juejin.im/post/5ad82dbef265da503825b240" target="_blank" rel="noopener">java集合入门和深入学习，看这篇就差不多了- 掘金</a></p>
<p><a href="http://wiki.jikexueyuan.com/project/java-interview-bible/collection.html" target="_blank" rel="noopener">集合类- Java 面试宝典- 极客学院Wiki</a></p>
<p><a href="http://www.importnew.com/15980.html" target="_blank" rel="noopener">40个Java集合面试问题和答案- ImportNew</a></p>
<h3 id="Java给指定URL字符串添加值和获取URL字符串中的参数值-CSDN博客"><a href="#Java给指定URL字符串添加值和获取URL字符串中的参数值-CSDN博客" class="headerlink" title="Java给指定URL字符串添加值和获取URL字符串中的参数值 - CSDN博客"></a><a href="https://www.baidu.com/link?url=hRk6a_jFlupDS52vosD-Ah0EBYYkK-sJ_Ws0VUhbgDdN1XuxQo9SDS4MAaqNxQ8aCX8sS2toHOCr1t8ORHpNA5NAMNFHnS-_aeTeN4XAsV_&wd=&eqid=e57fafc000019250000000065bd13838" target="_blank" rel="noopener"><em>Java</em>给指定<em>URL</em>字符串添加值和<em>获取URL</em>字符串中的<em>参数</em>值 - CSDN博客</a></h3><h3 id="beetl中文文档"><a href="#beetl中文文档" class="headerlink" title="beetl中文文档"></a><a href="http://www.baidu.com/link?url=rG_uv1w1AckL7Z19v3xcqxm1s4-JDPkcSdzpQ2Q134kYXCCocU6X5E0eImqaTPAc" target="_blank" rel="noopener"><em>beetl</em>中文文档</a></h3><p><strong>千万不要</strong>在定界符里使用占位符号，因为占位符仅仅嵌在静态文本里，如下例子是<strong>错误</strong>例子</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">"hi"</span>;</span><br><span class="line"><span class="keyword">var</span> c = $&#123;a&#125;+<span class="string">"beetl"</span>; <span class="comment">//应该是var c = a+"beetl"</span></span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>



<p><a href="https://blog.csdn.net/shiyangkai/article/details/79359512" target="_blank" rel="noopener">判断正整数的正则表达式</a></p>
<h3 id="js货币比较-CSDN博客"><a href="#js货币比较-CSDN博客" class="headerlink" title="js货币比较 - CSDN博客"></a><a href="https://www.baidu.com/link?url=2pwotvBC14dx928_j99U8J6TD-5Rg8ReFwh3e2Jl7UWKvAKwEcDlXm96eQRt7xCcJILKNtJ28_y2JG-dXnzO7_&wd=&eqid=98cb1de7000043c9000000065bd19269" target="_blank" rel="noopener"><em>js<em>货币</em>比较</em> - CSDN博客</a></h3><h3 id="js-判断字符串中是否包含某个字符串-草木物语-博客园"><a href="#js-判断字符串中是否包含某个字符串-草木物语-博客园" class="headerlink" title="js 判断字符串中是否包含某个字符串 - 草木物语 - 博客园"></a><a href="https://www.baidu.com/link?url=stryjYP3ebE2qQoSx620_1jX1miOlg3Dtgf4afbN5Fs14dMf7EU2jUeZ0FT8fFfsZDsxq2fgbucP443PcOnchq&wd=&eqid=9a40285700007a44000000065bd6b8a8" target="_blank" rel="noopener"><em>js</em> 判断<em>字符串<em>中是否</em>包含<em>某个</em>字符串</em> - 草木物语 - 博客园</a></h3><h3 id="这一次-让你彻底明白Java的值传递和引用传递"><a href="#这一次-让你彻底明白Java的值传递和引用传递" class="headerlink" title="这一次,让你彻底明白Java的值传递和引用传递!"></a><a href="http://mp.weixin.qq.com/s?src=11&timestamp=1540870119&ver=1213&signature=nNxk9l03HyGyOFlS0L-GyUlacRbp8ijYAxPbcpUrI9gQltfgN4Vcm-x2NyD9m9IW3no*CO5eFh-CHSbsKyQe4HS-zAX5r*3pCj35vm-JlgjX0srC8z9G-Dwm6R5Pw7rt&new=1" target="_blank" rel="noopener">这一次,让你彻底明白Java的<em>值传递和引用传递</em>!</a></h3><p><a href="https://blog.csdn.net/zhujianlin1990/article/details/51469359/" target="_blank" rel="noopener">java如何提取url里的域名</a></p>
<h3 id="SpringBoot定时任务及Cron表达式详解-51CTO-COM"><a href="#SpringBoot定时任务及Cron表达式详解-51CTO-COM" class="headerlink" title="SpringBoot定时任务及Cron表达式详解 - 51CTO.COM"></a><a href="https://www.baidu.com/link?url=vTmAX7vYQHFWkDGJCRWJ3Up49Hx59Uf_G_oOde7-FiH2ttYs6HdMJzPMGckG3JnNxXyx10T0ZZVII-M4Ioc1ia&wd=&eqid=ab8c7d490005cb9a000000065bd90e37" target="_blank" rel="noopener"><em>SpringBoot定时任务</em>及<em>Cron</em>表达式详解 - 51CTO.COM</a></h3><p><a href="https://blog.csdn.net/luckyxl029/article/details/81282815" target="_blank" rel="noopener">@Transactional注解和synchronized关键字不能同时使用</a></p>
<h3 id="MySQL中TIMESTAMPDIFF和TIMESTAMPADD函数的用法-欣宇…-CSDN博客"><a href="#MySQL中TIMESTAMPDIFF和TIMESTAMPADD函数的用法-欣宇…-CSDN博客" class="headerlink" title="MySQL中TIMESTAMPDIFF和TIMESTAMPADD函数的用法 - 欣宇…_CSDN博客"></a><a href="https://www.baidu.com/link?url=uXCVmz0SJCfXkCtH4ZSf4oVwWd41u-mQDG2O3-TVDT3_WMIEJFPKQ88rL3kq2M4D0Z5Jtgp_2H6dBSjIWsX51SOHDBfbr62P1IcrzYhDFwC&wd=&eqid=ad9b8c0e0002961a000000065bd97208" target="_blank" rel="noopener"><em>MySQL<em>中</em>TIMESTAMPDIFF<em>和TIMESTAMPADD函数</em>的用法</em> - 欣宇…_CSDN博客</a></h3><p><a href="https://blog.csdn.net/wushuchu/article/details/52036753" target="_blank" rel="noopener">并发页面访问量统计简单实现</a></p>
<h1 id="PV统计优化设计"><a href="#PV统计优化设计" class="headerlink" title="PV统计优化设计"></a><a href="https://segmentfault.com/a/1190000012250446" target="_blank" rel="noopener">PV统计优化设计</a></h1><h3 id="storm高并发UV统计"><a href="#storm高并发UV统计" class="headerlink" title="storm高并发UV统计"></a><a href="http://javafu.iteye.com/blog/2374288" target="_blank" rel="noopener">storm高并发UV统计</a></h3><p><a href="https://blog.csdn.net/u014203449/article/details/79330811" target="_blank" rel="noopener">权限管理(项目和源码)：一.springboot与shiro整合</a></p>
<h3 id="MySql修改时间字段-要争气-CSDN博客"><a href="#MySql修改时间字段-要争气-CSDN博客" class="headerlink" title="MySql修改时间字段 - 要争气 - CSDN博客"></a><a href="https://www.baidu.com/link?url=BPFLwq-qAxMd1RCKoav6hUc5wNaLg85MTzc48KZjFa3QDiqpxvfis2PSCwqMlBBViFSAVC-iCzftAeimH8CCLCsE7wNFsOHyrRH-VeDEXqW&wd=&eqid=8103d22a000350a4000000065bdaa05d" target="_blank" rel="noopener"><em>MySql修改时间</em>字段 - 要争气 - CSDN博客</a></h3><p><a href="https://www.oschina.net/question/146385_54132" target="_blank" rel="noopener">在遍历List时，对List里的对象进行remove()，此操作会改变List的大小 …</a></p>
<p><a href="https://www.jianshu.com/p/747b30ba5b4c" target="_blank" rel="noopener">Iterator/foreach遍历list时，删除元素的报错问题- 简书</a></p>
<h3 id="java中int与Integer-用-比较详解-xingkongdeasi的专栏-CSDN博客"><a href="#java中int与Integer-用-比较详解-xingkongdeasi的专栏-CSDN博客" class="headerlink" title="java中int与Integer*用==*比较详解 - xingkongdeasi的专栏 - CSDN博客"></a><a href="https://www.baidu.com/link?url=vGTMnPV9Z8zzXlRVbWx8BNtYqs4ewl5PQ30mgRIXTJNdho7t-FOmyxNBuocT5ORYYaYZksG4J3bQ3Y_l8xgthx9QN-ZfrENMwWXU_T4kdf7&wd=&eqid=8dde48a90001b4f3000000065bdbc568" target="_blank" rel="noopener">java中int与<em>Integer*用</em>==*比较详解 - xingkongdeasi的专栏 - CSDN博客</a></h3><h3 id="树状结构Java模型、层级关系Java模型、上下级关系Java模…-博客园"><a href="#树状结构Java模型、层级关系Java模型、上下级关系Java模…-博客园" class="headerlink" title="树状结构Java模型、层级关系Java模型、上下级关系Java模…_博客园"></a><a href="https://www.baidu.com/link?url=SGgkvID5dEcrH0gsYz-52r6JJSG868lF51VRPWnENMb0TEDYE604jPqr78gYy6eTo1QxudHbQvUJm8svl5jnVq&wd=&eqid=cabb0cd600014072000000065bdbeb1e" target="_blank" rel="noopener">树状结构Java<em>模型</em>、层级<em>关系</em>Java<em>模型</em>、<em>上下级关系</em>Java模…_博客园</a></h3><h3 id="Java关于数据结构的实现-树-郭孝星-CSDN博客"><a href="#Java关于数据结构的实现-树-郭孝星-CSDN博客" class="headerlink" title="Java关于数据结构的实现:树 - 郭孝星 - CSDN博客"></a><a href="https://www.baidu.com/link?url=NeOhiINyYatXzS1t7_YNe311TEXCAOFDBhmnyKhsPlI8qnlR1qPCYn6JyRgeR7OnE-FIANKh2FxWdbR3Ne8svW--RCVCbfoTz1F0cSqegUy&wd=&eqid=b500fb3d00014d63000000065bdbec29" target="_blank" rel="noopener"><em>Java</em>关于数据结构的实现:树 - 郭孝星 - CSDN博客</a></h3><h3 id="input-onclick事件实现页面跳转-Tiger覃-博客园"><a href="#input-onclick事件实现页面跳转-Tiger覃-博客园" class="headerlink" title="input onclick事件实现页面跳转 - Tiger覃 - 博客园"></a><a href="https://www.baidu.com/link?url=oYzJOFiJE67ugOW2KTdehG_8orftfT3u1odJM0DsEsH9GAhjPRWfUkMc5db8FEJc4zgBTZ3kW8z6GIUvsF8WxsMgbbtFoPhTgpqptMpsQwu&wd=&eqid=e9fe19b50000435d000000065be0ff64" target="_blank" rel="noopener"><em>input</em> onclick事件实现<em>页面跳转</em> - Tiger覃 - 博客园</a></h3><h3 id="CountDownLatch的简单理解-joenqc的博客-CSDN博客"><a href="#CountDownLatch的简单理解-joenqc的博客-CSDN博客" class="headerlink" title="CountDownLatch的简单理解 - joenqc的博客 - CSDN博客"></a><a href="https://www.baidu.com/link?url=0l1I7uEoVhFQe9pZcS1PVWaDxuWxmhPHjxx4h3OBV8e1EwNuHjbXiiBk0-Qj4Nxi4645xYbFFJGo_vtsALWv3_&wd=&eqid=f865177b0007037f000000065be188f4" target="_blank" rel="noopener"><em>CountDownLatch</em>的简单理解 - joenqc的博客 - CSDN博客</a></h3><p><a href="https://blog.csdn.net/zilie972803341/article/details/78444703" target="_blank" rel="noopener">MySql数据库：数据查重、去重的实现</a></p>
<h3 id="宝塔linux主机面板查看网站日志记录及分析网站日志的方法-…"><a href="#宝塔linux主机面板查看网站日志记录及分析网站日志的方法-…" class="headerlink" title="宝塔linux主机面板查看网站日志记录及分析网站日志的方法 - …"></a><a href="https://www.baidu.com/link?url=_9LBpJL0trtgpfUZUMzJLBAQyiBhJKgiWGIhoRmQQHQ8ynGOolAo2-mm2XAYA2UdSjbcfiK1-8oCTeC135e-c_&wd=&eqid=e873bd8e00067a2b000000065be2960d" target="_blank" rel="noopener"><em>宝塔linux</em>主机面板查看网站<em>日志</em>记录及分析网站<em>日志</em>的方法 - …</a></h3><h3 id="在intellij-idea-中不用git-解除关联-Alex-81D的博客-CSDN博客"><a href="#在intellij-idea-中不用git-解除关联-Alex-81D的博客-CSDN博客" class="headerlink" title="在intellij idea 中不用git 解除关联 - Alex_81D的博客 - CSDN博客"></a><a href="https://www.baidu.com/link?url=wgWYPlRgfNfuo_VzzyAjVSZURujkQJvAMwxBMM5x5YYT37yYCilt1r3PR3HELxMN4yv9wZEJGIzYo8IpKmnkWhl7zSb9QjyWiCeVzN8aM9W&wd=&eqid=e77c4020000b209f000000065be2b70b" target="_blank" rel="noopener">在intellij <em>idea</em> 中不用<em>git</em> 解除关联 - Alex_81D的博客 - CSDN博客</a></h3><h1 id="使用-Google-Guava-美化你的-Java-代码"><a href="#使用-Google-Guava-美化你的-Java-代码" class="headerlink" title="使用 Google Guava 美化你的 Java 代码"></a><a href="https://my.oschina.net/leejun2005/blog/172328" target="_blank" rel="noopener">使用 Google Guava 美化你的 Java 代码</a></h1><p><a href="http://marklodato.github.io/visual-git-guide/index-zh-cn.html#merge" target="_blank" rel="noopener">图解Git</a></p>
<p><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="noopener">廖雪峰Git教程</a></p>
<p><a href="https://git-scm.com/book/en/v2" target="_blank" rel="noopener">Pro Git book</a></p>
<h1 id="【原】js实现复制到剪贴板功能，兼容所有浏览器"><a href="#【原】js实现复制到剪贴板功能，兼容所有浏览器" class="headerlink" title="【原】js实现复制到剪贴板功能，兼容所有浏览器"></a><a href="https://www.cnblogs.com/PeunZhang/p/3324727.html" target="_blank" rel="noopener">【原】js实现复制到剪贴板功能，兼容所有浏览器</a></h1><p><a href="https://clipboardjs.com/" target="_blank" rel="noopener">clipboard.js 将文本复制到剪贴板的现代方法</a></p>
<h1 id="用jmeter进行多用户并发压力测试"><a href="#用jmeter进行多用户并发压力测试" class="headerlink" title="用jmeter进行多用户并发压力测试"></a><a href="https://www.cnblogs.com/opps/p/4538523.html" target="_blank" rel="noopener">用jmeter进行多用户并发压力测试</a></h1><p><a href="https://blog.csdn.net/tengxing007/article/details/83186121" target="_blank" rel="noopener">Jmeter5.0脚本录制</a></p>
<p><a href="http://mp.baomidou.com/" target="_blank" rel="noopener">MyBatis-Plus</a></p>
<h3 id="ssm框架中-mybatis的sql语句日志输出-逸致-CSDN博客"><a href="#ssm框架中-mybatis的sql语句日志输出-逸致-CSDN博客" class="headerlink" title="ssm框架中,mybatis的sql语句日志输出 - 逸致 - CSDN博客"></a><a href="https://www.baidu.com/link?url=B0sVgB3R2sDkWvBb2S9gOaU2lWLHGRMkqAfAD6eRtHVCAvQicG7imNGE7rp_X03h3Am375ReHwjNjIpPrRlPjE5OtTOYIN3cakJKkLWZsFC&wd=&eqid=f2c9eefb0001f4f1000000065be65670" target="_blank" rel="noopener">ssm框架中,<em>mybatis</em>的sql语句<em>日志</em>输出 - 逸致 - CSDN博客</a></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看nginx</span></span><br><span class="line">netstat -n | awk '/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;'</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看tomcat</span></span><br><span class="line">netstat -antp | grep 9333 | grep ESTABLISHED -c</span><br></pre></td></tr></table></figure>



<p><a href="https://blog.csdn.net/u011328417/article/details/73610930" target="_blank" rel="noopener">MySQL更新某个字段的值为原来的值加1 (非auto_increament) - 全国花 …</a></p>
<p><a href="https://blog.csdn.net/fly910905/article/details/79501896" target="_blank" rel="noopener">Idea:Git的常用菜单操作和常用命令【含分支创建、检出、提交、合并】</a></p>
<p><a href="http://blog.didispace.com/springbootasync-2/" target="_blank" rel="noopener">Spring Boot使用@Async实现异步调用：自定义线程池</a></p>
<p>handler有四个选择</p>
<ol>
<li>ThreadPoolExecutor.AbortPolicy() ：抛出java.util.concurrent.RejectedExecutionException异常 </li>
<li>ThreadPoolExecutor.CallerRunsPolicy() : 重试添加当前的任务，他会自动重复调用execute()方法</li>
<li>ThreadPoolExecutor.DiscardOldestPolicy() : 抛弃旧的任务 </li>
<li>ThreadPoolExecutor.DiscardPolicy() : 抛弃当前的任务</li>
</ol>
<p><a href="https://blog.csdn.net/xusheng_Mr/article/details/78771746" target="_blank" rel="noopener">springboot 在idea中实现热部署</a></p>
<p><a href="https://blog.csdn.net/gnail_oug/article/details/80252188" target="_blank" rel="noopener">Spring Boot教程(十二)：Spring Boot集成热部署插件devtools</a></p>
<p><a href="https://blog.csdn.net/gld824125233/article/details/52842914" target="_blank" rel="noopener">Jmeter使用CSV Data Set Config参数化数据不重复的多次循环执行（实现多用户多次抽奖功能）</a></p>
<p><a href="https://blog.csdn.net/daguanjia11/article/details/80059002" target="_blank" rel="noopener">spring boot中返回httpcode和错误处理</a></p>
<h3 id="去掉文本框前后的空格-JS-JQuery-大da脸-博客园"><a href="#去掉文本框前后的空格-JS-JQuery-大da脸-博客园" class="headerlink" title="去掉文本框前后的空格(JS+JQuery) - 大da脸 - 博客园"></a><a href="https://www.baidu.com/link?url=Zy51saLB8mzLu-M1idHvWODW1SMhrHgxX9xcXB-lwOFAuwfN2Cc2lIK69emmjS9R74KidhavKH2jEFMlDNr_6q&wd=&eqid=f8aef5540001df72000000065bed0bb1" target="_blank" rel="noopener"><em>去掉文本框前后<em>的</em>空格</em>(JS+<em>JQuery</em>) - 大da脸 - 博客园</a></h3><p><a href="https://blog.csdn.net/qq_26525215/article/details/53726690" target="_blank" rel="noopener">【问题解决】IDEA右键选择new新文件的时候没有JSP文件选项解决</a></p>
<h3 id="IntelliJ-IDEA手动配置连接MySQL数据库-竹山一叶-博客园"><a href="#IntelliJ-IDEA手动配置连接MySQL数据库-竹山一叶-博客园" class="headerlink" title="IntelliJ IDEA手动配置连接MySQL数据库 - 竹山一叶 - 博客园"></a><a href="https://www.baidu.com/link?url=w8UYQ5qOipuf81w43M61rS-Tu7g39vicZrhKbl0kZTjGLehncnq9nv_YaxSfgQROXUhxZfPQW9OCWW6zkz6P4_&wd=&eqid=ab6c433600001335000000065bf2c093" target="_blank" rel="noopener">IntelliJ <em>IDEA<em>手动配置连接MySQL</em>数据库</em> - 竹山一叶 - 博客园</a></h3><p><a href="https://blog.csdn.net/weixin_40845165/article/details/80780159" target="_blank" rel="noopener">java.sql.SQLException: The server time zone value ‘ÖÐ¹ú±ê×¼Ê±¼ 解决方案</a></p>
<h1 id="idea中xml打开方式变成file，代码变成灰色"><a href="#idea中xml打开方式变成file，代码变成灰色" class="headerlink" title="idea中xml打开方式变成file，代码变成灰色"></a><a href="https://www.cnblogs.com/psyche61/p/9328224.html" target="_blank" rel="noopener">idea中xml打开方式变成file，代码变成灰色</a></h1><h3 id="Builder-与-NoArgsConstructor-Lombok-N-CE波-博客园"><a href="#Builder-与-NoArgsConstructor-Lombok-N-CE波-博客园" class="headerlink" title="@Builder*与@NoArgsConstructor* | Lombok - N!CE波 - 博客园"></a><a href="https://www.baidu.com/link?url=aLHwIX1c2Ig2c-Ov4Tfxlni1uGeF3N_uqpD5gKcNWcBGnnreMaFQIIdy5Ks8ixInMsAvCo_ljhF7nbLFM31eOa&wd=&eqid=d531bd3a00001e81000000065bf5620d" target="_blank" rel="noopener"><em>@Builder*与</em>@NoArgsConstructor* | <em>Lombok</em> - N!CE波 - 博客园</a></h3><h3 id="Lombok-Builder-和-NoArgsConstructor-冲突-编程之路-Segment…"><a href="#Lombok-Builder-和-NoArgsConstructor-冲突-编程之路-Segment…" class="headerlink" title="Lombok@Builder*和@NoArgsConstructor*冲突 - 编程之路 - Segment…"></a><a href="https://www.baidu.com/link?url=EMpP0owriCRvISKN7AHK6IeU1L-T5_xVBDLq6rzl_6D9jTTQS0gp80lGcL9V0Sb2XJo46vAfUS9FVyO05mLGPK&wd=&eqid=d531bd3a00001e81000000065bf5620d" target="_blank" rel="noopener"><em>Lombok@Builder*和</em>@NoArgsConstructor*冲突 - 编程之路 - Segment…</a></h3><p><a href="https://stackoverflow.com/questions/50696100/difference-in-resource-and-autowired" target="_blank" rel="noopener">spring - Difference in @Resource and @Autowired - Stack Overflow</a></p>
<h3 id="BootStrapTable的JS封装-Javascript教程-JS教程-技术…-红黑联盟"><a href="#BootStrapTable的JS封装-Javascript教程-JS教程-技术…-红黑联盟" class="headerlink" title="BootStrapTable的JS封装 - Javascript教程_JS教程_技术…_红黑联盟"></a><a href="https://www.baidu.com/link?url=tLr8fkTmBXPOVG_tw6NwdKgHZkFhSdtzInfhK-KeDFoSaFMsMNp550nPW7YnSRINAomUxbVbnp6AhiX0NryKda&wd=&eqid=90486ce000010aa5000000065bf766eb" target="_blank" rel="noopener"><em>BootStrapTable</em>的<em>JS</em>封装 - Javascript教程_<em>JS</em>教程_技术…_红黑联盟</a></h3><h1 id="JS组件系列——表格组件神器：bootstrap-table"><a href="#JS组件系列——表格组件神器：bootstrap-table" class="headerlink" title="JS组件系列——表格组件神器：bootstrap table"></a><a href="https://www.cnblogs.com/landeanfen/p/4976838.html" target="_blank" rel="noopener">JS组件系列——表格组件神器：bootstrap table</a></h1><p><a href="https://blog.csdn.net/q_linchao/article/details/79700807" target="_blank" rel="noopener">Spring Boot 读取配置文件到静态工具类</a></p>
<p><a href="https://blog.csdn.net/kongrun12/article/details/76246369" target="_blank" rel="noopener">spring boot 静态变量注入配置文件</a></p>
<p><a href="https://blog.csdn.net/testcs_dn/article/details/78799203" target="_blank" rel="noopener">Java 逐行读写 TXT 文件</a></p>
<p><a href="http://link.zhihu.com/?target=https%3A//github.com/whinc/blog/issues/7">程序变量命名的几种叫法</a></p>
<p>查询MYSQl数据表中的最后一条记录</p>
<p><code>SELECT * from tb where id = (SELECT max(id) FROM tb);</code></p>
<p><a href="https://projectlombok.org/features/Cleanup" target="_blank" rel="noopener">Lombok-@Cleanup</a></p>
<p><a href="https://www.cnblogs.com/12kk/p/8663408.html" target="_blank" rel="noopener">httpclient中post提交json和map参数</a></p>
<p><a href="https://www.cnblogs.com/jingmoxukong/p/7755643.html" target="_blank" rel="noopener">WebSocket 详解教程</a></p>
<p><a href="https://blog.csdn.net/Solar24/article/details/80248683" target="_blank" rel="noopener">前端数组 后端java mvc list 接收</a></p>
<p><a href="http://www.woshipm.com/pd/478366.html" target="_blank" rel="noopener">支付系统设计：绑卡、签约和身份验证（四）</a></p>
<h3 id="java中的replace和replaceAll的区别-人非生而知之者-…-CSDN博客"><a href="#java中的replace和replaceAll的区别-人非生而知之者-…-CSDN博客" class="headerlink" title="java中的replace和replaceAll的区别 - 人非生而知之者,…_CSDN博客"></a><a href="https://www.baidu.com/link?url=KWrlaOBn0pZF_aJ1gsyu6IHuAfuBDBnzfjxj-QL0GddeCOZa2H06omyKVZfV9FsWbOOAFCjYDF0yWI0qW8VBHeE2h72a0lpvtsSs0Dx9qTm&wd=&eqid=fb2a80c90003e1a1000000065c0759b3" target="_blank" rel="noopener">java中的<em>replace和replaceAll</em>的区别 - 人非生而知之者,…_CSDN博客</a></h3><p><a href="https://github.com/mybatis/mybatis-3/blob/master/src/test/java/org/apache/ibatis/submitted/primitive_result_type/ProductMapper.xml" target="_blank" rel="noopener">mybatis-3/ProductMapper.xml at master · mybatis/mybatis-3 · GitHub</a></p>
<p><a href="https://blog.csdn.net/qing_gee/article/details/50518795" target="_blank" rel="noopener">Mybatis+0+null，小问题引发的血案</a></p>
<p><a href="https://blog.csdn.net/john1337/article/details/70230563" target="_blank" rel="noopener">mybatis把整数0识别为null</a></p>
<p><a href="https://stackoverflow.com/questions/28216251/bigdecimal-scale-not-working" target="_blank" rel="noopener">java - BigDecimal scale not working - Stack Overflow</a></p>
<p><a href="https://www.baidu.com/link?url=bssC1KBkxlxbFa-n31GkX0_WuWK-4Q3kgadMorX0rQ4YlVP2NR-jD32D7vjCfpHL&wd=&eqid=c75720540000b303000000065c08c05c" target="_blank" rel="noopener"><em>BigDecimal.setScale</em>用法总结 - 简书</a></p>
<p><a href="https://blog.csdn.net/DOCALLEN/article/details/62050608" target="_blank" rel="noopener">layer：子父之间的数据传递</a></p>
<p><a href="https://blog.csdn.net/u012110719/article/details/48420693" target="_blank" rel="noopener">JS函数修改html的元素内容，及修改属性内容</a></p>
<p><a href="https://blog.csdn.net/Yeomer/article/details/79582815" target="_blank" rel="noopener">JavaScript 运算出现多位小数的解决办法</a></p>
<p><a href="https://www.cnblogs.com/SuperLiangG/p/5964439.html" target="_blank" rel="noopener">js float浮点数计算精度问题</a></p>
<p>MySQL时间操作</p>
<p><code>SELECT amount, orderid, date_add(order_time, interval 16 hour) &#39;order_time&#39;, date_add(pay_time, interval 16 hour) &#39;pay_time&#39; FROM pay_record WHERE cpid = 1003 and ispay = 2</code></p>
<p><a href="https://blog.csdn.net/guanmjie/article/details/4458604" target="_blank" rel="noopener">BigDecimal不整除异常- hello world - CSDN博客</a></p>
<p><a href="https://forum.fastadmin.net/thread/1580" target="_blank" rel="noopener">bootstrap-Table 统计 求和 footerFormatter 分享</a></p>
<p><a href="https://forum.fastadmin.net/thread/1816" target="_blank" rel="noopener">bootstrap-Table 统计 求和 footerFormatter PC WAP 手机端 安卓 等各种不显示 版面崩坏的解决办法</a></p>
<p><a href="https://segmentfault.com/a/1190000016620289" target="_blank" rel="noopener">Java异步编程——深入源码分析FutureTask</a></p>
<p><a href="https://blog.csdn.net/lichuangcsdn/article/details/80862172" target="_blank" rel="noopener">IDEA Mybatis Plugin插件（方便在Dao接口和Mappper XML文件之间进行切换）</a></p>
<p><a href="https://blog.csdn.net/James_qqh/article/details/60325983" target="_blank" rel="noopener">判断一个BigDecimal数值是否为零</a></p>
<p><a href="https://blog.csdn.net/wangziqiangai/article/details/51245246" target="_blank" rel="noopener">MySQL查询一小时之内的数据</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectTotalCountByChannelId"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"BigDecimal"</span>&gt;</span></span><br><span class="line">     select count(*)</span><br><span class="line">     from pay_record</span><br><span class="line">     where channel_id = #&#123;channelId&#125;</span><br><span class="line">     and order_time &gt; DATE_SUB(NOW(), INTERVAL 1 HOUR)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><a href="https://formulahendry.github.io/2016/12/04/hexo-ci/#" target="_blank" rel="noopener">Hexo的版本控制与持续集成</a></p>
<p><a href="https://github.com/tommy351/tommy351.github.io/blob/source/.travis.yml" target="_blank" rel="noopener">Hexo作者的.travis.yml配置</a></p>
<p>78ce4df05e1e44bec02266d66758943d3cedf4de</p>
<p><img data-src="https://i.loli.net/2018/12/14/5c13287562f08.jpg" alt=""></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 提交本地hexo分支到远程仓库的hexo分支</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> git push origin hexo:hexo</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.itfanr.cc/2017/08/09/using-travis-ci-automatic-deploy-hexo-blogs/" target="_blank" rel="noopener">使用Travis CI自动部署Hexo博客</a></p>
<p><a href="https://notes.iissnan.com/2016/publishing-github-pages-with-travis-ci/" target="_blank" rel="noopener">使用 Travis CI 自动更新 GitHub Pages</a></p>
<p><a href="http://magicse7en.github.io/2016/03/27/travis-ci-auto-deploy-hexo-github/" target="_blank" rel="noopener">使用Travis CI自动构建hexo博客</a></p>
<p>「<a href="https://snatix.com/categories/Hexo%E5%8D%9A%E5%AE%A2%E9%87%8D%E5%90%AF%E8%AE%A1%E5%88%92/" target="_blank" rel="noopener">Hexo博客重启计划</a>」</p>
<p><a href="https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html" target="_blank" rel="noopener">打造个性超赞博客Hexo+NexT+GitHubPages的超深度优化| reuixiy</a></p>
<p><a href="https://godweiyang.com/2018/04/13/hexo-blog/" target="_blank" rel="noopener">https://godweiyang.com/2018/04/13/hexo-blog/</a></p>
<p><a href="https://liolok.github.io/Hexo-Travis-CI/" target="_blank" rel="noopener">Hexo + Travis CI 博客管理</a></p>
<p>git rm –cached next</p>
<p><a href="https://www.jianshu.com/p/0f3fdf6c0d5f" target="_blank" rel="noopener">Windows系统下更新npm和node</a></p>
<p>node的n模块并不支持windows，所以以上命令只能算是linux等系统下的更新命令。</p>
<p><a href="https://blog.csdn.net/junhuahouse/article/details/23087755" target="_blank" rel="noopener">怎么进行：URLEncode编码 与 URLDecode解码</a></p>
<p><a href="https://meyerweb.com/eric/tools/dencoder/" target="_blank" rel="noopener">URL在线编解码</a></p>
<p><a href="https://blog.csdn.net/yelllowcong/article/details/79711429" target="_blank" rel="noopener">Springboot之接收json字符串的两种方式-yellowcong</a></p>
<p><a href="https://blog.csdn.net/wangjun5159/article/details/47781301" target="_blank" rel="noopener">postman 发送json请求</a></p>
<p><a href="https://www.bejson.com/jsoneditoronline/" target="_blank" rel="noopener">json在线编辑</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dubbo.pay.modular.api.chanel.channel4.notify;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.dubbo.pay.modular.api.chanel.channel4.consts.Channel4Constent;</span><br><span class="line"><span class="keyword">import</span> com.dubbo.pay.modular.api.service.IPayNotifyService;</span><br><span class="line"><span class="keyword">import</span> com.dubbo.pay.modular.api.utils.PayDigestUtil;</span><br><span class="line"><span class="keyword">import</span> com.dubbo.pay.modular.api.utils.ResponseUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>： libo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>： 2018/12/8:17:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Channel4NotifyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    IPayNotifyService payNotifyService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * status     订单状态,1:成功，其他失败</span></span><br><span class="line"><span class="comment">     * customerid 商户编号</span></span><br><span class="line"><span class="comment">     * sdpayno    平台订单号</span></span><br><span class="line"><span class="comment">     * sdorderno  商户订单号</span></span><br><span class="line"><span class="comment">     * total_fee  交易金额</span></span><br><span class="line"><span class="comment">     * paytype    支付类型</span></span><br><span class="line"><span class="comment">     * sign       MD5加密验证</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/pnotify/channel4"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json;charset=UTF-8"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">payNotifyRes</span><span class="params">(@RequestBody JSONObject param, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        String status = param.getString(<span class="string">"status"</span>);</span><br><span class="line">        String sdorderno = param.getString(<span class="string">"sdorderno"</span>);</span><br><span class="line">        String customerid = param.getString(<span class="string">"customerid"</span>);</span><br><span class="line">        String sdpayno = param.getString(<span class="string">"sdpayno"</span>);</span><br><span class="line">        String totalFee = param.getString(<span class="string">"total_fee"</span>);</span><br><span class="line">        String paytype = param.getString(<span class="string">"paytype"</span>);</span><br><span class="line">        String sign = param.getString(<span class="string">"sign"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> payResult = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//解析参数</span></span><br><span class="line">            log.info(<span class="string">"====== 通道4：接收支付回调通知开始解析参数。param=&#123;&#125; ======"</span>, param);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (sdorderno == <span class="keyword">null</span> || status == <span class="keyword">null</span>) &#123;</span><br><span class="line">                log.error(<span class="string">"====== 通道4：回调数据解析失败,sdorderno=&#123;&#125;,status=&#123;&#125; ======"</span>, sdorderno, status);</span><br><span class="line">                ResponseUtil.write(response, <span class="string">"回调数据解析失败"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String signStr = <span class="string">"customerid="</span> + customerid + <span class="string">"&amp;status="</span> + status + <span class="string">"&amp;sdpayno="</span> + sdpayno + <span class="string">"&amp;sdorderno="</span> + sdorderno + <span class="string">"&amp;total_fee="</span> + totalFee + <span class="string">"&amp;paytype="</span> + paytype + <span class="string">"&amp;"</span> + Channel4Constent.KEY;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isBlank(sign) || !sign.equals(PayDigestUtil.md5(signStr))) &#123;</span><br><span class="line">                log.error(<span class="string">"====== 通道4：签名验证失败。签名参数：&#123;&#125;，md5加密后实际值：&#123;&#125; ======"</span>, sign, PayDigestUtil.md5(signStr));</span><br><span class="line">                ResponseUtil.write(response, <span class="string">"签名验证失败"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"1"</span>.equals(status)) &#123;</span><br><span class="line">                payResult = <span class="number">1</span>;</span><br><span class="line">                log.info(<span class="string">"====== 支付成功 ======"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (payNotifyService.payHandler(sdorderno, payResult)) &#123;</span><br><span class="line">                ResponseUtil.write(response, <span class="string">"success"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"====== 通道4：回调异常。e=&#123;&#125; ======"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        ResponseUtil.write(response, <span class="string">"-1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p><a href="http://imshuai.com/change-linux-timezone/" target="_blank" rel="noopener">Linux查看和修改时区 - 毛帅的博客</a></p>
<p><a href="https://blog.csdn.net/halfclear/article/details/77573956" target="_blank" rel="noopener">Java中的Date和时区转换</a></p>
<p>Date里存放的毫秒数是与时区无关的,Date对象里存的是自格林威治时间（ GMT）1970年1月1日0点至Date对象所表示时刻所经过的毫秒数。</p>
<p>Sysytem.out.println函数在打印时间时，会取操作系统当前所设置的时区，然后根据这个时区将同毫秒数解释成该时区的时间。</p>
<p><a href="https://blog.csdn.net/Mr_linjw/article/details/49849691" target="_blank" rel="noopener">Mysql 更新时间（加上或者减去一段时间）</a></p>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html" target="_blank" rel="noopener">Java List API</a></p>
<p><a href="https://blog.csdn.net/qq754772661/article/details/81452131" target="_blank" rel="noopener">win10更新后 chrome内核浏览器总是打开网页一直加载 甚至打不开 解决方法</a></p>
<p><a href="https://www.cnblogs.com/wlandwl/p/bootstrap_table.html" target="_blank" rel="noopener">新的表格展示利器 Bootstrap Table Ⅰ</a></p>
<p><a href="https://github.com/Snailclimb/JavaGuide" target="_blank" rel="noopener">【Java学习+面试指南】 一份涵盖大部分Java程序员所需要掌握的核心知识。</a></p>
<p><a href="https://blog.csdn.net/qq_37599827/article/details/78731437" target="_blank" rel="noopener">js比较两个日期大小</a></p>
<p>@RequestParam 可以使用方法来填充默认值吗？？？</p>
<p>分析<code>DateUtil.offsetMinute()</code></p>
<p>位置：支付后台<code>com.dubbo.pay.modular.pay.controller.list()</code></p>
<p>总结Guns后台分页逻辑</p>
<p><a href="https://blog.csdn.net/xuanzhangran/article/details/60329357" target="_blank" rel="noopener">mybatis中大于等于小于等于的写法- chenxingde的博客- CSDN博客</a></p>
<p>什么是js中的闭包？</p>
<p><a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="noopener">学习Javascript闭包（Closure） - 阮一峰的网络日志</a></p>
<p><a href="https://blog.csdn.net/catoop/article/details/50501676" target="_blank" rel="noopener">Spring Boot Controller - 小单的博客专栏- CSDN博客 - CSDN Blog</a></p>
<p><a href="https://blog.csdn.net/isea533/article/details/50412212" target="_blank" rel="noopener">Spring Boot 静态资源处理</a></p>
<p><a href="https://blog.csdn.net/wangb_java/article/details/71775637" target="_blank" rel="noopener">spring boot(4)-html和templates</a></p>
<p><a href="https://blog.csdn.net/tim_yip/article/details/43466451" target="_blank" rel="noopener">微信内置浏览器是什么？</a></p>
<p><a href="https://www.jianshu.com/p/6a10f833b099" target="_blank" rel="noopener">判断微信客户端的那些坑</a></p>
<p><a href="https://blog.csdn.net/Q389281541/article/details/76502158" target="_blank" rel="noopener">如何区分客户端是手机端还是PC端</a></p>
<p><a href="https://blog.csdn.net/chendeyou5/article/details/79722731" target="_blank" rel="noopener">java request判断是否是微信客户端访问</a></p>
<p><a href="https://segmentfault.com/a/1190000014517685" target="_blank" rel="noopener">移动端监听安卓手机返回键</a></p>
<p><a href="http://phpstudy.php.cn/c.php/41712.html" target="_blank" rel="noopener">移动端web开发，页面如何监听安卓手机物理返回键的回退事件</a></p>
<p>@Value默认值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.db-name:guns&#125;"</span>)</span><br></pre></td></tr></table></figure>



<p><a href="https://blog.csdn.net/thekenofDIS/article/details/75116580" target="_blank" rel="noopener">使用AOP处理注解时出现error Type referred to is not an annotation type:xxx</a></p>
<p><a href="https://stackoverflow.com/questions/8574348/error-type-referred-to-is-not-an-annotation-type" target="_blank" rel="noopener">error Type referred to is not an annotation type:</a></p>
<p>Excel 怎么实现让部分内容滚动，比如表头不动，只又表体跟着鼠标滚轮滚动。</p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/%E5%86%BB%E7%BB%93%E7%AA%97%E6%A0%BC%E4%BB%A5%E9%94%81%E5%AE%9A%E8%A1%8C%E5%92%8C%E5%88%97-dab2ffc9-020d-4026-8121-67dd25f2508f" target="_blank" rel="noopener">冻结窗格以锁定行和列</a></p>
</blockquote>
<p>Excel怎么设置时间间隔</p>
<p><a href="https://blog.csdn.net/Mint6/article/details/78363761" target="_blank" rel="noopener">@Transactional(rollbackFor=Exception.class)的使用- Mint6的博客 …</a></p>
<p><a href="https://zh.wikipedia.org/zh-hans/RC4" target="_blank" rel="noopener">RC4加密算法 - 维基百科</a></p>
<p><a href="https://blog.csdn.net/fengshizty/article/details/48754609" target="_blank" rel="noopener">App开放接口api安全性—Token签名sign的设计与实现</a></p>
<p><a href="http://www.morecoder.com/article/1115597.html" target="_blank" rel="noopener">PAT——甲级1042：Shuffling Mashine</a></p>
<p>jQuery 去掉字符串前后空格</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$.trim(str)</span><br></pre></td></tr></table></figure>



<p>mybatis 不能将string类型的时间 插入到数据库。</p>
]]></content>
  </entry>
  <entry>
    <title>Design Pattern-Decorator</title>
    <url>/2020/11/03/Design-Pattern-Decorator/</url>
    <content><![CDATA[<img data-src="https://addyosmani.com/assets/decorator.jpg" width="100%"/>

<a id="more"></a>

<h2 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h2><blockquote>
<p>别称：包装模式、装饰器模式、Wrapper、Decorator</p>
</blockquote>
<p>装饰器模式（Decorator Pattern）允许在<strong>不改变其结构</strong>的情况下向一个现有的对象添加新的功能。</p>
<h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><ol>
<li><strong>抽象构件</strong> （Component）</li>
<li><strong>具体构件</strong> （Concrete Component）</li>
<li><strong>抽象装饰类</strong> （Decorator） </li>
<li><strong>具体装饰类</strong> （Concrete Decorators）</li>
</ol>
<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><blockquote>
<p><a href="https://www.runoob.com/design-pattern/decorator-pattern.html" target="_blank" rel="noopener">装饰器模式| 菜鸟教程</a></p>
</blockquote>
<p>画图形：图形有长方形、圆形；可以画红色的也可以画绿色的。</p>
<h4 id="抽象构件"><a href="#抽象构件" class="headerlink" title="抽象构件"></a>抽象构件</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="具体构件"><a href="#具体构件" class="headerlink" title="具体构件"></a>具体构件</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.print(<span class="string">"Shape: rectangle\t"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.print(<span class="string">"Shape: circle\t"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抽象装饰类"><a href="#抽象装饰类" class="headerlink" title="抽象装饰类"></a>抽象装饰类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeDecorator</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> Shape shape;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ShapeDecorator</span><span class="params">(Shape shape)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.shape = shape;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="具体装饰类"><a href="#具体装饰类" class="headerlink" title="具体装饰类"></a>具体装饰类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedShapeDecorator</span> <span class="keyword">extends</span> <span class="title">ShapeDecorator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">RedShapeDecorator</span><span class="params">(Shape shape)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(shape);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    shape.draw();</span><br><span class="line">    System.out.println(<span class="string">"Color: red"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreenShapeDecorator</span> <span class="keyword">extends</span> <span class="title">ShapeDecorator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">GreenShapeDecorator</span><span class="params">(Shape shape)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(shape);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    shape.draw();</span><br><span class="line">    System.out.println(<span class="string">"Color: green"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  Shape shape = <span class="keyword">new</span> RedShapeDecorator(<span class="keyword">new</span> Rectangle());</span><br><span class="line">  shape.draw();</span><br><span class="line"></span><br><span class="line">  shape = <span class="keyword">new</span> GreenShapeDecorator(<span class="keyword">new</span> Rectangle());</span><br><span class="line">  shape.draw();</span><br><span class="line"></span><br><span class="line">  shape = <span class="keyword">new</span> RedShapeDecorator(<span class="keyword">new</span> Circle());</span><br><span class="line">  shape.draw();</span><br><span class="line"></span><br><span class="line">  shape = <span class="keyword">new</span> GreenShapeDecorator(<span class="keyword">new</span> Circle());</span><br><span class="line">  shape.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Shape: rectangle	Color: red</span><br><span class="line">Shape: rectangle	Color: green</span><br><span class="line">Shape: circle	Color: red</span><br><span class="line">Shape: circle	Color: green</span><br></pre></td></tr></table></figure>

<h3 id="典型应用"><a href="#典型应用" class="headerlink" title="典型应用"></a>典型应用</h3><blockquote>
<p><a href="https://juejin.im/post/6844903681322647566" target="_blank" rel="noopener">设计模式| 装饰者模式及典型应用 - 掘金</a></p>
</blockquote>
<h4 id="Java-I-O"><a href="#Java-I-O" class="headerlink" title="Java I/O"></a>Java I/O</h4><p>抽象构件：<code>java.io.InputStream</code></p>
<p>具体构件：</p>
<ul>
<li><p><code>java.io.FileInputStream</code></p>
</li>
<li><p><code>java.io.ByteArrayInputStream</code></p>
</li>
<li><p><code>java.io.PipedInputStream</code></p>
</li>
</ul>
<p>抽象装饰类：<code>java.io.FilterInputStream</code></p>
<p>具体装饰类：</p>
<ul>
<li><p><code>java.io.BufferedInputStream</code></p>
</li>
<li><p><code>java.io.DataInputStream</code></p>
</li>
<li><p><code>java.io.PushbackInputStream</code></p>
</li>
</ul>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/9/18/165ecd4e160d8682" alt=""></p>
<p>实例化一个具有缓存功能的字节流对象时，只需要在 FileInputStream 对象上再套一层 BufferedInputStream 对象即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(filePath);</span><br><span class="line">BufferedInputStream bufferedInputStream = <span class="keyword">new</span> BufferedInputStream(fileInputStream);</span><br></pre></td></tr></table></figure>

<p>DataInputStream 装饰者提供了对更多数据类型进行输入的操作，比如 int、double 等基本类型。</p>
]]></content>
  </entry>
  <entry>
    <title>Design Pattern-Iterator</title>
    <url>/2020/11/04/Design-Pattern-Iterator/</url>
    <content><![CDATA[<img data-src="https://cdn.journaldev.com/wp-content/uploads/2013/07/iterator-design-pattern.jpg" width="100%"/>

<a id="more"></a>

<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><blockquote>
<p><a href="https://refactoringguru.cn/design-patterns/iterator" target="_blank" rel="noopener">迭代器设计模式 - Refactoring.Guru</a></p>
<p><a href="https://laijianfeng.org/2018/10/设计模式-迭代器模式及典型应用/" target="_blank" rel="noopener">设计模式| 迭代器模式及典型应用| 小旋锋</a></p>
</blockquote>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>在不暴露集合底层表现形式 （列表、 栈和树等） 的情况下遍历集合中所有的元素。</p>
<h3 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h3><p>将集合的遍历行为抽取为单独的迭代器对象。</p>
<h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><ol>
<li>抽象迭代器（Iterator）</li>
<li>具体迭代器（Concrete Iterators）</li>
<li>抽象集合（Collection）</li>
<li>具体集合（Concrete Collections）</li>
</ol>
<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><p>学生报数</p>
<h4 id="抽象迭代器"><a href="#抽象迭代器" class="headerlink" title="抽象迭代器"></a>抽象迭代器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentIterator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">hashNext</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">Student <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">getPosition</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="具体迭代器"><a href="#具体迭代器" class="headerlink" title="具体迭代器"></a>具体迭代器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteStudentIterator</span> <span class="keyword">implements</span> <span class="title">StudentIterator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Student[] students;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> position = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ConcreteStudentIterator</span><span class="params">(Student[] students)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.students = students;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> position;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hashNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> position &lt; students.length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Student <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> students[position++];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抽象集合"><a href="#抽象集合" class="headerlink" title="抽象集合"></a>抽象集合</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentCollection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">abstract</span> StudentIterator <span class="title">createIterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="具体集合"><a href="#具体集合" class="headerlink" title="具体集合"></a>具体集合</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteStudentCollection</span> <span class="keyword">extends</span> <span class="title">StudentCollection</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Student[] students;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ConcreteStudentCollection</span><span class="params">(Student[] students)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.students = students;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function">StudentIterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ConcreteStudentIterator(students);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  StudentCollection studentCollection = <span class="keyword">new</span> ConcreteStudentCollection(<span class="keyword">new</span> Student[]&#123;<span class="keyword">new</span> Student(<span class="string">"张三"</span>), <span class="keyword">new</span> Student(<span class="string">"李四"</span>)&#125;);</span><br><span class="line">  StudentIterator iterator = studentCollection.createIterator();</span><br><span class="line">  <span class="keyword">while</span> (iterator.hashNext()) &#123;</span><br><span class="line">    Student student = iterator.next();</span><br><span class="line">    System.out.println(<span class="string">"我是"</span> + iterator.getPosition() + <span class="string">"号："</span> + student.getName());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">我是1号：张三</span><br><span class="line">我是2号：李四</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h3 id="典型应用"><a href="#典型应用" class="headerlink" title="典型应用"></a>典型应用</h3><h4 id="Java-集合"><a href="#Java-集合" class="headerlink" title="Java 集合"></a>Java 集合</h4><p><img data-src="/post_image/image_2020_11_04T11_06_19_787Z.png" alt=""></p>
]]></content>
  </entry>
  <entry>
    <title>Design Pattern - Proxy</title>
    <url>/2020/10/26/Design-Pattern-Proxy/</url>
    <content><![CDATA[<img data-src="https://cdn.journaldev.com/wp-content/uploads/2013/07/proxy-design-pattern.jpg" width="100%"/>

<a id="more"></a>

<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><blockquote>
<p><a href="https://blog.csdn.net/shusheng0007/article/details/80864854" target="_blank" rel="noopener">秒懂Java代理与动态代理模式</a></p>
</blockquote>
<p>用代理对象<strong>代替</strong>目标对象来实现某个目的（服务/主题/功能）。</p>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><ol>
<li>隐藏目标对象</li>
<li>增强目标对象</li>
</ol>
<h3 id="代理模式结构"><a href="#代理模式结构" class="headerlink" title="代理模式结构"></a>代理模式结构</h3><blockquote>
<p><a href="https://refactoringguru.cn/design-patterns/proxy" target="_blank" rel="noopener">代理模式 | <strong>Refactoring.Guru</strong></a></p>
</blockquote>
<ol>
<li><p>服务接口</p>
<p>声明了服务接口。 代理必须遵循该接口才能伪装成服务对象。</p>
</li>
<li><p>服务类</p>
<p>提供了一些实用的业务逻辑。</p>
</li>
<li><p>代理类</p>
<p>代理类包含一个指向服务对象的引用成员变量。 代理完成其任务 （例如延迟初始化、 记录日志、 访问控制和缓存等） 后会将请求传递给服务对象。 通常情况下， 代理会对其服务对象的整个生命周期进行管理。</p>
</li>
<li><p>客户端</p>
<p>客户端能通过同一接口与服务或代理进行交互，所以你可在一切需要服务对象的代码中使用代理。</p>
</li>
</ol>
<h2 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h2><p>劳动仲裁案例：代理律师代理讨薪员工索要工资。</p>
<h3 id="服务接口"><a href="#服务接口" class="headerlink" title="服务接口"></a>服务接口</h3><blockquote>
<p>代理主题：讨薪</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AskAbility</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="服务类"><a href="#服务类" class="headerlink" title="服务类"></a>服务类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhangSan</span> <span class="keyword">implements</span> <span class="title">AskAbility</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"还钱！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代理类"><a href="#代理类" class="headerlink" title="代理类"></a>代理类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lawyer</span> <span class="keyword">implements</span> <span class="title">AskAbility</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> ZhangSan zhangSan;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Lawyer</span><span class="params">(ZhangSan zhangSan)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.zhangSan = zhangSan;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    zhangSan.askForPay();</span><br><span class="line">    System.out.println(<span class="string">"如果不还将承担法律责任！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ZhangSan zhangSan = <span class="keyword">new</span> ZhangSan();</span><br><span class="line">    AskAbility ask = <span class="keyword">new</span> Lawyer(zhangSan);</span><br><span class="line">    ask.askForPay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><p>静态代理中代理类在编译期已经存在，一个服务类需要一个代理类与之对应，当服务类增多时，代理类随着增多，导致类数量太多。</p>
<p>动态代理就是为了减少类数量而产生。</p>
<p>动态代理有 JDK(基于接口、反射生成) 和 CGLIB(基于继承、字节码生成) 两种实现方式。</p>
<p>Spring AOP 就是基于动态代理实现的。</p>
<blockquote>
<p><a href="https://blog.csdn.net/javazejian/article/details/56267036" target="_blank" rel="noopener">关于 Spring AOP (AspectJ) 你该知晓的一切</a></p>
<p><a href="https://how2j.cn/k/spring/spring-annotation-ioc-di/1067.html" target="_blank" rel="noopener">Spring系列教材 （三）- 注解方式 IOC/DI</a></p>
</blockquote>
<h3 id="JDK-动态代理"><a href="#JDK-动态代理" class="headerlink" title="JDK 动态代理"></a>JDK 动态代理</h3><p>两个重要的元素：</p>
<ol>
<li><p>InvocationHandler 接口</p>
<p><code>public Object invoke(Object proxy, Method method, Object[] args) throws Throwable;</code></p>
<ul>
<li>proxy：动态代理对象</li>
<li>method：正在执行的方法</li>
<li>args：当前执行方法传入的实参</li>
</ul>
</li>
<li><p>Proxy 类</p>
<p><code>public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException</code></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AskingHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AskingHandler</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.target = target;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    Object invoke = method.invoke(target, args);</span><br><span class="line">    System.out.println(<span class="string">"如果不还将承担法律责任！"</span>);</span><br><span class="line">    <span class="keyword">return</span> invoke;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">    InvocationHandler handler = <span class="keyword">new</span> AskingHandler(employee);</span><br><span class="line">    AskAbility proxy = (AskAbility) Proxy.newProxyInstance(employee.getClass().getClassLoader(), employee.getClass().getInterfaces(), handler);</span><br><span class="line">    proxy.askForPay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CGLIB-动态代理"><a href="#CGLIB-动态代理" class="headerlink" title="CGLIB 动态代理"></a>CGLIB 动态代理</h3><p>JDK 只能对实现了接口的类做动态代理，而不能对没有实现接口的类做动态代理，所以出现了 cgLib。</p>
<p>CGLib（Code Generation Library）是一个强大、高性能的 Code 生成类库，它可以在程序运行期间动态扩展类或接口，它的底层是使用 <strong>java字节码操作框架</strong> ASM 实现。</p>
<p>CGLIB 两个重要元素：</p>
<ol>
<li><p>MethodInterceptor 方法拦截器</p>
<p><code>Object intercept(Object var1, Method var2, Object[] var3, MethodProxy var4) throws Throwable;</code></p>
</li>
<li><p>Enhancer</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">create</span><span class="params">(Class type, Callback callback)</span> </span>&#123;</span><br><span class="line">  Enhancer e = <span class="keyword">new</span> Enhancer();</span><br><span class="line">  e.setSuperclass(type);</span><br><span class="line">  e.setCallback(callback);</span><br><span class="line">  <span class="keyword">return</span> e.create();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="服务类-1"><a href="#服务类-1" class="headerlink" title="服务类"></a>服务类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"还钱！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方法拦截器"><a href="#方法拦截器" class="headerlink" title="方法拦截器"></a>方法拦截器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AskingMethodInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    Object result = methodProxy.invokeSuper(o, objects);</span><br><span class="line">    <span class="keyword">if</span> (method.getName().equals(<span class="string">"askForPay"</span>))</span><br><span class="line">      System.out.println(<span class="string">"如果不还将承担法律责任！"</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">    Employee proxy = (Employee) Enhancer.create(employee.getClass(), <span class="keyword">new</span> AskingMethodInterceptor());</span><br><span class="line"></span><br><span class="line">    proxy.askForPay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Design Pattern - Singleton</title>
    <url>/2020/10/22/Design-Pattern-Singleton/</url>
    <content><![CDATA[<img data-src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSEYmhD44QXA-K_w4fBjzKvdjkiZ2dcl55lbA&usqp=CAU" width="100%"/>

<a id="more"></a>

<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><h3 id="饿汉模式"><a href="#饿汉模式" class="headerlink" title="饿汉模式"></a>饿汉模式</h3><blockquote>
<p>Static initializers are run by the JVM at class initialization time, after class loading but before the class is used by any thread. Because the <span style="color: red">JVM acquires a lock during initialization</span> [JLS 12.4.2] and this lock is acquired by each thread at least once to ensure that the class has been loaded, memory writes made during static initialization are automatically visible to all threads. Thus statically initialized objects require no explicit synchronization either during construction or when being referenced</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton1 instance = <span class="keyword">new</span> Singleton1();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类加载机制保障了饿汉模式的线程安全。JVM在类加载时会获取一把锁，这把锁在线程访问对象时也会先去争取，确保类已经被加载了。</p>
<h3 id="懒汉模式"><a href="#懒汉模式" class="headerlink" title="懒汉模式"></a>懒汉模式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton2 instance;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton2 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> Singleton2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="线程安全的懒汉模式"><a href="#线程安全的懒汉模式" class="headerlink" title="线程安全的懒汉模式"></a>线程安全的懒汉模式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton3 instance;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton3 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> Singleton3();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="双重校验锁模式（DCL，即-double-checked-locking）"><a href="#双重校验锁模式（DCL，即-double-checked-locking）" class="headerlink" title="双重校验锁模式（DCL，即 double-checked locking）"></a>双重校验锁模式（DCL，即 double-checked locking）</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton4 instance;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton4 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (Singleton4<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">          instance = <span class="keyword">new</span> Singleton4();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="为什么要两次判空？"><a href="#为什么要两次判空？" class="headerlink" title="为什么要两次判空？"></a>为什么要两次判空？</h4><p>第一次判空是为了减少无谓的抢夺锁，提升销量。</p>
<p>第二次判空是为了保障不会破坏单例，假设没有第二次判空，线程1，线程2 同时通过第一次判空，之后线程1获得了锁，并实例化了 instance，之后线程2 获得锁，又会实例化一遍，破坏了单例模式。</p>
<h4 id="为什么要加-volatile-关键字？"><a href="#为什么要加-volatile-关键字？" class="headerlink" title="为什么要加 volatile 关键字？"></a>为什么要加 volatile 关键字？</h4><blockquote>
<p><a href="https://blog.csdn.net/justloveyou_/article/details/64127789" target="_blank" rel="noopener">彻头彻尾理解单例模式与多线程</a></p>
</blockquote>
<p><code>instance = new Singleton4();</code> 可以被拆解为三条机器指令（伪代码）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">memory &#x3D; allocate();        &#x2F;&#x2F;1:分配对象的内存空间</span><br><span class="line">ctorInstance(memory);       &#x2F;&#x2F;2:初始化对象</span><br><span class="line">instance &#x3D; memory;        &#x2F;&#x2F;3:使 instance 引用指向刚分配的内存地址</span><br></pre></td></tr></table></figure>

<p>由于存在指令重排序，上述三条指令的顺序可能会变成 1、3、2</p>
<p>如果没有使用 volatile，那假设线程1 已经执行到创建对象的语句了，且刚好执行到重排序后到机器指令3，此时 instance 已经不是 null 了，其他线程就会获取到一个没有完整初始化的 instance 对象，进而造成未知错误。</p>
<h3 id="静态内部类单例模式"><a href="#静态内部类单例模式" class="headerlink" title="静态内部类单例模式"></a>静态内部类单例模式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton5 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> InnerClass.instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton5 instance = <span class="keyword">new</span> Singleton5();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态内部类模式综合了懒汉和饿汉模式，既满足线程安全，又满足延迟加载。</p>
<h3 id="枚举单例模式"><a href="#枚举单例模式" class="headerlink" title="枚举单例模式"></a>枚举单例模式</h3><blockquote>
<p>《Effective Java》作者认为该模式是单例模式的最佳实践。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton6 &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="反射攻击"><a href="#反射攻击" class="headerlink" title="反射攻击"></a>反射攻击</h2><p>私有化构造器并不能阻止反射攻击。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">  Singleton1 instance = Singleton1.getInstance();</span><br><span class="line"></span><br><span class="line">  Constructor&lt;Singleton1&gt; declaredConstructor = Singleton1<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>()</span>;</span><br><span class="line">  declaredConstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">  Singleton1 instance1 = declaredConstructor.newInstance();</span><br><span class="line">  System.out.println(instance == instance1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">false</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>反射攻击枚举单例模式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">  Singleton6 instance = Singleton6.INSTANCE;</span><br><span class="line"></span><br><span class="line">  Constructor&lt;Singleton6&gt; declaredConstructor = Singleton6<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>()</span>;</span><br><span class="line">  declaredConstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">  Singleton6 instance2 = declaredConstructor.newInstance();</span><br><span class="line">  System.out.println(instance == instance2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.NoSuchMethodException: com.gzhennaxia.demo.singleton.Singleton6.&lt;init&gt;()</span><br><span class="line">	at java.lang.Class.getConstructor0(Class.java:<span class="number">3082</span>)</span><br><span class="line">	at java.lang.Class.getDeclaredConstructor(Class.java:<span class="number">2178</span>)</span><br></pre></td></tr></table></figure>

<p>报错说找不到空构造方法，但即使手动添加了空构造方法同样会报这个错，因为 Java 编译器会为每个构造器自动添加两个参数，这点从反编译文件中可以看出（只有一个 <code>com/gzhennaxia/demo/singleton/Singleton6.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</code> 双参构造器）。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton6 &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Classfile /Users/libo/Documents/GitHub/projects/demo/src/main/java/com/gzhennaxia/demo/singleton/Singleton6<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">  <span class="title">Last</span> <span class="title">modified</span> 2020年10月22日</span>; size <span class="number">921</span> bytes</span><br><span class="line">  MD5 checksum bf867cdc275213b5182d9e511c593cad</span><br><span class="line">  Compiled from <span class="string">"Singleton6.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">gzhennaxia</span>.<span class="title">demo</span>.<span class="title">singleton</span>.<span class="title">Singleton6</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">com</span>.<span class="title">gzhennaxia</span>.<span class="title">demo</span>.<span class="title">singleton</span>.<span class="title">Singleton6</span>&gt;</span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">56</span></span><br><span class="line">  flags: (<span class="number">0x4031</span>) ACC_PUBLIC, ACC_FINAL, ACC_SUPER, ACC_ENUM</span><br><span class="line">  this_class: #4                          // com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">  super_class: #10                        // java/lang/Enum</span><br><span class="line">  interfaces: <span class="number">0</span>, fields: <span class="number">2</span>, methods: <span class="number">4</span>, attributes: <span class="number">2</span></span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Fieldref           #4.#29         // com/gzhennaxia/demo/singleton/Singleton6.$VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">   #2 = Methodref          #30.#31        // "[Lcom/gzhennaxia/demo/singleton/Singleton6;".clone:()Ljava/lang/Object;</span><br><span class="line">   #3 = Class              #14            // "[Lcom/gzhennaxia/demo/singleton/Singleton6;"</span><br><span class="line">   #4 = Class              #32            // com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">   #5 = Methodref          #10.#33        // java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">   #6 = Methodref          #10.#34        // java/lang/Enum."&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">   #7 = String             #11            // INSTANCE</span><br><span class="line">   #8 = Methodref          #4.#34         // com/gzhennaxia/demo/singleton/Singleton6."&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">   #9 = Fieldref           #4.#35         // com/gzhennaxia/demo/singleton/Singleton6.INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #10 = Class              #36            // java/lang/Enum</span><br><span class="line">  #11 = Utf8               INSTANCE</span><br><span class="line">  #12 = Utf8               Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #13 = Utf8               $VALUES</span><br><span class="line">  #14 = Utf8               [Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #15 = Utf8               values</span><br><span class="line">  #16 = Utf8               ()[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #17 = Utf8               Code</span><br><span class="line">  #18 = Utf8               LineNumberTable</span><br><span class="line">  #19 = Utf8               valueOf</span><br><span class="line">  #20 = Utf8               (Ljava/lang/String;)Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #21 = Utf8               &lt;init&gt;</span><br><span class="line">  #22 = Utf8               (Ljava/lang/String;I)V</span><br><span class="line">  #23 = Utf8               Signature</span><br><span class="line">  #24 = Utf8               ()V</span><br><span class="line">  #25 = Utf8               &lt;clinit&gt;</span><br><span class="line">  #26 = Utf8               Ljava/lang/Enum&lt;Lcom/gzhennaxia/demo/singleton/Singleton6;&gt;;</span><br><span class="line">  #27 = Utf8               SourceFile</span><br><span class="line">  #28 = Utf8               Singleton6.java</span><br><span class="line">  #29 = NameAndType        #13:#14        // $VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #30 = Class              #14            // "[Lcom/gzhennaxia/demo/singleton/Singleton6;"</span><br><span class="line">  #31 = NameAndType        #37:#38        // clone:()Ljava/lang/Object;</span><br><span class="line">  #32 = Utf8               com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">  #33 = NameAndType        #19:#39        // valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">  #34 = NameAndType        #21:#22        // "&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">  #35 = NameAndType        #11:#12        // INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #36 = Utf8               java/lang/Enum</span><br><span class="line">  #37 = Utf8               clone</span><br><span class="line">  #38 = Utf8               ()Ljava/lang/Object;</span><br><span class="line">  #39 = Utf8               (Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.gzhennaxia.demo.singleton.Singleton6 INSTANCE;</span><br><span class="line">    descriptor: Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">    flags: (<span class="number">0x4019</span>) ACC_PUBLIC, ACC_STATIC, ACC_FINAL, ACC_ENUM</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.gzhennaxia.demo.singleton.Singleton6[] values();</span><br><span class="line">    descriptor: ()[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">    flags: (<span class="number">0x0009</span>) ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         0: getstatic     #1                  // Field $VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">         3: invokevirtual #2                  // Method "[Lcom/gzhennaxia/demo/singleton/Singleton6;".clone:()Ljava/lang/Object;</span><br><span class="line">         6: checkcast     #3                  // class "[Lcom/gzhennaxia/demo/singleton/Singleton6;"</span><br><span class="line">         <span class="number">9</span>: areturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.gzhennaxia.demo.singleton.<span class="function">Singleton6 <span class="title">valueOf</span><span class="params">(java.lang.String)</span></span>;</span><br><span class="line">    descriptor: (Ljava/lang/String;)Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">    flags: (<span class="number">0x0009</span>) ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         0: ldc           #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">         <span class="number">2</span>: aload_0</span><br><span class="line">         3: invokestatic  #5                  // Method java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">         6: checkcast     #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">         <span class="number">9</span>: areturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: (<span class="number">0x0008</span>) ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">4</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         0: new           #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">         <span class="number">3</span>: dup</span><br><span class="line">         4: ldc           #7                  // String INSTANCE</span><br><span class="line">         <span class="number">6</span>: iconst_0</span><br><span class="line">         7: invokespecial #8                  // Method "&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">        10: putstatic     #9                  // Field INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">        <span class="number">13</span>: iconst_1</span><br><span class="line">        14: anewarray     #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">        <span class="number">17</span>: dup</span><br><span class="line">        <span class="number">18</span>: iconst_0</span><br><span class="line">        19: getstatic     #9                  // Field INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">        <span class="number">22</span>: aastore</span><br><span class="line">        23: putstatic     #1                  // Field $VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">        <span class="number">26</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">8</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">7</span>: <span class="number">13</span></span><br><span class="line">&#125;</span><br><span class="line">Signature: #26                          // Ljava/lang/Enum&lt;Lcom/gzhennaxia/demo/singleton/Singleton6;&gt;;</span><br><span class="line">SourceFile: <span class="string">"Singleton6.java"</span></span><br></pre></td></tr></table></figure>

<p>从反编译结果可以看出枚举的实例化调用的是继承自 <code>java.lang.Enum</code> 的 <code>protected Enum(String var1, int var2)</code> 构造器，那是否可以反射调用该构造器来实例化 Singleton6 呢？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">  Singleton6 instance = Singleton6.INSTANCE;</span><br><span class="line"></span><br><span class="line">  Constructor&lt;Singleton6&gt; declaredConstructor = Singleton6<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>(<span class="title">String</span>.<span class="title">class</span>, <span class="title">int</span>.<span class="title">class</span>)</span>;</span><br><span class="line">  declaredConstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">  Singleton6 instance2 = declaredConstructor.newInstance(<span class="string">""</span>, <span class="number">0</span>);</span><br><span class="line">  System.out.println(instance == instance2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Cannot reflectively create enum objects</span><br><span class="line">	at java.lang.reflect.Constructor.newInstance(Constructor.java:417)</span><br></pre></td></tr></table></figure>

<p>结果报错，查看 java.lang.reflect.Constructor.newInstance(Constructor.java:417)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(Object ... initargs)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> InstantiationException, IllegalAccessException,</span></span><br><span class="line"><span class="function">IllegalArgumentException, InvocationTargetException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!override) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;</span><br><span class="line">      Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">      checkAccess(caller, clazz, <span class="keyword">null</span>, modifiers);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((clazz.getModifiers() &amp; Modifier.ENUM) != <span class="number">0</span>)</span><br><span class="line">    <span class="comment">////////////  417  //////////// </span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Cannot reflectively create enum objects"</span>);</span><br><span class="line">  ConstructorAccessor ca = constructorAccessor;   <span class="comment">// read volatile</span></span><br><span class="line">  <span class="keyword">if</span> (ca == <span class="keyword">null</span>) &#123;</span><br><span class="line">    ca = acquireConstructorAccessor();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">  T inst = (T) ca.newInstance(initargs);</span><br><span class="line">  <span class="keyword">return</span> inst;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到反射创建实例的时候会判断类的修饰符中是否有 enum，如果有就抛出 <code>IllegalArgumentException</code> 异常。</p>
<p>因此，<strong>枚举类型可以防止反射攻击</strong>。</p>
<h3 id="非枚举的防守方法"><a href="#非枚举的防守方法" class="headerlink" title="非枚举的防守方法"></a>非枚举的防守方法</h3><p>在构造器中判断实例是否已经存在，存在就抛出异常，保证构造器只被调用一次！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton1 instance = <span class="keyword">new</span> Singleton1();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance != <span class="keyword">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"实例已存在，单例构造器只能被调用一次！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="序列化攻击"><a href="#序列化攻击" class="headerlink" title="序列化攻击"></a>序列化攻击</h2><p>一般类需要实现 <code>Serializable</code> 接口才能被序列化，但枚举类不用，因为枚举类本质是继承了 <code>java.lang.Enum</code> 的，而 Enum 已经声明实现了 <code>Serializable</code>。</p>
<p>一般的单例模式无法防止序列化攻击，经过序列化和反序列化后会创建出新的实例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonTest2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    Singleton1 instance = Singleton1.getInstance();</span><br><span class="line"></span><br><span class="line">    ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(outputStream);</span><br><span class="line">    objectOutputStream.writeObject(instance);</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = outputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">    ByteArrayInputStream byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">    ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(byteArrayInputStream);</span><br><span class="line">    Singleton1 instance1 = (Singleton1) objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">    System.out.println(instance == instance1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">false</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>但是对于枚举类来说，反序列化后还是原来的实例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">  Singleton6 instance = Singleton6.INSTANCE;</span><br><span class="line"></span><br><span class="line">  ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">  ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(outputStream);</span><br><span class="line">  objectOutputStream.writeObject(instance);</span><br><span class="line">  <span class="keyword">byte</span>[] bytes = outputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">  ByteArrayInputStream byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">  ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(byteArrayInputStream);</span><br><span class="line">  Singleton6 instance1 = (Singleton6) objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">  System.out.println(instance == instance1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">true</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到反序列化枚举后得到的实例和序列化之前的实例是同一个实例。查看 <code>ByteArrayOutputStream.writeObject()</code> 方法源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (enableOverride) &#123;</span><br><span class="line">    writeObjectOverride(obj);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    writeObject0(obj, <span class="keyword">false</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == <span class="number">0</span>) &#123;</span><br><span class="line">      writeFatalException(ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> ex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>writeObject0()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject0</span><span class="params">(Object obj, <span class="keyword">boolean</span> unshared)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// remaining cases</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">    writeString((String) obj, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cl.isArray()) &#123;</span><br><span class="line">    writeArray(obj, desc, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Enum) &#123;</span><br><span class="line">    writeEnum((Enum&lt;?&gt;) obj, desc, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Serializable) &#123;</span><br><span class="line">    writeOrdinaryObject(obj, desc, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(</span><br><span class="line">        cl.getName() + <span class="string">"\n"</span> + debugInfoStack.toString());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(cl.getName());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  depth--;</span><br><span class="line">  bout.setBlockDataMode(oldMode);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果是枚举类型，会调用 <code>writeEnum()</code> 方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeEnum</span><span class="params">(Enum&lt;?&gt; en,</span></span></span><br><span class="line"><span class="function"><span class="params">                       ObjectStreamClass desc,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">boolean</span> unshared)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Enum 类型标记：129</span></span><br><span class="line"><span class="comment">     * new Enum constant.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="comment">// final static byte TC_ENUM =         (byte)0x7E;</span></span><br><span class="line">  bout.writeByte(TC_ENUM);</span><br><span class="line">  ObjectStreamClass sdesc = desc.getSuperDesc();</span><br><span class="line">  writeClassDesc((sdesc.forClass() == Enum.class) ? desc : sdesc, false);</span><br><span class="line">  handles.assign(unshared ? <span class="keyword">null</span> : en);</span><br><span class="line">  writeString(en.name(), <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着再看 Enum 类型的反序列化，<code>ObjectInputStream.readObject()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">readObject</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException, ClassNotFoundException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (enableOverride) &#123;</span><br><span class="line">    <span class="keyword">return</span> readObjectOverride();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if nested read, passHandle contains handle of enclosing object</span></span><br><span class="line">  <span class="keyword">int</span> outerHandle = passHandle;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Object obj = readObject0(<span class="keyword">false</span>);</span><br><span class="line">    handles.markDependency(outerHandle, passHandle);</span><br><span class="line">    ClassNotFoundException ex = handles.lookupException(passHandle);</span><br><span class="line">    <span class="keyword">if</span> (ex != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (depth == <span class="number">0</span>) &#123;</span><br><span class="line">      vlist.doCallbacks();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    passHandle = outerHandle;</span><br><span class="line">    <span class="keyword">if</span> (closed &amp;&amp; depth == <span class="number">0</span>) &#123;</span><br><span class="line">      clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ObjectInputStream.readObject0()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readObject0</span><span class="params">(<span class="keyword">boolean</span> unshared)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (tc) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> TC_ENUM:</span><br><span class="line">        <span class="keyword">return</span> checkResolve(readEnum(unshared));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_OBJECT:</span><br><span class="line">        <span class="keyword">return</span> checkResolve(readOrdinaryObject(unshared));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_EXCEPTION:</span><br><span class="line">        IOException ex = readFatalException();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WriteAbortedException(<span class="string">"writing aborted"</span>, ex);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_BLOCKDATA:</span><br><span class="line">      <span class="keyword">case</span> TC_BLOCKDATALONG:</span><br><span class="line">        <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">          bin.setBlockDataMode(<span class="keyword">true</span>);</span><br><span class="line">          bin.peek();             <span class="comment">// force header read</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> OptionalDataException(</span><br><span class="line">            bin.currentBlockRemaining());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> StreamCorruptedException(</span><br><span class="line">            <span class="string">"unexpected block data"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_ENDBLOCKDATA:</span><br><span class="line">        <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> OptionalDataException(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> StreamCorruptedException(</span><br><span class="line">            <span class="string">"unexpected end of block data"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StreamCorruptedException(</span><br><span class="line">          String.format(<span class="string">"invalid type code: %02X"</span>, tc));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    depth--;</span><br><span class="line">    bin.setBlockDataMode(oldMode);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ObjectInputStream.readEnum()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Enum&lt;?&gt; readEnum(<span class="keyword">boolean</span> unshared) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (cl != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">      Enum&lt;?&gt; en = Enum.valueOf((Class)cl, name);</span><br><span class="line">      result = en;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">      <span class="keyword">throw</span> (IOException) <span class="keyword">new</span> InvalidObjectException(</span><br><span class="line">        <span class="string">"enum constant "</span> + name + <span class="string">" does not exist in "</span> +</span><br><span class="line">        cl).initCause(ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!unshared) &#123;</span><br><span class="line">      handles.setObject(enumHandle, result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handles.finish(enumHandle);</span><br><span class="line">  passHandle = enumHandle;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Enum.valueOf()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt;&gt; <span class="function">T <span class="title">valueOf</span><span class="params">(Class&lt;T&gt; enumType,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            String name)</span> </span>&#123;</span><br><span class="line">  T result = enumType.enumConstantDirectory().get(name);</span><br><span class="line">  <span class="keyword">if</span> (result != <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  <span class="keyword">if</span> (name == <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"Name is null"</span>);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">    <span class="string">"No enum constant "</span> + enumType.getCanonicalName() + <span class="string">"."</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终是根据 <code>name</code> 在枚举类实力数组里查找，所以返回的实例是已经存在的实例，并不会新建实例。</p>
<p>因此<strong>枚举可以防止反序列化攻击</strong>。</p>
<h3 id="非枚举的防守方法-1"><a href="#非枚举的防守方法-1" class="headerlink" title="非枚举的防守方法"></a>非枚举的防守方法</h3><p>增加 <code>readResolve()</code> 方法返回单例，反序列化时会判断对象是否存在该方法，存在则会调用该方法返回对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><table>
<thead>
<tr>
<th></th>
<th>饿汉模式</th>
<th>懒汉模式</th>
<th>线程安全的懒汉模式</th>
<th>双重校验锁模式</th>
<th>静态内部类单例模式</th>
<th>枚举单例模式</th>
</tr>
</thead>
<tbody><tr>
<td>延迟加载</td>
<td><span style="color: red"/>否</span></td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td><span style="color: red"/>否</span></td>
</tr>
<tr>
<td>线程安全</td>
<td>是</td>
<td><span style="color: red"/>否</span></td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>反射攻击<br />(能否抵御)</td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td>能</td>
</tr>
<tr>
<td>反序列化攻击<br />(能否抵御)</td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td><span style="color: red"/>否</span></td>
<td>能</td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>Design Pattern - Template Method</title>
    <url>/2020/08/26/Design-Pattern-Template-Method/</url>
    <content><![CDATA[<img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARkAAAC0CAMAAACXO6ihAAAAkFBMVEX+/v7////9/f3y8vL6+vqioqLQ0NBvb295eXnCwsKysrK9vb0AAACwsLD29vZ9fX3u7u7a2tqZmZloaGjm5ubd3d3Ly8vh4eG/v7+QkJC3t7fIyMiqqqqkpKSJiYlZWVlhYWFRUVE7OztDQ0OUlJQoKCghISE2NjZCQkIaGhpUVFQjIyNKSko5OTkvLy8REREwOaKlAAAbBklEQVR4nO1di3qjKhAGRLwhgqImajS3Nk3qJu//dmdA0+7ldJukTdPd7Xy7SaoI+DsMM8MwIvxF/0/o1h34tPSFzEv0hcxL9IXMS/SFzEv0hcxL9D0y6F+m3yFz677dlr6QeYm+kHmJXkOGUELIbwXT30MIUbhbfCIyUFjQf4V9DBOQ4x+vIUOIEM6/QlJKh56MDKXOwvt3KDsZGRhNjn/aMP0biCb0ZDmDMCDzP+X+QkIYieR0CUwGZP4REmfwDMHiusiQ14s8lz2n8AVEzkAGXw8ZgsZR+nrRn57W1egTIGMVSKooFqySxPwJ/0HcwxfMhtSeJtR+moOCRVWtnALK2hKEjOffu1u3RwbuXuBm7mC95MrcqUVDglZpcbF/mTLwQ1PC5n0ULn192JZEmOMGSireH5rbI0OMYl0f5oI6D53A5mYpxZNWGJYQFNm/LfsgNhf1/UOOcZ0628xgBlyELHSCvrfcuS0yxMhcwEHtuCcQ49mM0boJAznlHmuqkBEZBfEEUxmGzJnd9eWKV4CR0BPeYKeaRBEtZ1Uo5Sxu9Ps+tNsig41tAiNn3QAyOOX+flNu0ybR/SFt+I6v5apd8xlm3+JkpTPeNnwl7SBruZILOOfirit22u+LrvybkDFDx6hUDSBD6WLv+PcTvmJa7Hck5H6ct1tgH+X0Hqkqmt3JlrfGeqPOZkXbe3OO9jwsxZw3Srxnzz4DMpSuvXbOW5RvEwBHT/mcFnyNfM5wee85DwsR8Ara1tsMWMU1wgcKpHrrOZvOQQG/U5gdDgyR9+3bjeUMJU7sUhzyFv5PGG+ZzLblmgflciFwzdMZT5wGhEopQ+6KEHgL0aBMeRDxtctbCeKHh0rG3P2rJLCZeKKlRk7Cfaflk87LdyxdADiziKcYM36X8Uwrvm1TM5K0k8EYS1zH4+uaP8K5PEmLO9VO2bL4q5CBmdYJAk3KoK4dXTURFUFcScwaR9YSA2yBjEGyMrcQOG9KjEm0njI4MJO0CrRbojoMcwzzmXrfsXRrZMZGnz/I8ImtrUDGLtmD1s86HrBf6LmL5NjD96QzkfkEtrYB6SPaOQeZT+GFwNZa+oCGzkIGfQJkTC8+pJVzkDF2nv8J1g4+pAeYnOHTwxT9Q35ges5oAp7J2D9DtX86MkI4O/efoTQTp89N/9JoOmtV5TPM2h9GN9eBPy2dqen9Q8ictd70STS9jyAw1ow+MyrbryEDmt4/JIHP0oEF+of0maL2zrAOhNPNbq1mfBTN3OwMZKj8d0YTosnJmt5gN5lf45IpOboDhnVUs7w4rqYi+388OZT40XVgimI6/iQ/ry9+lKfhZcKEOmfNTeKIjFlNfV4xxWbB2awS2sVWs5xolx7H0+Z689ePbdPxNP51Vdou117rnk8kfM6s/azpmQVTbFdVj9cOC6gWF8MNeLg7OlRr2QJO/zDj28J4rOwHHMwKLnr3Ffxz6TIdmAiBNKXf3RAd1ulFWTjDcKKaySMywBaOXXP7oWWqlTkPoKGfOISKXNx4NF2GjPHgF7R1BD0us8N5FhhA5LRzbJgHEs2dJE+nnUSbux9rsi5tUno+MA2hsSIDak+lZcOqPxAZYmRqmst0ELlDJAdBYQt/YNy2eAj0QHFmYzesTMbpThJqxTAeokAw0zhLsSmaBZiOMTLGyWsmQEVm8tbK9gXIEKLrNohbDZJDCtBxNCAgpIABIOUusGKCSCebgXjXFhxaLD0hhAP/KHVsWbYo5YJRhwgHDsO4Mwv5QjvCAT07xsSd/IHIUMr85XSeZZ4ju5JG63WrSb0MSNmE3lKblSHdxO1eoSB12xLK63XrU9m2dTIX4UJRr9bLnhU9azvppJ1s5kW6ULj2pr7fkHgHkK/dPw8ZGBRYrXGoykdF/DLsNe4brDa6zGqceEagSq9Cbi/qZYnmU5iwp7nfEpx5cbMRuo9wXItdg9PMjTaapBluFm6wYXoZ4jbTYtWAPPf+QGRAWujptPIatazzRi5jTPcNbjrip8QBjGDSSRNKsyndpVhkIHdiv9mvsbPxxBSA9UIxc9Re0x6YpSOiq3CyydlGqrtSLCrM9jlMZd/CPw8ZkJGOVzBfyflsJtmmxGzLiNfojcLuIQeWcTYTPOGB5jnK7xhmqZYPKZTKxWqCSJtWDICk+T6gXYP1pnQeXJDcRKRJmwpcLRyKi807xwmdTxfN2mBRKGAVr8uJelAU5hh9FxePk8BbMphnnM2s8PeR3jLHT0Tpa6r3FV57uF7CZJzuKiy8RMUdLe9jGi+i4lGLh7UUyQwENK7mBOEkufm61vnIAMmQ1AURbg3StXLdCtS+eUTXXVUDCjB3NV2j/BLX6WwmZJuVYtZNy3WNCy+neJaALti2ThMilSlUeTpwqfQmpOj6b1ONCwClXOg/EBlzEUytdDCMYKoV1k7AJg5TjGGqAtRY4xUTQ2QmlBFDECuoxo22RtdwfIxmhU+AScu6D7FMiJgyNKjPZIih/mOQsca2CUW1+6OMTEZ2yqKjmf3dt41XHU1MOKg8V9ugRYzQaJJjMYSvsgVTIL0wDVhYDPYCQTc0LS/jGav94u89C/ZWj0oxGlEarcKjXQ6HykYaFH41LYHj8nAaaiKwZuVwyEAuyJ+FzOiI+ckeHjwQwz67Ibb5aEuPceEGTssIP/RgQNMMKmy/R4az0cI/WK0fS5eNpmPQ+3e3iLEdJYNPwVpBYnze5iDGxyD5YRT+0IVB5tCjb2cE0VrhgvxpPKNyEo2OhdH9Jhzz9PXUl9bAJNKd6+HpIyd0q0KPOwp+9AQaKrzAnHGGEGj67DBEMgrkL/6+j6KLLEqCXOYkYnzO9oZI01pEpnOKhwdfbcS4kaLNmHvPnnadoEEEjTOTQ/SyMM6u2nOeKhyGqnaVqvAfwzPI7oFY67KxcmRwv8HNaGVYiHqN9eABeNMpGlwLehVjOZVGZA97K4ZBN8gpNaNs6YC8po6iI6hkmMeEX2Nn/kfJGarSLPXnaSycxiGyrhglygW7QNXhXlmJkheTVYCdoGLAGGCAI0lRGQWayHCi0lLPGJZVXNNgk9B1KxuGdVjLSSCrCSF5E0e5Q5IEAOzfeZ/FNZExN65aEUbuEpT6XGdVuQkQOzC6Xmu/EzAlk3iq13daZ3HZRRirh50kZOKpcC51l6X76axrZRJWK6d6rOjcTTsfAWfJReJ6O8pWIeOtVlsFIgqQ/mOQMatOzTRvg3zLRCq9FuGFi+sVjT0He1Pjlqs7jdcZaT1CPB8LwrYeLfcBVptcLDPV+zqbJW7puThcwImp9mZYL3PRJypNcDvH8jHH0wUMqXxT3srreYmcEUXv+Ru/2k3CQm9gXNxHYCuLRYDZY21ExjwGGzKW2xrLvpEw1uKDdh8ECZdSHZjiRdlH97NZQXEG4ByU/gb205wyHtBFhatOtS2l2RpT3CzFHzQ3gaD0pU6JmPsRKZYldleO00fsoKV3nwPPyEMhkm1R8hKHe6dIzJY3DZzgzFOUegS4qemiQ45lLjcT6idgXmvqt8KdI7ZUVLaxEtTpAkyFcXz9OcjArbc0qIynBbSQLA46hfK7NF9krdsrmLpE1rfht4nImiIryOyxiuYzWncqbQXNIjoHDtsV3WKdavWtKVcKJwvl7Noyq4BHChRv24lENFOY1Ct9s3Wni3x6DqMKbJvSTNcOYw7oqoWDy8KRzJoNuoZfAgtmdlXkZd0oA2et4FwpRE5JroiewLQlCikURTmcYZrmgmiGizSa9nOBU4adBAbnnzRrDyeslT1upkDkeYfEcMwajc91HCtHw5nj1gtTDT5urzAWJLSRmN07CwA6orFZiPjDvBBX7A9rmyoFJhJBrQjGN1uQ+3TIGHVaDlEVwnLRreg9kBlKEvvr6dgvJdBTNd9fNY6o5+Ji9EoYN5910hzLfTRGlyIz+uSGOuA7L+CIKDRGT66H8SRFo/1EnUDi41VDygIpBzNTa2csjakshu3sg18Hi1oj7BgZ/cHQXOaFQFTaAJknlwpufPia7GvzzIUYj5NjmI2xKIRwuRozPQyJDZCc3s8MAOrbvBxdM45oe328xFB8P8FlyypXfHpk7LgoKzR4CgAHcxjuFaSCeLCL92BhChMbacTE4KOj1tDWHFQUbFIbKBtjA5DwXsKFLW8GHzIpI8J6aQKVrLPLoLcJqB9R2n70ouVFmh4CyxhTHdTSASUlrxSlKsA6KpY1gFTfuwqrsBCUsbLSomZQVFdgTnOlq0ASdjfLaR5Dgdy7DwkqkxUgo8JayMxjrM8nYFCYZCGYQBubetIDY6nlB1vdFyCDhZbMlVrtOuF4dTyt+7ZcLGQXu4cauETtZzpsq2Wj9n3b92m2DzzuP/BCHlgXTueC7d0ySibLlJYuGOd4FncNbpLo0dWZr9im9Q6q9IN2pfNdlfKJbzw9YhF/dmRAxY2b1G9mLFpqOdULhYP7PF1MW+wsYTQRpy9EX6kkQ20GZraiXTMBm6r3JQ9aGa+kWBZiF6s2o2XKeC092TV0EarEp+0as4cc7MopGEx9609xuYm+NWaMdslnR8Y4K3EJo4nIVRir+l5T/VC7/SLFzqo2gmdV6L3SWuN1gsq9pt4seARtv4fRxNK0B2SYXhZaS5KndO41sdg1+pHBAdpOEeu1mIf9jOC26xusv1V3jZHGnfexIvgSW9tIytiI1dlDS4utwrpXab9LsFgFxpJaMb0JKYnoNMFqL4nXBI8Up748xL1mOykearlsEJk4eYqjw0KKrpH7EKNAAM8oEMpZuGgJapPFFMvVZO+axuafnmcGm5EZ92/5OKOy80WT0Gk/427IE2lGU1sn3E9cE03DtsAB6+BQ6t2k5Ott4981zi4xBXyX1j51+jXR2ynx4cCMpKuq3udiN6vumM7U9NA0fO21hhP7Ty9nRsXNKHPYlTAXJ14j5Wyt0p3rVUaFjVrtTBdTqVNXVeuoSGcNT5KITqbh2q/bGgVt6az7qSNnYFCDkV2tU+W0fStw6dehvULG85YhqGadRMEOdJl8+cGRe2+wDoaFIzgnBrubjPr/L5cjHD2aZYZjnlibxwDTJzt8zGtAh1/HC20GsGExoY0QWTefWJ/5abfgsMBqDw8q/1M5hJ4zNdiY6fRRjwtwx/+jJ+LJYiQ/m1o2JN1gY3b8pipsPjpC+KxdPD/voyTf3QOytzbaffj7XQbGu1WUx2D654tf4YEhQt0wjqCyLM1i8OW3eQGdxzN2R8awtDrmZ7Dh4pig520YT4NsLGgT5KHBUCLPZANjnrd1PBmn5Mcyo+X9lDfvbfR01yeUPAsZuyfuWPg79v9/z8TT0WPKwJ/DqE4Kqxo8fQa5d0kwY0NyTipo96pcf7eg9Uj92sDHkwGGnNIRck72A+NQ8S7NKm1yNH8KOrUfUvun7/EHnkn8Cym5+Mp3pXO6MT0nywo9gQ//n2bNxZe+J0lPnzyoyRl74i6UembdsuudW29zM6urFZ+dLMqfi52CzCUYmdk3SvzoVlENT/0A1Shx5+L8Se5KPGPjPP1J5L+hjvcgMzpU5mT1+bx7LWRAb4IeiZ3G/6v6fBjBA5q6OPTPj76+FjKgyaQuwWn6vBBzC4LGna5EYlVicubq1fV4xtmVCKvOue2OWoLDFoTweobomQr11ZBBdWJsET+43So1Mm4OmtUYZM3cOZd3r4QMPCAvMpmjI5/edDgBJnaLiBeQM/txLWRIvnCMLiFhlN+S8HRmvdhVQs9cC74aMq47xAOk7q2Gk01SIRfa9ALLeXlmZPq15Az0xKZJABks31DPmwgUfVy1w/Yh4B10nk5zJWRw4AvbESJghL+hojeQ9Zp69cCyRgafB811kME0iWw/sJHBN4stI5jBnDTstBNZcHM5Y6zzvJPHDUuyL28TRmXcBOnMzJM28q9KzhN474+M9d6mKR52ioF6BTL4nVPMn9wRvSvJEHkCmqeVxafTuyNjHdxyXks9kqxBD74FMmau9rU0HSlNP5LZWZe/P8+Y1bdy0c2Bhs/uQZvwm48fUATNVvPnfiymZ119DTljNi5Z3+u0hi/4addHPpxrTFic7YZomfnhiM9gNw01perNFb2ByNN6wbS8oB9XQgbZFfFU3dQ78+TRnV5ioVwPGYQGZG5PX8i8RF/IvERfyLxEX8i8RF/IvERfyLxEX8i8RF/IvERfyLxEH4PMORaztZtunaTU9GOaX+A6O5tnTvYnEAzInGc1jRGMvylwTm1PZJA5qdMmavkpsvA8ZIY0Or9c8/+ESMqeIqVPI/pLnOxP7dvdY2fTVJ3Wa5tiCZ0YwfhTzxA9p2tmo/HppfGQn/v3PHNaKOJPNFX4tMAxs6PxMp4xfqjTgxLFtD6jtL1C/H6JlcozKxxqbdlpl0lTPbmEZ3DiJ4n9fxp5pxe1ZNIL/wYZjPMOWj+zUt8/tR++qXtOn1o7Bxn73qeT+HLcz3Ee66v179dfTIFLRhM5rR92evHEJaMJZ/SMpSO74HTO3IRV+vviFpkL5idyWj/MSAZkjo2dj8w4Ab7Sw/8/TX535UnI/Fj5U31n4vVi8TfxzPHKEzrwSx34d1eejsyPux/wib35uR+/0ptH0/O4HDZNfD+h2A1KiI4pBW1qT7ub67l2ux1luJSMv4faTkNmGKTH9smxSYIGbQ4/78Gyr38f2yHHbg/71YYyY8/JuDfLlnkLMhQ7EzcucjUmnnzKLjnk9hyS3dokGOQp6wGlOnYrpTSL1JiVkB6zZJhfMtD4RGRsm3kzg9okHdsYKhHfvbTDJPehYvw5tKRmTVQyPQkkfcq0OWTPhHKsCRyrDr4BGQRz5+O6SA/u860dk3A+vwvBfk0YGVMCk/CxrwLvW9lwD9PhpQj2tmxmFcftD8XpyFDcHHZVMF/osWHx3OwRjAERZyaOiUNFy/26WmZOd2BkTAY5Jgk1QXOc85YahnoDMlgu+QQYN00RHStGQ4Zck2nS5nvFwnQIqU0w8hCZ8JUGFTMpGSCD6JjD0uZgNikz8jOQMTmteS8xlSaZtaDomDXVvHvh6eVA1KR5pu5yOGGBgTvHRUKTAzMZnw2P2cZNX8WarflSkzchg/Gad6Y9rUjdealD6ySd9hF10vmuFlUymc6l62cK5yvuT5zU8xQVHU9N9qpSGmSKdp5omXiJyWoFn1Bbxk9HhsgVD00GAOUIt/MmRLhJk81zpJIuk2XbTuZp7kPPSMgfXV0mXiux4ofc4McAGSVm/i4UKksSSeosaSmVWO4XJuvLW5ChGaA/bOC+89W2xQW/a+56Z8bzZUdD/uDt0nvld9TxeCObbe6ZzIK8HrbDF9yTd23A18E2iifAxYFbAHvNARly4mgi6t6UNkvlMZ80UPOaZymfinlW8xnZ8WyXzD21jYniS+V0WXnnYuiXHGShf1AhZx5XSc/Wks475YOEwfp+Ld4mgQ0yieVQ3PCZXOyBDeZitdI9p0UFjykTzvwumvMStzyg3aaac603PLBiAAEyonXhPibmeZIKUDVD4CyeAWSCIXFNxzXjCXZ5rHireEJjRnw+oQHPQu4TuV2RkvvVXQd9fdD2fVKGZ5gP/SumfBFQkfF5YSRN2tnXCL1pNLV8YUYumLA8FoutVgDGwyp/4BqOVTwldLFXunRwwgunNz8p8L9r0xUCz2Q46BLeioTzCkYT55F5A805PKP3PLSizVlxaD3BKTdZPxn0A2SZzxWwYiJLSeRhRRX3Zamh3QMY3CaxvH9gtPU8XpcPfK8x2/AlcJPqSqHpG+WM3h7M0AjVhKdy0wvgGblalnM+dXInBAigczNRSwRPT2a8obVD4JFJgvXMqXmmt17M26CIgffqIuQmyfDcjLaTkIHbIzO+kwiXITSUR3w9IJOUh0MgS2CCHKvtt1wzKg8PMj/slawJDO0W1CwWAU+phocJr+McPmiVZ5wRvfTSLnqjBCa46B/cpk0d4XWzfYTqQ8f6e8b2fBFTlycCF3eHrqG42i4m9SOfz4Bb3fuuadqIxoc5u9v7d72bVasAh13U16CePGwbcfLcRGi6nTdNEhC1nCYLjVq+rrY7MeWPGZOrbUFJyzceQzS792XL915BkfYObZhOS3hW1ZovskPbtm4vRTad7hyRHLb8Lsdv1PQIdgp3pkCaOUGsCNFM5aDDIVXBLFMq5VCUx8zMnqoQRIXMMCnRlRtpLKCko5gALY0FIHp1UYF24SggeeJoMt8kh9okNnnxKxAfiqmSMccpKk2kUiVMw3VVAoayzpGow9L4w6hq3FpQqVjuFKVT6LKADlFVVxqZGph649xkvq0ngDxvyLeFzUAzSuSYO+J5f/vwYWs0v+w+BIrpkKbeHDAyC6NT5Qw6OjesL8fM3sL4pu3bFYy/FNt3++HhjQzDJxmsBIyH99mZvZIUj3/biMun/fhv5Zlj6nliM8WNW/GNkjdmsCfjS/WG3zatDx4uGS4Ys90POv1zrm10skU5ZHRH36XAJ8fEamR8mwAd30Zx7BIa3lIxbrAng+P02L2nXf5vkDMDCwz3Zh/YEPVlH9qQ8//Yx6O9eExpO+REOKruaLgby3DD6xHg6yT/zHfQHBEZU+SPwIzPaniVwph+AT2/7nJ4fQB5eqEHsSlP6LhscTEygtCjoYuHq5+j4Ub/vL3HY16Rp2yn5o8xdQQ6/h+yR4zt4BP1mWPzhIydsGPDNELJkHUKD1a4bZZaBkfjbaFh1NKhB2i43o6+oQMmxvtynrnA2Xgy5a8hw9ITFwEuJHr5aIrj8Iq0Tn+/ZIxVVl21A2Ec7i5EpoomUTS5FrmvIuNdrW1D5ua6i/3Al6wRnkqvjiYQRNdsH79p1n7yHr4/nSaBr9X64Ll9m4f8WuENp3vIr9T+W/3Afy0yb9Jn/mpkrJr1Fi/E9Sh/dW5Kr9q+oUuRacyUfy2q0tf1mas1bsjcWnepPjOJrEpzFTpJn7la60MXJpciI/BFQU8n0iujCcNoOjOI60wyr+m6FBl0xbfbnajPXI+Mw+kNsRDX28p167kJDWuUxz/ORubvnbXfrs9cq2M3R+Yt+sxV5d9JFuW16UJk5k18RQqnr7AEVvPwmh0wtLgMGTWZBFekSfnbcGBMJJS5ag+CoDh24CxkrunptPR6DPkloZ3n0Yv3+ltkrkyvviaZvILce9KZyFzjIX3X4BCn9JvektO3PVzahwuRuZo/bXSq4dfifc2a3rU78ToyH7836YQ47I9KQfc/3PQOHPl30hcyL9EXMi/Rf3SFOY4D/sc4AAAAAElFTkSuQmCC" width="100%"/>

<a id="more"></a>

<h2 id="模版方法模式"><a href="#模版方法模式" class="headerlink" title="模版方法模式"></a>模版方法模式</h2><blockquote>
<p>模版方法模式在一个方法中定义一个算法的骨架，而将一些步骤延迟到子类中。模版方法使得子类可以在不改变算法结构的情况下，重新定义算法中的某些步骤。——《Head First 设计模式（中文版）》</p>
</blockquote>
<h3 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h3><p>冲泡咖啡和茶</p>
<p>咖啡冲泡步骤：</p>
<ol>
<li>把水煮沸</li>
<li>用沸水冲泡咖啡</li>
<li>把咖啡倒进杯子</li>
<li>加糖和牛奶</li>
</ol>
<p>茶冲泡步骤：</p>
<ol>
<li>把水煮沸</li>
<li>用沸水浸泡茶叶</li>
<li>把咖啡倒进杯子</li>
<li>加柠檬</li>
</ol>
<p>把共有的步骤及其顺序抽象为抽象类中的模版方法，可以共享的步骤放在抽象类中作为普通方法，需要子类实现的作为抽象方法。</p>
<h4 id="抽象类-CaffeineBerverage"><a href="#抽象类-CaffeineBerverage" class="headerlink" title="抽象类 CaffeineBerverage"></a>抽象类 CaffeineBerverage</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">prepareRecipe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    boilWater();</span><br><span class="line">    brew();</span><br><span class="line">    pourInCup();</span><br><span class="line">    addCondiments();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Boiling water"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pourInCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Pouring into cup"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="咖啡实现类"><a href="#咖啡实现类" class="headerlink" title="咖啡实现类"></a>咖啡实现类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> <span class="keyword">extends</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Steeping the coffee"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Adding Sugar and Milk"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="茶实现类"><a href="#茶实现类" class="headerlink" title="茶实现类"></a>茶实现类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tea</span> <span class="keyword">extends</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Steeping the tea"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Adding Lemon"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    CaffeineBeverage coffee = <span class="keyword">new</span> Coffee();</span><br><span class="line">    coffee.prepareRecipe();</span><br><span class="line">    System.out.println(<span class="string">"--------------------"</span>);</span><br><span class="line">    CaffeineBeverage tea = <span class="keyword">new</span> Tea();</span><br><span class="line">    tea.prepareRecipe();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Boiling water</span><br><span class="line">Steeping the cffee</span><br><span class="line">Pouring into cup</span><br><span class="line">Adding Sugar and Milk</span><br><span class="line">--------------------</span><br><span class="line">Boiling water</span><br><span class="line">Steeping the tea</span><br><span class="line">Pouring into cup</span><br><span class="line">Adding Lemon</span><br></pre></td></tr></table></figure>

<h3 id="Java-API-中的例子"><a href="#Java-API-中的例子" class="headerlink" title="Java API 中的例子"></a>Java API 中的例子</h3><p><code>java.io.InputStream</code> 的 <code>read()</code> 方法，是抽象方法，需要由子类实现，而这个方法又会被 <code>read(byte b[], int off, int len)</code> 模版方法使用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">InputStream</span> <span class="keyword">implements</span> <span class="title">Closeable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span> b[], <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (off &lt; <span class="number">0</span> || len &lt; <span class="number">0</span> || len &gt; b.length - off) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> c = read();</span><br><span class="line">    <span class="keyword">if</span> (c == -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    b[off] = (<span class="keyword">byte</span>)c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (; i &lt; len ; i++) &#123;</span><br><span class="line">        c = read(); <span class="comment">// 需要子类（例如 FileInputStream/ObjectInputStream）实现的方法！</span></span><br><span class="line">        <span class="keyword">if</span> (c == -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        b[off + i] = (<span class="keyword">byte</span>)c;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException ee) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInputStream</span> <span class="keyword">extends</span> <span class="title">InputStream</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> read0();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">read0</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectInputStream</span> <span class="keyword">extends</span> <span class="title">InputStream</span> <span class="keyword">implements</span> <span class="title">ObjectInput</span>, <span class="title">ObjectStreamConstants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> BlockDataInputStream bin;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bin.read();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockDataInputStream</span> <span class="keyword">extends</span> <span class="title">InputStream</span> <span class="keyword">implements</span> <span class="title">DataInput</span>    </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (blkmode) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pos == end) &#123;</span><br><span class="line">          refill();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (end &gt;= <span class="number">0</span>) ? (buf[pos++] &amp; <span class="number">0xFF</span>) : -<span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> in.read();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Java-EE-API-中的例子"><a href="#Java-EE-API-中的例子" class="headerlink" title="Java EE API 中的例子"></a>Java EE API 中的例子</h3><blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304265949708322" target="_blank" rel="noopener">Servlet入门- 廖雪峰的官方网站</a></p>
</blockquote>
<p>WEB 开发中常用 <code>HttpServlet</code> 里面的 <code>service</code> 方法处理请求，<code>service</code> 方法里面定义了调用流程，根据客户端调用的不同方式调用不同的方法，比如 <code>doGet</code>，<code>doPost</code>，<code>doDelete</code> 等实现 restful 调用，具体的 <code>doGet</code>，<code>doPost</code> 方法实现可以在自定义的 <code>Servlet</code> 中进行重写。 </p>
<p>但需要注意的是 <code>doGet</code>，<code>doPost</code>，<code>doDelete</code> 等并没有被定义为抽象方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    String method = req.getMethod();</span><br><span class="line">    <span class="keyword">long</span> lastModified;</span><br><span class="line">    <span class="keyword">if</span> (method.equals(<span class="string">"GET"</span>)) &#123;</span><br><span class="line">      lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">      <span class="keyword">if</span> (lastModified == -<span class="number">1L</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">long</span> ifModifiedSince = req.getDateHeader(<span class="string">"If-Modified-Since"</span>);</span><br><span class="line">        <span class="keyword">if</span> (ifModifiedSince &lt; lastModified) &#123;</span><br><span class="line">          <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">          <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resp.setStatus(<span class="number">304</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"HEAD"</span>)) &#123;</span><br><span class="line">      lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">      <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">      <span class="keyword">this</span>.doHead(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"POST"</span>)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.doPost(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"PUT"</span>)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.doPut(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"DELETE"</span>)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.doDelete(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"OPTIONS"</span>)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.doOptions(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"TRACE"</span>)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.doTrace(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      String errMsg = lStrings.getString(<span class="string">"http.method_not_implemented"</span>);</span><br><span class="line">      Object[] errArgs = <span class="keyword">new</span> Object[]&#123;method&#125;;</span><br><span class="line">      errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line">      resp.sendError(<span class="number">501</span>, errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mybatis-中的例子"><a href="#Mybatis-中的例子" class="headerlink" title="Mybatis 中的例子"></a>Mybatis 中的例子</h3><p>Mybatis 框架中的 BaseExecutor 类是一个基础的 SQL 执行类，实现了大部分 SQL 的执行逻辑，然后把几个方法交给子类定制化完成，例如模版方法 <code>queryFromDatabase</code> 中调用的 <code>doQuery</code> 方法就是一个抽象方法，需要子类提供实现。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.ibatis.executor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">doQuery</span><span class="params">(MappedStatement var1, Object var2, RowBounds var3, ResultHandler var4, BoundSql var5)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">queryFromDatabase</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.localCache.putObject(key, ExecutionPlaceholder.EXECUTION_PLACEHOLDER);</span><br><span class="line"></span><br><span class="line">    List list;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      list = <span class="keyword">this</span>.doQuery(ms, parameter, rowBounds, resultHandler, boundSql); <span class="comment">// 抽象方法需要子类提供实现</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.localCache.removeObject(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.localCache.putObject(key, list);</span><br><span class="line">    <span class="keyword">if</span> (ms.getStatementType() == StatementType.CALLABLE) &#123;</span><br><span class="line">      <span class="keyword">this</span>.localOutputParameterCache.putObject(key, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="http://www.uxys.com/u/cms/www/201912/01193214y9j2.jpg" alt=""></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.ibatis.executor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleExecutor</span> <span class="keyword">extends</span> <span class="title">BaseExecutor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">doQuery</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Statement stmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    List var9;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Configuration configuration = ms.getConfiguration();</span><br><span class="line">      StatementHandler handler = configuration.newStatementHandler(<span class="keyword">this</span>.wrapper, ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">      stmt = <span class="keyword">this</span>.prepareStatement(handler, ms.getStatementLog());</span><br><span class="line">      var9 = handler.query(stmt, resultHandler);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.closeStatement(stmt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var9;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>将相同处理逻辑的代码放到抽象父类中，把不变的行为写在父类中，去除了子类的重复代码，提供了一个很好的代码复用平台，符合开闭原则。</li>
<li>将不同的逻辑放到不同的子类中，通过子类的扩展增加新的行为，提高了代码的扩展性。</li>
<li>通过父类调用子类的操作，通过对子类的扩展增加新的行为，实现了反向控制。</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>每个抽象类都需要至少一个子类来实现，导致了类数量的增加。</li>
<li>类数量增加间接增加了系统的复杂性。</li>
<li>因为继承关系的自身缺点，如果父类添加一个新的抽象方法，所有子类都要实现一遍。</li>
</ol>
]]></content>
      <categories>
        <category>Design Pattern</category>
      </categories>
  </entry>
  <entry>
    <title>Details of Charges</title>
    <url>/2019/01/31/Details-of-Charges/</url>
    <content><![CDATA[<img data-src="http://www.divorcelawyer.com.hk/wp-content/uploads/2017/07/%E7%A6%BB%E5%A9%9A%E5%BE%8B%E5%B8%88%E8%B4%B9%E7%94%A8.jpg" width="100%"/>

<a id="more"></a>

<h2 id="费用明细"><a href="#费用明细" class="headerlink" title="费用明细"></a>费用明细</h2><table>
<thead>
<tr>
<th>类型</th>
<th>详情</th>
<th>时间</th>
<th>金额</th>
<th>截图</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>住宿</td>
<td>汉庭苏州苏蠡路酒店</td>
<td>2019-01-30 16:24</td>
<td>306</td>
<td><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1fzpu1x32b0j30u01t0dvj.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1fzpu1x32b0j30u01t0dvj.jpg</a><br /><a href="https://wx4.sinaimg.cn/large/005M2pcYgy1fzptxz1l1fj30u01t07h9.jpg" target="_blank" rel="noopener">https://wx4.sinaimg.cn/large/005M2pcYgy1fzptxz1l1fj30u01t07h9.jpg</a></td>
<td></td>
</tr>
<tr>
<td>住宿</td>
<td>汉庭苏州苏蠡路酒店</td>
<td>2019-01-30 16:19</td>
<td>296</td>
<td><a href="https://ws4.sinaimg.cn/large/005M2pcYgy1fzpu6x8lshj30u01t0qgs.jpg" target="_blank" rel="noopener">https://ws4.sinaimg.cn/large/005M2pcYgy1fzpu6x8lshj30u01t0qgs.jpg</a><br /><a href="https://wx4.sinaimg.cn/large/005M2pcYgy1fzpu7joakij30u01t0h0y.jpg" target="_blank" rel="noopener">https://wx4.sinaimg.cn/large/005M2pcYgy1fzpu7joakij30u01t0h0y.jpg</a></td>
<td></td>
</tr>
<tr>
<td>住宿</td>
<td>汉庭上海中环沪南路酒店</td>
<td>2019-01-28 21:57</td>
<td>458</td>
<td><a href="https://ws2.sinaimg.cn/large/005M2pcYgy1fzpuerugvbj30u01t0gzh.jpg" target="_blank" rel="noopener">https://ws2.sinaimg.cn/large/005M2pcYgy1fzpuerugvbj30u01t0gzh.jpg</a><br /><a href="https://ws4.sinaimg.cn/large/005M2pcYgy1fzpuexzixhj30u01t0k6g.jpg" target="_blank" rel="noopener">https://ws4.sinaimg.cn/large/005M2pcYgy1fzpuexzixhj30u01t0k6g.jpg</a></td>
<td></td>
</tr>
<tr>
<td>住宿</td>
<td>汉庭上海中环沪南路酒店</td>
<td>2019-01-28 21:50</td>
<td>458</td>
<td><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1fzpug452wxj30u01t0na4.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1fzpug452wxj30u01t0na4.jpg</a><br /><a href="https://ws2.sinaimg.cn/large/005M2pcYgy1fzpugbgy7cj30u01t0aos.jpg" target="_blank" rel="noopener">https://ws2.sinaimg.cn/large/005M2pcYgy1fzpugbgy7cj30u01t0aos.jpg</a></td>
<td></td>
</tr>
<tr>
<td>住宿</td>
<td>汉庭上海浦东机场T2航站楼酒店双床房</td>
<td>2019-01-24 21:58</td>
<td>322</td>
<td><a href="https://wx4.sinaimg.cn/large/005M2pcYgy1fzpuipmjw0j30u01t04am.jpg" target="_blank" rel="noopener">https://wx4.sinaimg.cn/large/005M2pcYgy1fzpuipmjw0j30u01t04am.jpg</a><br /><a href="https://ws4.sinaimg.cn/large/005M2pcYgy1fzpukl8d3mj30u00dqadl.jpg" target="_blank" rel="noopener">https://ws4.sinaimg.cn/large/005M2pcYgy1fzpukl8d3mj30u00dqadl.jpg</a></td>
<td></td>
</tr>
<tr>
<td>住宿</td>
<td>汉庭上海康桥沪南路酒店</td>
<td>2019-02-10 09:26</td>
<td>190</td>
<td><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1g04si08katj30u01t0ju0.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1g04si08katj30u01t0ju0.jpg</a><br /><a href="https://ws3.sinaimg.cn/large/005M2pcYgy1g04sinqu2vj30u01t0go2.jpg" target="_blank" rel="noopener">https://ws3.sinaimg.cn/large/005M2pcYgy1g04sinqu2vj30u01t0go2.jpg</a></td>
<td></td>
</tr>
<tr>
<td>住宿</td>
<td>汉庭上海康桥沪南路酒店</td>
<td>2019-02-11 08:36</td>
<td>94</td>
<td><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1g04sieal7sj30u01t0q5l.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1g04sieal7sj30u01t0q5l.jpg</a><br /><a href="https://wx4.sinaimg.cn/large/005M2pcYgy1g04siyiz00j30u01t0acm.jpg" target="_blank" rel="noopener">https://wx4.sinaimg.cn/large/005M2pcYgy1g04siyiz00j30u01t0acm.jpg</a></td>
<td></td>
</tr>
<tr>
<td>住宿</td>
<td>汉庭上海康桥沪南路酒店</td>
<td>2019-02-11 08:36</td>
<td>94</td>
<td><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1g04sieal7sj30u01t0q5l.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1g04sieal7sj30u01t0q5l.jpg</a><br /><a href="https://wx4.sinaimg.cn/large/005M2pcYgy1g04siyiz00j30u01t0acm.jpg" target="_blank" rel="noopener">https://wx4.sinaimg.cn/large/005M2pcYgy1g04siyiz00j30u01t0acm.jpg</a></td>
<td></td>
</tr>
<tr>
<td>火车票</td>
<td>杭州东 - 深圳北</td>
<td>2019-01-24 15:15</td>
<td>455</td>
<td><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1fzpumqhkihj30u01t0amd.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1fzpumqhkihj30u01t0amd.jpg</a><br /><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1fzpun06q08j30u01t01kx.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1fzpun06q08j30u01t01kx.jpg</a></td>
<td></td>
</tr>
<tr>
<td>机票</td>
<td>深圳 - 上海</td>
<td>2019-01-24 14:19</td>
<td>340</td>
<td><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1fzpuplw7hqj30u01t0wqj.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1fzpuplw7hqj30u01t0wqj.jpg</a><br /><a href="https://ws2.sinaimg.cn/large/005M2pcYgy1fzpupu2u3uj30u01t04nw.jpg" target="_blank" rel="noopener">https://ws2.sinaimg.cn/large/005M2pcYgy1fzpupu2u3uj30u01t04nw.jpg</a></td>
<td></td>
</tr>
<tr>
<td>火车票</td>
<td>杭州 - 西安<br />退票费</td>
<td>2019-01-24 09:58</td>
<td>262</td>
<td><a href="https://wx3.sinaimg.cn/large/005M2pcYgy1fzputhtowlj30u01t013v.jpg" target="_blank" rel="noopener">https://wx3.sinaimg.cn/large/005M2pcYgy1fzputhtowlj30u01t013v.jpg</a><br /><a href="https://ws3.sinaimg.cn/large/005M2pcYgy1fzputpxvajj30u024bwmw.jpg" target="_blank" rel="noopener">https://ws3.sinaimg.cn/large/005M2pcYgy1fzputpxvajj30u024bwmw.jpg</a></td>
<td>退票</td>
</tr>
<tr>
<td>机票</td>
<td>西安-上海<br />退票费</td>
<td>2019-01-24 08:08</td>
<td>280</td>
<td></td>
<td>退票</td>
</tr>
<tr>
<td>机票</td>
<td>西安-上海</td>
<td>2019-01-24 08:08</td>
<td>1000</td>
<td><a href="https://wx3.sinaimg.cn/large/005M2pcYgy1fzpuv5r6fgj30u01t0al6.jpg" target="_blank" rel="noopener">https://wx3.sinaimg.cn/large/005M2pcYgy1fzpuv5r6fgj30u01t0al6.jpg</a><br /><a href="https://wx3.sinaimg.cn/large/005M2pcYgy1fzpuw88pblj30u036davy.jpg" target="_blank" rel="noopener">https://wx3.sinaimg.cn/large/005M2pcYgy1fzpuw88pblj30u036davy.jpg</a></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>汉庭（浦东机场店）<br />汉庭（上海中环沪南路）<br />六张成人票</td>
<td>2019-02-05 09:00</td>
<td>36</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>汉庭（上海中环沪南路）<br />豫园<br />六张成人票</td>
<td>2019-02-05 11:00</td>
<td>24</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>外白渡桥<br />汉庭（上海中环沪南路）<br />六张成人票</td>
<td>2019-02-05 18:00</td>
<td>24</td>
<td></td>
<td></td>
</tr>
<tr>
<td>门票</td>
<td>城隍庙<br />六张成人票</td>
<td>2019-02-05 13:00</td>
<td>60</td>
<td></td>
<td></td>
</tr>
<tr>
<td>拍照</td>
<td>外滩拍照<br />3张 12寸照片</td>
<td>2019-02-05 16:36</td>
<td>150</td>
<td><a href="https://ws2.sinaimg.cn/large/005M2pcYgy1g04luszyjej30u01t046n.jpg" target="_blank" rel="noopener">https://ws2.sinaimg.cn/large/005M2pcYgy1g04luszyjej30u01t046n.jpg</a><br /><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1g04luzj5efj30u01t0ai9.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1g04luzj5efj30u01t0ai9.jpg</a></td>
<td></td>
</tr>
<tr>
<td>照片</td>
<td>下载电子版照片</td>
<td>2019-02-11 21:21</td>
<td>19.8</td>
<td><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1g04lx9qd4qj30u01t0myy.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1g04lx9qd4qj30u01t0myy.jpg</a><br /><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1g04lx9qd4qj30u01t0myy.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1g04lx9qd4qj30u01t0myy.jpg</a></td>
<td></td>
</tr>
<tr>
<td>吃饭</td>
<td>肯德基</td>
<td>2019-02-05 19:43</td>
<td>145</td>
<td><a href="https://ws3.sinaimg.cn/large/005M2pcYgy1g04maaiz7ej30u01t04az.jpg" target="_blank" rel="noopener">https://ws3.sinaimg.cn/large/005M2pcYgy1g04maaiz7ej30u01t04az.jpg</a></td>
<td></td>
</tr>
<tr>
<td>超市</td>
<td>超市购物</td>
<td>2019-02-05 19:35</td>
<td>117</td>
<td><a href="https://ws2.sinaimg.cn/large/005M2pcYgy1g04ma3p2jtj30u01t0tl7.jpg" target="_blank" rel="noopener">https://ws2.sinaimg.cn/large/005M2pcYgy1g04ma3p2jtj30u01t0tl7.jpg</a></td>
<td></td>
</tr>
<tr>
<td>公交</td>
<td>汉庭上海中环沪南路酒店<br />朱家角古镇景区</td>
<td>2019-02-06 08:00</td>
<td>84</td>
<td></td>
<td></td>
</tr>
<tr>
<td>门票</td>
<td>上海 朱家角 新水乡访古游+游船</td>
<td>2019-02-06 07:43</td>
<td>357</td>
<td><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1g04mhfyhw6j30u01t0alq.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1g04mhfyhw6j30u01t0alq.jpg</a></td>
<td></td>
</tr>
<tr>
<td>吃饭</td>
<td>朱家角古镇外饭馆</td>
<td>2019-02-06 13:43</td>
<td>90</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>朱家角<br />田子坊</td>
<td>2019-02-06 14:00</td>
<td>48</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>田子坊<br />汉庭上海中环沪南路酒店</td>
<td>2019-02-06 18:00</td>
<td>24</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>汉庭上海中环沪南路酒店<br />中华艺术宫</td>
<td>2019-02-07 08:00</td>
<td>30</td>
<td></td>
<td></td>
</tr>
<tr>
<td>行李寄存</td>
<td>上海站行李寄存</td>
<td>2019-02-07 09:23</td>
<td>40</td>
<td><a href="https://wx4.sinaimg.cn/large/005M2pcYgy1g04n2209vsj30u01t0aka.jpg" target="_blank" rel="noopener">https://wx4.sinaimg.cn/large/005M2pcYgy1g04n2209vsj30u01t0aka.jpg</a></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>中华艺术宫<br />上海博物馆</td>
<td>2019-02-07 14:00</td>
<td>18</td>
<td></td>
<td></td>
</tr>
<tr>
<td>吃饭</td>
<td>粉丝汤+梅菜扣肉</td>
<td>2019-02-07 14:52</td>
<td>207</td>
<td><a href="https://wx4.sinaimg.cn/large/005M2pcYgy1g04n644u14j30u01t0q5k.jpg" target="_blank" rel="noopener">https://wx4.sinaimg.cn/large/005M2pcYgy1g04n644u14j30u01t0q5k.jpg</a></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>上海博物馆<br />上海站</td>
<td>2019-02-07 17:00</td>
<td>18</td>
<td></td>
<td></td>
</tr>
<tr>
<td>火车</td>
<td>上海站<br />苏州站</td>
<td>2019-02-07 08:00</td>
<td>81.5</td>
<td><a href="https://wx2.sinaimg.cn/large/005M2pcYgy1g04n7o2rt8j30u01t041s.jpg" target="_blank" rel="noopener">https://wx2.sinaimg.cn/large/005M2pcYgy1g04n7o2rt8j30u01t041s.jpg</a><br /><a href="https://ws4.sinaimg.cn/large/005M2pcYgy1g04n94bl5qj30u01t0tc5.jpg" target="_blank" rel="noopener">https://ws4.sinaimg.cn/large/005M2pcYgy1g04n94bl5qj30u01t0tc5.jpg</a></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>苏州站<br />汉庭苏州苏蠡路酒店</td>
<td>2019-02-07 22:00</td>
<td>18</td>
<td></td>
<td></td>
</tr>
<tr>
<td>公交</td>
<td>汉庭苏州苏蠡路酒店<br />拙政园</td>
<td>2019-02-08 08:00</td>
<td>24</td>
<td></td>
<td></td>
</tr>
<tr>
<td>门票</td>
<td>拙政园门票</td>
<td>2019-02-08 09:00</td>
<td>320</td>
<td><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1g04nf2ihk1j30u01t0go9.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1g04nf2ihk1j30u01t0go9.jpg</a><br /><a href="https://ws2.sinaimg.cn/large/005M2pcYgy1g04ng2gm1cj30u01t0q4v.jpg" target="_blank" rel="noopener">https://ws2.sinaimg.cn/large/005M2pcYgy1g04ng2gm1cj30u01t0q4v.jpg</a></td>
<td></td>
</tr>
<tr>
<td>吃饭</td>
<td>苏州博物馆外饭馆</td>
<td>2019-02-08 14:00</td>
<td>200</td>
<td></td>
<td></td>
</tr>
<tr>
<td>公交</td>
<td>平江路<br />汉庭苏州苏蠡路酒店</td>
<td>2019-02-08 19:00</td>
<td>48</td>
<td></td>
<td></td>
</tr>
<tr>
<td>超市</td>
<td>超市购物+饺子</td>
<td>2019-02-08 21:00</td>
<td>247</td>
<td></td>
<td></td>
</tr>
<tr>
<td>公交</td>
<td>汉庭苏州苏蠡路酒店<br />苏州汽车北站</td>
<td>2019-02-09 08:00</td>
<td>12</td>
<td></td>
<td></td>
</tr>
<tr>
<td>大巴</td>
<td>苏州汽车北站<br />杭州汽车客运中心站</td>
<td>2019-02-09 10:05</td>
<td>456</td>
<td><a href="https://wx3.sinaimg.cn/large/005M2pcYgy1g04np403unj30u01t0jul.jpg" target="_blank" rel="noopener">https://wx3.sinaimg.cn/large/005M2pcYgy1g04np403unj30u01t0jul.jpg</a><br /><a href="https://wx3.sinaimg.cn/large/005M2pcYgy1g04np403unj30u01t0jul.jpg" target="_blank" rel="noopener">https://wx3.sinaimg.cn/large/005M2pcYgy1g04np403unj30u01t0jul.jpg</a></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>杭州汽车客运中心站<br />下沙江滨</td>
<td>2019-02-09 12:05</td>
<td>30</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>下沙江滨<br />杭州西湖</td>
<td>2019-02-10 08:00</td>
<td>42</td>
<td></td>
<td></td>
</tr>
<tr>
<td>出行</td>
<td>雷峰塔<br />下沙江滨</td>
<td>2019-02-10 14:00</td>
<td>27</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>下沙江滨<br />杭州东站</td>
<td>2019-02-10 14:50</td>
<td>36</td>
<td></td>
<td></td>
</tr>
<tr>
<td>火车</td>
<td>杭州东站<br />上海南站</td>
<td>2019-02-10 17:35</td>
<td>165</td>
<td><a href="https://ws3.sinaimg.cn/large/005M2pcYgy1g04sgujfpzj30u01t077m.jpg" target="_blank" rel="noopener">https://ws3.sinaimg.cn/large/005M2pcYgy1g04sgujfpzj30u01t077m.jpg</a><br /><a href="https://ws4.sinaimg.cn/large/005M2pcYgy1g04sgyyhbjj30u01t0q68.jpg" target="_blank" rel="noopener">https://ws4.sinaimg.cn/large/005M2pcYgy1g04sgyyhbjj30u01t0q68.jpg</a><br /><a href="https://wx2.sinaimg.cn/large/005M2pcYgy1g04shaugxuj30u01t0wgc.jpg" target="_blank" rel="noopener">https://wx2.sinaimg.cn/large/005M2pcYgy1g04shaugxuj30u01t0wgc.jpg</a></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>上海南站<br />御桥站</td>
<td>2019-02-10 22:25</td>
<td>30</td>
<td><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1g04slkqwajj30u01t077a.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1g04slkqwajj30u01t077a.jpg</a></td>
<td></td>
</tr>
<tr>
<td>打车</td>
<td>御桥站<br />汉庭上海康桥沪南路酒店</td>
<td>2019-02-10 22:45</td>
<td>28</td>
<td></td>
<td></td>
</tr>
<tr>
<td>门票</td>
<td>迪士尼<br />三张成人票一张儿童票</td>
<td>2019-02-10 23:55</td>
<td>1496</td>
<td><a href="https://wx1.sinaimg.cn/large/005M2pcYgy1g04smuk613j30u01t0q56.jpg" target="_blank" rel="noopener">https://wx1.sinaimg.cn/large/005M2pcYgy1g04smuk613j30u01t0q56.jpg</a></td>
<td></td>
</tr>
<tr>
<td>打车</td>
<td>汉庭上海康桥沪南路酒店<br />御桥站</td>
<td>2019-02-11 06:00</td>
<td>18</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>御桥站<br />迪士尼</td>
<td>2019-02-11 06:05</td>
<td>24</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>迪士尼<br />上海动物园</td>
<td>2019-02-11 08:35</td>
<td>18</td>
<td></td>
<td></td>
</tr>
<tr>
<td>门票</td>
<td>上海动物园</td>
<td>2019-02-11 09:05</td>
<td>80</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>上海动物园<br />新天地</td>
<td>2019-02-11 13:35</td>
<td>12</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>新天地<br />御桥站</td>
<td>2019-02-11 14:45</td>
<td>15</td>
<td></td>
<td></td>
</tr>
<tr>
<td>打车</td>
<td>迪士尼<br />汉庭上海康桥沪南路酒店</td>
<td>2019-02-11 19:45</td>
<td>45</td>
<td></td>
<td></td>
</tr>
<tr>
<td>地铁</td>
<td>汉庭上海康桥沪南路酒店<br />上海站</td>
<td>2019-02-12 07:45</td>
<td>30</td>
<td></td>
<td></td>
</tr>
<tr>
<td>火车</td>
<td>上海站<br />西安站</td>
<td>2019-02-12 07:45</td>
<td>1515.5</td>
<td><a href="https://wx2.sinaimg.cn/large/005M2pcYgy1g04t3dcvjrj30u01t0djf.jpg" target="_blank" rel="noopener">https://wx2.sinaimg.cn/large/005M2pcYgy1g04t3dcvjrj30u01t0djf.jpg</a><br /><a href="https://ws1.sinaimg.cn/large/005M2pcYgy1g04lln0rk3j30u01t0wgn.jpg" target="_blank" rel="noopener">https://ws1.sinaimg.cn/large/005M2pcYgy1g04lln0rk3j30u01t0wgn.jpg</a></td>
<td></td>
</tr>
<tr>
<td>大巴</td>
<td>西安城南客运站<br />大荔</td>
<td>2019-02-13 06:40</td>
<td>164.25</td>
<td></td>
<td></td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Charges</category>
      </categories>
      <tags>
        <tag>Tour</tag>
      </tags>
  </entry>
  <entry>
    <title>EXCEL Function Instance</title>
    <url>/2019/11/01/EXCEL-Function-Instance/</url>
    <content><![CDATA[<img data-src="https://bitcoinist.com/wp-content/uploads/2019/05/shutterstock_1067559386.png" width="100%"/>

<a id="more"></a>

<h2 id="SUMIF"><a href="#SUMIF" class="headerlink" title="SUMIF"></a>SUMIF</h2><blockquote>
<p><a href="https://support.office.com/zh-cn/article/sumif-函數-169b8c99-c05c-4483-a712-1697a653039b" target="_blank" rel="noopener">SUMIF 函数- Office 支持 - Office Support - Office 365</a></p>
<p><strong>单条件求和</strong>函数，可对范围中符合指定条件的值求和。</p>
</blockquote>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SUMIF(range, criteria, [sum_range])</span><br></pre></td></tr></table></figure>

<ul>
<li>range：要按条件筛选的单元格区域</li>
<li>criteria：筛选条件</li>
<li>sum_range：要求和的实际单元格区域</li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><h4 id="Sheet1"><a href="#Sheet1" class="headerlink" title="Sheet1"></a>Sheet1</h4><table>
<thead>
<tr>
<th>日期</th>
<th>时间</th>
<th>名称</th>
<th>金额(¥)</th>
</tr>
</thead>
<tbody><tr>
<td>2019/10/21</td>
<td>8:15</td>
<td>地铁</td>
<td>3</td>
</tr>
<tr>
<td>2019/10/21</td>
<td>12:42</td>
<td>卤肉面+油条</td>
<td>16</td>
</tr>
<tr>
<td>2019/10/21</td>
<td>18:46</td>
<td>哈密瓜</td>
<td>26.8</td>
</tr>
<tr>
<td>2019/10/21</td>
<td>18:59</td>
<td>桂圆</td>
<td>13.8</td>
</tr>
<tr>
<td>2019/10/21</td>
<td>20:17</td>
<td>地铁</td>
<td>3</td>
</tr>
<tr>
<td>2019/10/21</td>
<td>22:26</td>
<td>谷歌助手</td>
<td>15.99</td>
</tr>
<tr>
<td>2019/10/22</td>
<td>9:06</td>
<td>地铁</td>
<td>3</td>
</tr>
<tr>
<td>2019/10/22</td>
<td>12:55</td>
<td>西红柿鸡蛋拌面</td>
<td>16</td>
</tr>
<tr>
<td>2019/10/22</td>
<td>17:10</td>
<td>地铁</td>
<td>3</td>
</tr>
<tr>
<td>2019/10/23</td>
<td>8:27</td>
<td>借给吕江</td>
<td>1000</td>
</tr>
<tr>
<td>2019/10/23</td>
<td>8:48</td>
<td>地铁</td>
<td>3</td>
</tr>
<tr>
<td>2019/10/23</td>
<td>12:42</td>
<td>肉酱拌面+加面</td>
<td>18.5</td>
</tr>
<tr>
<td>2019/10/23</td>
<td>17:56</td>
<td>地铁</td>
<td>3</td>
</tr>
</tbody></table>
<h4 id="Sheet2"><a href="#Sheet2" class="headerlink" title="Sheet2"></a>Sheet2</h4><table>
<thead>
<tr>
<th>日期</th>
<th>总计</th>
</tr>
</thead>
<tbody><tr>
<td>2019/10/21</td>
<td>78.59</td>
</tr>
<tr>
<td>2019/10/22</td>
<td>22</td>
</tr>
<tr>
<td>2019/10/23</td>
<td>1024.5</td>
</tr>
</tbody></table>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><table>
<thead>
<tr>
<th>位置</th>
<th>公式</th>
<th>说明</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Sheet2 B2</td>
<td>=SUMIF(Sheet1!A2:A14,<br />Sheet2!A2,Sheet1!D2:D14)</td>
<td>Sheet1  A2 ～ A14 中日期等于Sheet2中 A2 日期的金额总和</td>
<td>Sheet1 中 2019/10/21 的金额总和</td>
</tr>
<tr>
<td>Sheet2 B3</td>
<td>=SUMIF(Sheet1!A2:A14,<br />Sheet2!A3,Sheet1!D2:D14)</td>
<td>Sheet1  A2 ～ A14 中日期等于Sheet2中 A3 日期的金额总和</td>
<td>Sheet1 中 2019/10/22 的金额总和</td>
</tr>
<tr>
<td>Sheet2 B4</td>
<td>=SUMIF(Sheet1!A2:A14,<br />Sheet2!A4,Sheet1!D2:D14)</td>
<td>Sheet1  A2 ～ A14 中日期等于Sheet2中 A4 日期的金额总和</td>
<td>Sheet1 中 2019/10/23 的金额总和</td>
</tr>
</tbody></table>
<h2 id="SUMIFS"><a href="#SUMIFS" class="headerlink" title="SUMIFS"></a>SUMIFS</h2><blockquote>
<p><a href="https://support.office.com/zh-cn/article/sumifs-函数-c9e748f5-7ea7-455d-9406-611cebce642b" target="_blank" rel="noopener">SUMIFS 函数- Office 支持 - Office Support - Office 365</a></p>
<p><strong>多条件求和</strong>函数，可对范围中符合指定条件的值求和。</p>
</blockquote>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SUMIFS(sum_range, criteria_range1, criteria1, [criteria_range2, criteria2], ...)</span><br></pre></td></tr></table></figure>

<ul>
<li>sum_range：要求和的单元格区域</li>
<li>criteria_range1：条件 1 的筛选区域</li>
<li>criteria：条件 1 的筛选条件</li>
</ul>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><h4 id="Sheet1-1"><a href="#Sheet1-1" class="headerlink" title="Sheet1"></a>Sheet1</h4><blockquote>
<p>同 SUMIF Sheet1</p>
</blockquote>
<h4 id="Sheet2-1"><a href="#Sheet2-1" class="headerlink" title="Sheet2"></a>Sheet2</h4><table>
<thead>
<tr>
<th>日期</th>
<th>12:00</th>
<th>13:00</th>
</tr>
</thead>
<tbody><tr>
<td>2019/10/21</td>
<td>16</td>
<td>0</td>
</tr>
<tr>
<td>2019/10/22</td>
<td>16</td>
<td>0</td>
</tr>
<tr>
<td>2019/10/23</td>
<td>18.5</td>
<td>0</td>
</tr>
</tbody></table>
<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><style>
table th:first-of-type {  #first表示表格第一列
    width: 100px; # 可使用%比例
}
</style>

<table>
<thead>
<tr>
<th>位置</th>
<th>公式</th>
<th>说明</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Sheet2 B1</td>
<td>=SUMIFS(Sheet1!E2:E54,<br />Sheet1!A2:A54, Sheet2!A2,<br />Sheet1!B2:B54,”&gt;=”&amp;Sheet2!B1, <br />Sheet1!B2:B54,”&lt;”&amp;Sheet2!C1)</td>
<td>Sheet1 A2~A54 中日期等于 Sheet2 B1 的日期，<br />并且 Sheet1 B2 ~ B54 中时间大于等于 Sheet2 B1 <br />的时间小于 C1 的时间的金额总和</td>
<td>Sheet1 中 2019/10/22 12:00 ~ 13:00 的金额总和</td>
</tr>
</tbody></table>
<h2 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h2><h3 id="汉字转拼音"><a href="#汉字转拼音" class="headerlink" title="汉字转拼音"></a>汉字转拼音</h3><blockquote>
<p><a href="http://club.excelhome.net/thread-229924-1-1.html" target="_blank" rel="noopener"><strong>汉字转拼音的完美解决方案</strong></a></p>
<p><a href="https://jingyan.baidu.com/article/22a299b5c006aa9e19376a29.html" target="_blank" rel="noopener">excel汉字转拼音完美解决方案-百度经验</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Excel</category>
      </categories>
      <tags>
        <tag>Excel</tag>
      </tags>
  </entry>
  <entry>
    <title>Effective Java</title>
    <url>/2020/09/18/Effective-Java/</url>
    <content><![CDATA[<img data-src="https://e5g4c4d6.rocketcdn.me/wp-content/uploads/2018/01/review-effective-java.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://github.com/jbloch/effective-java-3e-source-code" target="_blank" rel="noopener">https://github.com/jbloch/effective-java-3e-source-code</a></p>
</blockquote>
<h2 id="服务提供者框架"><a href="#服务提供者框架" class="headerlink" title="服务提供者框架"></a>服务提供者框架</h2><blockquote>
<p><a href="https://monkeysayhi.github.io/2017/09/21/源码|什么是服务提供者框架？举例？/" target="_blank" rel="noopener">源码|什么是服务提供者框架？举例？ | 程序猿说你好 - 猴子007</a></p>
</blockquote>
<p>服务提供者框架是只这样一个系统：多个服务提供者实现一个服务，系统为服务提供者的客户端提供多个实现，并把他们从多个实现中解耦出来。</p>
<p>服务提供者框架中有四个重要的组件：</p>
<ul>
<li>服务接口（Service Interface）：由服务提供者实现，用来抽象服务提供者提供的服务。</li>
<li>提供者注册API（Provider Registration API）：系统用来注册实现，让客户端访问它们的。</li>
<li>服务访问API（Service Access API）：客户端用来获取服务的实例。</li>
<li>服务提供者接口（Service Provider Interface）：可选，由服务提供者实现，用来抽象服务提供者。</li>
</ul>
<h3 id="JDBC-中的应用"><a href="#JDBC-中的应用" class="headerlink" title="JDBC 中的应用"></a>JDBC 中的应用</h3><ul>
<li>服务接口：Connection</li>
<li>服务提供者接口：Driver</li>
<li>提供者注册API：DriverManager.registerDriver() 方法</li>
<li>服务访问API：DriverManager.getConnection() 方法</li>
</ul>
<h3 id="服务接口"><a href="#服务接口" class="headerlink" title="服务接口"></a>服务接口</h3><p>Connection 即为数据库连接服务。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Connection</span>  <span class="keyword">extends</span> <span class="title">Wrapper</span>, <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="服务提供者接口"><a href="#服务提供者接口" class="headerlink" title="服务提供者接口"></a>服务提供者接口</h3><p>Driver 提供 Connection 服务实例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Driver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function">Connection <span class="title">connect</span><span class="params">(String url, java.util.Properties info)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="提供者注册API"><a href="#提供者注册API" class="headerlink" title="提供者注册API"></a>提供者注册API</h3><p>服务的提供者实现 Driver 接口，通过 DriverManager.registerDriver() 将服务提供者的实例注册到 DriverManager 中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DriverManager</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">registerDriver</span><span class="params">(java.sql.Driver driver)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    registerDriver(driver, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">registerDriver</span><span class="params">(java.sql.Driver driver, DriverAction da)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">/* Register the driver if it has not already been added to our list */</span></span><br><span class="line">    <span class="keyword">if</span>(driver != <span class="keyword">null</span>) &#123;</span><br><span class="line">      registeredDrivers.addIfAbsent(<span class="keyword">new</span> DriverInfo(driver, da));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// This is for compatibility with the original DriverManager</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"registerDriver: "</span> + driver);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体的注册行为由服务提供者发起。以 MySQL 的 Driver 实现 com.mysql.jdbc.Driver 为例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Driver</span> <span class="keyword">extends</span> <span class="title">NonRegisteringDriver</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">sql</span>.<span class="title">Driver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      java.sql.DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException E) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Can't register driver!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Driver</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">// Required for Class.forName().newInstance()</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可知，在第一次加载 com.mysql.jdbc.Driver 时，com.mysql.jdbc.Driver会利用静态代码块调用提供者注册API <code>DriverManager.registerDriver()</code>。</p>
<h3 id="服务访问API"><a href="#服务访问API" class="headerlink" title="服务访问API"></a>服务访问API</h3><p>注册服务提供者的实例后，服务提供者就能够通过框架提供服务。具体来说，可通过静态工厂方法 <code>DriverManager.getConnection()</code> 提供Connection 服务，底层是通过 Driver 接口的实现类实现的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DriverManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String url)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">      java.util.Properties info = <span class="keyword">new</span> java.util.Properties();</span><br><span class="line">    <span class="keyword">return</span> (getConnection(url, info, Reflection.getCallerClass()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  Worker method called by the public getConnection() methods.</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    ...</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">for</span>(DriverInfo aDriver : registeredDrivers)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// If the caller does not have permission to load the driver then</span></span><br><span class="line">      <span class="comment">// skip it.</span></span><br><span class="line">      <span class="keyword">if</span>(isDriverAllowed(aDriver.driver, callerCL)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          println(<span class="string">"    trying "</span> + aDriver.driver.getClass().getName());</span><br><span class="line">          Connection con = aDriver.driver.connect(url, info);</span><br><span class="line">          <span class="keyword">if</span> (con != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Success!</span></span><br><span class="line">            println(<span class="string">"getConnection returning "</span> + aDriver.driver.getClass().getName());</span><br><span class="line">            <span class="keyword">return</span> (con);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">          <span class="keyword">if</span> (reason == <span class="keyword">null</span>) &#123;</span><br><span class="line">            reason = ex;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        println(<span class="string">"    skipping: "</span> + aDriver.getClass().getName());</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的逻辑很简单，遍历所有已注册的Driver实现类，<strong>选择第一个可用的Driver</strong>创建Connection。还记得 <code>Driver#connect()</code> 方法吗？<code>aDriver.driver.connect</code> 一句中，<strong>由底层Driver完成Connection的创建</strong>。</p>
<h2 id="WeakHashMap"><a href="#WeakHashMap" class="headerlink" title="WeakHashMap"></a>WeakHashMap</h2><blockquote>
<p><a href="https://juejin.im/entry/6844903510652239879" target="_blank" rel="noopener">Java中的WeakHashMap - 后端- 掘金</a></p>
<p><a href="https://wangkuiwu.github.io/2012/02/13/collection-13-weakhashmap/" target="_blank" rel="noopener">Java 集合系列13之WeakHashMap详细介绍(源码解析)和使用 …</a></p>
</blockquote>
<h3 id="自动回收特性"><a href="#自动回收特性" class="headerlink" title="自动回收特性"></a>自动回收特性</h3><p>在 WeakHashMap 中，key 的类型是 WeakReference。如果对应的 key 被回收，则这个 key 指向的 value 会被从 Map 容器中移除。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">  String key = <span class="keyword">new</span> String(<span class="string">"k1"</span>);</span><br><span class="line">  String key2 = <span class="string">"k2"</span>;</span><br><span class="line">  String value = <span class="string">"v1"</span>;</span><br><span class="line">  String value2 = <span class="string">"v2"</span>;</span><br><span class="line">  WeakHashMap&lt;String, String&gt; map = <span class="keyword">new</span> WeakHashMap&lt;&gt;();</span><br><span class="line">  map.put(key,value);</span><br><span class="line">  map.put(key2,value2);</span><br><span class="line"></span><br><span class="line">  System.out.println(map.size());</span><br><span class="line">  System.out.println(map);</span><br><span class="line"></span><br><span class="line">  key = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  System.gc();</span><br><span class="line">  Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  System.out.println(map.size());</span><br><span class="line">  System.out.println(map);</span><br><span class="line"></span><br><span class="line">  key2 = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  System.gc();</span><br><span class="line">  Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  System.out.println(map.size());</span><br><span class="line">  System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2</span><br><span class="line">&#123;k2&#x3D;v2, k1&#x3D;v1&#125;</span><br><span class="line">1</span><br><span class="line">&#123;k2&#x3D;v2&#125;</span><br><span class="line">1</span><br><span class="line">&#123;k2&#x3D;v2&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Q：当key是以字面量方式赋值时，并不会自动回收"><a href="#Q：当key是以字面量方式赋值时，并不会自动回收" class="headerlink" title="Q：当key是以字面量方式赋值时，并不会自动回收"></a>Q：当key是以字面量方式赋值时，并不会自动回收</h4><p>字面量赋值时是引用的常量池里的对象，GC 不会回收，即不会讲该 key 存入 queue，expungeStaleEntries 自然也不会清除掉对应的 entity。</p>
<h3 id="利用-WeakHashMap-实现缓存"><a href="#利用-WeakHashMap-实现缓存" class="headerlink" title="利用 WeakHashMap 实现缓存"></a>利用 WeakHashMap 实现缓存</h3><p>WeakHashMap 的特性比较适合实现类似本地、堆内缓存的存储机制——缓存的失效依赖于 GC 收集器的行为。假设一种应用场景：我们需要保存一批大的图片对象，其中 values 是图片的内容，key 是图片的名字，这里我们需要选择一种合适的容器保存这些对象。</p>
<p>使用普通的 HashMap 并不是好的选择，这些大对象将会占用很多内存，并且还不会被GC回收，除非我们在对应的 key 废弃之前主动 remove 掉这些元素。WeakHashMap 非常适合使用在这种场景下，下面的代码演示了具体的实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">WeakHashMap&lt;UniqueImageName, BigImage&gt; map = <span class="keyword">new</span> WeakHashMap&lt;&gt;();</span><br><span class="line">BigImage bigImage = <span class="keyword">new</span> BigImage(<span class="string">"image_id"</span>);</span><br><span class="line">UniqueImageName imageName = <span class="keyword">new</span> UniqueImageName(<span class="string">"name_of_big_image"</span>); <span class="comment">//强引用</span></span><br><span class="line"></span><br><span class="line">map.put(imageName, bigImage);</span><br><span class="line">assertTrue(map.containsKey(imageName));</span><br><span class="line"></span><br><span class="line">imageName = <span class="keyword">null</span>; <span class="comment">//map中的values对象成为弱引用对象</span></span><br><span class="line">System.gc(); <span class="comment">//主动触发一次GC</span></span><br><span class="line"></span><br><span class="line">await().atMost(<span class="number">10</span>, TimeUnit.SECONDS).until(map::isEmpty);</span><br></pre></td></tr></table></figure>

<p>首先，创建一个WeakHashMap对象来存储 BigImage 实例，对应的 key 是UniqueImageName 对象，保存到 WeakHashMap 里的时候，key 是一个弱引用类型。</p>
<p>然后，我们将 imageName 设置为null，这样就没有其他强引用指向bigImage 对象，按照 WeakHashMap 的规则，在下一次GC周期中会回收bigImage 对象。</p>
<p>通过 System.gc() 主动触发一次GC过程，然后可以发现 WeakHashMap 成为空的了。</p>
<h2 id="No-22"><a href="#No-22" class="headerlink" title="No 22"></a>No 22</h2><h3 id="二进制兼容性"><a href="#二进制兼容性" class="headerlink" title="二进制兼容性"></a>二进制兼容性</h3><blockquote>
<p><a href="https://stackoverflow.com/questions/14973380/what-is-binary-compatibility-in-java" target="_blank" rel="noopener">What is binary compatibility in Java? - Stack Overflow</a></p>
</blockquote>
<p>22条提到如果在接口中定义了常量，然后在其他类中需要使用时，实现这个接口，然后就可以用了，但是如果之后不用这些常量了，为了二进制兼容性，还需要实现这个接口。</p>
<p>这里提到的二进制兼容性，简单理解就是不需要重新编译没有改动的类。</p>
<p>即你在接口A中定义了常量，然后类B实现了这个接口，类C又继承了类B，在类B，C中都有用到这个常量，之后有一天你的B类不再需要使用这个常量了，但如果你删除了B类中的实现声明，那就会导致C类编译失败！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> CONSTANT = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">implements</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">funB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(CONSTANT);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">funC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(CONSTANT);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>B not need A.CONSTANT any more, delete implements.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//public class B implements A &#123;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">funB</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(CONSTANT);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then C will cpmpile failed.</p>
<h2 id="No-24"><a href="#No-24" class="headerlink" title="No 24"></a>No 24</h2><h3 id="嵌套类"><a href="#嵌套类" class="headerlink" title="嵌套类"></a>嵌套类</h3><blockquote>
<p><a href="https://cloud.tencent.com/developer/article/1482981" target="_blank" rel="noopener">Effective Java-嵌套类(内部类) - 云+社区- 腾讯云</a></p>
</blockquote>
<h2 id="No-28"><a href="#No-28" class="headerlink" title="No 28"></a>No 28</h2><h3 id="为什么创建泛型数组是非法的？"><a href="#为什么创建泛型数组是非法的？" class="headerlink" title="为什么创建泛型数组是非法的？"></a>为什么创建泛型数组是非法的？</h3><p>因为泛型数组不是<strong>类型安全</strong>的。如果它合法，那么编译器自动添加的类型转换在运行期间可能会抛出 ClassCastException 异常。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 假设能创建泛型数组</span></span><br><span class="line"><span class="comment">/* (1) */</span> List&lt;String&gt;[] stringLists = <span class="keyword">new</span> List&lt;String&gt;[<span class="number">1</span>];</span><br><span class="line"><span class="comment">/* (2) */</span> List&lt;Integer&gt; intList = List.of(<span class="number">42</span>);</span><br><span class="line"><span class="comment">/* (3) */</span> Object[] objects = stringLists;</span><br><span class="line"><span class="comment">/* (4) */</span> objects[<span class="number">0</span>] = intList;</span><br><span class="line"><span class="comment">/* (5) */</span> String s = stringLists[<span class="number">0</span>].get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>假设第 1 行是合法的，创建了一个泛型数组。</p>
<p>第 2 行穿件并初始化了一个包含单个元素的 List&lt;Integer&gt;。</p>
<p>第 3 行将 List&lt;String&gt; 数组保存到一个 Object 数组变量中，这是合法的，因为数组是<strong>协变</strong>的，即 List&lt;String&gt; 是 Object 的子类，所以 List&lt;String&gt;[] 也是 Object[] 的子类。</p>
<p>第 4 行将 List&lt;Integer&gt; 保存到 Object 数组中，这是合法的，因为泛型是通过擦除实现的，List&lt;Integer&gt; 在运行时类型只是 List。</p>
<p>第 5 行在运行时将抛出 ClassCastException 异常。因为编译器会添加上类型转化 <code>String s = (String) stringLists[0].get(0);</code></p>
<p>我们将第 5 行拆分开来看：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// String s = stringLists[0].get(0);</span></span><br><span class="line">List list = stringLists[<span class="number">0</span>];</span><br><span class="line">Object object = list.get(<span class="number">0</span>);</span><br><span class="line">String s = (String) object;</span><br></pre></td></tr></table></figure>

<p>由于第 4 行将 List&lt;Integer&gt; 实例保存到了原本只包含 List&lt;String&gt; 实例的数组中，所以这里的 object 实际上是 Integer 类型，所以在转化为 String 类型时将抛出异常。</p>
<h3 id="为什么-Java-将泛型设置为不可变的？"><a href="#为什么-Java-将泛型设置为不可变的？" class="headerlink" title="为什么 Java 将泛型设置为不可变的？"></a>为什么 Java 将泛型设置为不可变的？</h3><p>我们知道 Java 中的数组是可变的，泛型是不可变的，即如果 Sub 是 Super 的子类，那么 Sub[] 就是 Super[] 的子类，但是 List&lt;Sub&gt; 却不是 List&lt;Super&gt; 的子类！</p>
<p>那么为什么 Java 要将泛型设置为不可变的呢？原因是为了兼容，Java 使用了类型擦除的方式实现泛型，由于存在类型擦除，所以为了类型安全，将泛型设计为不可变。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* (1) */</span> List&lt;String&gt; stringList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"><span class="comment">/* (2) */</span> List&lt;Object&gt; objectList = stringList;</span><br><span class="line"><span class="comment">/* (3) */</span> objectList.add(<span class="number">12</span>);</span><br><span class="line"><span class="comment">/* (4) */</span> String s = stringList.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>假设泛型是可变的，那么第 2 行代码就是合法的，那么第 4 行代码就会在运行时抛出 ClassCastException 异常。</p>
]]></content>
  </entry>
  <entry>
    <title>Encode and Decode</title>
    <url>/2019/01/03/Encode-and-Decode/</url>
    <content><![CDATA[<img data-src="http://www.habilelabs.io/wp-content/uploads/2016/08/encode-decode-model-of-communication.jpg" width="100%"/>

<a id="more"></a>

<h2 id="16进制编解码"><a href="#16进制编解码" class="headerlink" title="16进制编解码"></a>16进制编解码</h2><blockquote>
<p><a href="https://www.bejson.com/convert/ox2str/" target="_blank" rel="noopener">16进制到文本字符串的转换，16进制-BeJSON.com - Json校验</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello world	&gt;	\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64</span><br></pre></td></tr></table></figure>

<h2 id="ASCLL"><a href="#ASCLL" class="headerlink" title="ASCLL"></a>ASCLL</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">你好	&gt;	\u4f60\u597d</span><br></pre></td></tr></table></figure>

<h2 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello world	&gt;	&amp;#104;&amp;#101;&amp;#108;&amp;#108;&amp;#111;&amp;#32;&amp;#119;&amp;#111;&amp;#114;&amp;#108;&amp;#100;</span><br></pre></td></tr></table></figure>

<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.baidu.com?q&#x3D;你好	&gt;	http:&#x2F;&#x2F;www.baidu.com?q&#x3D;%E4%BD%A0%E5%A5%BD</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Encoding</tag>
        <tag>Decoding</tag>
      </tags>
  </entry>
  <entry>
    <title>Enum in Java</title>
    <url>/2019/12/05/Enum-in-Java/</url>
    <content><![CDATA[<img data-src="https://www.edureka.co/blog/wp-content/uploads/2019/06/Enumeration-in-Java.jpg" width="100%"/>

<a id="more"></a>

<h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260473188087424" target="_blank" rel="noopener">枚举类- 廖雪峰的官方网站</a></p>
</blockquote>
<h3 id="枚举常量与普通常量的比较"><a href="#枚举常量与普通常量的比较" class="headerlink" title="枚举常量与普通常量的比较"></a>枚举常量与普通常量的比较</h3><p>Java 中通过<code>static final</code>来定义普通常量，与普通常量相比，用枚举类定义的常量拥有以下特点。</p>
<ul>
<li><code>enum</code> 常量本身带有类型信息，即<code>Weekday.SUN</code>类型是<code>Weekday</code>，编译器会自动检查出类型错误。<ul>
<li>因为枚举常量拥有类型信息，所以不同类型的枚举常量不能相互比较合赋值</li>
</ul>
</li>
</ul>
<h3 id="枚举类型与其他引用类型的区别"><a href="#枚举类型与其他引用类型的区别" class="headerlink" title="枚举类型与其他引用类型的区别"></a>枚举类型与其他引用类型的区别</h3><p>定义一个枚举类 Color：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Color &#123;</span><br><span class="line">    RED, GREEN, BLUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反编译后的结果：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Color</span> <span class="keyword">extends</span> <span class="title">Enum</span> </span>&#123; <span class="comment">// 继承自Enum；标记为final class，不能被继承</span></span><br><span class="line">  	<span class="comment">// 每个实例均为全局唯一</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Color RED = <span class="keyword">new</span> Color();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Color GREEN = <span class="keyword">new</span> Color();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Color BLUE = <span class="keyword">new</span> Color();</span><br><span class="line">	  <span class="comment">// 私有构造方法，确保外部无法使用 new 操作符来创建实例</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Color</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由反编译结果可以看出枚举类型有如下特点：</p>
<ul>
<li>枚举类型也是引用类型；</li>
<li>定义的<code>enum</code>类型总是继承自<code>java.lang.Enum</code>，且无法被继承；</li>
<li>只能定义出<code>enum</code>的实例，而无法通过<code>new</code>操作符创建<code>enum</code>的实例；</li>
<li>定义的每个实例都是引用类型的唯一实例。</li>
</ul>
<p>其次 Java 中的枚举类型还有以下特点：</p>
<ul>
<li>可以将<code>enum</code>类型用于<code>switch</code>语句；</li>
<li>与普通的引用类型相比，枚举常量不必使用 equals 方法进行比较，直接使用 <code>==</code> 比较即可。这是因为 <code>enum</code> 类型的每个常量在JVM中只有一个唯一实例。</li>
</ul>
<h3 id="使用枚举时的注意事项"><a href="#使用枚举时的注意事项" class="headerlink" title="使用枚举时的注意事项"></a>使用枚举时的注意事项</h3><ul>
<li>不要使用 <code>toString()</code>，通过 <code>name()</code> 来获取常量定义的字符串；</li>
<li>enum 的构造方法必须声明为 private，否则编译报错；</li>
<li>枚举类的字段可以是非final类型，即可以在运行期修改，但是不推荐这样做！</li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Enum</tag>
      </tags>
  </entry>
  <entry>
    <title>Enumerations in Java</title>
    <url>/2020/10/23/Enum/</url>
    <content><![CDATA[<img data-src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcRrRiUnBB0OyvfKqKFrGihpnhVmsNqE2ALoqg&usqp=CAU" width="100%"/>

<a id="more"></a>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Color &#123;</span><br><span class="line"></span><br><span class="line">  RED, GREEN, BLUE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> String STR = <span class="string">"STR"</span>;</span><br><span class="line">  <span class="keyword">static</span> String str = <span class="string">"str"</span>;</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    System.out.println(RED);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Color() &#123;</span><br><span class="line">    System.out.println(STR);</span><br><span class="line">    <span class="comment">// 编译报错：Cannot refer to the static enum field Color.str within an initializer</span></span><br><span class="line">    <span class="comment">// System.out.println(str);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">  RED = <span class="keyword">new</span> Color(<span class="string">"RED"</span>, <span class="number">0</span>);</span><br><span class="line">  GREEN = <span class="keyword">new</span> Color(<span class="string">"GREEN"</span>, <span class="number">0</span>);</span><br><span class="line">  BLUE = <span class="keyword">new</span> Color(<span class="string">"BLUE"</span>, <span class="number">0</span>);</span><br><span class="line">  $VALUES = <span class="keyword">new</span> Color[<span class="number">3</span>];</span><br><span class="line">  $VALUES[<span class="number">0</span>] = RED;</span><br><span class="line">  $VALUES[<span class="number">1</span>] = GREEN;</span><br><span class="line">  $VALUES[<span class="number">2</span>] = BLUE;</span><br><span class="line">  str = <span class="string">"str"</span>;</span><br><span class="line">  System.out.println(RED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过反编译可以看到枚举对象的构造和赋值先于所有的 <code>static</code> 代码（静态变量/静态代码块）。</p>
<p>普通的类是先完成类的初始化，然后才构造对象，构造对象的时候所有的静态成员都已经准备好了；</p>
<p>但是枚举不同，枚举类初始化的第一步就是要构造所有的枚举对象，也就是说，枚举对象构造时，静态成员还完全没有准备好，这也是为什么<strong>在枚举对象的构造函数中，引用非 final 的 static 成员会编译不通过</strong>。</p>
]]></content>
  </entry>
  <entry>
    <title>Exception Handling in Spring Boot</title>
    <url>/2019/12/05/Exception-Handling-in-Spring-Boot/</url>
    <content><![CDATA[<img data-src="https://techblogstation.com/wp-content/uploads/2019/11/Spring-Boot-Exception-Handling.jpg" width="100%"/>

<a id="more"></a>

<h2 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h2><blockquote>
<p><a href="http://www.programmersought.com/article/4190609518/" target="_blank" rel="noopener">Unified exception handling of Controller in Spring Boot …</a></p>
<p><a href="https://techblogstation.com/spring-boot/spring-boot-exception-handling/" target="_blank" rel="noopener">Spring Boot Exception Handling – Complete Tutorial</a></p>
</blockquote>
<h3 id="统一异常处理类"><a href="#统一异常处理类" class="headerlink" title="统一异常处理类"></a>统一异常处理类</h3><p>使用 Spring Boot 中的注解 @ControllerAdvice 和 @ExceptionHandler 即可</p>
<figure class="highlight java"><figcaption><span>GlobalExceptionHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// RestControllerAdvice 用于全局返回 json，如需返回 ModelAndView 请使用 ControllerAdvice</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 处理自定义异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(LoginException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ReturnVo</span> <span class="title">loginExceptionHandler</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">LoginException</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ReturnVo.error(CodeEnum.LOGIN_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 处理未知异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ReturnVo</span> <span class="title">unknownExceptionHandler</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Exception</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ReturnVo.error(CodeEnum.UNKNOWN_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h3><blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264737765214592" target="_blank" rel="noopener">自定义异常 | 廖雪峰</a></p>
</blockquote>
<figure class="highlight java"><figcaption><span>LoginException.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginException</span> <span class="keyword">extends</span> <span class="title">BaseException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Spring-Boot</category>
      </categories>
      <tags>
        <tag>Exception</tag>
      </tags>
  </entry>
  <entry>
    <title>Fillder4</title>
    <url>/2018/12/15/Fillder4/</url>
    <content><![CDATA[<img data-src="http://www.rahulpnath.com/images/fiddler.png" width="100%"/>

<a id="more"></a>

<h1 id="不同请求字体颜色的含义"><a href="#不同请求字体颜色的含义" class="headerlink" title="不同请求字体颜色的含义"></a>不同请求字体颜色的含义</h1><p><img data-src="https://i.loli.net/2018/12/25/5c21de1b6ae27.png" alt="fillder4"></p>
]]></content>
      <categories>
        <category>Network</category>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>Tool</tag>
        <tag>Fillder</tag>
      </tags>
  </entry>
  <entry>
    <title>Free Image Hosting</title>
    <url>/2020/01/08/Free-Image-Hosting/</url>
    <content><![CDATA[<img data-src="https://twitgoo.com/wp-content/uploads/2019/11/choose-best-blog-hosting.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://hao.su/pic.html" target="_blank" rel="noopener">免费图床- 不死鸟- 分享为王</a></p>
<p><a href="https://www.chaidu.com/" target="_blank" rel="noopener">https://www.chaidu.com/</a></p>
<p><img data-src="https://wx1.sinaimg.cn/mw690/0060lm7Tly1ftl505nwt1j30xf06rjry.jpg" alt=""></p>
</blockquote>
<h2 id="SM·MS"><a href="#SM·MS" class="headerlink" title="SM·MS"></a>SM·MS</h2><blockquote>
<p><a href="https://sm.ms/" target="_blank" rel="noopener">https://sm.ms/</a></p>
</blockquote>
<p><img data-src="" alt="挂了"></p>
<h2 id="imgur"><a href="#imgur" class="headerlink" title="imgur"></a>imgur</h2><blockquote>
<p><a href="https://imgur.com/" target="_blank" rel="noopener">imgur</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Image</category>
      </categories>
      <tags>
        <tag>Image</tag>
      </tags>
  </entry>
  <entry>
    <title>Git Error MERGE_MSG</title>
    <url>/2019/11/01/Git-Error-MERGE-MSG/</url>
    <content><![CDATA[<img data-src="https://raw.githubusercontent.com/DRPrincess/BlogImages/master/qiniu/95e1e0d779e7824420350bfbc96019a1.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://blog.csdn.net/qq_32452623/article/details/78395832" target="_blank" rel="noopener">Git-解释“Swap file .MERGE_MSG.swp already exists”的问题- 段浅浅的 …</a></p>
</blockquote>
<p>合并后，执行 git pull 或者 push 或者 merge 命令时，报以上错误</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>merge 后未正确关闭 MERGE_MSG 编辑文件。合并后会进入 commit msg 编辑页面（MERGE_MSG文件），若未正确退出，下次再合并时就会报这个错误。</p>
<p><img data-src="https://raw.githubusercontent.com/DRPrincess/BlogImages/master/qiniu/9a65e381933b29e2d6dd12bcaa50dccf.png" alt=""></p>
<p>这是因为 linux 中使用 vim 编辑某文件时，会生成一个 .sw* 的隐藏文件，当正确退出后会自动删除该文件。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><ol>
<li><p>回到合并前状态</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git merge -abort</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除 vim 非正常关闭产生的文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm .git/.MERGE_MSG.sw*</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新合并</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Goals Offer</title>
    <url>/2018/12/15/Goals-Offer/</url>
    <content><![CDATA[<p><img data-src="https://mahatest.com/img/Uploads/special-offer.gif" alt=""></p>
<a id="more"></a>

<h1 id="数组中重复的数字"><a href="#数组中重复的数字" class="headerlink" title="数组中重复的数字"></a>数组中重复的数字</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>在一个长度为n的数组里的所有数字都在0到n-1的范围内。 数组中某些数字是重复的，但不知道有几个数字是重复的。也不知道每个数字重复几次。请找出数组中任意一个重复的数字。 例如，如果输入长度为7的数组{2,3,1,0,2,5,3}，那么对应的输出是第一个重复的数字2。 </p>
<h2 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h2><blockquote>
<p>来源：<a href="https://www.nowcoder.com/questionTerminal/623a5ac0ea5b4e5f95552655361ae0a8" target="_blank" rel="noopener">牛客网回答区</a></p>
</blockquote>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>循环遍历数组，给数组下标为当前元素的数组元素的值减去n，当有重复元素时，访问后一个重复值时发现此时对应位序上的值已经小于n了，放回这个位序即可。</p>
<p>注：</p>
<ol>
<li>使用“减n”而不用“加n”是为了避免加法溢出</li>
<li>当当前元素值p小于0时，要做减n操作的元素是位于（p+n）上的元素</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">eg：array = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] , n = <span class="number">6</span></span><br><span class="line">position-<span class="number">0</span> : [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// array[2] - 6</span></span><br><span class="line">             [<span class="number">2</span>,<span class="number">3</span>,-<span class="number">5</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] </span><br><span class="line">position-<span class="number">1</span> : [<span class="number">2</span>,<span class="number">3</span>,-<span class="number">5</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// array[3] - 6</span></span><br><span class="line">             [<span class="number">2</span>,<span class="number">3</span>,-<span class="number">5</span>,-<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>]            </span><br><span class="line">position-<span class="number">2</span> : [<span class="number">2</span>,<span class="number">3</span>,-<span class="number">5</span>,-<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// array[array[2] + 6] - 6</span></span><br><span class="line">             [<span class="number">2</span>,-<span class="number">3</span>,-<span class="number">5</span>,-<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>] </span><br><span class="line">position-<span class="number">3</span> : [<span class="number">2</span>,-<span class="number">3</span>,-<span class="number">5</span>,-<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// array[array[3] + 6] - 6             </span></span><br><span class="line">             [-<span class="number">4</span>,-<span class="number">3</span>,-<span class="number">5</span>,-<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>]</span><br><span class="line">position-<span class="number">4</span> : [-<span class="number">4</span>,-<span class="number">3</span>,-<span class="number">5</span>,-<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// array[2] &lt; 0，结束，重复数字为2</span></span><br></pre></td></tr></table></figure>

<h3 id="Java代码实现"><a href="#Java代码实现" class="headerlink" title="Java代码实现"></a>Java代码实现</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">duplicate</span><span class="params">(<span class="keyword">int</span> numbers[],<span class="keyword">int</span> length,<span class="keyword">int</span> [] duplication)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(numbers == <span class="keyword">null</span> || length &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> index = numbers[i];</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            index += length;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (numbers[index] &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            duplication[<span class="number">0</span>] = index;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        numbers[index] -= length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h2><blockquote>
<p>来源：<a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/%E5%89%91%E6%8C%87%20offer%20%E9%A2%98%E8%A7%A3.md#3-%E6%95%B0%E7%BB%84%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97" target="_blank" rel="noopener"><a href="https://github.com/CyC2018" target="_blank" rel="noopener">CyC2018</a>/<strong>Interview-Notebook</strong></a></p>
</blockquote>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>将值为i的元素交换到位序为i的位置上，如果对应位置上已经有正确的值（元素值等于位序即为正确）了则可判定该值即为重复值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">eg：array = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] </span><br><span class="line">position-<span class="number">0</span> : [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// 2 &lt;-&gt; 1</span></span><br><span class="line">             [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// 1 &lt;-&gt; 3</span></span><br><span class="line">             [<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// 3 &lt;-&gt; 0</span></span><br><span class="line">             [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// already in position</span></span><br><span class="line">position-<span class="number">1</span> : [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// already in position</span></span><br><span class="line">position-<span class="number">2</span> : [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// already in position</span></span><br><span class="line">position-<span class="number">3</span> : [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// already in position</span></span><br><span class="line">position-<span class="number">4</span> : [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>] <span class="comment">// array[i] == array[array[i]], exit</span></span><br></pre></td></tr></table></figure>

<h3 id="Java代码实现-1"><a href="#Java代码实现-1" class="headerlink" title="Java代码实现"></a>Java代码实现</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">duplicate</span><span class="params">(<span class="keyword">int</span> numbers[],<span class="keyword">int</span> length,<span class="keyword">int</span> [] duplication)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(numbers == <span class="keyword">null</span> || length &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(numbers[i] != i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(numbers[i] == numbers[numbers[i]])&#123;</span><br><span class="line">                duplication[<span class="number">0</span>] = numbers[i];</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(numbers, i, numbers[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> arrays[], <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = arrays[i];</span><br><span class="line">    arrays[i] = arrays[j];</span><br><span class="line">    arrays[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>Offer</tag>
        <tag>Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>Handbook for Managers of XU</title>
    <url>/2018/12/29/Handbook-for-Managers-of-XU/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2018/12/29/5c27440b3f7f7.jpg" width="100%"/>

<a id="more"></a>

<h2 id="补单处理流程"><a href="#补单处理流程" class="headerlink" title="补单处理流程"></a>补单处理流程</h2><p><img data-src="https://i.loli.net/2018/12/29/5c2740dabe589.jpg" alt=""></p>
<h2 id="重复单处理流程"><a href="#重复单处理流程" class="headerlink" title="重复单处理流程"></a>重复单处理流程</h2><p><img data-src="https://i.loli.net/2018/12/29/5c2735a9b633b.jpg" alt=""></p>
<blockquote>
<p>如有疑问请留言。</p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Handbook of Mac OS</title>
    <url>/2019/08/10/Handbook-of-Mac-OS/</url>
    <content><![CDATA[<img data-src="https://assets.website-files.com/5acbcf3278f9ca8c8c178e76/5bae943f1d8edfa43e6a7ae2_main-mojave.jpg" width="100%"/>

<a id="more"></a>

<h2 id="Keymap"><a href="#Keymap" class="headerlink" title="Keymap"></a>Keymap</h2><blockquote>
<p><a href="https://support.apple.com/zh-cn/HT201236" target="_blank" rel="noopener">Mac 键盘快捷键</a></p>
<p><a href="https://support.apple.com/zh-cn/guide/mac-help/cpmh0011/mac" target="_blank" rel="noopener">键盘符号对照表</a></p>
</blockquote>
<h3 id="新开一个终端窗口"><a href="#新开一个终端窗口" class="headerlink" title="新开一个终端窗口"></a>新开一个终端窗口</h3><p><code>Command + T</code></p>
<h3 id="删除光标后面的字符"><a href="#删除光标后面的字符" class="headerlink" title="删除光标后面的字符"></a>删除光标后面的字符</h3><p><code>fn + delete</code></p>
<h3 id="删除整行"><a href="#删除整行" class="headerlink" title="删除整行"></a>删除整行</h3><p><code>command + delete</code></p>
<h3 id="查看当前所有窗口"><a href="#查看当前所有窗口" class="headerlink" title="查看当前所有窗口"></a>查看当前所有窗口</h3><p><code>Control + ↑</code></p>
<h3 id="显示最前面的应用的所有窗口"><a href="#显示最前面的应用的所有窗口" class="headerlink" title="显示最前面的应用的所有窗口"></a>显示最前面的应用的所有窗口</h3><p><code>Control + ↓</code></p>
<h3 id="切换同一应用下不同窗口"><a href="#切换同一应用下不同窗口" class="headerlink" title="切换同一应用下不同窗口"></a>切换同一应用下不同窗口</h3><p><code>Command + ~</code></p>
<h3 id="输入特殊字符"><a href="#输入特殊字符" class="headerlink" title="输入特殊字符"></a>输入特殊字符</h3><p><code>control + command + space</code></p>
<h3 id="英文名称中间-·-的输入"><a href="#英文名称中间-·-的输入" class="headerlink" title="英文名称中间 · 的输入"></a>英文名称中间 <code>·</code> 的输入</h3><p>中文输入法下的 <code>~</code> 键</p>
<h3 id="翻页"><a href="#翻页" class="headerlink" title="翻页"></a>翻页</h3><p><code>fn + ↑ / ↓</code></p>
<p><code>space/shift + space</code></p>
<h3 id="切换全屏窗口"><a href="#切换全屏窗口" class="headerlink" title="切换全屏窗口"></a>切换全屏窗口</h3><p><code>control + ← / →</code></p>
<h3 id="最大化窗口"><a href="#最大化窗口" class="headerlink" title="最大化窗口"></a>最大化窗口</h3><p><code>control + command + F</code></p>
<h3 id="最小化窗口"><a href="#最小化窗口" class="headerlink" title="最小化窗口"></a>最小化窗口</h3><p><code>Command + M</code></p>
<h3 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h3><blockquote>
<p><a href="https://zh.wikihow.com/在Mac-OS-X上截取屏幕截图" target="_blank" rel="noopener">5种方法来在Mac OS X上截取屏幕截图 - wikiHow</a></p>
</blockquote>
<ul>
<li><p>对整个屏幕进行截图</p>
<p><code>command + shift + 3</code></p>
</li>
<li><p>对屏幕的一部分进行截图</p>
<p><code>Command + Shift + 4 + 鼠标拉选</code></p>
</li>
<li><p>对打开的窗口进行截图</p>
<p><code>Command + Shift + 4 + Space + 鼠标点选</code></p>
</li>
</ul>
<h3 id="回到桌面"><a href="#回到桌面" class="headerlink" title="回到桌面"></a>回到桌面</h3><p><code>command + F3</code> / <code>fn + f11</code></p>
<h3 id="窗口缩放"><a href="#窗口缩放" class="headerlink" title="窗口缩放"></a>窗口缩放</h3><p><code>command + &#39;+&#39; / &#39;-&#39;</code></p>
<h2 id="Command-Line-Tools"><a href="#Command-Line-Tools" class="headerlink" title="Command Line Tools"></a>Command Line Tools</h2><blockquote>
<p><a href="https://www.jianshu.com/p/308d7be8b8df" target="_blank" rel="noopener">Mac安装Command Line Tools</a></p>
</blockquote>
<p>Mac 下使用 git 需要安装Command Line Tools</p>
<h2 id="Mac-下-Chrome-快捷键"><a href="#Mac-下-Chrome-快捷键" class="headerlink" title="Mac 下 Chrome 快捷键"></a>Mac 下 Chrome 快捷键</h2><h3 id="刷新"><a href="#刷新" class="headerlink" title="刷新"></a>刷新</h3><p><code>Command + R</code></p>
<h2 id="Mac-下-IDEA-快捷键"><a href="#Mac-下-IDEA-快捷键" class="headerlink" title="Mac 下 IDEA 快捷键"></a>Mac 下 IDEA 快捷键</h2><blockquote>
<p><a href="https://resources.jetbrains.com/storage/products/intellij-idea/docs/IntelliJIDEA_ReferenceCard.pdf" target="_blank" rel="noopener">默认快捷键PDF</a></p>
<p><a href="https://disq.us/url?url=https%3A%2F%2Fplugins.jetbrains.com%2Fplugin%2F7066-keymap-exporter%3APzIda8xZJUI_yTke-yVWlDxszNw&cuid=476847" target="_blank" rel="noopener">快捷键PDF导出插件</a></p>
</blockquote>
<h3 id="回到历史光标位置"><a href="#回到历史光标位置" class="headerlink" title="回到历史光标位置"></a>回到历史光标位置</h3><p><code>control + command + ← / →</code></p>
<h3 id="切换选种字符大小写"><a href="#切换选种字符大小写" class="headerlink" title="切换选种字符大小写"></a>切换选种字符大小写</h3><p><code>command + shift + U</code></p>
<h3 id="优化-import-信息"><a href="#优化-import-信息" class="headerlink" title="优化 import 信息"></a>优化 import 信息</h3><p><code>control + option + o</code></p>
<h3 id="扩展选中字符"><a href="#扩展选中字符" class="headerlink" title="扩展选中字符"></a>扩展选中字符</h3><p><code>option + ↑ / ↓</code></p>
<ul>
<li>比如光标在单词中间，想要选中整个单词时就可以用这个快捷键。</li>
<li>如果光标在 <code>{</code>/  <code>}</code>前后时，可使用该快捷键选中整个 {} 的内容。</li>
<li>如果光标在 <code>;</code> 后，使用该快捷键可选中整行。</li>
</ul>
<h3 id="移动代码"><a href="#移动代码" class="headerlink" title="移动代码"></a>移动代码</h3><p><code>command + shift + ↑ / ↓</code></p>
<h2 id="Mac-下-WebStorm-快捷键"><a href="#Mac-下-WebStorm-快捷键" class="headerlink" title="Mac 下 WebStorm 快捷键"></a>Mac 下 WebStorm 快捷键</h2><blockquote>
<p><strong>[PDF]</strong><a href="https://resources.jetbrains.com/storage/products/webstorm/docs/WebStorm_ReferenceCard.pdf" target="_blank" rel="noopener">DEFAULT OS X KEYMAP - JetBrains</a></p>
</blockquote>
<h3 id="多行输入"><a href="#多行输入" class="headerlink" title="多行输入"></a>多行输入</h3><ul>
<li><p>连续多行输入</p>
<p>option + shift + 鼠标下拉选中连续行</p>
</li>
<li><p>隔行多行输入</p>
<p>option + 鼠标点击多行选中</p>
</li>
</ul>
<h2 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h2><h3 id="查看命令手册"><a href="#查看命令手册" class="headerlink" title="查看命令手册"></a>查看命令手册</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> man <span class="built_in">command</span></span></span><br></pre></td></tr></table></figure>

<h3 id="复制粘贴"><a href="#复制粘贴" class="headerlink" title="复制粘贴"></a>复制粘贴</h3><p>pbcopy / pbpaste</p>
<p>实例：</p>
<ul>
<li><p>将生成的 SSH 公钥复制到剪切板</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pbcopy &lt; ~/.ssh/id_sra.pub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat ~/.ssh/id_sra.pub | pbcopy</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="打开目录或文件"><a href="#打开目录或文件" class="headerlink" title="打开目录或文件"></a>打开目录或文件</h3><p>open</p>
<blockquote>
<p><strong>-n</strong>  Open a new instance of the application(s) even if one is already running.</p>
</blockquote>
<p>实例：</p>
<ul>
<li><p>在 finder 中打开当前目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> open .</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Atom 中打开指定文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> open xxx.txt -a atom</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>微信双开</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> open -n /Applications/WeChat.app/Contents/MacOS/WeChat</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="网络代理"><a href="#网络代理" class="headerlink" title="网络代理"></a>网络代理</h3><blockquote>
<p><a href="/2020/03/03/Configing-Procy-of-Network-in-Mac-Terminal/">Mac 终端环境下配置网络代理</a></p>
</blockquote>
<h2 id="Spotlight"><a href="#Spotlight" class="headerlink" title="Spotlight"></a>Spotlight</h2><h3 id="进入文件所在目录"><a href="#进入文件所在目录" class="headerlink" title="进入文件所在目录"></a>进入文件所在目录</h3><p>选中搜索结果后按 <code>Command + 回车</code>，之后就能打开这个文件所在的文件夹，并且这个文件已被选中了。</p>
<p>选中 Spotlight 的一个搜索条目，按下 Command 键，在 Spotlight 的预览区下方就会出现所选文件的完整路径。</p>
<h3 id="按文件类型和文件格式进行查找"><a href="#按文件类型和文件格式进行查找" class="headerlink" title="按文件类型和文件格式进行查找"></a>按文件类型和文件格式进行查找</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kind:image keyword</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kind:text keyword</span><br></pre></td></tr></table></figure>

<h3 id="检索-Markdown-文件"><a href="#检索-Markdown-文件" class="headerlink" title="检索 Markdown 文件"></a>检索 Markdown 文件</h3><blockquote>
<p><a href="https://gist.github.com/gereon/3150445#gistcomment-2764557" target="_blank" rel="noopener">Markdown to Spotlight</a></p>
<p><a href="https://baltazaar.wordpress.com/2018/11/20/add-markdown-support-to-mac-os-x-spotlight/" target="_blank" rel="noopener">Add Markdown Indexing to Mac OS X Spotlight</a></p>
<p><a href="http://theoveranalyzed.net/2015/12/3/how-to-force-spotlight-to-index-markdown-files-in-el-capitan" target="_blank" rel="noopener">How to Force Spotlight to Index Markdown Files in El Capitan</a></p>
<p><a href="https://brettterpstra.com/2011/10/18/fixing-spotlight-indexing-of-markdown-content/" target="_blank" rel="noopener">Fixing Spotlight indexing of Markdown content</a></p>
</blockquote>
<ol>
<li><p><code>cp -r /System/Library/Spotlight/RichText.mdimporter ~/</code></p>
</li>
<li><p>打开 <code>RichText.mdimporter/Contents/Info.plist</code>，添加下面的代码。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>net.daringfireball.markdown<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.postimg.cc/dwn4fgdw/markdown-finder.png" alt=""></p>
</li>
<li><p>重命名 RichText.mdimporter 为 Markdown.mdimporter。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mv ~/RichText.mdimporter Markdown.mdimporter</span><br></pre></td></tr></table></figure>
</li>
<li><p>把 Markdown.mdimporter 拷贝到 <code>/Library/Spotlight</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo cp -R ~/Markdown.mdimporter /Library/Spotlight</span><br></pre></td></tr></table></figure>
</li>
<li><p>将 Markdown.mdimporter 导入系统</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mdimport -r /Library/Spotlight/Markdown.mdimporter</span><br></pre></td></tr></table></figure>
</li>
<li><p>强制 Spotlight 重新建立索引</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mdutil -E /</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="Spotlight-的命令行版本"><a href="#Spotlight-的命令行版本" class="headerlink" title="Spotlight 的命令行版本"></a>Spotlight 的命令行版本</h3><p>在命令行中使用 <code>mdfind</code> 命令来实现 Spotlight 功能。</p>
<h4 id="限制目录进行检索"><a href="#限制目录进行检索" class="headerlink" title="限制目录进行检索"></a>限制目录进行检索</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mdfind <span class="string">"keyword"</span> -onlyin ~/Document</span></span><br></pre></td></tr></table></figure>

<h3 id="使用默认浏览器搜索"><a href="#使用默认浏览器搜索" class="headerlink" title="使用默认浏览器搜索"></a>使用默认浏览器搜索</h3><ol>
<li>打开 spotlight，输入要搜索的关键字</li>
<li>Command + b</li>
</ol>
]]></content>
      <categories>
        <category>Mac-OS</category>
      </categories>
      <tags>
        <tag>Mac-OS</tag>
      </tags>
  </entry>
  <entry>
    <title>In-depth understanding of the Java Virtual Machine -- 3rd edition</title>
    <url>/2020/07/16/In-depth-understanding-of-the-Java-Virtual-Machine-3rd-edition/</url>
    <content><![CDATA[<img data-src="https://img30.360buyimg.com/vc/jfs/t1/99692/8/6999/163928/5df8449fE81a77bbc/55441b8d8f41b6b3.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://m.douban.com/book/subject/34907497/" target="_blank" rel="noopener">深入理解Java虚拟机（第3版） - 图书- 豆瓣</a></p>
</blockquote>
<h1 id="第一部分-走近Java"><a href="#第一部分-走近Java" class="headerlink" title="第一部分　走近Java"></a>第一部分　走近Java</h1><h2 id="第1章-走近Java"><a href="#第1章-走近Java" class="headerlink" title="第1章　走近Java"></a>第1章　走近Java</h2><blockquote class="blockquote-center">
            <p>世界上并没有完美的程序，但我们并不因此而沮丧，因为写程序本来就是一个不断追求完美的过程</p>

          </blockquote>

<h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1　概述"></a>1.1　概述</h3><p>Java 的优点：</p>
<ul>
<li><p>结构严谨</p>
<p>因为 Java 只支持<strong>面向对象</strong>这一种<a href="https://zh.wikipedia.org/wiki/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%9E%8B" target="_blank" rel="noopener">编程范式</a></p>
</li>
<li><p>面向对象</p>
<p>在面向对象编程中，程序员认为程序<strong>是</strong>一系列相互作用的对象</p>
</li>
<li><p>摆脱了硬件平台的束缚，实现了“一次编写，到处运行”的理想</p>
</li>
<li><p>提供了一种相对安全的<strong>内存管理和访问</strong>机制，避免了绝大部分内存泄漏和指针越界问题</p>
</li>
<li><p>实现了热点代码检测和运行时编译及优化，使得应用能随着运行时间的增长而获得更高的性能</p>
</li>
<li><p>有一套完善的应用程序<strong>接口</strong>，还有无数来自商业机构和开源社区的<strong>第三方类库</strong>来帮助用户实现各种各样的功能</p>
</li>
</ul>
<h3 id="1-2-Java技术体系"><a href="#1-2-Java技术体系" class="headerlink" title="1.2　Java技术体系"></a>1.2　Java技术体系</h3><p><img data-src="/post_image/Java-Technology-System.png" alt=""></p>
<h4 id="根据-Java-各个组成部分的功能来进行划分"><a href="#根据-Java-各个组成部分的功能来进行划分" class="headerlink" title="根据 Java 各个组成部分的功能来进行划分"></a>根据 Java 各个组成部分的功能来进行划分</h4><p>从传统意义上来看，<a href="https://zh.wikipedia.org/zh-hans/JCP" target="_blank" rel="noopener">JCP</a> 官方所定义的 Java 技术体系包括了以下几个组成部分： </p>
<ul>
<li>Java 程序设计语言</li>
<li>各种硬件平台上的 Java 虚拟机实现</li>
<li>Class 文件格式</li>
<li>Java 类库 API</li>
<li>来自商业机构和开源社区的第三方 Java 类库</li>
</ul>
<p>Java 程序设计语言、Java 虚拟机、Java 类库这<strong>三部分</strong>统称为 <strong>JDK</strong>(Java Development Kit)，JDK 是用于支持 Java 程序<strong>开发</strong>的最小环境。</p>
<p>可以把 Java 类库 API 中的 Java SE API 子集和 Java 虚拟机这<strong>两部分</strong>统称为 <strong>JRE</strong>(Java Runtime Environment)，JRE 是支持 Java 程序<strong>运行</strong>的标准环境。</p>
<p><img data-src="https://wiki.jikexueyuan.com/project/java-vm/images/jvmstructure.gif" alt=""></p>
<h4 id="按照技术所服务的领域来或者技术关注的重点业务来划分"><a href="#按照技术所服务的领域来或者技术关注的重点业务来划分" class="headerlink" title="按照技术所服务的领域来或者技术关注的重点业务来划分"></a>按照技术所服务的领域来或者技术关注的重点业务来划分</h4><ol>
<li><p>Java Card：</p>
<p>支持 Java 小程序(Applets)运行在小内存设备(如智能卡)上的平台。 </p>
</li>
<li><p>Java ME(Micro Edition)：</p>
<p>支持 Java 程序运行在移动终端(手机、PDA)上的平台，对 Java API 有所精简，并加入了移动终端的针对性支持，这条产品线在 JDK 6 以前被称为J2ME。</p>
<p>有一点读者请勿混淆，现在在智能手机上非常流行的、主要使用 Java 语言开发程序的 <strong>Android 并不属于 Java ME</strong>。 </p>
</li>
<li><p>Java SE(Standard Edition)：</p>
<p>支持面向桌面级应用(如Windows下的应用程序)的Java平台，提供了完整的 Java 核心 API，这条产品线在 JDK 6 以前被称为 J2SE。 </p>
</li>
<li><p>Java EE(Enterprise Edition)：</p>
<p>支持使用多层架构的企业应用(如ERP、MIS、CRM应用)的 Java平台，除了提供 Java SE API 外，还对其做了大量有针对性的扩充，并提供了相关的部署支持，这条产品线在 JDK 6 以前被称为J2EE，在 JDK 10 以后被 Oracle 放弃，捐献给Eclipse基金会管理，此后被称为 Jakarta EE。</p>
</li>
</ol>
<h3 id="1-3-Java发展史"><a href="#1-3-Java发展史" class="headerlink" title="1.3　Java发展史"></a>1.3　Java发展史</h3><p><img data-src="/post_image/java-time-line.png" alt=""></p>
<iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1UvTGFxDU7TIq41bT_uZrUNvomG7mAXxAF_bUdeWzkZw&font=Default&lang=en&initial_zoom=2&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe>

<p>1991年4月，由 James Gosling 博士领导的绿色计划（Green Project）开始启动，这个计划的产品就是Java语言的前身：Oak（得名于James Gosling办公室外的一棵橡树）。</p>
<p>1995年5月23日，Oak语言改名为 Java，并且在 SunWorld 大会上正式发布 Java 1.0 版本。Java 语言第一次提出了 “Write Once，Run Anywhere” 的口号。</p>
<p>1996年1月23日，JDK 1.0发布，Java语言有了第一个正式版本的运行环境。JDK 1.0提供了一个纯解释执行的Java虚拟机实现（Sun Classic VM）。</p>
<p>1996年4月，十个最主要的操作系统和计算机供应商声明将在其产品中嵌入Java技术。</p>
<p>在1996年5月底，Sun于美国旧金山举行了首届JavaOne大会，从此JavaOne成为全世界数百万Java语言开发者每年一度的技术盛会。</p>
<p>1997年2月19日，Sun公司发布了JDK 1.1，Java里许多最基础的技术支撑点（如JDBC等）都是在 JDK 1.1版本中提出的。</p>
<p>1998年12月4日，JDK迎来了一个里程碑式的重要版本：工程代号为Playground（竞技场）的JDK 1.2，Sun在这个版本中把Java技术体系拆分为三个方向，分别是面向桌面应用开发的J2SE（Java 2 Platform，Standard Edition）、面向企业级开发的J2EE（Java 2 Platform，Enterprise Edition）和面向手机等移动终端开发的J2ME（Java 2 Platform，Micro Edition）。</p>
<p>在1999年3月和7月，分别有 JDK 1.2.1和JDK 1.2.2两个小升级版本发布。 </p>
<p>1999年4月27日，HotSpot虚拟机诞生。</p>
<p>2000年5月8日，工程代号为Kestrel（美洲红隼）的JDK 1.3发布。</p>
<p>2002年2月13日，JDK 1.4发布，工程代号为Merlin（灰背隼）。JDK 1.4是标志着Java真正走向成熟的一个版本，Compaq、Fujitsu、SAS、Symbian、IBM等著名公司都有参与功能规划，甚至实现自己独立发行的JDK 1.4。</p>
<p>JDK 1.4有两个后续修正版：2002年9月16日发布的工程代号为Grasshopper（蚱蜢）的JDK 1.4.1与2003年6月26日发布的工程代号为Mantis（螳螂） 的JDK 1.4.2。 </p>
<p>2002年前后还发生了一件与Java没有直接关系，但事实上对Java的发展进程影响很大的事件，就是微软的.NET Framework发布。这个无论是技术实现还是目标用户上都与Java有很多相近之处的技术平台给Java带来了很多讨论、比较与竞争，.NET平台和Java平台之间声势浩大的孰优孰劣的论战到今天为止都仍然没有完全平息。</p>
<p>2004年9月30日，JDK 5发布，工程代号为Tiger（老虎）。</p>
<p>2006年12月11日，JDK 6发布，工程代号为Mustang（野马）。在这个版本中，Sun公司终结了从 JDK 1.2开始已经有八年历史的J2EE、J2SE、J2ME的产品线命名方式，启用Java EE 6、Java SE 6、Java ME 6的新命名来代替。</p>
<p>在2006年11月13日的JavaOne大会上，Sun公司宣布计划要把Java开源。 </p>
<p>2009年2月19日，工程代号为Dolphin（海豚）的JDK 7完成了其第一个里程碑版本。</p>
<p>2009年4月20日，Oracle宣布正式以74亿美元的价格收购市值曾超过2000亿美元的Sun公司，传奇的Sun Microsystems从此落幕成为历史，Java商标正式划归Oracle所有（Java语言本身并不属于哪间公司所有，它由JCP组织进行管理，尽管在JCP中Sun及后来的Oracle的话语权很大）。</p>
<p>2017年9月21日 JDK9 得以艰难面世。 </p>
<p>2018年3月20日，JDK 10如期发布。</p>
<p>2018年3月27日，Android的Java侵权案有了最终判决，法庭裁定Google赔偿Oracle合计88亿美元。</p>
<p>2018年10月，最后一届 JavaOne 2018在旧金山举行。</p>
<p>2018年9月25日，JDK 11发布。</p>
<p>2019年3月20日，JDK 12发布。</p>
<h3 id="1-4-Java虚拟机家族"><a href="#1-4-Java虚拟机家族" class="headerlink" title="1.4　Java虚拟机家族"></a>1.4　Java虚拟机家族</h3><h4 id="1-4-1-虚拟机始祖：Sun-Classic-Exact-VM"><a href="#1-4-1-虚拟机始祖：Sun-Classic-Exact-VM" class="headerlink" title="1.4.1　虚拟机始祖：Sun Classic/Exact VM"></a>1.4.1　虚拟机始祖：Sun Classic/Exact VM</h4><p>Sun Classic 虚拟机，“世界上第一款商用Java虚拟机”。1996年1月23日，Sun发布 JDK 1.0，Java语言首次拥有了商用的正式运行环境，这个JDK中所带的<br>虚拟机就是Classic VM。这款虚拟机只能使用纯解释器方式来执行Java代码，如果要使用即时编译器那就必须进行外挂，但是假如外挂了即时编译器的话，即时编译器就会完全接管虚拟机的执行系统，解释器便不能再工作了。</p>
<p>由于解释器和编译器不能配合工作，这就意味着如果要使用编译执行，编译<br>器就不得不对每一个方法、每一行代码都进行编译，而无论它们执行的频率是否具有编译的价值。基于程序响应时间的压力，这些编译器根本不敢应用编译耗时稍高的优化技术，因此这个阶段的虚拟机虽然用了即时编译器输出本地代码，其执行效率也和传统的C/C++程序有很大差距，“<strong>Java语言很慢</strong>”的印象就是在这阶段开始在用户心中树立起来的。</p>
<p>在JDK 1.2时，曾在Solaris平台上发布过一款名为Exact VM的虚拟机，它的编译执行系统已经具备现代高性能虚拟机雏形，如热点探测、两级即时编译器、编译器与解释器混合工作模式等。</p>
<p>Exact VM因它使用准确式内存管理（Exact Memory Management，也可以叫Non-Conservative/Accurate Memory Management）而得名。<strong>准确式内存管理</strong>是指虚拟机可以知道内存中某个位置的数据具体是什么类型。譬如内存中有一个32bit的整数123456，虚拟机将有能力分辨出它到底是一个指向了123456的内存地址的引用类型还是一个数值为123456的整数。由于使用了准确式内存管理，Exact VM可以抛弃掉以前Classic VM基于句柄（Handle）的对象查找方式这样每次定位对象都少了一次间接查找的开销，显著提升执行性能。</p>
<p>虽然Exact VM的技术相对Classic VM来说先进了许多，但是它的命运显得十分英雄气短，在商业应用上只存在了很短暂的时间就被外部引进的HotSpotVM所取代，甚至还没有来得及发布Windows和Linux平台下的商用版本。而Classic VM的生命周期则相对要长不少，它在JDK 1.2之前是JDK中唯一的虚拟机，在JDK 1.2时，它与HotSpot VM并存，但默认是使用Classic VM（用户可用java-hotspot参数切换至HotSpot VM），而在JDK 1.3时，HotSpot VM成为默认虚拟机，它仍作为虚拟机的“备用选择”发布（使用java-classic参数切换），直到JDK 1.4的时候，Classic VM才完全退出商用虚拟机的历史舞台，与Exact VM一起进入了Sun Labs Research VM之中。</p>
<h4 id="1-4-2-武林盟主：HotSpot-VM"><a href="#1-4-2-武林盟主：HotSpot-VM" class="headerlink" title="1.4.2　武林盟主：HotSpot VM"></a>1.4.2　武林盟主：HotSpot VM</h4><p>相信所有Java程序员都听说过HotSpot虚拟机，它是Sun/OracleJDK和OpenJDK中的默认Java虚拟机，也是目前使用范围最广的Java虚拟机。</p>
<p>这个在今天看起来“血统纯正”的虚拟机在最初并非由Sun公司所开发，而是由一家名为“Longview Technologies”的小公司设计；Sun公司注意到这款虚拟机在即时编译等多个方面有着优秀的理念和实际成果，在1997年收购了Longview Technologies公司，从而获得了HotSpot虚拟机。</p>
<p>HotSpot既继承了Sun之前两款商用虚拟机的优点，也有许多自己新的技术优势，如它名称中的HotSpot指的就是它的<strong>热点代码探测技术</strong>，HotSpot虚拟机的热点代码探测能力可以通过执行计数器找出最具有编译价值的代码，然后通知即时编译器以方法为单位进行编译。如果一个方法被频繁调用，或方法中有效循环次数很多，将会分别触发标准即时编译和栈上替换编译（On-StackReplacement，OSR）行为。</p>
<h4 id="1-4-3-小家碧玉：Mobile-Embedded-VM"><a href="#1-4-3-小家碧玉：Mobile-Embedded-VM" class="headerlink" title="1.4.3　小家碧玉：Mobile/Embedded VM"></a>1.4.3　小家碧玉：Mobile/Embedded VM</h4><p>面对移动和嵌入式市场，有专门的Java虚拟机产品。Oracle公司在Java ME这条产品线上的虚拟机名为CDC-HI（C Virtual Machine，CVM）和CLDC-HI（Monty VM）。其中CDC/CLDC全称是Connected（Limited）Device Configuration，后面的HI则是HotSpot Implementation的缩写。</p>
<h4 id="1-4-4-天下第二：BEA-JRockit-IBM-J9-VM"><a href="#1-4-4-天下第二：BEA-JRockit-IBM-J9-VM" class="headerlink" title="1.4.4　天下第二：BEA JRockit/IBM J9 VM"></a>1.4.4　天下第二：BEA JRockit/IBM J9 VM</h4><p>除了Sun/Oracle公司以外，也有其他组织、公司开发过虚拟机的实现。如果说HotSpot是天下第一的武林盟主，那曾经与HotSpot并称“三大商业Java虚拟机”的另外两位，毫无疑问就该是天下第二了，它们分别是BEA System公司的JRockit与IBM公司的IBM J9。</p>
<p>JRockit随着BEA被Oracle收购，现已不再继续发展，永远停留在R28版本，这是JDK 6版JRockit的代号。</p>
<h4 id="1-4-5-软硬合璧：BEA-Liquid-VM-Azul-VM"><a href="#1-4-5-软硬合璧：BEA-Liquid-VM-Azul-VM" class="headerlink" title="1.4.5　软硬合璧：BEA Liquid VM/Azul VM"></a>1.4.5　软硬合璧：BEA Liquid VM/Azul VM</h4><p>我们平时所提及的“高性能Java虚拟机”一般是指HotSpot、JRockit、J9这类在通用硬件平台上运行 的商用虚拟机，但其实还有一类与特定硬件平台绑定、软硬件配合工作的专有虚拟机，往往能够实现更高的执行性能，或提供某些特殊的功能特性。这类专有虚拟机的代表是BEA Liquid VM和Azul VM。</p>
<p>Liquid VM也被称为JRockit VE（Virtual Edition，VE），它是BEA公司开发的可以直接运行在自家 Hypervisor系统上的JRockit虚拟机的虚拟化版本。随着JRockit虚拟机终止开发，Liquid VM 项目也已经停止了。</p>
<p>Azul VM是Azul Systems公司在HotSpot基础上进行大量改进，运行于Azul Systems公司的专有硬件Vega系统上的Java虚拟机。随着虚拟机技术的不断发展，Java虚拟机变得越来越强大的同时也越来越复杂，要推动在专有硬件上的Java虚拟机升级发展，难以直接借助开源社区的力量，往往需要耗费更高昂的成本，在商业上的缺陷使得专有虚拟机逐渐没落，Azul Systems公司最终也放弃了Vega产品线，把全部精力投入到Zing 和Zulu产品线中。</p>
<p>Zing虚拟机是一个从HotSpot某旧版代码分支基础上独立出来重新开发的高性能Java虚拟机，在要求低延迟、快速预热等场景中，Zing VM都要比HotSpot表现得更好。Zing的PGC、 C4收集器可以轻易支持TB级别的Java堆内存，而且保证暂停时间仍然可以维持在不超过10毫秒的范围里，HotSpot要一直到JDK 11和JDK 12的ZGC及Shenandoah收集器才达到了相同的目标，而且目前效果仍然远不如C4。Zing的ReadyNow功能可以利用之前运行时收集到的性能监控数据，引导虚拟机在启动后快速达到稳定的高性能水平，减少启动后从解释执行到即时编译的等待时间。Zing自带的 ZVision/ZVRobot功能可以方便用户监控Java虚拟机的运行状态，从找出代码热点到对象分配监控、锁 竞争监控等。Zing能让普通用户无须了解垃圾收集等底层调优，就可以使得Java应用享有低延迟、快速预热、易于监控的功能，这是Zing的核心价值和卖点，很多Java应用都可以通过长期努力在应用、 框架层面优化来提升性能，但使用Zing的话就可以把精力更多集中在业务方面。</p>
<h4 id="1-4-6-挑战者：Apache-Harmony-Google-Android-Dalvik-VM"><a href="#1-4-6-挑战者：Apache-Harmony-Google-Android-Dalvik-VM" class="headerlink" title="1.4.6　挑战者：Apache Harmony/Google Android Dalvik VM"></a>1.4.6　挑战者：Apache Harmony/Google Android Dalvik VM</h4><p>Harmony虚拟机（准确地说是Harmony里的DRLVM）和Dalvik虚拟机只能称作“虚拟机”，而不能称作“Java虚拟机”，Apache Harmony是一个Apache软件基金会旗下以Apache License协议开源的实际兼容于JDK 5和 JDK 6的Java程序运行平台，它含有自己的虚拟机和Java类库API，用户可以在上面运行Eclipse、 Tomcat、Maven等常用的Java程序。但是，它并没有通过TCK认证，所以我们不得不用一长串冗长拗口的语言来介绍它，而不能用一句“Apache的JDK”或者“Apache的Java虚拟机”来直接代指。 如果一个公司要宣称自己的运行平台“兼容于Java技术体系”，那该运行平台就必须要通过 TCK（Technology Compatibility Kit）的兼容性测试，Apache基金会曾要求当时的Sun公司提供TCK的使用授权，但是一直遭到各种理由的拖延和搪塞，直到Oracle收购了Sun公司之后，双方关系越闹越僵，最终导致<strong>Apache基金会愤然退出JCP组织</strong>，这是Java社区有史以来最严重的分裂事件之一。</p>
<p>Dalvik虚拟机曾经是Android平台的核心组成部分之一。Dalvik虚拟机并不是一个Java虚拟机，它没有遵循《Java虚拟机规范》，不能直接执行Java的 Class文件，使用寄存器架构而不是Java虚拟机中常见的栈架构。但是它与Java却又有着千丝万缕的联系，它执行的DEX（Dalvik Executable）文件可以通过Class文件转化而来，使用Java语法编写应用程序，可以直接使用绝大部分的Java API等。在Android发展的早期，Dalvik虚拟机随着Android的成功迅速流行，在Android 2.2中开始提供即时编译器实现，执行性能又有了进一步提高。不过到了Android 4.4时代，支持提前编译（Ahead of Time Compilation，AOT）的ART虚拟机迅速崛起，在当时性能还不算特别强大的移动设备上，提前编译要比即时编译更容易获得高性能，所以在Android 5.0里ART就全面代替了Dalvik虚拟机。</p>
<h4 id="1-4-7-没有成功，但并非失败：Microsoft-JVM及其他"><a href="#1-4-7-没有成功，但并非失败：Microsoft-JVM及其他" class="headerlink" title="1.4.7　没有成功，但并非失败：Microsoft JVM及其他"></a>1.4.7　没有成功，但并非失败：Microsoft JVM及其他</h4><p>在Java语言诞生的初期（1996年～1998年，以JDK1.2发布之前为分界），它的主要应用之一是在浏览器中运行Java Applets程序，微软为了在Internet Explorer 3浏览器中支持Java Applets应用而开发了自己的Java虚拟机，在1997年10月，Sun公司正式以侵犯商标、不正当竞争等罪名控告微软，官司的结果是微软向Sun公司（最终微软因垄断赔偿给Sun公司的总金额高达10亿美元）赔偿2000万美金，承诺终止其Java虚拟机的发展，并逐步在产品中移除Java虚拟机相关功能。而最令人感到讽刺的是，到后来在 Windows XP SP3 中Java虚拟机被完全抹去的时候，Sun公司却又到处登报希望微软不要这样做。Windows XP高级产品经理Jim Cullinan称：“我们花费了三年的时间和Sun公司打官司，当时他们试图阻止我们在Windows中支持Java，现在我们这样做了，可他们又在抱怨，这太具有讽刺意味了。” 我们试想一下，如果当年Sun公司没有起诉微软公司，微软继续保持着对Java技术的热情，那 Java 的世界会变得更好还是更坏？.NET技术是否还会发展起来？</p>
<h4 id="1-4-8-百家争鸣"><a href="#1-4-8-百家争鸣" class="headerlink" title="1.4.8　百家争鸣"></a>1.4.8　百家争鸣</h4><p>还有一些Java虚拟机天生就注定不会应用在主流领域，或者不是单纯为了用于生产，甚至在设计之初就没有抱着商用的目的，仅仅是用于研究、验证某种技术和观点，又或者是作为一些规范的标准实现。</p>
<ul>
<li><p>KVM</p>
</li>
<li><p>Java Card VM</p>
</li>
<li><p>Squawk VM</p>
</li>
<li><p>JavaInJava</p>
</li>
<li><p>Maxine VM</p>
</li>
<li><p>Jikes RVM</p>
</li>
<li><p>IKVM.NET</p>
</li>
</ul>
<h3 id="1-5-展望Java技术的未来"><a href="#1-5-展望Java技术的未来" class="headerlink" title="1.5　展望Java技术的未来"></a>1.5　展望Java技术的未来</h3><h4 id="1-5-1-无语言倾向"><a href="#1-5-1-无语言倾向" class="headerlink" title="1.5.1　无语言倾向"></a>1.5.1　无语言倾向</h4><p>2018年4月，Oracle Labs新公开了一项黑科技：Graal VM，从它的口号“Run Programs Faster Anywhere”就能感觉到一颗蓬勃的野心，这句话显然是与1995年Java刚诞生时的“Write Once，Run Anywhere”在遥相呼应。</p>
<p>Graal VM被官方称为“Universal VM”和“Polyglot VM”，这是一个在HotSpot虚拟机基础上增强而成的<strong>跨语言全栈虚拟机</strong>，可以作为“任何语言”的运行平台使用，这里“任何语言”包括了Java、Scala、 Groovy、Kotlin等基于Java虚拟机之上的语言，还包括了C、C++、Rust等基于LLVM的语言，同时支持其他像JavaScript、Ruby、Python和R语言等。Graal VM可以无额外开销地混合使用这些编程语言， 支持不同语言中混用对方的接口和对象，也能够支持这些语言使用已经编写好的本地库文件。</p>
<p>如果Java语言或者 HotSpot虚拟机真的有被取代的一天，那从现在看来Graal VM是希望最大的一个候选项，这场革命很可能会在Java使用者没有明显感觉的情况下悄然而来，Java世界所有的软件生态都没有发生丝毫变化， 但天下第一的位置已经悄然更迭。</p>
<h4 id="1-5-2-新一代即时编译器"><a href="#1-5-2-新一代即时编译器" class="headerlink" title="1.5.2　新一代即时编译器"></a>1.5.2　新一代即时编译器</h4><p>HotSpot虚拟机中含有两个即时编译器，分别是编译耗时短但输出代码优化程度较低的<strong>客户端编译器</strong>（简称为C1）以及编译耗时长但输出代码优化质量也更高的<strong>服务端编译器</strong>（简称为C2），通常它们会在分层编译机制下与解释器互相配合来共同构成HotSpot虚拟机的执行子系统</p>
<p>自JDK 10起，HotSpot中又加入了一个全新的即时编译器：Graal编译器。Graal编译器是以C2编译器替代者的身份登场的。Graal能够做比C2更加复杂的优化，如“部分逃逸分析”（Partial Escape Analysis），也拥有比C2更容易使用激进预测性优化（Aggressive Speculative Optimization）的策略，支持自定义的预测性假设等。</p>
<p>今天的Graal编译器尚且年幼，还未经过足够多的实践验证，所以仍然带着“实验状态”的标签，需要用开关参数去激活。Graal编译器未来的前途可期，作为Java虚拟机执行代码的最新引擎，它的持续改进，会同时为 HotSpot与Graal VM注入更快更强的驱动力。</p>
<h4 id="1-5-3-向Native迈进"><a href="#1-5-3-向Native迈进" class="headerlink" title="1.5.3　向Native迈进"></a>1.5.3　向Native迈进</h4><p>在微服务架构的视角下，应用拆分后，单个微服务很可能就不再需要面对数十、数百GB乃至TB的内存，有了高可用的服务集群，也无须追求单个服务要7×24小时不间断地运行，它们随时可以中断和更新。</p>
<p>Java的启动时间相对较长，需要预热才能达到最高性能等特点就显得相悖于这样的应用场景。</p>
<p>在无服务架构中，矛盾则可能会更加突出，比起服务，一个函数的规模通常会更小，执行时间会更短，当前最热门的无服务运行环境AWS Lambda所允许的最长运行时间仅有15分钟。</p>
<p>一直把软件服务作为重点领域的Java自然不可能对此视而不见，在最新的几个JDK版本的功能清单中，已经陆续推出了跨进程的、可以面向用户程序的类型信息共享（Application Class Data Sharing，AppCDS，允许把加载解析后的类型信息缓存起来，从而提升下次启动速度，原本CDS只支持Java标准库，在JDK 10时的AppCDS开始支持用户的程序代码）、无操作的垃圾收集器（Epsilon， 只做内存分配而不做回收的收集器，对于运行完就退出的应用十分合适）等改善措施。而酝酿中的一个<strong>更彻底</strong>的解决方案，是逐步开始对<strong>提前编译</strong>（Ahead of Time Compilation，AOT）提供支持。</p>
<p>提前编译是相对于即时编译的概念。</p>
<p>早在JDK 9时期，Java就提供了实验性的Jaotc命令来进行提前编译，不过多数人试用过后都颇感失望。直到Substrate VM出现，才算是满足了人们心中对Java提前编译的全部期待。</p>
<p>Substrate VM是在 Graal VM 0.20版本里新出现的一个极小型的运行时环境，目标是代替HotSpot用来支持提前编译后的程序执行。</p>
<p>Substrate VM带来的好处是能显著降低内存占用及启动时间。根据Oracle官方给出的测试数据，运行在Substrate VM上的小规模应用， 其内存占用和启动时间与运行在HotSpot上相比有5倍到50倍的下降。</p>
<p>Substrate VM补全了Graal VM“Run Programs Faster Anywhere”愿景蓝图里的最后一块拼图，让 Graal VM支持其他语言时不会有重量级的运行负担。譬如运行JavaScript代码，Node.js的V8引擎执行效率非常高，但即使是最简单的HelloWorld，它也要使用约20MB的内存，而运行在Substrate VM上的Graal.js，跑一个HelloWorld则只需要4.2MB内存，且运行速度与V8持平。Substrate VM的轻量特性，使得它十分适合嵌入其他系统，譬如Oracle自家的数据库就已经开始使用这种方式支持用不同的语言代替PL/SQL来编写存储过程。</p>
<h5 id="提前编译的好处："><a href="#提前编译的好处：" class="headerlink" title="提前编译的好处："></a>提前编译的好处：</h5><p>Java虚拟机加载这些已经预编译成二进制库之后就能够直接调用，而无须再等待即时编译器在运行时将其编译成二进制机器码。</p>
<h5 id="提前编译的坏处："><a href="#提前编译的坏处：" class="headerlink" title="提前编译的坏处："></a>提前编译的坏处：</h5><ul>
<li><p>破坏了Java“一次编写，到处运行”的承诺，必须为每个不同的硬件、操作系统去编译对应的发行包；</p>
</li>
<li><p>降低了Java链接过程的动态性，必须要求加载的代码在编译期就是全部已知的，而不能在运行期才确定，否则就只能舍弃掉已经提前编译好的版本，退回到原来的即时编译执行状态。</p>
</li>
</ul>
<h4 id="1-5-4-灵活的胖子"><a href="#1-5-4-灵活的胖子" class="headerlink" title="1.5.4　灵活的胖子"></a>1.5.4　灵活的胖子</h4><p>二十年间有无数改进和功能被不断地添加到HotSpot的源代码上，致使它成长为今天这样的庞然大物。 HotSpot的定位是面向各种不同应用场景的全功能Java虚拟机，这是一个极高的要求，仿佛是让一个胖子能拥有敏捷的身手一样的矛盾。</p>
<p>HotSpot开发团队正在持续地重构着HotSpot的架构，让它具有模块化的能力和足够的开放性。<strong>模块化方面原本是HotSpot的弱项</strong>，监控、执行、编译、内存管理等多个子系统的代码相互纠缠。</p>
<p>BM的J9就一直做得就非常好，面向Java ME的J9虚拟机与面向Java EE的J9虚拟机可以是完全由同一套代码库编译出来的产品，只有编译时选择的模块配置有所差别。</p>
<p>现在，HotSpot虚拟机也有了与J9类似的能力，能够在编译时指定一系列特性开关，让编译输出的 HotSpot 虚拟机可以裁剪成不同的功能，譬如支持哪些编译器，支持哪些收集器，是否支持JFR、 AOT、CDS、NMT等都可以选择。能够实现这些功能特性的组合拆分，反映到源代码不仅仅是<strong>条件编译</strong>，更关键的是接口与实现的分离。</p>
<p>早期（JDK 1.4时代及之前）的HotSpot虚拟机为了提供监控、调试等不会在《Java虚拟机规范》 中约定的内部功能和数据，就曾开放过Java虚拟机信息监控接口（Java Virtual Machine Profiler Interface，JVMPI）与Java虚拟机调试接口（Java Virtual Machine Debug Interface，JVMDI）供运维和性能监控、IDE等外部工具使用。</p>
<p>到了JDK 5时期，又抽象出了层次更高的Java虚拟机工具接口（Java Virtual Machine Tool Interface，JVMTI）来为所有Java虚拟机相关的工具提供本地编程接口集合，到 JDK 6时JVMTI就完全整合代替了JVMPI和JVMDI的作用。 </p>
<p>在JDK 9时期，HotSpot虚拟机开放了Java语言级别的编译器接口（Java Virtual Machine Compiler Interface，JVMCI），使得在Java虚拟机外部增加、替换即时编译器成为可能，这个改进实现起来并不费劲，但比起之前JVMPI、JVMDI和JVMTI却是更深层次的开放，它为不侵入HotSpot代码而增加或修改HotSpot虚拟机的固有功能逻辑提供了可行性。Graal编译器就是通过这个接口植入到HotSpot之中。</p>
<p>到了JDK 10，HotSpot又重构了Java虚拟机的垃圾收集器接口（Java Virtual Machine Compiler Interface），统一了其内部各款垃圾收集器的公共行为。有了这个接口，才可能存在日后（今天尚未） 某个版本中的CMS收集器退役，和JDK 12中Shenandoah这样由Oracle以外其他厂商领导开发的垃圾收集器进入HotSpot中的事情。如果未来这个接口完全开放的话，甚至有可能会出现其他独立于HotSpot 的垃圾收集器实现。 经过一系列的重构与开放，HotSpot虚拟机逐渐从时间的侵蚀中挣脱出来，虽然代码复杂度还在增长，体积仍在变大，但其架构并未老朽，而是拥有了越来越多的<strong>开放性</strong>和<strong>扩展性</strong>，使得HotSpot成为一个能够联动外部功能，能够应对各种场景，能够学会十八般武艺的身手灵活敏捷的“胖子”。</p>
<h4 id="1-5-5-语言语法持续增强"><a href="#1-5-5-语言语法持续增强" class="headerlink" title="1.5.5　语言语法持续增强"></a>1.5.5　语言语法持续增强</h4><p>一门语言的功能、语法是影响语言生产力和效率的重要因素，很多语言特性和语法糖不论有没有，程序也照样能写，但即使只是可有可无的语法糖，也是直接影响语言使用者的幸福感程度的关键指标。</p>
<p>JDK 7的Coins项目结束以后，Java社区又创建了另外一个新的语言特性改进项目Amber，JDK 10至13里面提供的新语法改进基本都来自于这个项目，譬如： </p>
<ul>
<li>JEP 286：Local-Variable Type Inference，在JDK 10中提供，本地类型变量推断。</li>
<li>JEP 323：Local-Variable Syntax for Lambda Parameters，在JDK 11中提供，JEP 286的加强，使它可以用在Lambda中。</li>
<li>JEP 325：Switch Expressions，在JDK 13中提供，实现switch语句的表达式支持。</li>
<li>JEP 335：Text Blocks，在JDK 13中提供，支持文本块功能，可以节省拼接HTML、SQL等场景里 大量的“+”操作。</li>
</ul>
<p>还有一些是仍然处于草稿状态或者暂未列入发布范围的JEP，可供我们窥探未来Java语法的变化， 譬如：</p>
<ul>
<li>JEP 301：Enhanced Enums，允许常量类绑定数据类型，携带额外的信息。</li>
<li>JEP 302：Lambda Leftovers，用下划线来表示Lambda中的匿名参数。 </li>
<li>JEP 305：Pattern Matching for instanceof，用instanceof判断过的类型，在条件分支里面可以不需要做强类型转换就能直接使用。</li>
</ul>
<p>除语法糖以外，语言的功能也在持续改进之中，以下几个项目是目前比较明确的，也是受到较多关注的功能改进计划：</p>
<ul>
<li>Project Loom：现在的Java做并发处理的最小调度单位是线程，Java线程的调度是直接由操作系统内核提供的，会有核心态、用户态的切换开销。而很多其他语言都提供了更加轻量级的、由软件自身进行调度的用户线程，譬如 Golang的Groutine、D语言的Fiber等。Loom项目就准备提供一套与目前Thread类API非常接近的Fiber实现。</li>
<li>Project Valhalla：提供值类型和基本类型的泛型支持，并提供明确的不可变类型和非引用类型的声明。不可变类型在并发编程中能带来很多好处，没有数据竞争风险带来了更好的性能。一些语言（如Scala）就有明确的不可变类型声明，而Java中只能在定义类时将全部字段声明为final来间接实现。基本类型的范型支持是指在泛型中引用基本数据类型不需要自动装箱和拆箱，避免性能损耗。</li>
<li>Project Panama：目的是消弭Java虚拟机与本地代码之间的界线。现在Java代码可以通过JNI来调用本地代码，这点在与硬件交互频繁的场合尤其常用（譬如Android）。但是JNI的调用方式充其量只能说是达到能用的标准而已，使用起来仍相当烦琐，频繁执行的性能开销也非常高昂，Panama项目的目标就是提供更好的方式让Java代码与本地代码进行调用和传输数据。</li>
</ul>
<h3 id="1-6-实战：自己编译JDK"><a href="#1-6-实战：自己编译JDK" class="headerlink" title="1.6　实战：自己编译JDK"></a>1.6　实战：自己编译JDK</h3><h4 id="1-6-1-获取源码"><a href="#1-6-1-获取源码" class="headerlink" title="1.6.1　获取源码"></a>1.6.1　获取源码</h4><p>OpenJDK 12：<a href="https://hg.openjdk.java.net/jdk/jdk12/" target="_blank" rel="noopener">https://hg.openjdk.java.net/jdk/jdk12/</a></p>
<p>然后点击左边菜单中的“Browse”，此时点击左边的“zip”链接即可下载当前版本打包好的源码，到本地直接解压即可。</p>
<h4 id="1-6-2-系统需求"><a href="#1-6-2-系统需求" class="headerlink" title="1.6.2　系统需求"></a>1.6.2　系统需求</h4><p>建议尽量在Linux或者MacOS上构建OpenJDK，这两个系统在准备构建工具链和依赖项上要比在Windows或Solaris平台上要容易许多。</p>
<p>无论在什么平台下进行编译，都建议读者认真阅读一遍源码中的doc/building.html文档。</p>
<p>本次编译中采用的是64位操作系统，默认参数下编译出来的也是64位的OpenJDK。在官方文档上要求编译OpenJDK至少需要2～4GB的内存空间，而且至少要6～8GB的空闲磁盘空间，不要看OpenJDK源码的大小只有不到600MB，要完成编译，过程中会产生大量的中间文件，并且编译出不同优化级别（Product、FastDebug、SlowDebug）的HotSpot虚拟机可能要重复生成这些中间文件，这都会占用大量磁盘空间。</p>
<p>所有的文件，包括源码和依赖项目，都不要放在包含中文的目录里面。</p>
<h4 id="1-6-3-构建编译环境"><a href="#1-6-3-构建编译环境" class="headerlink" title="1.6.3　构建编译环境"></a>1.6.3　构建编译环境</h4><table>
<thead>
<tr>
<th>工具</th>
<th>库名称</th>
<th>安装命令</th>
</tr>
</thead>
<tbody><tr>
<td>FreeType</td>
<td>The FreeType Project</td>
<td>sudo apt-get install libfreetype6-dev</td>
</tr>
<tr>
<td>CUPS</td>
<td>Common UNIX Printing System</td>
<td>sudo apt-get install libcups2-dev</td>
</tr>
<tr>
<td>X11</td>
<td>X Window System</td>
<td>sudo apt-get install libx11-dev libxext-dev libxrender-dev libxrandr-dev libxtst-dev libxt-dev</td>
</tr>
<tr>
<td>ALSA</td>
<td>Advanced Linux Sound Architecture</td>
<td>sudo apt-get install libasound2-dev</td>
</tr>
<tr>
<td>libffi</td>
<td>Portable Foreign Function Interface Library</td>
<td>sudo apt-get install libffi-dev</td>
</tr>
<tr>
<td>Autoconf</td>
<td>Extensible Package of M4 Macros</td>
<td>sudo apt-get install autoconf</td>
</tr>
</tbody></table>
<p>要编译大版本号为N的JDK，还要另外准备一个大版本号至少为N-1的、已经编译 好的JDK，这是因为OpenJDK由多个部分构成，其中一部分代码使用C、C++编写，而更多的代码则是使用Java语言来实现，因此编译这些Java代码就需要用到另一个编译期可用的JDK，官方称这个JDK为“Bootstrap JDK”。编译OpenJDK 12时，Bootstrap JDK必须使用JDK 11及之后的版本。在Ubuntu中使用以下命令安装OpenJDK 11：<code>sudo apt-get install openjdk-11-jdk</code></p>
<h4 id="1-6-4-进行编译"><a href="#1-6-4-进行编译" class="headerlink" title="1.6.4　进行编译"></a>1.6.4　进行编译</h4><h4 id="1-6-5-在IDE工具中进行源码调试"><a href="#1-6-5-在IDE工具中进行源码调试" class="headerlink" title="1.6.5　在IDE工具中进行源码调试"></a>1.6.5　在IDE工具中进行源码调试</h4><h3 id="1-7-本章小结"><a href="#1-7-本章小结" class="headerlink" title="1.7　本章小结"></a>1.7　本章小结</h3><h1 id="第二部分-自动内存管理"><a href="#第二部分-自动内存管理" class="headerlink" title="第二部分　自动内存管理"></a>第二部分　自动内存管理</h1><h2 id="第2章-Java内存区域与内存溢出异常"><a href="#第2章-Java内存区域与内存溢出异常" class="headerlink" title="第2章　Java内存区域与内存溢出异常"></a>第2章　Java内存区域与内存溢出异常</h2><blockquote class="blockquote-center">
            <p>Java与C++之间有一堵由内存动态分配和垃圾收集技术所围成的高墙，墙外面的人想进去，墙里面的人却想出来。</p>

          </blockquote>

<h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1　概述"></a>2.1　概述</h3><p>对于从事C、C++程序开发的开发人员来说，在内存管理领域，他们既是拥有最高权力的“皇帝”， 又是从事最基础工作的劳动人民——既拥有每一个对象的“所有权”，又担负着每一个对象生命从开始到终结的维护责任。</p>
<h5 id="Java虚拟机自动内存管理机制的优缺点"><a href="#Java虚拟机自动内存管理机制的优缺点" class="headerlink" title="Java虚拟机自动内存管理机制的优缺点"></a>Java虚拟机自动内存管理机制的优缺点</h5><p>优点：不再需要为每一个new操作去写配对的内存分配回收代码，不容易出现内存泄漏和内存溢出问题。</p>
<p>缺点：由于把控制内存的权力交给了Java虚拟机，一旦出现内存泄漏和溢出方面的问题，如果不了解虚拟机是怎样使用内存的，那排查错误、修正问题将会成为一项异常艰难的工作。</p>
<h3 id="2-2-运行时数据区域"><a href="#2-2-运行时数据区域" class="headerlink" title="2.2　运行时数据区域"></a>2.2　运行时数据区域</h3><p>Java虚拟机在执行Java程序的过程中会把它所管理的内存划分为若干个不同的数据区域。这些区域有各自的用途，以及创建和销毁的时间。根据《Java虚拟机规范》的规定，Java虚拟机所管理的内存将会包括以下几个运行时数据区域。</p>
<p><img data-src="https://images2017.cnblogs.com/blog/740591/201707/740591-20170727190400258-768840483.png" alt=""></p>
<h4 id="2-2-1-程序计数器"><a href="#2-2-1-程序计数器" class="headerlink" title="2.2.1　程序计数器"></a>2.2.1　程序计数器</h4><p>程序计数器（Program Counter Register）是一块较小的内存空间，它可以看作是<strong>当前线程</strong>所执行的<strong>字节码</strong>的<strong>行号指示器</strong>。</p>
<p>字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，它是程序控制流的指示器。</p>
<p>如果线程正在执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机<strong>字节码指令的地址</strong>；如果正在执行的是本地（Native）方法，这个计数器值则应为空（Undefined）。</p>
<p>此内存区域是<strong>唯一</strong>一个在《Java虚拟机规范》中没有规定任何OutOfMemoryError情况的区域。</p>
<h5 id="为什么程序计数器是线程私有的？"><a href="#为什么程序计数器是线程私有的？" class="headerlink" title="为什么程序计数器是线程私有的？"></a>为什么程序计数器是线程私有的？</h5><p>由于Java虚拟机的<strong>多线程</strong>是通过线程轮流切换、分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器（对于多核处理器来说是一个内核）都只会执行一条线程中的指令。因此，<strong>为了线程切换后能恢复到正确的执行位置</strong>，每条线程都需要有一个独立的程序计数器，各条线程之间计数器互不影响，独立存储。</p>
<h4 id="2-2-2-Java虚拟机栈"><a href="#2-2-2-Java虚拟机栈" class="headerlink" title="2.2.2　Java虚拟机栈"></a>2.2.2　Java虚拟机栈</h4><p>与程序计数器一样，Java虚拟机栈（Java Virtual Machine Stack）也是线程私有的，它的生命周期与线程相同。</p>
<p><strong>虚拟机栈描述的是Java方法执行的线程内存模型</strong>：每个方法被执行的时候，Java虚拟机都会同步创建一个栈帧（Stack Frame）用于存储<strong>局部变量表、操作数栈、动态连接、方法出口</strong>等信息。每一个方法被调用直至执行完毕的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。</p>
<p>局部变量表存放了编译期可知的各种Java虚拟机<strong>基本数据类型</strong>、<strong>对象引用</strong>（可能是一个指向对象起始地址的引用指针，也可能是指向一个代表对象的句柄或者其他与此对象相关的位置）和<strong>returnAddress 类型</strong>（指向了一条字节码指令的地址）。 </p>
<p>局部变量表中的存储空间以<strong>局部变量槽</strong>（Slot）来表示，其中64位长度的long和 double类型的数据会占用两个变量槽，其余的数据类型只占用一个。</p>
<p><strong>局部变量表所需的内存空间在编译期间完成分配</strong>，当进入一个方法时，这个方法需要在栈帧中分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表的大小。</p>
<p>在《Java虚拟机规范》中，对这个内存区域规定了两类异常状况：</p>
<ol>
<li><p>如果线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError异常；</p>
</li>
<li><p>如果Java虚拟机栈容量可以动态扩展，当栈扩 展时无法申请到足够的内存会抛出OutOfMemoryError异常。</p>
<p>HotSpot虚拟机的栈容量是不可以动态扩展的，以前的Classic虚拟机倒是可以。所以在HotSpot虚拟机上是不会由于虚拟机栈无法扩展而导致OutOfMemoryError异常——只要线程申请栈空间成功了就不会有OOM，但是如果申请时就失败，仍然是会出现OOM异常的。</p>
</li>
</ol>
<h4 id="2-2-3-本地方法栈"><a href="#2-2-3-本地方法栈" class="headerlink" title="2.2.3　本地方法栈"></a>2.2.3　本地方法栈</h4><p>本地方法栈（Native Method Stacks）与虚拟机栈的<strong>区别</strong>：</p>
<p>虚拟机栈为虚拟机执行Java方法（也就是字节码）服务，而本地方法栈则是为虚拟机使用到的本地（Native） 方法服务。</p>
<p>《Java虚拟机规范》对本地方法栈中方法使用的语言、使用方式与数据结构并没有任何强制规定，因此<strong>Hot-Spot虚拟机直接就把本地方法栈和虚拟机栈合二为一</strong>。</p>
<p>与虚拟机栈一样，本地方法栈也会在栈深度溢出或者栈扩展失败时分别抛出StackOverflowError和OutOfMemoryError异常。</p>
<h4 id="2-2-4-Java堆"><a href="#2-2-4-Java堆" class="headerlink" title="2.2.4　Java堆"></a>2.2.4　Java堆</h4><p>Java堆（Java Heap）是虚拟机所管理的内存中<strong>最大</strong>的一块。</p>
<p>Java堆是被所有线程共享的一块内存区域，在虚拟机启动时创建。</p>
<p>此内存区域的<strong>唯一目的</strong>就是存放对象实例。</p>
<p>Java堆是垃圾收集器管理的内存区域，因此也被称作“GC堆”（Garbage Collected Heap）。</p>
<p>从<strong>回收内存</strong>的角度看，由于现代垃圾收集器大部分都是基于<strong>分代收集理论</strong>设计的，所以Java堆中经常会出现“新生代”、“老年代”、“永久代”、“Eden空间”、“From Survivor空 间”、“To Survivor空间”等名词。</p>
<p>从<strong>分配内存</strong>的角度看，所有线程共享的Java堆中可以划分出多个线程私有的分配缓冲区 （Thread Local Allocation Buffer，TLAB），以提升对象分配时的效率。</p>
<p>根据《Java虚拟机规范》的规定，Java堆可以处于物理上不连续的内存空间中，但在逻辑上它应该被视为连续的。但对于大对象（典型的如数组对象），多数虚拟机实现出于实现简单、存储高效的考虑，很可能会要求连续的内存空间。</p>
<p>主流的Java虚拟机都是按照可扩展来实现的。如果在Java堆中没有内存完成实例分配，并且堆也无法再扩展时，Java虚拟机将会抛出OutOfMemoryError异常。</p>
<h5 id="Java对象实例都分配在堆上吗？"><a href="#Java对象实例都分配在堆上吗？" class="headerlink" title="Java对象实例都分配在堆上吗？"></a>Java对象实例都分配在堆上吗？</h5><p>Java 世界里<strong>“几乎”</strong>所有的对象实例都在这里分配内存。在《Java虚拟机规范》中对Java堆的描述是：“所有的对象实例以及数组都应当在堆上分配”。</p>
<p>随着Java语言的发展，现在已经能看到些许迹象表明日后可能出现<strong>值类型</strong>的支持，即使只考虑现在，由于即时编译技术的进步，尤其是<strong>逃逸分析</strong>技术的日渐强大，<strong>栈上分配</strong>、<strong>标量替换</strong>优化手段已经导致一些微妙的变化悄然发生，所以说Java对象实例都分配在堆上也渐渐变得不是那么绝对了。</p>
<p>如果对一个对象进行逃逸分析，发现其作用范围并不会超出一个方法，那就可以直接将该对象分配在栈空间，如果发现只使用了该对象的个别成员变量，那就可以将该对象拆开，将使用到的成员变量转变为局部变量。</p>
<h5 id="Java堆中一定存在年轻代、老年代或永久代吗？"><a href="#Java堆中一定存在年轻代、老年代或永久代吗？" class="headerlink" title="Java堆中一定存在年轻代、老年代或永久代吗？"></a>Java堆中一定存在年轻代、老年代或永久代吗？</h5><p>Java堆是否被划分为年轻代、老年代和永久代，取决于Java虚拟机所使用的垃圾收集器是否按照经典的分代收集理论来设计的，即虚拟机采用了按分代收集理论设计的垃圾收集器时才会被划分为年轻代、老年代和永久代。</p>
<p>这样的区域划分<strong>仅仅</strong>是<strong>一部分</strong>垃圾收集器的<strong>共同特性</strong>或者说<strong>设计风格</strong>而已，而非某个Java虚拟机具体实现的固有内存布局，更不是《Java虚拟机规范》里对Java堆的进一步细致划分。</p>
<p>在十年之前（以G1收集器的出现为分界），HotSpot虚拟机内部的垃圾收集器<strong>全部</strong>都基于“经典分代”来设计，需要新生代、老年代收集器搭配才能工作。</p>
<p>但是到了今天，垃圾收集器技术与十年前已不可同日而语，HotSpot里面也出现了不采用分代设计的新垃圾收集器。</p>
<h4 id="2-2-5-方法区"><a href="#2-2-5-方法区" class="headerlink" title="2.2.5　方法区"></a>2.2.5　方法区</h4><p>方法区（Method Area）与Java堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的<strong>类型信息</strong>、<strong>常量</strong>、<strong>静态变量</strong>、<strong>即时编译器编译后的代码缓存</strong>等数据。</p>
<p>虽然《Java虚拟机规范》中把方法区描述为堆的一个逻辑部分，但是它却有一个别名叫作“非堆”（Non-Heap），目的是与Java堆区分开来。</p>
<p>说到方法区，不得不提一下“永久代”这个概念，尤其是在JDK 8以前，许多Java程序员都习惯在 HotSpot虚拟机上开发、部署程序，很多人都更愿意把方法区称呼为“永久代”（Permanent Generation），或将两者混为一谈。本质上这两者并不是等价的，因为仅仅是当时的HotSpot虚拟机设计团队选择把收集器的分代设计扩展至方法区，或者说使用永久代来实现方法区而已，这样使得 HotSpot 的垃圾收集器能够像管理Java堆一样管理这部分内存，省去专门为方法区编写内存管理代码的工作。但是对于其他虚拟机实现，譬如BEA JRockit、IBM J9等来说，是不存在永久代的概念的。原则上如何实现方法区属于虚拟机实现细节，不受《Java虚拟机规范》管束，并不要求统一。但现在回头来看，当年使用永久代来实现方法区的决定并不是一个好主意，这种设计导致了Java应用更容易遇到内存溢出的问题（永久代有-XX：MaxPermSize的上限，即使不设置也有默认大小，而J9和JRockit只要没有触碰到进程可用内存的上限，例如32位系统中的4GB限制，就不会出问题），而且有极少数方法 （例如String::intern()）会因永久代的原因而导致不同虚拟机下有不同的表现。当Oracle收购BEA获得了 JRockit的所有权后，准备把JRockit中的优秀功能，譬如Java Mission Control管理工具，移植到HotSpot 虚拟机时，但因为两者对方法区实现的差异而面临诸多困难。考虑到HotSpot未来的发展，在JDK 6的 时候HotSpot开发团队就有放弃永久代，逐步改为采用本地内存（Native Memory）来实现方法区的计划了，到了JDK 7的HotSpot，已经把原本放在永久代的字符串常量池、静态变量等移出，而到了 JDK 8，终于完全废弃了永久代的概念，改用与JRockit、J9一样在本地内存中实现的元空间（Metaspace）来代替，把JDK 7中永久代还剩余的内容（主要是类型信息）全部移到元空间中。</p>
<h5 id="方法区于永久代的联系与区别"><a href="#方法区于永久代的联系与区别" class="headerlink" title="方法区于永久代的联系与区别"></a>方法区于永久代的联系与区别</h5><p>在JDK 8以前，HotSpot虚拟机设计团队选择把收集器的分代设计扩展至方法区，或者说使用永久代来实现方法区而已，这样使得 HotSpot 的垃圾收集器能够像管理Java堆一样管理这部分内存，省去专门为方法区编写内存管理代码的工作。但是对于其他虚拟机实现，譬如BEA JRockit、IBM J9等来说，是不存在永久代的概念的。</p>
<p>这种设计导致了Java应用更容易遇到内存溢出的问题（永久代有-XX：MaxPermSize的上限，即使不设置也有默认大小，而J9和JRockit只要没有触碰到进程可用内存的上限，例如32位系统中的4GB限制，就不会出问题），而且有极少数方法 （例如String::intern()）会因永久代的原因而导致不同虚拟机下有不同的表现。当Oracle收购BEA获得了 JRockit的所有权后，准备把JRockit中的优秀功能，譬如Java Mission Control管理工具，移植到HotSpot 虚拟机时，但因为两者对方法区实现的差异而面临诸多困难。考虑到HotSpot未来的发展，</p>
<p>在JDK 6的时候HotSpot开发团队就有放弃永久代，逐步改为采用本地内存（Native Memory）来实现方法区的计划了，到了JDK 7的HotSpot，已经把原本放在永久代的字符串常量池、静态变量等移出，而到了 JDK 8，终于完全废弃了永久代的概念，改用与JRockit、J9一样在本地内存中实现的元空间（Metaspace）来代替，把JDK 7中永久代还剩余的内容（主要是类型信息）全部移到元空间中。</p>
<p>2.2.6　运行时常量池 47<br>2.2.7　直接内存 47<br>2.3　HotSpot虚拟机对象探秘 48<br>2.3.1　对象的创建 48<br>2.3.2　对象的内存布局 51<br>2.3.3　对象的访问定位 52<br>2.4　实战：OutOfMemoryError异常 53<br>2.4.1　Java堆溢出 54<br>2.4.2　虚拟机栈和本地方法栈溢出 56<br>2.4.3　方法区和运行时常量池溢出 61<br>2.4.4　本机直接内存溢出 65<br>2.5　本章小结 66<br>第3章　垃圾收集器与内存分配策略 67<br>3.1　概述 67<br>3.2　对象已死？ 68<br>3.2.1　引用计数算法 68<br>3.2.2　可达性分析算法 70<br>3.2.3　再谈引用 71<br>3.2.4　生存还是死亡？ 72<br>3.2.5　回收方法区 74<br>3.3　垃圾收集算法 75<br>3.3.1　分代收集理论 75<br>3.3.2　标记-清除算法 77<br>3.3.3　标记-复制算法 78<br>3.3.4　标记-整理算法 79<br>3.4　HotSpot的算法细节实现 81<br>3.4.1　根节点枚举 81<br>3.4.2　安全点 82<br>3.4.3　安全区域 83<br>3.4.4　记忆集与卡表 84<br>3.4.5　写屏障 85<br>3.4.6　并发的可达性分析 87<br>3.5　经典垃圾收集器 89<br>3.5.1　Serial收集器 90<br>3.5.2　ParNew收集器 92<br>3.5.3　Parallel Scavenge收集器 93<br>3.5.4　Serial Old收集器 94<br>3.5.5　Parallel Old收集器 95<br>3.5.6　CMS收集器 96<br>3.5.7　Garbage First收集器 98<br>3.6　低延迟垃圾收集器 104<br>3.6.1　Shenandoah收集器 105<br>3.6.2　ZGC收集器 112<br>3.7　选择合适的垃圾收集器 121<br>3.7.1　Epsilon收集器 121<br>3.7.2　收集器的权衡 121<br>3.7.3　虚拟机及垃圾收集器日志 122<br>3.7.4　垃圾收集器参数总结 127<br>3.8　实战：内存分配与回收策略 129<br>3.8.1　对象优先在Eden分配 130<br>3.8.2　大对象直接进入老年代 131<br>3.8.3　长期存活的对象将进入老年代 132<br>3.8.4　动态对象年龄判定 134<br>3.8.5　空间分配担保 135<br>3.9　本章小结 137<br>第4章　虚拟机性能监控、故障处理工具 138<br>4.1　概述 138<br>4.2　基础故障处理工具 138<br>4.2.1　jps：虚拟机进程状况工具 141<br>4.2.2　jstat：虚拟机统计信息监视工具 142<br>4.2.3　jinfo：Java配置信息工具 143<br>4.2.4　jmap：Java内存映像工具 144<br>4.2.5　jhat：虚拟机堆转储快照分析工具 145<br>4.2.6　jstack：Java堆栈跟踪工具 146<br>4.2.7　基础工具总结 148<br>4.3　可视化故障处理工具 151<br>4.3.1　JHSDB：基于服务性代理的调试工具 152<br>4.3.2　JConsole：Java监视与管理控制台 157<br>4.3.3　VisualVM：多合-故障处理工具 164<br>4.3.4　Java Mission Control：可持续在线的监控工具 171<br>4.4　HotSpot虚拟机插件及工具 175<br>4.5　本章小结 180<br>第5章　调优案例分析与实战 181<br>5.1　概述 181<br>5.2　案例分析 181<br>5.2.1　大内存硬件上的程序部署策略 182<br>5.2.2　集群间同步导致的内存溢出 184<br>5.2.3　堆外内存导致的溢出错误 185<br>5.2.4　外部命令导致系统缓慢 187<br>5.2.5　服务器虚拟机进程崩溃 187<br>5.2.6　不恰当数据结构导致内存占用过大 188<br>5.2.7　由Windows虚拟内存导致的长时间停顿 189<br>5.2.8　由安全点导致长时间停顿 190<br>5.3　实战：Eclipse运行速度调优 192<br>5.3.1　调优前的程序运行状态 193<br>5.3.2　升级JDK版本的性能变化及兼容问题 196<br>5.3.3　编译时间和类加载时间的优化 200<br>5.3.4　调整内存设置控制垃圾收集频率 203<br>5.3.5　选择收集器降低延迟 206<br>5.4　本章小结 209<br>第三部分　虚拟机执行子系统<br>第6章　类文件结构 212<br>6.1　概述 212<br>6.2　无关性的基石 212<br>6.3　Class类文件的结构 214<br>6.3.1　魔数与Class文件的版本 215<br>6.3.2　常量池 218<br>6.3.3　访问标志 224<br>6.3.4　类索引、父类索引与接口索引集合 225<br>6.3.5　字段表集合 226<br>6.3.6　方法表集合 229<br>6.3.7　属性表集合 230<br>6.4　字节码指令简介 251<br>6.4.1　字节码与数据类型 251<br>6.4.2　加载和存储指令 253<br>6.4.3　运算指令 254<br>6.4.4　类型转换指令 255<br>6.4.5　对象创建与访问指令 256<br>6.4.6　操作数栈管理指令 256<br>6.4.7　控制转移指令 257<br>6.4.8　方法调用和返回指令 257<br>6.4.9　异常处理指令 258<br>6.4.10　同步指令 258<br>6.5　公有设计，私有实现 259<br>6.6　Class文件结构的发展 260<br>6.7　本章小结 261<br>第7章　虚拟机类加载机制 262<br>7.1　概述 262<br>7.2　类加载的时机 263<br>7.3　类加载的过程 267<br>7.3.1　加载 267<br>7.3.2　验证 268<br>7.3.3　准备 271<br>7.3.4　解析 272<br>7.3.5　初始化 277<br>7.4　类加载器 279<br>7.4.1　类与类加载器 280<br>7.4.2　双亲委派模型 281<br>7.4.3　破坏双亲委派模型 285<br>7.5　Java模块化系统 287<br>7.5.1　模块的兼容性 288<br>7.5.2　模块化下的类加载器 290<br>7.6　本章小结 292<br>第8章　虚拟机字节码执行引擎 293<br>8.1　概述 293<br>8.2　运行时栈帧结构 294<br>8.2.1　局部变量表 294<br>8.2.2　操作数栈 299<br>8.2.3　动态连接 300<br>8.2.4　方法返回地址 300<br>8.2.5　附加信息 301<br>8.3　方法调用 301<br>8.3.1　解析 301<br>8.3.2　分派 303<br>8.4　动态类型语言支持 315<br>8.4.1　动态类型语言 316<br>8.4.2　Java与动态类型 317<br>8.4.3　java.lang.invoke包 318<br>8.4.4　invokedynamic指令 321<br>8.4.5　实战：掌控方法分派规则 324<br>8.5　基于栈的字节码解释执行引擎 326<br>8.5.1　解释执行 327<br>8.5.2　基于栈的指令集与基于寄存器的指令集 328<br>8.5.3　基于栈的解释器执行过程 329<br>8.6　本章小结 334<br>第9章　类加载及执行子系统的案例与实战 335<br>9.1　概述 335<br>9.2　案例分析 335<br>9.2.1　Tomcat：正统的类加载器架构 335<br>9.2.2　OSGi：灵活的类加载器架构 338<br>9.2.3　字节码生成技术与动态代理的实现 341<br>9.2.4　Backport工具：Java的时光机器 345<br>9.3　实战：自己动手实现远程执行功能 348<br>9.3.1　目标 348<br>9.3.2　思路 349<br>9.3.3　实现 350<br>9.3.4　验证 355<br>9.4　本章小结 356<br>第四部分　程序编译与代码优化<br>第10章　前端编译与优化 358<br>10.1　概述 358<br>10.2　Javac编译器 359<br>10.2.1　Javac的源码与调试 359<br>10.2.2　解析与填充符号表 362<br>10.2.3　注解处理器 363<br>10.2.4　语义分析与字节码生成 364<br>10.3　Java语法糖的味道 367<br>10.3.1　泛型 367<br>10.3.2　自动装箱、拆箱与遍历循环 375<br>10.3.3　条件编译 377<br>10.4　实战：插入式注解处理器 378<br>10.4.1　实战目标 379<br>10.4.2　代码实现 379<br>10.4.3　运行与测试 385<br>10.4.4　其他应用案例 386<br>10.5　本章小结 386<br>第11章　后端编译与优化 388<br>11.1　概述 388<br>11.2　即时编译器 389<br>11.2.1　解释器与编译器 389<br>11.2.2　编译对象与触发条件 392<br>11.2.3　编译过程 397<br>11.2.4　实战：查看及分析即时编译结果 398<br>11.3　提前编译器 404<br>11.3.1　提前编译的优劣得失 405<br>11.3.2　实战：Jaotc的提前编译 408<br>11.4　编译器优化技术 411<br>11.4.1　优化技术概览 411<br>11.4.2　方法内联 415<br>11.4.3　逃逸分析 417<br>11.4.4　公共子表达式消除 420<br>11.4.5　数组边界检查消除 421<br>11.5　实战：深入理解Graal编译器 423<br>11.5.1　历史背景 423<br>11.5.2　构建编译调试环境 424<br>11.5.3　JVMCI编译器接口 426<br>11.5.4　代码中间表示 429<br>11.5.5　代码优化与生成 432<br>11.6　本章小结 436<br>第五部分　高效并发<br>第12章　Java内存模型与线程 438<br>12.1　概述 438<br>12.2　硬件的效率与一致性 439<br>12.3　Java内存模型 440<br>12.3.1　主内存与工作内存 441<br>12.3.2　内存间交互操作 442<br>12.3.3　对于volatile型变量的特殊规则 444<br>12.3.4　针对long和double型变量的特殊规则 450<br>12.3.5　原子性、可见性与有序性 450<br>12.3.6　先行发生原则 452<br>12.4　Java与线程 455<br>12.4.1　线程的实现 455<br>12.4.2　Java线程调度 458<br>12.4.3　状态转换 460<br>12.5　Java与协程 461<br>12.5.1　内核线程的局限 461<br>12.5.2　协程的复苏 462<br>12.5.3　Java的解决方案 464<br>12.6　本章小结 465<br>第13章　线程安全与锁优化 466<br>13.1　概述 466<br>13.2　线程安全 466<br>13.2.1　Java语言中的线程安全 467<br>13.2.2　线程安全的实现方法 471<br>13.3　锁优化 479<br>13.3.1　自旋锁与自适应自旋 479<br>13.3.2　锁消除 480<br>13.3.3　锁粗化 481<br>13.3.4　轻量级锁 481<br>13.3.5　偏向锁 483<br>13.4　本章小结 485<br>附录A　在Windows系统下编译OpenJDK 6 486<br>附录B　展望Java技术的未来（2013年版） 493<br>附录C　虚拟机字节码指令表 499<br>附录D　对象查询语言（OQL）简介 506<br>附录E　JDK历史版本轨迹 512</p>
]]></content>
  </entry>
  <entry>
    <title>Interface in Java 1.8</title>
    <url>/2020/08/26/Interface-in-Java-1-8/</url>
    <content><![CDATA[<img data-src="https://cdn.journaldev.com/wp-content/uploads/2014/04/java-8-interface-changes-static-method-default-method.jpg" width="100%"/>

<a id="more"></a>

<p>Java 8 对接口设计了默认方法和静态方法</p>
<h2 id="默认方法"><a href="#默认方法" class="headerlink" title="默认方法"></a>默认方法</h2><p>接口的默认方法类似于抽象类中的抽象方法</p>
<h3 id="接口是否可以取代抽象类"><a href="#接口是否可以取代抽象类" class="headerlink" title="接口是否可以取代抽象类"></a>接口是否可以取代抽象类</h3><p>不可以，原因有以下几点：</p>
<ol>
<li>接口的变量只能是常量(<code>public static final</code>)。</li>
<li>接口的方法修饰符只能是 <code>public</code>。</li>
<li>接口不存在构造函数，抽象类中虽然有构造函数，但仍然不能实例化。</li>
</ol>
<p>实际开发中有哪些例子是只能用抽象类来实现的？</p>
<h3 id="多继承的问题"><a href="#多继承的问题" class="headerlink" title="多继承的问题"></a>多继承的问题</h3><p>如果一个类实现了两个接口，两个接口里面有同样的方法，而且都有自己的默认实现。当我调用这个类此方法的时候，到底调用的是哪个默认方法？</p>
<p>当一个类实现了多个接口，而这些接口中存在两个或两个以上方法签名相同的默认方法时，这被认为是冲突的。解决冲突需要遵守几个原则：</p>
<ol>
<li>类或父类中显式声明的方法，其优先级高于所有的默认方法</li>
<li>如果1规则失效，则选择与当前类距离最近的具有具体实现的默认方法</li>
<li>如果2规则也失效，则需要显式指定接口</li>
</ol>
<h3 id="设计目的"><a href="#设计目的" class="headerlink" title="设计目的"></a>设计目的</h3><ol>
<li><p>减少第三方工具类的创建</p>
<p>例如在 List 等集合接口中都有一些默认方法，List 接口中默认提供 replaceAll(UnaryOperator)、sort(Comparator)、spliterator() 等默认方法，这些方法在接口内部创建，避免了为了这些方法而专门去创建相应的工具类。</p>
</li>
<li><p>可以避免为了复用而创建基类</p>
<p>在 Java 8 之前可能需要创建一个基类来实现代码复用，而默认方法的出现，可以不必去创建基类。</p>
</li>
</ol>
<p>更好地支持集合的 API 在 lambda 表达式中应用</p>
<p>举个例子，为了在 Java 8 中为了扩展 Iterator 接口的 forEach() 方法，如果我们不创建默认方法，那么的话势必会带来和接口的演化类似的问题，换句话说这一点实际上与为了接口演化类似。</p>
<h2 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h2>]]></content>
  </entry>
  <entry>
    <title>Internet Download Manager</title>
    <url>/2019/01/03/Internet-Download-Manager/</url>
    <content><![CDATA[<img data-src="https://www.hashhackers.com/images/idm-download.png" width="100%"/>

<a id="more"></a>

]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>IDM</tag>
      </tags>
  </entry>
  <entry>
    <title>JSON Web Token</title>
    <url>/2019/12/17/JSON-Web-Token/</url>
    <content><![CDATA[<img data-src="https://images-1254006831.cos.ap-chengdu.myqcloud.com/jwt.jpg" width="100%"/>

<a id="more"></a>

<h2 id="WHAT-IS-JWT"><a href="#WHAT-IS-JWT" class="headerlink" title="WHAT IS JWT"></a>WHAT IS JWT</h2><h2 id="JWT-缺点"><a href="#JWT-缺点" class="headerlink" title="JWT 缺点"></a>JWT 缺点</h2><blockquote>
<p><a href="http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/" target="_blank" rel="noopener">Stop using JWT for sessions</a></p>
<p><a href="https://learnku.com/articles/22616#6536ec" target="_blank" rel="noopener">（译）别再使用 JWT 作为 Session 系统！问题重重且很危险。</a></p>
<p><a href="https://stackoverflow.com/questions/37959945/how-to-destroy-jwt-tokens-on-logout" target="_blank" rel="noopener">How to destroy JWT Tokens on logout?</a></p>
</blockquote>
<p>由于是无状态的，所以服务器无法主动销毁未过期的 JWT-Token。补救措施：将无效但未过期的 token 存在黑名单中，每次验证 token 前先检查其是否在黑名单中，在就直接抛相应异常即可。</p>
]]></content>
      <categories>
        <category>JWT</category>
      </categories>
      <tags>
        <tag>JWT</tag>
      </tags>
  </entry>
  <entry>
    <title>Java Thread</title>
    <url>/2020/10/26/Java-Thread/</url>
    <content><![CDATA[<img data-src="cover" width="100%"/>

<a id="more"></a>

<h2 id="创建线程的方式"><a href="#创建线程的方式" class="headerlink" title="创建线程的方式"></a>创建线程的方式</h2><ol>
<li><p>实现 Runnable 接口</p>
<p>继承 Thread 类，覆盖 run 方法，调用 <code>Thread#start</code> 启动</p>
</li>
<li><p>继承 Thread 类</p>
<p>实现 Runnable 接口，创建实例，作为 <code>Thread</code> 构造参数传入，调用 <code>Thread#start</code> 启动</p>
</li>
<li><p>实现 Callable 接口</p>
<p>实现 Callable 接口，创建实例，作为 <code>FutureTask&lt;&gt;</code> 构造参数创建 <code>FutureTask</code> 对象，将 FutureTask 对象作为 <code>Thread</code> 构造参数传入，调用 <code>Thread#start</code> 启动</p>
</li>
<li><p>线程池</p>
<p>使用 ThreadPoolExecutor 创建一个线程池，利用 <code>submit()</code> 方法提交线程，<code>Future&lt;Object&gt;</code> 接收返回</p>
</li>
</ol>
<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><h5 id="继承-Thread-和实现-Runnable、Callable-接口区别"><a href="#继承-Thread-和实现-Runnable、Callable-接口区别" class="headerlink" title="继承 Thread 和实现 Runnable、Callable 接口区别"></a>继承 Thread 和实现 Runnable、Callable 接口区别</h5><p>实现接口不影响继承其他类</p>
<h5 id="实现-Runnable-和-Callable的区别"><a href="#实现-Runnable-和-Callable的区别" class="headerlink" title="实现 Runnable 和 Callable的区别"></a>实现 Runnable 和 Callable的区别</h5><p>Runnable 无返回，Callable 有返回。</p>
<h5 id="Thread-启动和线程池启动方式"><a href="#Thread-启动和线程池启动方式" class="headerlink" title="Thread 启动和线程池启动方式"></a>Thread 启动和线程池启动方式</h5><p>线程池能够重复使用线程，节省 CPU 资源。</p>
]]></content>
  </entry>
  <entry>
    <title>Java Virtual Machine</title>
    <url>/2020/10/26/Java-Virtual-Machine/</url>
    <content><![CDATA[<img data-src="https://static001.infoq.cn/resource/image/5f/5e/5fe5dc2c6950ce2dce8808da91b63c5e.png" width="100%"/>

<a id="more"></a>

<h2 id="笔试题"><a href="#笔试题" class="headerlink" title="笔试题"></a>笔试题</h2><h3 id="Java-内存泄露的排查（思路及过程）"><a href="#Java-内存泄露的排查（思路及过程）" class="headerlink" title="Java 内存泄露的排查（思路及过程）"></a>Java 内存泄露的排查（思路及过程）</h3><blockquote>
<p><a href="https://blog.csdn.net/fishinhouse/article/details/80781673" target="_blank" rel="noopener">Java内存泄漏的排查总结</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1144256" target="_blank" rel="noopener">JVM第一篇：一个Java内存泄漏的排查案例</a></p>
</blockquote>
<ol>
<li>使用 jps/ps 命令确定虚拟机进程ID(LVMID，Local Virtual Machine Identifier)</li>
<li>使用 jstat 命令查看 JVM 的 GC 情况</li>
<li>使用 jmap 命令生产堆快照 dump 文件</li>
<li>使用 MAT 工具分析 dump 文件，在 MAT 中查看 Action 窗口下的 Histogram，找到占用内存大的对象，分析引用栈，最后定位到具体代码</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Java Web Norms</title>
    <url>/2020/05/18/Java-Web-Norms/</url>
    <content><![CDATA[<img data-src="https://img.alicdn.com/tfs/TB1piQUC4D1gK0jSZFsXXbldVXa-750-199.jpg" width="100%"/>

<a id="more"></a>

<p>分层领域模型规约:</p>
<blockquote>
<p><a href="https://github.com/alibaba/p3c/blob/master/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%EF%BC%88%E6%B3%B0%E5%B1%B1%E7%89%88%EF%BC%89.pdf" target="_blank" rel="noopener">阿里巴巴Java开发手册（泰山版）.pdf</a></p>
</blockquote>
<ul>
<li><p>DO/PO(Data Object/Persistent Object): 此对象与数据库表结构对应,通过 DAO 层向上传输数据源对象 </p>
</li>
<li><p>DTO(Data Transfer Object): 数据传输对象, Service 或 Manager 向外传输的对象。  </p>
</li>
<li><p>BO(Business Object): 业务对象, 可以由 Service 层输出的封装业务逻辑的对象  </p>
</li>
<li><p>Query: 数据查询对象,各层接收上层的查询请求。注意超过2个参数的查询封装,禁止使用Map类      </p>
</li>
<li><p>VO(View Object): 显示层对象,通常是 Web 向模板渲染引擎层传输的对象</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Norms</category>
        <category>Java Web</category>
      </categories>
  </entry>
  <entry>
    <title>Linux Command</title>
    <url>/2019/07/31/Linux-Command/</url>
    <content><![CDATA[<img data-src="https://opensource.com/sites/default/files/styles/image-full-size/public/lead-images/tux_linux_penguin_code_binary.jpg?itok=TxGxW0KY" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://man.linuxde.net/" target="_blank" rel="noopener">Linux命令大全</a></p>
</blockquote>
<h2 id="文件和目录管理"><a href="#文件和目录管理" class="headerlink" title="文件和目录管理"></a>文件和目录管理</h2><h3 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h3><blockquote>
<p><a href="https://man.linuxde.net/mkdir" target="_blank" rel="noopener">mkdir</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir -p /media/userfiles/<span class="built_in">cd</span>/temp</span><br><span class="line"><span class="comment"># -p, --parents</span></span><br><span class="line">no error <span class="keyword">if</span> existing, make parent directories as needed</span><br></pre></td></tr></table></figure>

<h3 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h3><blockquote>
<p><a href="https://man.linuxde.net/mv" target="_blank" rel="noopener">mv | Linux命令大全</a></p>
<p><strong>mv命令</strong>用来对文件或目录重新命名，或者将文件从一个目录移到另一个目录中。</p>
</blockquote>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><ul>
<li><p>将 admin 文件夹重命名为 ledger-admin</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> 到 admin 上一级</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv admin ledger-admin</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将文件 a.txt 从目录 <code>/a</code> 移动到 <code>/b</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mv /a/a.txt /b/a.txt</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>Mac-OS-Terminal</title>
    <url>/2019/07/31/Mac-OS-Terminal/</url>
    <content><![CDATA[<img data-src="https://photos5.appleinsider.com/gallery/29497-47785-000-3x2-Terminal-part-2-l.jpg" width="100%"/>

<a id="more"></a>

<h2 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h2><blockquote>
<p><a href="http://cn.linux.vbird.org/linux_basic/0210filepermission.php" target="_blank" rel="noopener">第六章、Linux 的文件权限与目录配置</a></p>
</blockquote>
<h3 id="查看文件权限"><a href="#查看文件权限" class="headerlink" title="查看文件权限"></a>查看文件权限</h3><p>命令：<code>ls -l</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ls -l xxx.xxx</span><br><span class="line">-rw-r--r--@ 1 boris  staff  1080  7 31 18:00 xxx.xxx</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>文件类型和访问权限</th>
<th>文件数量</th>
<th align="center">所属用户</th>
<th>所在群组</th>
<th>文件大小</th>
<th>修改日期（月 日 时 分）</th>
<th>文件名称</th>
</tr>
</thead>
<tbody><tr>
<td>-rw-r–r–@</td>
<td>1</td>
<td align="center">boris</td>
<td>staff</td>
<td>1080</td>
<td>7 31 18:00</td>
<td>xxx.xxx</td>
</tr>
</tbody></table>
<h4 id="文件类型和访问权限"><a href="#文件类型和访问权限" class="headerlink" title="文件类型和访问权限"></a>文件类型和访问权限</h4><p>第一个符号代表文件类型：</p>
<ul>
<li><code>-</code> 表示该文件是非目录类型</li>
<li><code>d</code> 表示目录类型</li>
<li>中间九个字母分为三组，分别对应用户（user）、所在组（group）和其他用户（other）对该文件的访问权限。每组中的三个字符 “rwx” 分别表示对应用户对该文件拥有的可读／可写／可执行权限，没有相应权限则使用 “-” 符号替代。</li>
<li>末尾的 @ 符号表示文件拓展属性，属于文件系统的一个功能。</li>
</ul>
<h3 id="修改文件权限"><a href="#修改文件权限" class="headerlink" title="修改文件权限"></a>修改文件权限</h3><p>命令：<code>chmod [用户][操作][权限] [文件]</code></p>
<ul>
<li>用户部分：使用字母 u 表示文件拥有者（user），g 表示拥有者所在群组（group），o 表示其他用户（other），a 表示全部用户（all，包含前面三种用户范围）；</li>
<li>操作部分：“+” 符号表示增加权限，“-” 符号表示取消权限，“=” 符号表示赋值权限；</li>
<li>权限部分：“r” 符号表示可读（read），“w” 表示可写（write），“x” 表示可执行权限（execute）；</li>
<li>文件部分：如不指定文件名，表示操作对象为当前目录下的所有文件。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod a-w demo.txt <span class="comment"># 所有用户去掉‘写’权限</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -l demo.txt </span></span><br><span class="line">-r--r--r--  1 boris  staff  4  8  7 09:10 demo.txt</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Mac</category>
      </categories>
      <tags>
        <tag>Command-line</tag>
      </tags>
  </entry>
  <entry>
    <title>Macau Tour at New Year&#39;s Day in 2020</title>
    <url>/2019/12/26/Macau-Tour-at-New-Year-s-Day-in-2020/</url>
    <content><![CDATA[<img data-src="https://imgcdn.yicai.com/vms-storage/df7a694bdc74ee4f44f8ab9ccd4d913560ceb568.jpeg" width="100%"/>

<a id="more"></a>

<iframe width="100%" height="600" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20200101/all/index.html"></iframe>

<h2 id="往返路线"><a href="#往返路线" class="headerlink" title="往返路线"></a>往返路线</h2><h3 id="深圳-往返-港珠澳大桥公路口岸-bus"><a href="#深圳-往返-港珠澳大桥公路口岸-bus" class="headerlink" title="深圳 -往返- 港珠澳大桥公路口岸 :bus:"></a>深圳 -往返- 港珠澳大桥公路口岸 :bus:</h3><blockquote>
<p><a href="http://www.mafengwo.cn/sales/5811177.html" target="_blank" rel="noopener">深圳到珠海公路口岸澳门自由行拼车</a></p>
<p>上车集合点：</p>
<ol>
<li>7：00 福田口岸/皇岗口岸集合</li>
<li>16:30-17:00 公路口岸</li>
</ol>
<p>票价：¥ 289</p>
</blockquote>
<p><img data-src="https://b1-q.mafengwo.net/s13/M00/17/6E/wKgEaVxtL1iAauPpAADQXT-OV-Q43.jpeg" alt=""></p>
<p><img data-src="https://n1-q.mafengwo.net/s13/M00/13/C6/wKgEaVxtLO2ATuG4AADxsEuMe0o57.jpeg" alt=""></p>
<h2 id="游玩路线"><a href="#游玩路线" class="headerlink" title="游玩路线"></a>游玩路线</h2><blockquote>
<p><a href="[chrome-extension://cdonnmffkdaoajfknoeeecmchibpmkmg/assets/pdf/web/viewer.html?file=https%3A%2F%2Fwww.dsat.gov.mo%2Fhzmb%2Fpdf%2FHZMB_userguide.pdf](chrome-extension://cdonnmffkdaoajfknoeeecmchibpmkmg/assets/pdf/web/viewer.html?file=https%3A%2F%2Fwww.dsat.gov.mo%2Fhzmb%2Fpdf%2FHZMB_userguide.pdf)">港珠澳大桥通行使用指南</a></p>
<p><a href="http://www.dsat.gov.mo/bus/site/index.aspx" target="_blank" rel="noopener">澳门交通事务局官网</a></p>
</blockquote>
<h3 id="由远及近"><a href="#由远及近" class="headerlink" title="由远及近"></a>由远及近</h3><h4 id="10-30-12-00"><a href="#10-30-12-00" class="headerlink" title="10:30 - 12:00"></a>10:30 - 12:00</h4><iframe width="100%" height="600" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20200101/bus/gzodqambjdl-wnsr.html"></iframe>

<table>
<thead>
<tr>
<th>公交线路</th>
<th>上车站</th>
<th>下车站</th>
<th>时长</th>
<th>票价</th>
</tr>
</thead>
<tbody><tr>
<td>102X</td>
<td>港珠澳大桥澳门边检大楼</td>
<td>奥林匹克大马路</td>
<td>1小时17分钟</td>
<td>6</td>
</tr>
</tbody></table>
<h4 id="港珠澳大桥珠海公路口岸-官也街"><a href="#港珠澳大桥珠海公路口岸-官也街" class="headerlink" title="港珠澳大桥珠海公路口岸 - 官也街"></a>港珠澳大桥珠海公路口岸 - 官也街</h4><table>
<thead>
<tr>
<th>公交线路</th>
<th>上车站</th>
<th>下车站</th>
<th>时长</th>
<th>票价</th>
</tr>
</thead>
<tbody><tr>
<td>102X</td>
<td>港珠澳大桥澳门边检大楼</td>
<td>凼仔官也街(公交站)</td>
<td>1小时2分钟</td>
<td>6</td>
</tr>
</tbody></table>
<h4 id="官也街-威尼斯人"><a href="#官也街-威尼斯人" class="headerlink" title="官也街 - 威尼斯人"></a>官也街 - 威尼斯人</h4><p>步行，18分钟</p>
<p>购物：威尼斯人购物中心</p>
<h4 id="威尼斯人"><a href="#威尼斯人" class="headerlink" title="威尼斯人 -"></a>威尼斯人 -</h4><p>购物：DFS(T广场新濠天地店)</p>
<h4 id="澳门威尼斯人-妈祖阁"><a href="#澳门威尼斯人-妈祖阁" class="headerlink" title="澳门威尼斯人 - 妈祖阁"></a>澳门威尼斯人 - 妈祖阁</h4><table>
<thead>
<tr>
<th>公交线路</th>
<th>上车站</th>
<th>下车站</th>
<th>时长</th>
<th>票价</th>
</tr>
</thead>
<tbody><tr>
<td>MT4</td>
<td>新城大马路/银河</td>
<td>妈阁总站</td>
<td>43分钟</td>
<td>6</td>
</tr>
</tbody></table>
<h3 id="由近及远"><a href="#由近及远" class="headerlink" title="由近及远"></a>由近及远</h3><h4 id="10-30-11-30"><a href="#10-30-11-30" class="headerlink" title="10:30 - 11:30"></a>10:30 - 11:30</h4><iframe width="100%" height="600" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20200101/bus/gzodqambjdl-dsbpf.html"></iframe>


<p><img data-src="https://i.loli.net/2019/12/31/eyijDN4bkvBX8xl.png" alt=""></p>
<table>
<thead>
<tr>
<th>公交线路</th>
<th>上车站</th>
<th>下车站</th>
<th>时长</th>
<th>票价</th>
</tr>
</thead>
<tbody><tr>
<td>101X</td>
<td>港珠澳大桥澳门边检大楼</td>
<td>新马路/大丰</td>
<td>52 分钟</td>
<td>6</td>
</tr>
</tbody></table>
<p>旅客可在珠海公路口岸直接步行通关澳门，无须乘车。（珠海公路口岸与澳门口岸相接，均位于珠澳人工岛之上）。——【港珠澳大桥珠海口岸微信公众号】</p>
<h2 id="准备事项"><a href="#准备事项" class="headerlink" title="准备事项"></a>准备事项</h2><h3 id="流量包"><a href="#流量包" class="headerlink" title="流量包"></a>流量包</h3><p>支付宝 - 境外流量包</p>
<h3 id="兑换澳币"><a href="#兑换澳币" class="headerlink" title="兑换澳币"></a>兑换澳币</h3><h3 id="相机"><a href="#相机" class="headerlink" title="相机"></a>相机</h3><ul>
<li>充电</li>
<li>备份</li>
</ul>
<h2 id="购物清单"><a href="#购物清单" class="headerlink" title="购物清单"></a>购物清单</h2><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2>]]></content>
      <categories>
        <category>Tour</category>
      </categories>
      <tags>
        <tag>Tour</tag>
      </tags>
  </entry>
  <entry>
    <title>Use of Markdown</title>
    <url>/2018/06/01/Markdown/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2018/12/26/5c23262feb7b6.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p>Markdown 是一个 Web 上使用的文本到HTML的转换工具，可以通过简单、易读易写的文本格式生成结构化的HTML文档。目前 github、Stackoverflow 等网站均支持这种格式。</p>
<p><a href="http://www.markdown.cn/" target="_blank" rel="noopener">Markdown</a></p>
</blockquote>
<h2 id="生成目录"><a href="#生成目录" class="headerlink" title="生成目录"></a>生成目录</h2><p>TOC：table of contents</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TOC]</span><br></pre></td></tr></table></figure>

<h2 id="修改图片尺寸"><a href="#修改图片尺寸" class="headerlink" title="修改图片尺寸"></a>修改图片尺寸</h2><blockquote>
<p><a href="https://support.typora.io/Resize-Image/" target="_blank" rel="noopener">Typora-Resize Images</a></p>
</blockquote>
<p>使用<code>img</code>标签指定图片样式，eg：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://www.google.com/doodles/kamma-rahbeks-241st-birthday"</span> <span class="attr">width</span>=<span class="string">"100%"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><blockquote>
<p><a href="http://xianbai.me/learn-md/article/extension/table.html" target="_blank" rel="noopener">表格</a></p>
</blockquote>
<h3 id="单元格和表头"><a href="#单元格和表头" class="headerlink" title="单元格和表头"></a>单元格和表头</h3><p>使用 <code>|</code> 来分隔不同的单元格，使用 <code>-</code> 来分隔表头和其他行：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">列名 | 列名</span><br><span class="line">--- | ---</span><br><span class="line">列值 | 列值</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>列名</th>
<th>列名</th>
</tr>
</thead>
<tbody><tr>
<td>列值</td>
<td>列值</td>
</tr>
</tbody></table>
<h3 id="对齐方式"><a href="#对齐方式" class="headerlink" title="对齐方式"></a>对齐方式</h3><p>在表头下方的分隔线标记中加入 <code>:</code>，即可标记下方单元格内容的对齐方式：</p>
<ul>
<li><code>:---</code> 代表左对齐</li>
<li><code>:--:</code> 代表居中对齐</li>
<li><code>---:</code> 代表右对齐</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">| left | center | right |</span><br><span class="line">| :--- | :----: | ----: |</span><br><span class="line">| aaaa | bbbbbb | ccccc |</span><br><span class="line">| a    | b      | c     |</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">left</th>
<th align="center">center</th>
<th align="right">right</th>
</tr>
</thead>
<tbody><tr>
<td align="left">aaaa</td>
<td align="center">bbbbbb</td>
<td align="right">ccccc</td>
</tr>
<tr>
<td align="left">a</td>
<td align="center">b</td>
<td align="right">c</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Micro Major-Java Senior Architect 2</title>
    <url>/2020/10/20/Micro-Major-Java-Senior-Architect-2/</url>
    <content><![CDATA[<img data-src="https://www.forknowledge.icu/gallery/thumbnails/javagcs.png" width="100%"/>

<a id="more"></a>

<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><h4 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h4><h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><h3 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h3><h4 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a>内存分配</h4><ul>
<li>String 类型的 value 最大可存储 512M。</li>
<li>List 类型，元素个数最多 2^32-1</li>
<li>Set 类型，元素个数最多 2^32-1</li>
<li>Hash 类型，键值对个数最多 2^32-1</li>
</ul>
<h4 id="内存压缩"><a href="#内存压缩" class="headerlink" title="内存压缩"></a>内存压缩</h4><h4 id="过期数据"><a href="#过期数据" class="headerlink" title="过期数据"></a>过期数据</h4><h5 id="主动处理"><a href="#主动处理" class="headerlink" title="主动处理"></a>主动处理</h5><h5 id="被动处理"><a href="#被动处理" class="headerlink" title="被动处理"></a>被动处理</h5><h4 id="内存挥手策略"><a href="#内存挥手策略" class="headerlink" title="内存挥手策略"></a>内存挥手策略</h4><h5 id="LRU-算法"><a href="#LRU-算法" class="headerlink" title="LRU 算法"></a>LRU 算法</h5><h5 id="LFU-算法"><a href="#LFU-算法" class="headerlink" title="LFU 算法"></a>LFU 算法</h5><h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><h4 id="主从复制流程"><a href="#主从复制流程" class="headerlink" title="主从复制流程"></a>主从复制流程</h4><h4 id="主从复制应用场景"><a href="#主从复制应用场景" class="headerlink" title="主从复制应用场景"></a>主从复制应用场景</h4><ul>
<li>读写分离</li>
</ul>
<h3 id="哨兵高可用机制"><a href="#哨兵高可用机制" class="headerlink" title="哨兵高可用机制"></a>哨兵高可用机制</h3><ol>
<li>哨兵如何知道 Redis 主从信息（自动发现机制）</li>
<li>什么是 master 主观下线</li>
<li>什么是可观下线</li>
<li>哨兵之间如何通信（哨兵之间的自动发现）</li>
<li>哪个哨兵负责故障转移？（哨兵领导选举机制）</li>
<li>slave 选举机制</li>
<li>最终主从切换的过程</li>
</ol>
<h3 id="Redis-集群分片存储"><a href="#Redis-集群分片存储" class="headerlink" title="Redis 集群分片存储"></a>Redis 集群分片存储</h3><ol>
<li>增加了 slot 槽的计算，是不是比单机性能差？</li>
<li>redis 集群大小，到底可以装多少数据？</li>
<li>集群节点间是怎么通信的？</li>
<li>ask 和 moved 重定向的区别</li>
<li>数据倾斜和访问倾斜的问题</li>
<li>slot 手动迁移怎么做？</li>
<li>节点之间会交换信息，传递的消息包括槽点信息，带来宽带消耗。</li>
<li>Pub/Sub 发布订阅机制</li>
<li>读写分离</li>
</ol>
<h4 id="非官方集群方案"><a href="#非官方集群方案" class="headerlink" title="非官方集群方案"></a>非官方集群方案</h4><p>Codis</p>
<h3 id="Redis-监控"><a href="#Redis-监控" class="headerlink" title="Redis 监控"></a>Redis 监控</h3><h4 id="Monitor-命令"><a href="#Monitor-命令" class="headerlink" title="Monitor 命令"></a>Monitor 命令</h4><h4 id="Info-命令"><a href="#Info-命令" class="headerlink" title="Info 命令"></a>Info 命令</h4><h4 id="图形化监控工具"><a href="#图形化监控工具" class="headerlink" title="图形化监控工具"></a>图形化监控工具</h4><h5 id="RedisLive"><a href="#RedisLive" class="headerlink" title="RedisLive"></a>RedisLive</h5><h2 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h2><h3 id="XMemcached"><a href="#XMemcached" class="headerlink" title="XMemcached"></a>XMemcached</h3><blockquote>
<p><a href="https://github.com/killme2008/xmemcached" target="_blank" rel="noopener">killme2008/xmemcached: High performance, easy to … - GitHub</a></p>
</blockquote>
<h3 id="Memcached-应用场景"><a href="#Memcached-应用场景" class="headerlink" title="Memcached 应用场景"></a>Memcached 应用场景</h3><ol>
<li>数据查询缓存</li>
<li>计数器</li>
<li>乐观锁</li>
<li>防止重复处理</li>
</ol>
<h3 id="Memcached-内存管理"><a href="#Memcached-内存管理" class="headerlink" title="Memcached 内存管理"></a>Memcached 内存管理</h3><h3 id="Memcached-缓存策略"><a href="#Memcached-缓存策略" class="headerlink" title="Memcached 缓存策略"></a>Memcached 缓存策略</h3><h4 id="LRU"><a href="#LRU" class="headerlink" title="LRU"></a>LRU</h4><h4 id="分段-LRU"><a href="#分段-LRU" class="headerlink" title="分段 LRU"></a>分段 LRU</h4><h4 id="LRU-Crawler"><a href="#LRU-Crawler" class="headerlink" title="LRU Crawler"></a>LRU Crawler</h4><h3 id="集群方案"><a href="#集群方案" class="headerlink" title="集群方案"></a>集群方案</h3><p>Twemproxy</p>
<h3 id="分布式算法"><a href="#分布式算法" class="headerlink" title="分布式算法"></a>分布式算法</h3><h5 id="Hash-取模"><a href="#Hash-取模" class="headerlink" title="Hash + 取模"></a>Hash + 取模</h5><h5 id="一致性-Hash-算法"><a href="#一致性-Hash-算法" class="headerlink" title="一致性 Hash 算法"></a>一致性 Hash 算法</h5><h3 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h3><h3 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h3><p>查询必然不存在的数据，请求透过 Redis，直击数据库。</p>
]]></content>
  </entry>
  <entry>
    <title>Micro Major-Java Senior Architect</title>
    <url>/2020/10/10/Micro-Major-Java-Senior-Architect/</url>
    <content><![CDATA[<img data-src="https://www.forknowledge.icu/gallery/thumbnails/javagcs.png" width="100%"/>

<a id="more"></a>

<h2 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h2><h3 id="JDK-API"><a href="#JDK-API" class="headerlink" title="JDK API"></a>JDK API</h3><h4 id="suspend-resume"><a href="#suspend-resume" class="headerlink" title="suspend / resume"></a><del>suspend / resume</del></h4><p>调用 suspend 挂起目标线程，通过 resume 恢复线程。<strong>已被废弃！</strong>被弃用的主要原因是，<strong>容易写出死锁的代码</strong>。所以用 wait/notify 和 park/unpark 机制进行替代。</p>
<h5 id="死锁示例-1：在同步代码中使用"><a href="#死锁示例-1：在同步代码中使用" class="headerlink" title="死锁示例 1：在同步代码中使用"></a>死锁示例 1：在同步代码中使用</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 死锁的suspend/resume。 suspend并不会像wait一样释放锁，故此容易写出死锁代码 */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">suspendResumeDeadLockTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="comment">// 启动线程</span></span><br><span class="line">  Thread consumerThread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (baozidian == <span class="keyword">null</span>) &#123; <span class="comment">// 如果没包子，则进入等待</span></span><br><span class="line">      System.out.println(<span class="string">"1、进入等待"</span>);</span><br><span class="line">      <span class="comment">// 当前线程拿到锁，然后挂起</span></span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        Thread.currentThread().suspend();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"2、买到包子，回家"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  consumerThread.start();</span><br><span class="line">  <span class="comment">// 3秒之后，生产一个包子</span></span><br><span class="line">  Thread.sleep(<span class="number">3000L</span>);</span><br><span class="line">  baozidian = <span class="keyword">new</span> Object();</span><br><span class="line">  <span class="comment">// 争取到锁以后，再恢复consumerThread</span></span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    consumerThread.resume();</span><br><span class="line">  &#125;</span><br><span class="line">  System.out.println(<span class="string">"3、通知消费者"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="死锁示例-2：suspend-在-resume-后执行"><a href="#死锁示例-2：suspend-在-resume-后执行" class="headerlink" title="死锁示例 2：suspend 在 resume 后执行"></a>死锁示例 2：suspend 在 resume 后执行</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 导致程序永久挂起的suspend/resume */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">suspendResumeDeadLockTest2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="comment">// 启动线程</span></span><br><span class="line">  Thread consumerThread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (baozidian == <span class="keyword">null</span>) &#123;</span><br><span class="line">      System.out.println(<span class="string">"1、没包子，进入等待"</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123; <span class="comment">// 为这个线程加上一点延时</span></span><br><span class="line">        Thread.sleep(<span class="number">5000L</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 这里的挂起执行在resume后面</span></span><br><span class="line">      Thread.currentThread().suspend();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"2、买到包子，回家"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  consumerThread.start();</span><br><span class="line">  <span class="comment">// 3秒之后，生产一个包子</span></span><br><span class="line">  Thread.sleep(<span class="number">3000L</span>);</span><br><span class="line">  baozidian = <span class="keyword">new</span> Object();</span><br><span class="line">  consumerThread.resume();</span><br><span class="line">  System.out.println(<span class="string">"3、通知消费者"</span>);</span><br><span class="line">  consumerThread.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait / notify"></a>wait / notify</h4><p>wait 和 notify 方法只能由同一对象锁的持有者线程调用，也就是写在同步代码块里面，否则会抛出 aaa 异常。</p>
<ul>
<li><span style="color: #2196F3;">wait</span> 方法导致当前线程等待，加入该对象的等待集合中，并且释放当前持有的对象锁。</li>
<li><span style="color: #2196F3;">notify/notifyAll</span>  方法唤醒一个或所有正在等待这个对象锁的线程。</li>
</ul>
<p><span style="color: #e91e63;">注意</span>：虽然 wait 会自动解锁，但是对顺序还是有要求，如果在 notify 被调用之后，才开始调用 wait，线程会永远处于 WAITING 状态。</p>
<h5 id="永久等待示例"><a href="#永久等待示例" class="headerlink" title="永久等待示例"></a>永久等待示例</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 会导致程序永久等待的wait/notify */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">waitNotifyDeadLockTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="comment">// 启动线程</span></span><br><span class="line">  <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (baozidian == <span class="keyword">null</span>) &#123; <span class="comment">// 如果没包子，则进入等待</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">5000L</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e1) &#123;</span><br><span class="line">        e1.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          System.out.println(<span class="string">"1、进入等待"</span>);</span><br><span class="line">          <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"2、买到包子，回家"</span>);</span><br><span class="line">  &#125;).start();</span><br><span class="line">  <span class="comment">// 3秒之后，生产一个包子</span></span><br><span class="line">  Thread.sleep(<span class="number">3000L</span>);</span><br><span class="line">  baozidian = <span class="keyword">new</span> Object();</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    System.out.println(<span class="string">"3、通知消费者"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="park-unpark"><a href="#park-unpark" class="headerlink" title="park / unpark"></a>park / unpark</h4><p>线程调用 park 则等待“许可”，调用 unpark 方法为指定线程提供“许可(permit)”。<span style="color: #2196F3;">不要求 park 和 unpack 方法的调用顺序</span>。</p>
<p>多次调用 unpack 后，再调用 park，线程会直接运行。但不会叠加，也就是说，连续多次调用 park 方法，第一次会拿到“许可”直接运行，后续调用会进入等待。“许可”类似于标志位。</p>
<h5 id="死锁示例"><a href="#死锁示例" class="headerlink" title="死锁示例"></a>死锁示例</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 死锁的park/unpark */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parkUnparkDeadLockTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="comment">// 启动线程</span></span><br><span class="line">  Thread consumerThread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (baozidian == <span class="keyword">null</span>) &#123; <span class="comment">// 如果没包子，则进入等待</span></span><br><span class="line">      System.out.println(<span class="string">"1、进入等待"</span>);</span><br><span class="line">      <span class="comment">// 当前线程拿到锁，然后挂起</span></span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        LockSupport.park();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"2、买到包子，回家"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  consumerThread.start();</span><br><span class="line">  <span class="comment">// 3秒之后，生产一个包子</span></span><br><span class="line">  Thread.sleep(<span class="number">3000L</span>);</span><br><span class="line">  baozidian = <span class="keyword">new</span> Object();</span><br><span class="line">  <span class="comment">// 争取到锁以后，再恢复consumerThread</span></span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    LockSupport.unpark(consumerThread);</span><br><span class="line">  &#125;</span><br><span class="line">  System.out.println(<span class="string">"3、通知消费者"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="伪唤醒"><a href="#伪唤醒" class="headerlink" title="伪唤醒"></a>伪唤醒</h4><p><span style="color: #e91e63;">警告！之前代码中使用 if 语句来判断是否进入等待状态是错误的！</span></p>
<p>官方建议<span style="color: #e91e63;">应该在循环中检查等待条件</span>，原因是处于等待状态的线程可能会收到<span style="color: #e91e63;">错误警报和伪唤醒</span>，如果不在循环中检查等待条件，程序就会在没有满足结束条件的情况下退出。</p>
<p>伪唤醒是指线程并非因为 notify、notifyAll、unpark 等 API 调用而唤醒，而是因为更底层原因导致的。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><table>
<thead>
<tr>
<th></th>
<th>同步代码</th>
<th>代码顺序</th>
</tr>
</thead>
<tbody><tr>
<td>suspend/resume</td>
<td>死锁</td>
<td>永久挂起</td>
</tr>
<tr>
<td>wait/notify</td>
<td>无</td>
<td>永久等待</td>
</tr>
<tr>
<td>park/unpack</td>
<td>死锁</td>
<td>无</td>
</tr>
</tbody></table>
<p>使用 while 循环代替 if 条件判断是否进入等待状态来避免伪唤醒。</p>
<h2 id="线程封闭"><a href="#线程封闭" class="headerlink" title="线程封闭"></a>线程封闭</h2><p>通过将数据封闭在线程中而避免使用同步的技术称为<strong>线程封闭</strong>。</p>
<p>Java 中具体体现为 ThreadLocal、局部变量等。</p>
<h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><p>ThreadLocal 是 Java 里一种特殊的变量。</p>
<p>ThreadLocal 是线程级别变量，每个线程都有自己独立的一个变量，竞争条件被彻底消除了，在并发模式下是绝对安全的变量。</p>
<p><span style="color: #2196F3;">可以理解为，JVM 维护了一个 Map&lt;Thread, T&gt;，每个线程要用这个 T 的时候，用当前的线程去 Map 里面取。</span></p>
<h5 id="线程封闭示例"><a href="#线程封闭示例" class="headerlink" title="线程封闭示例"></a>线程封闭示例</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 线程封闭示例 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo7</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** threadLocal变量，每个线程都有一个副本，互不干扰 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;String&gt; value = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * threadlocal测试</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadLocalTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// threadlocal线程封闭示例</span></span><br><span class="line">    value.set(<span class="string">"这是主线程设置的123"</span>); <span class="comment">// 主线程设置值</span></span><br><span class="line">    String v = value.get();</span><br><span class="line">    System.out.println(<span class="string">"线程1执行之前，主线程取到的值："</span> + v);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String v = value.get();</span><br><span class="line">        System.out.println(<span class="string">"线程1取到的值："</span> + v);</span><br><span class="line">        <span class="comment">// 设置 threadLocal</span></span><br><span class="line">        value.set(<span class="string">"这是线程1设置的456"</span>);</span><br><span class="line"></span><br><span class="line">        v = value.get();</span><br><span class="line">        System.out.println(<span class="string">"重新设置之后，线程1取到的值："</span> + v);</span><br><span class="line">        System.out.println(<span class="string">"线程1执行结束"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="number">5000L</span>); <span class="comment">// 等待所有线程执行结束</span></span><br><span class="line"></span><br><span class="line">    v = value.get();</span><br><span class="line">    System.out.println(<span class="string">"线程1执行之后，主线程取到的值："</span> + v);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Demo7().threadLocalTest();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="栈封闭"><a href="#栈封闭" class="headerlink" title="栈封闭"></a>栈封闭</h3><p><span style="color: #2196F3;">局部变量</span>的固有属性之一就是封闭在线程中。</p>
<h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><p>线程是不是越多越好？为什么要用线程池？</p>
<ol>
<li>线程在 Java 中是一个对象，需要占用内存，更需要占用操作系统的资源，线程的创建、销毁都需要时间。如果创建时间 + 销毁时间 &gt; 执行任务时间，就很不划算。</li>
<li>Java 对象占用堆内存，操作系统线程占用系统内存，根据 JVM 规范，一个线程默认最大栈大小为 1M，这个栈空间是需要从系统内存中分配的。线程过多，会消耗大量的内存。</li>
<li>线程过多时，操作系统需要频繁切换线程上下文，影响性能。</li>
</ol>
<p><span style="color: #2196F3;">线程池的推出，就是为了方便的控制线程数量。</span></p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ol>
<li><span style="color: #2196F3;">线程池管理器</span>：用于创建并管理线程池，包括创建线程池，销毁线程池，添加新任务；</li>
<li><span style="color: #2196F3;">工作线程</span>：线程池中的线程，在没有任务时处于等待状态，可以循环的执行任务；</li>
<li><span style="color: #2196F3;">任务接口</span>：每个任务必须实现的接口，以供工作线程调度任务的执行，它主要规定了任务的入口，任务执行完后的收尾工作，任务的执行状态等；</li>
<li><span style="color: #2196F3;">任务队列</span>：用于存放没有处理的任务，提供一种缓冲机制。</li>
</ol>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="接口定义和实现类"><a href="#接口定义和实现类" class="headerlink" title="接口定义和实现类"></a>接口定义和实现类</h4><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>接口</td>
<td>Executor</td>
<td>最上层的接口，定义了<span style="color: #e91e63;">执行任务的方法 execute</span></td>
</tr>
<tr>
<td>接口</td>
<td>ExecutorService</td>
<td>继承了 Executor 接口，拓展了 Callable、Future、关闭方法</td>
</tr>
<tr>
<td>接口</td>
<td>ScheduledExecutorService</td>
<td>继承了 ExecutorService，增加了定时任务相关的方法</td>
</tr>
<tr>
<td>实现类</td>
<td>ThreadPoolExecutor</td>
<td><span style="color: #e91e63;">基础、标准的线程池实现</span></td>
</tr>
<tr>
<td>实现类</td>
<td>ShceduledThreadPoolExecutor</td>
<td>继承了 ThreadPoolExecutor，实现了 ScheduledExecutorService 中<span style="color: #e91e63;">定时任务</span>相关的方法</td>
</tr>
</tbody></table>
<h5 id="ExecutorService"><a href="#ExecutorService" class="headerlink" title="ExecutorService"></a>ExecutorService</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExecutorService</span> <span class="keyword">extends</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监测 ExecutorService 是否已经关闭，直到所有任务执行完成，或发生超时，或当前线程被中断</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">awaitTermination</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行给定的任务集合，执行完毕后，返回结果</span></span><br><span class="line">  &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行给定的任务集合，执行完毕或者超时后，返回结果，其他任务终止</span></span><br><span class="line">  &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, <span class="keyword">long</span> timeout, TimeUnit unit) <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行给定的任务，任意一个执行成功或者超时后，则返回结果，其他任务终止</span></span><br><span class="line">  &lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果此线程池已关闭，则返回 true</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isShutdown</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 如果关闭后所有任务都已完成，则返回 true。</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isTerminated</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 优雅关闭线程池，之前提交的任务将被执行，但是不会接受新的任务。</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">	<span class="comment">// 尝试停止所有正在执行的任务，停止等待任务的处理，并返回等待执行任务的列表。</span></span><br><span class="line">  <span class="function">List&lt;Runnable&gt; <span class="title">shutdownNow</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 提交一个用于执行的 Callable 返回任务，并返回一个 Future，用于获取 Callable 执行结果。</span></span><br><span class="line">  &lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Callable&lt;T&gt; task)</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 提交可运行任务以执行，并返回一个 Future 对象，执行结果为 null</span></span><br><span class="line">  Future&lt;?&gt; submit(Runnable task);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 提交可运行任务以执行，并返回一个 Future 对象，执行结果为传入的 result</span></span><br><span class="line">  &lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Runnable task, T result)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ScheduledExecutorService"><a href="#ScheduledExecutorService" class="headerlink" title="ScheduledExecutorService"></a>ScheduledExecutorService</h5><p>创建并执行一个一次性任务，过了延迟时间就会被执行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;V&gt; <span class="function">ScheduledFuture&lt;V&gt; <span class="title">schedule</span><span class="params">(Callable&lt;V&gt; callable, <span class="keyword">long</span> delay, TimeUnit unit)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ScheduledFuture&lt;?&gt; schedule(Runnable command, <span class="keyword">long</span> delay, TimeUnit unit);</span><br></pre></td></tr></table></figure>

<p>创建并执行一个周期性任务，过了给定的初始延迟时间，会第一次被执行，执行过程中发生了异常，那么任务就停止。</p>
<p>一次任务执行时长超过了周期时间，下一次任务会等到该次任务执行结束后<span style="color: #2196F3;">立即执行</span>，这也是它和 scheduleWithFixedDelay 的重要区别。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, <span class="keyword">long</span> initialDelay, <span class="keyword">long</span> period, TimeUnit unit);</span><br></pre></td></tr></table></figure>

<p>创建并执行一个周期性任务，过了给定的初始延迟时间，第一次被执行后，后续以给定的周期时间执行，执行过程中发生了异常，那么任务就停止。</p>
<p>一次任务执行时长超过了周期时间，下一次任务会等到该次任务执行结束的时间基础上，计算<span style="color: #2196F3;">执行延时</span>。</p>
<h3 id="Executors-工具类"><a href="#Executors-工具类" class="headerlink" title="Executors 工具类"></a>Executors 工具类</h3><ul>
<li><p><code>public static ExecutorService newFixedThreadPool(int nThreads)</code></p>
<p>创建一个固定大小、任务队列容量无界的线程池。核心线程数=最大线程数。</p>
</li>
<li><p><code>public static ExecutorService newCachedThreadPool()</code></p>
<p>创建一个大小无界的缓冲线程池。它的任务队列是一个<a href="http://ifeve.com/java-synchronousqueue/" target="_blank" rel="noopener">同步队列</a>。任务加入到池中，如果池中有空闲线程，则用空闲线程执行，如无则创建新线程执行。池中的线程空闲超过 60 秒，将被销毁释放。线程数随任务的多少变化。适用于执行耗时较小的异步任务。池的核心线程数=0，最大线程数=Integer.MAX_VALUE</p>
</li>
<li><p><code>public static ScheduledExecutorService newSingleThreadScheduledExecutor()</code></p>
<p>只有一个线程来执行无界任务队列的单一线程池。该线程池确保任务按加入的顺序一个一个一次执行。当唯一的线程因任务异常中止时，将创建一个新的线程来继续执行后续的任务。与<code>newFixedThreadPool(1)</code>的区别在于，单一线程池的池大小在<code>newSingleThreadExecutor</code>方法中硬编码，不能再改变。</p>
</li>
<li><p><code>public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize)</code></p>
<p>能定时执行任务的线程池。该池的核心线程数由参数指定，最大线程数=Interger.MAX_VALUE</p>
</li>
</ul>
<h3 id="任务执行过程"><a href="#任务执行过程" class="headerlink" title="任务执行过程"></a>任务执行过程</h3><p>ThreadPoolExecutor.execute()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Proceed in 3 steps:</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 1. If fewer than corePoolSize threads are running, try to</span></span><br><span class="line"><span class="comment">         * start a new thread with the given command as its first</span></span><br><span class="line"><span class="comment">         * task.  The call to addWorker atomically checks runState and</span></span><br><span class="line"><span class="comment">         * workerCount, and so prevents false alarms that would add</span></span><br><span class="line"><span class="comment">         * threads when it shouldn't, by returning false.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 2. If a task can be successfully queued, then we still need</span></span><br><span class="line"><span class="comment">         * to double-check whether we should have added a thread</span></span><br><span class="line"><span class="comment">         * (because existing ones died since last checking) or that</span></span><br><span class="line"><span class="comment">         * the pool shut down since entry into this method. So we</span></span><br><span class="line"><span class="comment">         * recheck state and if necessary roll back the enqueuing if</span></span><br><span class="line"><span class="comment">         * stopped, or start a new thread if there are none.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 3. If we cannot queue task, then we try to add a new</span></span><br><span class="line"><span class="comment">         * thread.  If it fails, we know we are shut down or saturated</span></span><br><span class="line"><span class="comment">         * and so reject the task.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">  <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">  <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">    <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    c = ctl.get();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">    <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">    <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">      reject(command);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">      addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">    reject(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre class="mermaid" style="text-align: center;">
            graph TD
            
A[执行] --> B{是否达到核心线程数}

B --> |否|D[创建新线程执行]

B --> |是|C{工作队列是否已满}

C --> |否|E[丢到队列里]

C --> |是|F{是否达到最大线程数量}

F --> |否|G[新建线程执行]

F --> |是|H[执行拒绝策略]

          </pre>

<h3 id="线程数量"><a href="#线程数量" class="headerlink" title="线程数量"></a>线程数量</h3><p><span style="color: #e91e63;">如何确定合适数量的线程？</span></p>
<ul>
<li><span style="color: #2196F3;">计算型任务</span>：CPU 数量的 1-2 倍</li>
<li><span style="color: #2196F3;">IO型任务</span>：相对计算型任务，需要多一些线程，要根据具体的 <span style="color: #2196F3;">IO 阻塞时长</span>进行考量决定。如 tomcat 中默认的最大线程数为 200。</li>
<li>也可以考虑根据需要在一个<span style="color: #2196F3;">最小数量和最大数量</span>间自动增减线程数。</li>
</ul>
<h2 id="CAS-机制"><a href="#CAS-机制" class="headerlink" title="CAS 机制"></a>CAS 机制</h2><p>CAS（Compare and swap 比较和交换）属于硬件同步原语，处理器提供了基本内存操作的原子性保证。</p>
<p>CAS 操作需要输入两个数值，一个旧值A和一个新值B，在操作期间先比较旧值有没有发生变化，如果没有发生变化，才交换新值，否则不交换。</p>
<p>Java 中的 sun.misc.Unsafe 类，提供了 compareAndSwapInt() 和 compareAndSwapIong() 等几个方法实现 CAS。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gzhennaxia.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> value;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Unsafe unsafe;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> offset;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Field field = Unsafe.class.getDeclaredField("theUnsafe");</span><br><span class="line">      field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">      unsafe = (Unsafe) field.get(<span class="keyword">null</span>);</span><br><span class="line">      offset = unsafe.objectFieldOffset(Demo.class.getDeclaredField("value"));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    value++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incCAS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> current;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      current = unsafe.getIntVolatile(<span class="keyword">this</span>, offset);</span><br><span class="line">    &#125; <span class="keyword">while</span> (!unsafe.compareAndSwapInt(<span class="keyword">this</span>, offset, current, current + <span class="number">1</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    Demo demo10 = <span class="keyword">new</span> Demo();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">10000</span>; j++) &#123;</span><br><span class="line">          <span class="comment">//                    demo10.inc();</span></span><br><span class="line">          demo10.incCAS();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">    Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">    System.out.println(demo10.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="J-U-C-包内的原子操作封装类"><a href="#J-U-C-包内的原子操作封装类" class="headerlink" title="J.U.C 包内的原子操作封装类"></a>J.U.C 包内的原子操作封装类</h3><ul>
<li>AtomicBoolean：原子更新布尔类型</li>
<li>AtomicInteger：原子更新整型</li>
<li>AtomicLong：原子更新长整型</li>
</ul>
<ul>
<li>AtomicIntegerArray：原子更新整型数组里的元素</li>
<li>AtomicLongArray：原子更新长整形数组里的元素</li>
<li>AtomicReferenceArray：原子更新引用类型数组里的元素</li>
</ul>
<ul>
<li>AtomicIntegerFieldUpdater：原子更新整型字段的更新器</li>
<li>AtomicLongFieldUpdater：原子更新长整形字段的更新器</li>
<li>AtomicReferenceFieldUpdater：原子更新饮用类型的字段</li>
</ul>
<ul>
<li>AtomicReference：原子更新引用类型</li>
<li>AtomicStampedReference：原子更新带有版本号的引用类型</li>
<li>AtomicMarkableReference：原子更新带有标记位的引用类型</li>
</ul>
<p>1.8 更新：</p>
<p>更新器：DoubleAccumulator、LongAccumulator</p>
<p>计数器：DoubleAdder、LongAdder</p>
<p>计数器增强版，高并发下性能更好</p>
<p>频繁更新但不太频繁读取的汇总统计信息时使用</p>
<p>分成多个操作单元，不同线程更新不同的单元</p>
<p>只有需要汇总的时候才计算所有单元的操作</p>
<h3 id="CAS-的三个问题"><a href="#CAS-的三个问题" class="headerlink" title="CAS 的三个问题"></a>CAS 的三个问题</h3><ol>
<li><p>循环+CAS，自旋的实现让所有线程都处于高频运行，争抢 CPU 执行时间的状态。如果操作长时间不成功，会带来很大的 CPU 资源消耗。</p>
</li>
<li><p>仅针对单个变量的操作，不能用于多个变量来实现原子操作。</p>
</li>
<li><p><a href="https://www.cnblogs.com/senlinyang/p/7875381.html" target="_blank" rel="noopener">ABA 问题</a></p>
<p>线程1将A修改为B，线程2将B修改为C，线程3将B修改为A。</p>
<p>如果执行顺序为线程1 -&gt; 线程3 -&gt; 线程2，则线程2将无法感知到线程1和线程3的修改。</p>
</li>
</ol>
<h2 id="Java-锁"><a href="#Java-锁" class="headerlink" title="Java 锁"></a>Java 锁</h2><p><span style="color: #2196F3;">自旋锁</span>：为了不放弃 CPU 执行事件，循环的使用 CAS 技术对数据进行更新，直至成功。</p>
<p><span style="color: #2196F3;">悲观锁</span>：假定会发生并发冲突，同步所有对数据的相关操作，从读数据就开始上锁。</p>
<p><span style="color: #2196F3;">乐观锁</span>：假定没有冲突，在修改数据时如果发现和之前获取的不一样，则读最新数据，修改后重试修改。</p>
<p>自旋锁就是乐观锁的一种体现。</p>
<p><span style="color: #2196F3;">独享锁（写）</span>：给资源加上写锁，线程可以修改资源，其他线程不能再加锁；（单写）</p>
<p><span style="color: #2196F3;">共享锁（读）</span>：给资源加上读锁后只能读不能改，其他线程也只能加读锁，不能加写锁；（多读）</p>
<p><span style="color: #2196F3;">可重入锁、不可重入锁</span>：线程拿到一把锁之后，可以自由进入同一把锁所同步的其他代码。</p>
<p><span style="color: #2196F3;">公平锁、非公平锁</span>：争抢锁的顺序，如果是按先来后到，则为公平。</p>
<p>几种重要的锁实现：synchronized、ReentrantLock、ReentrantReadWriteLock</p>
<h3 id="同步关键字-synchronized"><a href="#同步关键字-synchronized" class="headerlink" title="同步关键字 synchronized"></a>同步关键字 synchronized</h3><p>synchronized 属于最基本的线程通信机制，基于对象监视器实现。</p>
<p>Java 中的每个对象都与一个监视器相关联，一个线程可以锁定或解锁。</p>
<p>一次只有一个线程可以锁定监视器，试图锁定该监视器的任何其他线程都会被阻塞，直到它们可以获得该监视器上的锁定为止。</p>
<p><span style="color: #2196F3;">特性</span>：可重入、独享、悲观锁</p>
<p><span style="color: #2196F3;">锁的范围</span>：类锁、对象锁、锁消除、锁粗化</p>
<p>提示：同步关键字，不仅是实现同步，根据 JMM 规定，还能保证可见性(读取最新主内存数据，结束后写入主内存)。</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><h5 id="可重入"><a href="#可重入" class="headerlink" title="可重入"></a>可重入</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可重入</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSyncDemo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">    System.out.println(Thread.currentThread() + <span class="string">" 我开始执行 "</span> + arg);</span><br><span class="line">    <span class="keyword">if</span> (arg == <span class="keyword">null</span>) &#123;</span><br><span class="line">      test1(<span class="keyword">new</span> Object());</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(Thread.currentThread() + <span class="string">" 我执行结束"</span> + arg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> ObjectSyncDemo2().test1(<span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="锁粗化"><a href="#锁粗化" class="headerlink" title="锁粗化"></a>锁粗化</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 锁粗化(运行时 jit 编译优化)</span></span><br><span class="line"><span class="comment">// jit 编译后的汇编内容, jitwatch可视化工具进行查看</span></span><br><span class="line"><span class="comment">// just-in-time compilation，缩写为JIT；又译及时编译、实时编译</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSyncDemo3</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 优化后只锁定一次</span></span><br><span class="line">  <span class="comment">//    public void test1(Object arg) &#123;</span></span><br><span class="line">  <span class="comment">//        synchronized (this) &#123;</span></span><br><span class="line">  <span class="comment">//            i++;</span></span><br><span class="line">  <span class="comment">//            i++;</span></span><br><span class="line">  <span class="comment">//        &#125;</span></span><br><span class="line">  <span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// 热点代码会进行分析后优化</span></span><br><span class="line">      <span class="keyword">new</span> ObjectSyncDemo3().test1(<span class="string">"a"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="锁消除"><a href="#锁消除" class="headerlink" title="锁消除"></a>锁消除</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 锁消除(jit)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSyncDemo4</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    builder.append(<span class="string">"a"</span>);</span><br><span class="line">    builder.append(arg);</span><br><span class="line">    builder.append(<span class="string">"c"</span>);</span><br><span class="line">    System.out.println(arg.toString());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">    String a = <span class="string">"a"</span>;</span><br><span class="line">    String c = <span class="string">"c"</span>;</span><br><span class="line">    System.out.println(a + arg + c);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// jit 优化, 消除了锁</span></span><br><span class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    stringBuffer.append(<span class="string">"a"</span>);</span><br><span class="line">    stringBuffer.append(arg);</span><br><span class="line">    stringBuffer.append(<span class="string">"c"</span>);</span><br><span class="line">    <span class="comment">// System.out.println(stringBuffer.toString());</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">new</span> ObjectSyncDemo4().test1(<span class="string">"123"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="synchronized-加锁原理"><a href="#synchronized-加锁原理" class="headerlink" title="synchronized 加锁原理"></a>synchronized 加锁原理</h4><blockquote>
<p><a href="https://juejin.im/post/6844903726545633287" target="_blank" rel="noopener">死磕Synchronized底层实现–概论 - 掘金</a></p>
<p>Java中的<code>synchronized</code>有偏向锁、轻量级锁、重量级锁三种形式，分别对应了锁只被一个线程持有、不同线程交替持有锁、多线程竞争锁三种情况。当条件不满足时，锁会按偏向锁-&gt;轻量级锁-&gt;重量级锁的顺序升级。</p>
<p><a href="https://www.cs.princeton.edu/picasso/mats/HotspotOverview.pdf" target="_blank" rel="noopener">The <strong>Hotspot</strong> Java Virtual Machine</a></p>
<p><a href="https://wiki.openjdk.java.net/display/hotspot/synchronization" target="_blank" rel="noopener">https://wiki.openjdk.java.net/display/hotspot/synchronization</a></p>
</blockquote>
<h3 id="Lock-锁接口实现"><a href="#Lock-锁接口实现" class="headerlink" title="Lock 锁接口实现"></a>Lock 锁接口实现</h3><h4 id="Lock-核心API"><a href="#Lock-核心API" class="headerlink" title="Lock 核心API"></a>Lock 核心API</h4><table>
<thead>
<tr>
<th>API</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>lock</td>
<td>获取锁的方法，若锁被其他线程获取，则等待(阻塞)</td>
</tr>
<tr>
<td>lockInterruptibly</td>
<td>在锁的获取过程中可以中断当前线程</td>
</tr>
<tr>
<td>tryLock</td>
<td>尝试非阻塞地获取锁，立即返回</td>
</tr>
<tr>
<td>unlock</td>
<td>释放锁</td>
</tr>
</tbody></table>
<p>提示：根据Lock接口的源码注释，Lock接口的实现，具备和同步关键字同样的内存语义。</p>
<h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><ul>
<li>独享锁</li>
<li>支持公平、非公平两种模式</li>
<li>可重入</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可响应中断</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockInterruptiblyDemo1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    LockInterruptiblyDemo1 demo1 = <span class="keyword">new</span> LockInterruptiblyDemo1();</span><br><span class="line">    Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          demo1.test(Thread.currentThread());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Thread thread1 = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">    Thread thread2 = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">    thread1.start();</span><br><span class="line">    Thread.sleep(<span class="number">500</span>); <span class="comment">// 等待0.5秒，让thread1先执行</span></span><br><span class="line"></span><br><span class="line">    thread2.start();</span><br><span class="line">    Thread.sleep(<span class="number">2000</span>); <span class="comment">// 两秒后，中断thread2</span></span><br><span class="line"></span><br><span class="line">    thread2.interrupt();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Thread thread)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">"， 想获取锁"</span>);</span><br><span class="line">    lock.lockInterruptibly();   <span class="comment">//注意，如果需要正确中断等待锁的线程，必须将获取锁放在外面，然后将InterruptedException抛出</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      System.out.println(thread.getName() + <span class="string">"得到了锁"</span>);</span><br><span class="line">      Thread.sleep(<span class="number">10000</span>); <span class="comment">// 抢到锁，10秒不释放</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      System.out.println(Thread.currentThread().getName() + <span class="string">"执行finally"</span>);</span><br><span class="line">      lock.unlock();</span><br><span class="line">      System.out.println(thread.getName() + <span class="string">"释放了锁"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h4><p>维护一对关联锁，一个用于只读操作，一个用于写入；读锁可以由多个读线程同时持有，写锁是排他的。</p>
<p>适合读取线程比写入线程多的场景，改进互斥锁的性能，示例场景：缓存组件、集合的并发线程安全性改造。</p>
<p><span style="color: #2196F3;">锁降级</span>指的是写锁降级为读锁。把持住当前拥有的写锁的同时，再获取到读锁，随后释放写锁的过程。</p>
<p>写锁是线程独占，读锁是共享，所以写-&gt;读是降级。(无法实现读-&gt;写)</p>
<h4 id="Codition"><a href="#Codition" class="headerlink" title="Codition"></a>Codition</h4><p>用于替代 wait/notify</p>
<p>Object 中的 wait()，notify()，notifyAll() 方法是和 synchronized 配合使用的，可以唤醒一个或者全部(单个等待集)；</p>
<p>Condition 是需要与 Lock 配合使用的，<span style="color: #2196F3;">提供了多个等待集合，更精确的控制</span>(底层是 park/unpark 机制)；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// condition 实现队列线程安全。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueDemo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">  <span class="comment">// 指定条件的等待 - 等待有空位</span></span><br><span class="line">  <span class="keyword">final</span> Condition notFull = lock.newCondition();</span><br><span class="line">  <span class="comment">// 指定条件的等待 - 等待不为空</span></span><br><span class="line">  <span class="keyword">final</span> Condition notEmpty = lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义数组存储数据</span></span><br><span class="line">  <span class="keyword">final</span> Object[] items = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">  <span class="keyword">int</span> putptr, takeptr, count;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 写入数据的线程,写入进来</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (count == items.length) <span class="comment">// 数据写满了</span></span><br><span class="line">        notFull.await(); <span class="comment">// 写入数据的线程,进入阻塞</span></span><br><span class="line">      items[putptr] = x;</span><br><span class="line">      <span class="keyword">if</span> (++putptr == items.length) putptr = <span class="number">0</span>;</span><br><span class="line">      ++count;</span><br><span class="line">      notEmpty.signal(); <span class="comment">// 唤醒指定的读取线程</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 读取数据的线程,调用take</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (count == <span class="number">0</span>)</span><br><span class="line">        notEmpty.await(); <span class="comment">// 线程阻塞在这里,等待被唤醒</span></span><br><span class="line">      Object x = items[takeptr];</span><br><span class="line">      <span class="keyword">if</span> (++takeptr == items.length) takeptr = <span class="number">0</span>;</span><br><span class="line">      --count;</span><br><span class="line">      notFull.signal(); <span class="comment">// 通知写入数据的线程,告诉他们取走了数据,继续写入</span></span><br><span class="line">      <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AQS-抽象队列同步器"><a href="#AQS-抽象队列同步器" class="headerlink" title="AQS 抽象队列同步器"></a>AQS 抽象队列同步器</h2><blockquote>
<p>运用到<strong>模版方法设计模式</strong></p>
<p>即算法的整体骨架已确定，某些具体的步骤由子类去实现。</p>
</blockquote>
<p>提供了对资源占用、释放，线程的等待、唤醒等等接口和具体实现。</p>
<p>可以用在各种需要控制资源争用的场景中。(ReentrantLock/CountDownLatch/Semphore)</p>
<p><img data-src="/post_image/Jietu20201013-163450.png" alt="image-20201013163241377"></p>
<p>acquire、acquireShared：定义了资源争用的逻辑，如果没拿到，则等待。</p>
<p><span style="color: #2196F3;">tryAcquire、tryAcquireShared：实际执行占用资源的操作，如何判定由使用者具体去实现。</span></p>
<p>release、releaseShared：定义释放资源的逻辑，释放之后，通知后续节点进行争抢。</p>
<p><span style="color: #2196F3;">tryRelease、tryReleaseShared：实际执行资源释放的操作，具体的AQS使用者去实现。</span></p>
<p><img data-src="/post_image/Jietu20201013-175221.png" alt=""></p>
<pre class="mermaid" style="text-align: center;">
            graph TD
            
A[acquire] --> B{tryAcquire}

B --> D[加入队尾]

B --> |抢到资源|C[end]

D --> E[寻找前置]

E --> F{前置节点是否为头节点}

F --> |是|G{tryAcquire}

F --> |否 park|H[等待]

H --> |unpark/interrupt|F

G --> |抢到资源|C

G --> |没抢到资源|E

          </pre>

<h3 id="信号量、栅栏和倒计时器"><a href="#信号量、栅栏和倒计时器" class="headerlink" title="信号量、栅栏和倒计时器"></a>信号量、栅栏和倒计时器</h3><h4 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h4><p>Semaphore 称为“信号量”，控制多个线程争抢许可。</p>
<ul>
<li>acquire：获取一个许可，如果没有就等待。</li>
<li>release：释放一个许可。</li>
<li>availablePermits：获取可用许可数目</li>
</ul>
<p>典型场景：</p>
<ul>
<li>代码并发处理限流(Hatrix)；</li>
</ul>
<h4 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h4><p>Java1.5 被引入的一个工具类，常被称为“倒计数器”。</p>
<p>创建对象时，传入指定数值作为线程参与的数量；</p>
<p><span style="color: #2196F3;">await</span>：该方法等待计数器变为0，在这之前，线程进入等待状态；</p>
<p><span style="color: #2196F3;">countdown</span>：计数器数值减一，知道为0；</p>
<p>经常用于等待其他线程执行到某一节点，再继续执行当前线程代码。</p>
<p>使用场景示例：</p>
<ul>
<li>统计线程执行的情况；</li>
<li>压力测试中，使用 countDownLatch 实现最大程度的并发处理；</li>
<li>多个线程之间，相互通信，比如线程异步调用接口，结果通知；</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">int</span> finalI = i;</span><br><span class="line">      <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">          System.out.println(<span class="string">"线程"</span> + finalI + <span class="string">"执行结束"</span>);</span><br><span class="line">          countDownLatch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      countDownLatch.await();</span><br><span class="line">      System.out.println(<span class="string">"主线程等待10个线程执行完后再往下执行"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h4><p>CyclicBarrier 也是1.5引入的，又称为“线程栅栏”。</p>
<p>创建对象时，指定栅栏线程数量。</p>
<p><span style="color: #2196F3;">await</span>：等指定数量多线程都处于等待状态时，继续执行后续代码。</p>
<p><span style="color: #2196F3;">barrierAction</span>：线程数量到了指定量后，自动触发执行指定任务。</p>
<p>和 CountDownLatch 的重要区别在于，CyclicBarrier 对象可以多次触发执行。</p>
<p>典型场景：</p>
<ul>
<li>数据量比较大时，实现批量插入数据到数据库；</li>
<li>数据统计，30个线程统计30天数据，全部统计完毕后，执行汇总；</li>
</ul>
<h2 id="J-U-C-并发容器类"><a href="#J-U-C-并发容器类" class="headerlink" title="J.U.C 并发容器类"></a>J.U.C 并发容器类</h2><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><h4 id="HashMap-ConcurrentHashMap-源码分析"><a href="#HashMap-ConcurrentHashMap-源码分析" class="headerlink" title="HashMap / ConcurrentHashMap 源码分析"></a>HashMap / ConcurrentHashMap 源码分析</h4><blockquote>
<p><a href="https://developer.ibm.com/zh/articles/java-lo-concurrenthashmap/" target="_blank" rel="noopener">探索 ConcurrentHashMap 高并发性的实现机制</a></p>
<p><a href="https://crossoverjie.top/2018/07/23/java-senior/ConcurrentHashMap/" target="_blank" rel="noopener">HashMap? ConcurrentHashMap? 相信看完这篇没人能难住你！</a></p>
<p><a href="http://www.jasongj.com/java/concurrenthashmap/" target="_blank" rel="noopener">Java进阶（六）从ConcurrentHashMap的演进看Java多线程核心技术</a></p>
</blockquote>
<h4 id="ConcurrentSkipListMap"><a href="#ConcurrentSkipListMap" class="headerlink" title="ConcurrentSkipListMap"></a>ConcurrentSkipListMap</h4><blockquote>
<p><a href="https://juejin.im/post/6844903958499033095" target="_blank" rel="noopener">J.U.C 之ConcurrentSkipListMap - 掘金</a></p>
<p><a href="https://en.wikipedia.org/wiki/Skip_list" target="_blank" rel="noopener">Skip list | 维基百科</a></p>
</blockquote>
<p><img data-src="https://upload.wikimedia.org/wikipedia/commons/2/2c/Skip_list_add_element-en.gif" alt=""></p>
<p>特点：</p>
<ul>
<li><p>有序链表实现</p>
</li>
<li><p>无锁实现(使用CAS)</p>
</li>
<li><p>value 不能为空</p>
</li>
<li><p>层级越高，跳跃性越大，数据约少，速度越快</p>
</li>
<li><p>随机决定新节点是否抽出来作为索引</p>
</li>
<li><p>时间复杂度为 O(log n)，空间复杂度为 O(n)</p>
</li>
</ul>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><h4 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h4><p>CopyOnWriteArrayList 容器即写时复制容器，和 ArrayList 相比，优点是并发安全，缺点有两个：</p>
<ol>
<li>多了内存占用：写数据是 copy 一份完整的数据，单独进行操作。</li>
<li>数据一致性：数据写完之后，其他线程不一定能马上读取到最新内容。</li>
</ol>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><table>
<thead>
<tr>
<th>实现</th>
<th>原理</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>HashSet</td>
<td>基于 HashMap 实现</td>
<td>非线程安全</td>
</tr>
<tr>
<td>CopyOnWriteArraySet</td>
<td>基于 CopyOnWriteArrayList</td>
<td>线程安全</td>
</tr>
<tr>
<td>ConcurrentSkipListSet</td>
<td>基于 ConcurrentSkipListMap</td>
<td>线程安全，有序，查询快</td>
</tr>
</tbody></table>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>add</td>
<td>添加元素</td>
<td>如果队列已满，则抛出 IllegalStateException 异常</td>
</tr>
<tr>
<td>remove</td>
<td>移除并返回队列头部的元素</td>
<td>如果队列为空，则抛出 NoSuchElementException 异常</td>
</tr>
<tr>
<td>element</td>
<td>返回队列头部的元素</td>
<td>如果队列为空，则抛出 NoSuchElementException 异常</td>
</tr>
<tr>
<td>offer</td>
<td>添加一个元素并返回 true</td>
<td>如果队列已满，则返回 false</td>
</tr>
<tr>
<td>poll</td>
<td>移除并返回队列头部的元素</td>
<td>如果队列为空，则返回 null</td>
</tr>
<tr>
<td>peek</td>
<td>返回队列头部的元素</td>
<td>如果队列为空，则返回 null</td>
</tr>
<tr>
<td>put</td>
<td>添加一个元素</td>
<td>如果队列已满，则阻塞</td>
</tr>
<tr>
<td>take</td>
<td>移除并返回队列头部的元素</td>
<td>如果队列为空，则阻塞</td>
</tr>
</tbody></table>
<h3 id="fork-join-并发处理框架"><a href="#fork-join-并发处理框架" class="headerlink" title="fork/join 并发处理框架"></a>fork/join 并发处理框架</h3><blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1306581226487842" target="_blank" rel="noopener">使用ForkJoin - 廖雪峰的官方网站</a></p>
<p><a href="https://www.liaoxuefeng.com/article/1146802219354112" target="_blank" rel="noopener">Java的Fork/Join任务，你写对了吗？ - 廖雪峰的官方网站</a></p>
<p><a href="http://ifeve.com/tag/fork-join/" target="_blank" rel="noopener">fork join | 并发编程网– ifeve.com</a></p>
<p><a href="https://my.oschina.net/u/4404812/blog/4650266" target="_blank" rel="noopener">面试大厂必问的ForkJoin框架剖析【建议收藏】</a></p>
</blockquote>
<p>Fork/Join 框架是 Java7 提供了的一个用于并行执行任务的框架， 是一个把大任务分割成若干个小任务，最终汇总每个小任务结果后得到大任务结果的框架。</p>
<p>ForkJoinPool 是 ExecutorService 接口的实现，专为可以递归分解的工作而设计。</p>
<p>分解任务的代码一般使用 RecursiveTask(带返回结果) 或者其子类 RecursiveAction。</p>
<p>适合数据处理、结果汇总、统计等场景；</p>
<p>Java 8 实例：java.util.Arrays#parallelSort() 方法。</p>
<p>工作窃取带来的性能提升偏理论，API 的复杂性较高，实际研发中可控性来说不如其他 API。</p>
<h3 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h3><p>Future 表示异步计算的结果，提供了用于检查计算是否完成、等待计算完成以及获取结果的方法。</p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="TCP-UDP-协议"><a href="#TCP-UDP-协议" class="headerlink" title="TCP/UDP 协议"></a>TCP/UDP 协议</h3><h4 id="传输控制协议-TCP"><a href="#传输控制协议-TCP" class="headerlink" title="传输控制协议 TCP"></a>传输控制协议 TCP</h4><blockquote>
<p><a href="https://github.com/jawil/blog/issues/14" target="_blank" rel="noopener">https://github.com/jawil/blog/issues/14</a></p>
<p><a href="https://juejin.im/post/6844903958624878606" target="_blank" rel="noopener">https://juejin.im/post/6844903958624878606</a></p>
</blockquote>
<p>传输控制协议（TCP，Transmission Control Protocol）是一个传输层协议，提供面向连接的、可靠的、有序的、基于字节流的传输层通信协议。应用程序在使用 TCP 之前，必须先建立 TCP 连接。</p>
<h5 id="TCP-三次握手"><a href="#TCP-三次握手" class="headerlink" title="TCP 三次握手"></a>TCP 三次握手</h5><h5 id="TCP-四次挥手"><a href="#TCP-四次挥手" class="headerlink" title="TCP 四次挥手"></a>TCP 四次挥手</h5><h6 id="为什么需要四次挥手？"><a href="#为什么需要四次挥手？" class="headerlink" title="为什么需要四次挥手？"></a>为什么需要四次挥手？</h6><p>四次挥手是为了连接双方能够安全的释放资源（连接双方会存储对方的地址信息）。</p>
<p>少于四次无法实现这个目的，假如客户端率先发起断开连接的请求：</p>
<ol>
<li><p>第一次挥手：客户端发送断开连接的请求给服务器</p>
<p>此时服务器由于还需要发报文给客户端，因此无法释放资源（即删除客户端地址信息）；而客户端还没有收到服务器的确认报文，需要持续监听，因此也无法释放资源（即删除服务器地址信息）。</p>
</li>
<li><p>第二次挥手：服务器发送确认报文给客户端</p>
<p>此时服务器由于还需要发送数据报文给客户端，因此无法自身释放资源；而客户端还需要继续监听服务端，也无法释放自身资源。</p>
</li>
<li><p>第三次挥手：服务器发送断开连接的请求给客户端</p>
<p>此时服务器由于还没收到客户端的确认报文，需要继续监听，所以无法释放资源；而客户端需要发送确认报文，也无法释放资源。</p>
</li>
<li><p>第四次挥手：客户端发送确认报文给服务器</p>
<p>当服务器收到该报文后就可以释放资源了，但客户端由于无法确定该报文是否被收到了，所以还无法释放资源，需要等待 2MSL 时间后才能释放资源。</p>
</li>
</ol>
<p>四次挥手是为了连接双方能够断开彼此之间的数据通道。少于四次无法实现这个目的。</p>
<p>假如客户端率先发起断开连接的请求：</p>
<ol>
<li><p>第一次挥手：客户端发送断开连接的请求给服务器</p>
<p>为了实现安全性，需要等待服务器的确认报文。</p>
</li>
<li><p>第二次挥手：服务器发送确认报文给客户端</p>
<p>由于 TCP 是全双工模式，双通道相互独立，故服务器还可以继续发送数据报文给客户端，此时客户端往服务器端的数据通道关闭，TCP 连接处于半关闭状态。</p>
</li>
<li><p>第三次挥手：服务器发送断开连接的请求给客户端</p>
<p>为了安全性，需要等待客户端的确认报文。</p>
</li>
<li><p>第四次挥手：客户端发送确认报文给服务器</p>
<p>当服务器接收到该报文后即可关闭连接，但客户端在发送完该报文后并不能确保服务器是否已收到，需要等待 2MSL 时间后再关闭。</p>
</li>
</ol>
<h5 id="2MSL等待状态"><a href="#2MSL等待状态" class="headerlink" title="2MSL等待状态"></a>2MSL等待状态</h5><p>报文段最大生存时间MSL（Maximum Segment Lifetime），在第四次挥手后主动端之所以还需要等待 2MSL 时间，是因为它无法保证报文是否被接收到，但如果假设报文丢失了，那么被动端会在 2MSL 时间内再发送一次断开连接的请求，此时主动端就可以判定确认报文丢失了，然后重新发送一次确认报文，如果 2MSL 时间内没有收到被动端再一次的断开连接请求，就认为被动端已经收到确认报文了，就可以关闭连接了。</p>
<h4 id="用户数据报协议-UDP"><a href="#用户数据报协议-UDP" class="headerlink" title="用户数据报协议 UDP"></a>用户数据报协议 UDP</h4><p>用户数据报协议属于传输层协议。提供无连接、不可靠、数据报尽力传输服务。</p>
<h3 id="Socket-编程"><a href="#Socket-编程" class="headerlink" title="Socket 编程"></a>Socket 编程</h3><p>应用最广泛的网络应用编程接口</p>
<ul>
<li>数据报类型套接字 SOCK_DGRAM（面向 UDP 接口）</li>
<li>流式套接字 SOCK_STREAM（面向 TCP 接口）</li>
<li>原始套接字 SOCK_RAW（面向网络层协议接口 IP、ICMP等）</li>
</ul>
<h4 id="Socket-API-调用过程"><a href="#Socket-API-调用过程" class="headerlink" title="Socket API 调用过程"></a>Socket API 调用过程</h4><pre class="mermaid" style="text-align: center;">
            graph TD
            
A[创建套接字] --> B[端点绑定]

B --> C[发送数据]

C --> D[接收数据]

D --> F[释放套接字]

          </pre>

<h4 id="Socket-API-函数"><a href="#Socket-API-函数" class="headerlink" title="Socket API 函数"></a>Socket API 函数</h4><p>listen()、accept() 函数只能用于服务器端；</p>
<p>connect() 函数只能用于客户端；</p>
<p>socket()、bind()、send()、recv()、sendto()、recvfrom()、close()</p>
<h3 id="BIO"><a href="#BIO" class="headerlink" title="BIO"></a>BIO</h3><h4 id="阻塞-IO-的含义"><a href="#阻塞-IO-的含义" class="headerlink" title="阻塞 IO 的含义"></a>阻塞 IO 的含义</h4><blockquote>
<p><a href="https://www.jianshu.com/p/efd69f496bcf" target="_blank" rel="noopener">同步和异步、阻塞和非阻塞</a></p>
</blockquote>
<ul>
<li><p><span style="color: #2196F3;">阻塞（blocking）IO</span>：资源不可用时，IO 请求一直阻塞，直到反馈结果（有数据或超时）。</p>
</li>
<li><p><span style="color: #2196F3;">非阻塞（non-blocking）IO</span>：资源不可用时，IO 请求立即返回，返回数据标识资源不可用。</p>
</li>
</ul>
<ul>
<li><p><span style="color: #2196F3;">同步（synchronous）IO</span>：应用阻塞在发送或接收数据的状态，直到数据成功传输或返回失败。</p>
</li>
<li><p><span style="color: #2196F3;">异步（asynchronous）IO</span>：应用发送或接收数据后立刻返回，实际处理是异步执行的。</p>
</li>
</ul>
<p>阻塞和非阻塞是获取资源的方式，同步/异步是程序如何处理资源的逻辑设计。</p>
<p>我的理解：阻塞/非阻塞是指单个线程的状态，同步/异步是指多个线程之间的关系。</p>
<p>API：ServerSocket#accept、InputStream#read 都是阻塞的API。操作系统底层 API 中，默认 Socket 操作都是 Blocking 型，send/recv 等接口都是阻塞的。</p>
<p><span style="color: #2196F3;">BIO 带来的问题：阻塞导致在处理网络 IO 时，一个线程只能处理一个网络连接。</span></p>
<h3 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h3><p>NIO 始于 Java 1.4。</p>
<p>NIO 有三个核心组件：</p>
<ol>
<li>Buffer 缓冲区</li>
<li>Channel 通道</li>
<li>Selector 选择器</li>
</ol>
<h4 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h4><p>使用 Buffer 进行数据读写，需要如下四个步骤：</p>
<ol>
<li>将数据写入缓冲区</li>
<li>调用 buffer.flip() 转换为读取模式</li>
<li>缓冲区读取数据</li>
<li>调用 buffer.clear() 或 buffer.compact() 清除缓冲区</li>
</ol>
<h5 id="Buffer-原理"><a href="#Buffer-原理" class="headerlink" title="Buffer 原理"></a>Buffer 原理</h5><p>三个重要属性：</p>
<ol>
<li>capacity</li>
<li>position：写入模式时代表写数据的位置，读取模式时代表读取数据的位置。</li>
<li>limit：写入模式时等于 capacity，读取模式时代表写入的数据量。</li>
</ol>
<h6 id="ByteBuffer"><a href="#ByteBuffer" class="headerlink" title="ByteBuffer"></a>ByteBuffer</h6><p>ByteBuffer 为性能关键型代码提供了直接内存(direct 堆外)和非直接内存(heap 堆)两种实现。</p>
<p>堆外内存获取的方式：<code>ByteBuffer.allocateDirect(noBytes);</code></p>
<p>好处：</p>
<ol>
<li>进行网络 IO 或者文件 IO 时比 heapBuffer 少一次拷贝（file/socket — OS memory — jvm heap）。GC 会移动对象内存，在写 file 或 socket 的过程中，JVM 的实现中，会先把数据复制到堆外，再进行写入。</li>
<li>GC 范围之外，降低 GC 压力，但实现了自动管理。DirectByteBuffer 中有一个 Cleaner 对象(PhantomReference)，Cleaner 被 GC 前会执行 clean 方法，触发 DirectByteBuffer 中定义的 Deallocator</li>
</ol>
<p>建议：</p>
<ol>
<li>性能确实可观的时候才去使用；分配给大型、长寿命；（网络传输、文件读写场景）</li>
<li>通过虚拟机参数 MaxDirectMemorySize 限制大小，防止耗尽整个机器的内存；</li>
</ol>
<h4 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h4><h5 id="SocketChannel"><a href="#SocketChannel" class="headerlink" title="SocketChannel"></a>SocketChannel</h5><p>SocketChannel 用于建立 TCP 网络连接，类似 java.net.Socket。有两种创建 SocketChannel 的形式：</p>
<ol>
<li>客户端主动发起和服务器的连接</li>
<li>服务端获取的新连接</li>
</ol>
<p><span style="color: #2196F3;">write</span>：write() 在尚未写入任何内容时就可能返回了。需要在循环中调用 write()。</p>
<p><span style="color: #2196F3;">read</span>：read() 方法可能直接返回而不读取任何数据，根据返回的 int 值判断读了多少字节。</p>
<h5 id="ServerSocketChannel"><a href="#ServerSocketChannel" class="headerlink" title="ServerSocketChannel"></a>ServerSocketChannel</h5><p>ServerSocketChannel 可以监听新建的 TCP 连接通道，类似 ServerSocket。</p>
<p><span style="color: #2196F3;">ServerSocketChannel.accept()</span>：如果该通道出去非阻塞模式，那么如果没有挂起的连接，该方法将立即返回 null。必须检查返回的 SocketChannel 是否为 null。</p>
<h5 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h5><p>Selector 实现一个线程处理多个通道：事件驱动机制。</p>
<p>非阻塞的网络通道下，开发者通过 Selector 注册对于通道感兴趣的事件类型，线程通过监听事件来触发相应的代码执行。（拓展：更底层是操作系统的多路复用机制）</p>
<h4 id="NIO-VS-BIO"><a href="#NIO-VS-BIO" class="headerlink" title="NIO VS BIO"></a>NIO VS BIO</h4><p>BIO，阻塞 IO，线程等待时间长，一个线程负责一个连接处理，线程多且利用率低。</p>
<p>NIO，非阻塞 IO，线程利用率更高，一个线程处理多个连接事件，性能更强大。</p>
<p>Tomcat 8 中，已经完全去除 BIO 相关的网络处理代码，默认采用 NIO 进行网络处理。</p>
<h4 id="NIO-与多线程结合的改进方案"><a href="#NIO-与多线程结合的改进方案" class="headerlink" title="NIO 与多线程结合的改进方案"></a>NIO 与多线程结合的改进方案</h4><blockquote>
<p><a href="http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf" target="_blank" rel="noopener">Doug Lea 的著名文章《Scalable IO in Java》</a></p>
</blockquote>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>NIO 为开发者提供了功能丰富及强大的 IO 处理 API，但是在应用与网络应用开发的过程中，直接使用 JDK 提供的 API，比较繁琐。而且要想将性能进行提升，光有 NIO 还不够，还需要将多线程技术与之结合起来。</p>
<p>因为网络编程本身的复杂性，以及 JDK API 开发的使用难度较高，所以在开源社区中，涌现出很多对 JDK NIO 进行封装、增强后对网络编程框架，例如：Netty、Mina 等。</p>
<h2 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h2><p>Netty 是一个高性能、高可扩展性的异步事件驱动的网络应用程序框架，它极大地简化了 TCP 和 UDP 客户端和服务器开发等网络编程。</p>
<p>Netty 重要的四个内容：</p>
<ol>
<li>Reactor 线程模型：一种高性能的多线程程序设计思路</li>
<li>Netty 中自己定义的 Channel 概念：增强版的通道概念</li>
<li>ChannelPipeline 职责链设计模式：事件处理机制</li>
<li>内存管理：增强的 ByteBuf 缓冲区</li>
</ol>
<h3 id="Netty-线程模型"><a href="#Netty-线程模型" class="headerlink" title="Netty 线程模型"></a>Netty 线程模型</h3><p>为了让 NIO 处理更好的利用多线程特性，Netty 实现了 Reactor 线程模型。</p>
<p>Reactor 模型中有四个核心概念：</p>
<ol>
<li>Resources 资源(请求/任务)</li>
<li>Synchronous Event Demultiplexer 同步事件复用器</li>
<li>Dispatcher 分配器</li>
<li>Request Handler 请求处理器</li>
</ol>
<h3 id="Channel-概念"><a href="#Channel-概念" class="headerlink" title="Channel 概念"></a>Channel 概念</h3><p>Netty 中的 Channel 是一个抽象的概念，可以理解为对 JDK NIO Channel 的增强和拓展。增加了很多属性和方法。</p>
<h4 id="责任链设计模式"><a href="#责任链设计模式" class="headerlink" title="责任链设计模式"></a>责任链设计模式</h4><blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319474561057" target="_blank" rel="noopener">责任链- 廖雪峰的官方网站</a></p>
<p><a href="https://refactoringguru.cn/design-patterns/chain-of-responsibility" target="_blank" rel="noopener">责任链设计模式（职责链模式） - 重构和设计模式</a></p>
<p><a href="https://juejin.im/post/6844903702260629512" target="_blank" rel="noopener">设计模式| 责任链模式及典型应用 - 掘金</a></p>
</blockquote>
<h5 id="模式结构"><a href="#模式结构" class="headerlink" title="模式结构"></a>模式结构</h5><p>责任链模式包含如下角色：</p>
<ul>
<li>处理器抽象类</li>
<li>具体处理器</li>
<li>处理器链维护器(可选)：维护了各个处理器的前后关系。可以由客户端再发送请求前生成链，或者动态地生成链。</li>
<li>客户端</li>
</ul>
<h5 id="伪例"><a href="#伪例" class="headerlink" title="伪例"></a>伪例</h5><p>请假流程</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/10/31/166c90b174855416" alt=""></p>
<p>请假请求类：LeaveRequest</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeaveRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> days;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LeaveRequest</span><span class="params">(<span class="keyword">int</span> days)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.days = days;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理器抽象类：LeaveRequestHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LeaveRequestHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.threshold = threshold;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理器具体类：SupervisorHandler、ManagerHandler、GeneralManagerHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SupervisorHandler</span> <span class="keyword">extends</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SupervisorHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(threshold);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaveRequest.days &lt;= threshold)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Random().nextBoolean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagerHandler</span> <span class="keyword">extends</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ManagerHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(threshold);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaveRequest.days &lt;= threshold)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Random().nextBoolean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneralManagerHandler</span> <span class="keyword">extends</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">GeneralManagerHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(threshold);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaveRequest.days &lt;= threshold)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Random().nextBoolean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端：Worker</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> days = <span class="number">3</span>;</span><br><span class="line">    Boolean response = requestLeave(days);</span><br><span class="line">    System.out.println(<span class="string">"申请"</span> + days + <span class="string">"天,"</span> + (response ? <span class="string">"申请成功！"</span> : <span class="string">"申请失败！"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Boolean <span class="title">requestLeave</span><span class="params">(<span class="keyword">int</span> days)</span> </span>&#123;</span><br><span class="line">    LeaveRequest leaveRequest = <span class="keyword">new</span> LeaveRequest(days);</span><br><span class="line">    SupervisorHandler supervisorHandler = <span class="keyword">new</span> SupervisorHandler(<span class="number">3</span>);</span><br><span class="line">    ManagerHandler managerHandler = <span class="keyword">new</span> ManagerHandler(<span class="number">7</span>);</span><br><span class="line">    GeneralManagerHandler generalManagerHandler = <span class="keyword">new</span> GeneralManagerHandler(Integer.MAX_VALUE);</span><br><span class="line">    LeaveRequestHandlerChain chain = <span class="keyword">new</span> LeaveRequestHandlerChain();</span><br><span class="line">    chain.addHandler(supervisorHandler);</span><br><span class="line">    chain.addHandler(managerHandler);</span><br><span class="line">    chain.addHandler(generalManagerHandler);</span><br><span class="line">    <span class="keyword">return</span> chain.process(leaveRequest);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="零拷贝机制"><a href="#零拷贝机制" class="headerlink" title="零拷贝机制"></a>零拷贝机制</h4><h2 id="类加载机制"><a href="#类加载机制" class="headerlink" title="类加载机制"></a>类加载机制</h2><p>一个 Java 程序运行，至少有三个类加载器实例，负责不同类的加载。</p>
<ol>
<li><p>Bootstrap loader 核心类库加载器</p>
<p>C/C++实现，无对应 Java 类：null</p>
<p>加载 JRE_HOME/jre/lib 目录，或用户配置的目录，JDK 核心类库 r t.jar…</p>
</li>
<li><p>Extension Class Loader 扩展类库加载器</p>
<p>ExtClassLoader 的实例：</p>
<p>加载 JRE_HOME/jre/lib/ext 目录，JDK 扩展包，或用户配置的目录</p>
</li>
<li><p>Application Class Loader 用户应用程序加载器</p>
<p>AppClassLoader 的实例：</p>
<p>加载 java.class.path 指定的目录，用户应用程序 class-path，或者 Java 命令运行时参数 -cp…</p>
</li>
</ol>
<p>查看类对应加载器的方法：java.lang.Class.getClassLoader()</p>
<p>该方法返回装载类的类加载器，如果这个类是由 BootstrapClassLoader 加载的，那么返回 null。</p>
<h3 id="不会重复加载"><a href="#不会重复加载" class="headerlink" title="不会重复加载"></a>不会重复加载</h3><h3 id="双亲委派模型"><a href="#双亲委派模型" class="headerlink" title="双亲委派模型"></a>双亲委派模型</h3><h2 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h2><h3 id="标记算法"><a href="#标记算法" class="headerlink" title="标记算法"></a>标记算法</h3><ul>
<li>引用计数</li>
<li>可达性分析算法</li>
</ul>
<h5 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h5><h5 id="可达性级别"><a href="#可达性级别" class="headerlink" title="可达性级别"></a>可达性级别</h5><h3 id="收集算法"><a href="#收集算法" class="headerlink" title="收集算法"></a>收集算法</h3><h3 id="JVM-命令工具"><a href="#JVM-命令工具" class="headerlink" title="JVM 命令工具"></a>JVM 命令工具</h3><h4 id="javap"><a href="#javap" class="headerlink" title="javap"></a>javap</h4><h4 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h4><h4 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h4><h4 id="jcmd"><a href="#jcmd" class="headerlink" title="jcmd"></a>jcmd</h4><h4 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h4><h4 id="jhat"><a href="#jhat" class="headerlink" title="jhat"></a>jhat</h4><h4 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h4><h4 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h4><h4 id="jconsole"><a href="#jconsole" class="headerlink" title="jconsole"></a>jconsole</h4><h4 id="JvisualVM"><a href="#JvisualVM" class="headerlink" title="JvisualVM"></a>JvisualVM</h4><h3 id="JVM-调优"><a href="#JVM-调优" class="headerlink" title="JVM 调优"></a>JVM 调优</h3><h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h3 id="Tomcat-网络处理线程模型"><a href="#Tomcat-网络处理线程模型" class="headerlink" title="Tomcat 网络处理线程模型"></a>Tomcat 网络处理线程模型</h3><h4 id="BIO-同步-Servlet"><a href="#BIO-同步-Servlet" class="headerlink" title="BIO + 同步 Servlet"></a>BIO + 同步 Servlet</h4><p>Tomcat 7 及以前使用 BIO + 同步 Servlet，一个请求使用一个线程。</p>
<h4 id="APR-异步-Servlet"><a href="#APR-异步-Servlet" class="headerlink" title="APR + 异步 Servlet"></a>APR + 异步 Servlet</h4><p>Apache可移植运行时（<em>Apache Portable Runtime</em>，简称APR）是Apache HTTP服务器的支持库，提供了一组映射到下层操作系统的API。</p>
<p>JNI 的形式调用 Apache HTTP 服务器的核心动态链接库来处理文件读取或网络传输操作。</p>
<p>Tomcat 默认监听指定路径，如果有 APR 安装，则自动启动。</p>
<h4 id="NIO-异步-Servlet"><a href="#NIO-异步-Servlet" class="headerlink" title="NIO + 异步 Servlet"></a>NIO + 异步 Servlet</h4><p>Tomcat 8 开始默认使用 NIO</p>
<h3 id="Tomcat-参数调优"><a href="#Tomcat-参数调优" class="headerlink" title="Tomcat 参数调优"></a>Tomcat 参数调优</h3><h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><h2 id="消息中间件"><a href="#消息中间件" class="headerlink" title="消息中间件"></a>消息中间件</h2><h3 id="AMQP-协议"><a href="#AMQP-协议" class="headerlink" title="AMQP 协议"></a>AMQP 协议</h3><blockquote>
<p>高级消息队列协议即Advanced Message Queuing Protocol是面向消息中间件提供的开放的应用层协议，其设计目标是对于消息的排序、路由、保持可靠性、保证安全性。 <a href="https://zh.wikipedia.org/zh-cn/高级消息队列协议" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<h3 id="MQTT-协议"><a href="#MQTT-协议" class="headerlink" title="MQTT 协议"></a>MQTT 协议</h3><blockquote>
<p>MQTT消息队列遥测传输（Message Queuing Telemetry Transport）是ISO 标准下基于发布 /订阅 范式的消息协议，可视为“资料传递的桥梁”它工作在TCP/IP协议族上，是为硬件性能低下的远程设备以及网络状况糟糕的情况下而设计的发布/订阅型消息协议，为此，它需要一个消息中间件，以解决当前繁重的资料传输协议，如：HTTP。 <a href="https://zh.wikipedia.org/zh-cn/MQTT" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<h3 id="OpenMessaging-协议"><a href="#OpenMessaging-协议" class="headerlink" title="OpenMessaging 协议"></a>OpenMessaging 协议</h3><blockquote>
<p><a href="http://140.205.61.252/2018/11/19/首个由国内发起的/" target="_blank" rel="noopener">首个由国内发起的分布式消息领域的国际标准OpenMessaging …</a></p>
</blockquote>
<h3 id="Kafka-协议"><a href="#Kafka-协议" class="headerlink" title="Kafka 协议"></a>Kafka 协议</h3><blockquote>
<p>Kafka是由Apache软件基金会开发的一个开源流处理平台，由Scala和Java编写。该项目的目标是为处理实时数据提供一个统一、高吞吐、低延迟的平台。其持久化层本质上是一个“按照分布式事务日志架构的大规模发布/订阅消息队列”，这使它作为企业级基础设施来处理流式数据非常有价值。 <a href="https://zh.wikipedia.org/zh-cn/Kafka" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<p>Kafka 协议是居于 TCP 的二机制协议。消息内部是通过长度来分割，由一些基本数据类型组成。</p>
<h3 id="消息持久化"><a href="#消息持久化" class="headerlink" title="消息持久化"></a>消息持久化</h3><table>
<thead>
<tr>
<th></th>
<th>ActiveMQ</th>
<th>RabbitMQ</th>
<th>Kafka</th>
<th>RocketMQ</th>
</tr>
</thead>
<tbody><tr>
<td>文件系统</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>数据库</td>
<td>支持</td>
<td>/</td>
<td>/</td>
<td>/</td>
</tr>
</tbody></table>
<h3 id="消息分发策略"><a href="#消息分发策略" class="headerlink" title="消息分发策略"></a>消息分发策略</h3><table>
<thead>
<tr>
<th></th>
<th>ActiveMQ</th>
<th>RabbitMQ</th>
<th>Kafka</th>
<th>RocketMQ</th>
</tr>
</thead>
<tbody><tr>
<td>文件系统</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>轮询分发</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>/</td>
</tr>
<tr>
<td>公平分发</td>
<td>/</td>
<td>支持</td>
<td>支持</td>
<td>/</td>
</tr>
<tr>
<td>重发</td>
<td>支持</td>
<td>支持</td>
<td>/</td>
<td>支持</td>
</tr>
<tr>
<td>消息拉取</td>
<td>/</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
</tbody></table>
<h3 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h3><h4 id="Master-Slave-主从共享部署方式"><a href="#Master-Slave-主从共享部署方式" class="headerlink" title="Master-Slave 主从共享部署方式"></a>Master-Slave 主从共享部署方式</h4><h4 id="Master-Slave-主从同步部署方式"><a href="#Master-Slave-主从同步部署方式" class="headerlink" title="Master-Slave 主从同步部署方式"></a>Master-Slave 主从同步部署方式</h4><h4 id="Broker-Cluster-多主集群同步部署方式"><a href="#Broker-Cluster-多主集群同步部署方式" class="headerlink" title="Broker-Cluster 多主集群同步部署方式"></a>Broker-Cluster 多主集群同步部署方式</h4><h4 id="Broker-Cluster-多主集群转发部署方式"><a href="#Broker-Cluster-多主集群转发部署方式" class="headerlink" title="Broker-Cluster 多主集群转发部署方式"></a>Broker-Cluster 多主集群转发部署方式</h4><h3 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h3><blockquote>
<p>Apache ActiveMQ是Apache软件基金会所研发的开放源码消息中间件；由于ActiveMQ是一个纯Java程序，因此只需要操作系统支持Java虚拟机，ActiveMQ便可执行。 <a href="https://zh.wikipedia.org/zh-cn/Apache_ActiveMQ" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<h4 id="JMS-规范"><a href="#JMS-规范" class="headerlink" title="JMS 规范"></a>JMS 规范</h4><blockquote>
<p>Java消息服务应用程序接口是一个Java平台中关于面向消息中间件的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。 Java消息服务的规范包括两种消息模式，点对点和发布者／订阅者。 <a href="https://zh.wikipedia.org/zh-cn/Java消息服务" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<h4 id="JMS-对象模型"><a href="#JMS-对象模型" class="headerlink" title="JMS 对象模型"></a>JMS 对象模型</h4><h4 id="JMS-消息模型"><a href="#JMS-消息模型" class="headerlink" title="JMS 消息模型"></a>JMS 消息模型</h4><ul>
<li><p>点对点</p>
</li>
<li><p>发布订阅</p>
</li>
</ul>
<h4 id="JMS-消息结构"><a href="#JMS-消息结构" class="headerlink" title="JMS 消息结构"></a>JMS 消息结构</h4><ul>
<li>消息头</li>
<li>消息属性</li>
<li>消息体类型</li>
</ul>
<h3 id="ActiveMQ-高可用集群方案"><a href="#ActiveMQ-高可用集群方案" class="headerlink" title="ActiveMQ 高可用集群方案"></a>ActiveMQ 高可用集群方案</h3><h3 id="ActiveMQ-持久化"><a href="#ActiveMQ-持久化" class="headerlink" title="ActiveMQ 持久化"></a>ActiveMQ 持久化</h3><h4 id="JDBC-方式"><a href="#JDBC-方式" class="headerlink" title="JDBC 方式"></a>JDBC 方式</h4><p>性能低</p>
<h4 id="AMQ-方式"><a href="#AMQ-方式" class="headerlink" title="AMQ 方式"></a>AMQ 方式</h4><h4 id="KahaDB-方式"><a href="#KahaDB-方式" class="headerlink" title="KahaDB 方式"></a>KahaDB 方式</h4><h4 id="LevelDB-方式"><a href="#LevelDB-方式" class="headerlink" title="LevelDB 方式"></a>LevelDB 方式</h4><p>已被摒弃</p>
<h3 id="事务机制"><a href="#事务机制" class="headerlink" title="事务机制"></a>事务机制</h3><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>Nginx 不执行动态语言，只能作为静态资源服务器。</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><ol>
<li>轮询</li>
<li>最少连接</li>
<li>IP hash</li>
<li>基于权重</li>
</ol>
<h3 id="代理缓存"><a href="#代理缓存" class="headerlink" title="代理缓存"></a>代理缓存</h3><h3 id="通过-Lua-拓展-Nginx"><a href="#通过-Lua-拓展-Nginx" class="headerlink" title="通过 Lua 拓展 Nginx"></a>通过 Lua 拓展 Nginx</h3><p>Lua 使得 Nginx 可以支持动态语言。</p>
<h4 id="协程（Coroutine）"><a href="#协程（Coroutine）" class="headerlink" title="协程（Coroutine）"></a>协程（Coroutine）</h4><h4 id="Nginx-进程模型"><a href="#Nginx-进程模型" class="headerlink" title="Nginx 进程模型"></a>Nginx 进程模型</h4><h3 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h3><blockquote>
<p>OpenResty是基于nginx的Web平台，可以使用其LuaJIT引擎运行Lua脚本。该软件是由Yichun Zhang创建的。它最初是在2011年前由Taobao.com赞助的，在2012年至2016年期间主要由Cloudflare支持。 <a href="https://en.wikipedia.org/wiki/OpenResty" target="_blank" rel="noopener">维基百科（英文)</a></p>
</blockquote>
<h3 id="高性能-Nginx-最佳实践"><a href="#高性能-Nginx-最佳实践" class="headerlink" title="高性能 Nginx 最佳实践"></a>高性能 Nginx 最佳实践</h3><h4 id="监听端口"><a href="#监听端口" class="headerlink" title="监听端口"></a>监听端口</h4><h4 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h4><h4 id="配置-location"><a href="#配置-location" class="headerlink" title="配置 location"></a>配置 location</h4><h4 id="常规配置"><a href="#常规配置" class="headerlink" title="常规配置"></a>常规配置</h4><h5 id="定义环境变量"><a href="#定义环境变量" class="headerlink" title="定义环境变量"></a>定义环境变量</h5><h5 id="嵌入其他配置文件"><a href="#嵌入其他配置文件" class="headerlink" title="嵌入其他配置文件"></a>嵌入其他配置文件</h5><h5 id="pid文件"><a href="#pid文件" class="headerlink" title="pid文件"></a>pid文件</h5><h5 id="worker-进程运行的用户和用户组"><a href="#worker-进程运行的用户和用户组" class="headerlink" title="worker 进程运行的用户和用户组"></a>worker 进程运行的用户和用户组</h5><h5 id="指定-worker-进程可以打开的最大句柄描述符个数"><a href="#指定-worker-进程可以打开的最大句柄描述符个数" class="headerlink" title="指定 worker 进程可以打开的最大句柄描述符个数"></a>指定 worker 进程可以打开的最大句柄描述符个数</h5><h5 id="限制信号队列"><a href="#限制信号队列" class="headerlink" title="限制信号队列"></a>限制信号队列</h5><h4 id="高性能配置"><a href="#高性能配置" class="headerlink" title="高性能配置"></a>高性能配置</h4><h5 id="worker-进程个数"><a href="#worker-进程个数" class="headerlink" title="worker 进程个数"></a>worker 进程个数</h5><h5 id="绑定-worker-进程到指定-CPU-内核"><a href="#绑定-worker-进程到指定-CPU-内核" class="headerlink" title="绑定 worker 进程到指定 CPU 内核"></a>绑定 worker 进程到指定 CPU 内核</h5><h5 id="SSL-硬件加速"><a href="#SSL-硬件加速" class="headerlink" title="SSL 硬件加速"></a>SSL 硬件加速</h5><h5 id="worker-进程优先级设置"><a href="#worker-进程优先级设置" class="headerlink" title="worker 进程优先级设置"></a>worker 进程优先级设置</h5><h4 id="事件配置"><a href="#事件配置" class="headerlink" title="事件配置"></a>事件配置</h4><h5 id="是否打开-accept-锁"><a href="#是否打开-accept-锁" class="headerlink" title="是否打开 accept 锁"></a>是否打开 accept 锁</h5><h5 id="使用-accept-锁后到真正建立连接之间的延迟时间"><a href="#使用-accept-锁后到真正建立连接之间的延迟时间" class="headerlink" title="使用 accept 锁后到真正建立连接之间的延迟时间"></a>使用 accept 锁后到真正建立连接之间的延迟时间</h5><h5 id="批量建立新连接"><a href="#批量建立新连接" class="headerlink" title="批量建立新连接"></a>批量建立新连接</h5><h5 id="选择事件模型"><a href="#选择事件模型" class="headerlink" title="选择事件模型"></a>选择事件模型</h5><h5 id="每个-worker-的最大连接数"><a href="#每个-worker-的最大连接数" class="headerlink" title="每个 worker 的最大连接数"></a>每个 worker 的最大连接数</h5><h4 id="Nginx-事件模型"><a href="#Nginx-事件模型" class="headerlink" title="Nginx 事件模型"></a>Nginx 事件模型</h4><p>epoll</p>
<h3 id="LVS-负载均衡软件"><a href="#LVS-负载均衡软件" class="headerlink" title="LVS 负载均衡软件"></a>LVS 负载均衡软件</h3><blockquote>
<p>Linux虚拟服务器(Linux Virtual Server)是一个虚拟的服务器集群系统，用于实现负载平衡。项目在1998年5月由章文嵩成立，是中国国内最早出现的自由软件项目之一。 <a href="https://zh.wikipedia.org/zh-cn/Linux虚拟服务器" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<h4 id="IP-虚拟服务器软件-IPVS"><a href="#IP-虚拟服务器软件-IPVS" class="headerlink" title="IP 虚拟服务器软件 IPVS"></a>IP 虚拟服务器软件 IPVS</h4><h5 id="Virtual-Server-via-Direct-Routing-VS-DR"><a href="#Virtual-Server-via-Direct-Routing-VS-DR" class="headerlink" title="Virtual Server via Direct Routing (VS/DR)"></a>Virtual Server via Direct Routing (VS/DR)</h5><h5 id="Virtual-Server-via-Network-Address-Translation-VS-NAT"><a href="#Virtual-Server-via-Network-Address-Translation-VS-NAT" class="headerlink" title="Virtual Server via Network Address Translation (VS/NAT)"></a>Virtual Server via Network Address Translation (VS/NAT)</h5><h5 id="Virtual-Server-via-IP-Tunneling-VS-TUN"><a href="#Virtual-Server-via-IP-Tunneling-VS-TUN" class="headerlink" title="Virtual Server via IP Tunneling (VS/TUN)"></a>Virtual Server via IP Tunneling (VS/TUN)</h5><h4 id="IPVS-调度算法"><a href="#IPVS-调度算法" class="headerlink" title="IPVS 调度算法"></a>IPVS 调度算法</h4><p>八种负载调度算法</p>
<h4 id="内核-Layer-7-交换机-KTCPVS"><a href="#内核-Layer-7-交换机-KTCPVS" class="headerlink" title="内核 Layer-7 交换机 KTCPVS"></a>内核 Layer-7 交换机 KTCPVS</h4><h4 id="LVS-与-Nginx-对比"><a href="#LVS-与-Nginx-对比" class="headerlink" title="LVS 与 Nginx 对比"></a>LVS 与 Nginx 对比</h4><h3 id="基于-VIP-的-keepalived-高可用架构"><a href="#基于-VIP-的-keepalived-高可用架构" class="headerlink" title="基于 VIP 的 keepalived 高可用架构"></a>基于 VIP 的 keepalived 高可用架构</h3><h3 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h3><h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><h4 id="高可用集群"><a href="#高可用集群" class="headerlink" title="高可用集群"></a>高可用集群</h4><h4 id="高可用架构"><a href="#高可用架构" class="headerlink" title="高可用架构"></a>高可用架构</h4><h2 id="使用-CDN-实现应用的缓存和加速"><a href="#使用-CDN-实现应用的缓存和加速" class="headerlink" title="使用 CDN 实现应用的缓存和加速"></a>使用 CDN 实现应用的缓存和加速</h2><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><h4 id="服务模式"><a href="#服务模式" class="headerlink" title="服务模式"></a>服务模式</h4><h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><h4 id="关键技术"><a href="#关键技术" class="headerlink" title="关键技术"></a>关键技术</h4><h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><h2 id="谷歌-Guava-缓存"><a href="#谷歌-Guava-缓存" class="headerlink" title="谷歌 Guava 缓存"></a>谷歌 Guava 缓存</h2><p>Guava Cache 是 Google Guava 中的一个内存缓存模块，用于将数据缓存到 JVM 内存中。</p>
<h2 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h2><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><h4 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h4><h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><h3 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h3><h4 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a>内存分配</h4><ul>
<li>String 类型的 value 最大可存储 512M。</li>
<li>List 类型，元素个数最多 2^32-1</li>
<li>Set 类型，元素个数最多 2^32-1</li>
<li>Hash 类型，键值对个数最多 2^32-1</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Permission Control in Git Repository</title>
    <url>/2019/11/15/Permission-Control-in-Git-Repository/</url>
    <content><![CDATA[<img data-src="https://backlog.com/app/themes/backlog-child/assets/img/guides/git/basics/rewriting_history_005.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p>原有的 Git 并不支持权限控制，权限控制都是各大远程仓库托管平台所提供的功能。</p>
</blockquote>
<h2 id="合并流程"><a href="#合并流程" class="headerlink" title="合并流程"></a>合并流程</h2><blockquote>
<p>我们公司 API 项目组的 master 分支的合并权限是测试人员才有的，也就是说只有测试人员才能把其他开发分支合并到 master 分支。</p>
</blockquote>
<p>因为合并的时候如果有冲突，就需要到测试人员那里去解决冲突，但是测试那里并没有开发环境，解决冲突后无法确定项目是否能正常运行（如果合并时出现合并后存在问题的代码），而部署的权限也在测试手里，合完后他们就直接部署了。</p>
<p>这就存在合并后有冲突，冲突解决后如果代码存在运行时异常，直接部署后导致部署失败，又需要回退再重新合并。</p>
<p>为了解决这种麻烦且易错的问题，我的方案如下。</p>
<h3 id="主要角色"><a href="#主要角色" class="headerlink" title="主要角色"></a>主要角色</h3><ol>
<li>QA：测试人员</li>
<li>DP：开发人员</li>
</ol>
<h3 id="涉及分支"><a href="#涉及分支" class="headerlink" title="涉及分支"></a>涉及分支</h3><ol>
<li>master</li>
<li>API-1921（根据 jira 分配的任务编号建对应分支）</li>
</ol>
<h3 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h3><p><img data-src="https://i.loli.net/2019/11/15/xvD9GbWqJ6rBAMk.png" alt=""></p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Prepare for PAT</title>
    <url>/2019/01/11/Prepare-for-PAT/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2019/01/11/5c3813443dce6.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://www.patest.cn/" target="_blank" rel="noopener">PAT官网</a></p>
</blockquote>
<h2 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h2><h3 id="1-11-2-20"><a href="#1-11-2-20" class="headerlink" title="1/11-2/20"></a>1/11-2/20</h3><p>一共 50h</p>
<p><a href="https://doc.weiyun.com/bec9710ef6076b30f1154413324b9ef1" target="_blank" rel="noopener">PAT-timeaxis.xlsx</a></p>
<p><img data-src="https://i.loli.net/2019/01/11/5c38115365f11.jpg" alt=""></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><blockquote>
<p><a href="https://github.com/libo9527/PAT" target="_blank" rel="noopener">PAT</a></p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<p><a href="https://libo9527.github.io/2019/02/15/Summary-of-PAT/" target="_blank" rel="noopener">Summary of PAT</a></p>
</blockquote>
<p>条件判断中如果有对称性的逻辑，尽量适用下面这种方式，即变量不动，逻辑判断动。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(a1 + b1 == a2 &amp;&amp; a1 + b1 != b2)&#123;</span><br><span class="line">    a++;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(a1 + b1 != a2 &amp;&amp; a1 + b1 == b2)&#123;</span><br><span class="line">    b++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>避免适用下面这种方式（比较混乱）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(a1 + b1 == a2 &amp;&amp; a1 + b1 != b2)&#123;</span><br><span class="line">    a++;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(a1 + b1 == b2 &amp;&amp; a1 + b1 != a2)&#123;</span><br><span class="line">    b++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="http://www.morecoder.com/article/1115597.html" target="_blank" rel="noopener">PAT——甲级1042：Shuffling Mashine</a></p>
<p>long long 类型在 C++(g++) 下错误 C++(clang++) 下正确。</p>
<figure class="highlight c++"><figcaption><span>PAT-1065.cpp</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> t;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;t);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t; i++)&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> a, b, c;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>, &amp;a, &amp;b, &amp;c);</span><br><span class="line">    <span class="keyword">if</span>(a &gt; <span class="number">0</span> &amp;&amp; b &gt; <span class="number">0</span> &amp;&amp; a + b &lt; <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Case #%d: true\n"</span>, i+<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(a &lt; <span class="number">0</span> &amp;&amp; b &lt; <span class="number">0</span> &amp;&amp; a + b &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Case #%d: false\n"</span>, i+<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(a + b &gt; c)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Case #%d: true\n"</span>, i+<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Case #%d: false\n"</span>, i+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注意计数器自增自减和条件判断的前后顺序。</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">count--;</span><br><span class="line"><span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">////</span></span><br><span class="line"><span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">count--;</span><br></pre></td></tr></table></figure>



<p>sort() 函数的使用</p>
<h3 id="C-error-2872-不明确的符号-code-nie的博客-CSDN博客"><a href="#C-error-2872-不明确的符号-code-nie的博客-CSDN博客" class="headerlink" title="C++ error 2872:不明确的符号 - code_nie的博客 - CSDN博客"></a><a href="https://www.baidu.com/link?url=HvAoxxP6Vh5jlJN6_5JVIgqn4V5H04hTcU8KEF6ctZDJEEgE7k-y7GsouW6h_IlqUgHTgYR1YWeomMvxU3_yM0_i8Lmz4EJGseKSohh6zR_&wd=&eqid=eec0d1d100080620000000065c6bbaed" target="_blank" rel="noopener"><em>C++</em> error 2872:<em>不明确的符号</em> - code_nie的博客 - CSDN博客</a></h3><p>简单地说，出现这种情况是因为程序使用的命名空间里已经有这个变量名了</p>
<p>namespace std,  “rank”</p>
<p>vs2010 报错：</p>
<p>1&gt;MSVCRTD.lib(crtexe.obj) : error LNK2019: 无法解析的外部符号 _main，该符号在函数 ___tmainCRTStartup 中被引用<br>1&gt;f:\visual studio 2010\Projects\pat\Debug\pat.exe : fatal error LNK1120: 1 个无法解析的外部命令</p>
<p>原因：main 拼错了，拼成了 mian</p>
<p>strcpy() 函数</p>
<h2 id="考点"><a href="#考点" class="headerlink" title="考点"></a>考点</h2><p>深圳大学： 白鉴聪, <a href="mailto:szubjc@szu.edu.cn">szubjc@szu.edu.cn</a><br>Dev C++ 5.10; Code::Blocks16.01; Java SE Development Kit9.0.1; Eclipse Oxygen.2 版本 4.7.2; Python解释器（3.6.5）; PyCharm Community Edition</p>
<p>求余（%）和取整（/）优先级相同。</p>
<blockquote>
<p><a href="https://blog.csdn.net/qq_38658814/article/details/82534765?utm_source=blogxgwz2" target="_blank" rel="noopener">PAT备考经验&amp;相关信息</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Algorithm</category>
        <category>PAT</category>
      </categories>
      <tags>
        <tag>PAT</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL Functions in ORACLE</title>
    <url>/2019/08/14/SQL-Functions-in-ORACLE/</url>
    <content><![CDATA[<img data-src="https://regmedia.co.uk/2017/05/03/oracle_balloons2_photo_via_shutterstock.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions001.htm" target="_blank" rel="noopener">SQL Functions - Oracle Help Center</a></p>
</blockquote>
<h2 id="通用函数"><a href="#通用函数" class="headerlink" title="通用函数"></a>通用函数</h2><h3 id="NVL"><a href="#NVL" class="headerlink" title="NVL"></a>NVL</h3><p>格式：<strong>NVL(expr1,expr2)</strong></p>
<p>功能：如果第一个参数为空那么显示第二个参数的值，如果第一个参数的值不为空，则显示第一个参数本来的值。</p>
<p>实例：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,NVL(comm, <span class="number">-1</span>) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">------------------------------------</span></span><br><span class="line"></span><br><span class="line">ENAME NVL(COMM,-1)</span><br><span class="line"><span class="comment">------- ----</span></span><br><span class="line">SMITH -1</span><br><span class="line">ALLEN 300</span><br><span class="line">WARD 500</span><br><span class="line">JONES -1</span><br><span class="line">MARTIN 1400</span><br><span class="line">BLAKE -1</span><br><span class="line">FORD -1</span><br><span class="line">MILLER -1</span><br></pre></td></tr></table></figure>

<h4 id="空值-NULL-和数字相加"><a href="#空值-NULL-和数字相加" class="headerlink" title="空值 NULL 和数字相加"></a>空值 NULL 和数字相加</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> GLOBAL_LOCATION <span class="keyword">SET</span> POPULATION = NVL(POPULATION, <span class="number">0</span>) + <span class="number">1000</span> <span class="keyword">WHERE</span> <span class="keyword">ID</span> = <span class="number">5022</span></span><br></pre></td></tr></table></figure>

<h3 id="NVL2"><a href="#NVL2" class="headerlink" title="NVL2"></a>NVL2</h3><p>语法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">NVL2(expr1, expr2, expr3)</span><br></pre></td></tr></table></figure>

<p>如果 expr1 为 NULL 返回 expr2，否则返回 expr3。</p>
<h2 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h2><h3 id="SUBSTR"><a href="#SUBSTR" class="headerlink" title="SUBSTR"></a>SUBSTR</h3><p>substr(字符串,截取开始位置,截取长度) //返回截取的字符串</p>
<p>substr(‘Hello World’,2,4) //返回结果为 ‘ello’</p>
<p>substr(‘Hello World’,-3,3)//返回结果为 ‘rld’ 负数(-i)表示截取的开始位置为字符串右端向左数第i个字符</p>
<h3 id="LENGTH"><a href="#LENGTH" class="headerlink" title="LENGTH"></a>LENGTH</h3><p>length(字符串) //返回字符串长度</p>
<h3 id="REGEXP-SUBSTR"><a href="#REGEXP-SUBSTR" class="headerlink" title="REGEXP_SUBSTR"></a>REGEXP_SUBSTR</h3><blockquote>
<p><a href="https://blog.csdn.net/sofeien/article/details/80534557" target="_blank" rel="noopener">oracle如何拆分以逗号分隔的字符串为多行</a></p>
<p><a href="https://blog.csdn.net/wang_yunj/article/details/51040029" target="_blank" rel="noopener">oracle connect by用法篇</a></p>
</blockquote>
<p>REGEXP_SUBSTR(srcstr, pattern, position, occurrence, modifier)</p>
<ul>
<li>srcstr：需要进行正则处理的字符串</li>
<li>pattern：进行匹配的正则表达式</li>
<li>position：起始位置，从第几个字符开始正则表达式匹配（默认为1）</li>
<li>occurrence：标识提取第几个匹配值，默认为1</li>
<li>modifier：模式（’i’不区分大小写进行检索；’c’区分大小写进行检索。默认为’c’。）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> regexp_substr(<span class="string">'1,7,250'</span>,<span class="string">'[^,]+'</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">result</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--- rsult: 1</span></span><br><span class="line"><span class="keyword">select</span> regexp_substr(<span class="string">'1,7,250'</span>,<span class="string">'[^,]+'</span>,<span class="number">1</span>,<span class="number">2</span>) <span class="keyword">result</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--- rsult: 7</span></span><br><span class="line"><span class="keyword">select</span> regexp_substr(<span class="string">'1,7,250'</span>,<span class="string">'[^,]+'</span>,<span class="number">1</span>,<span class="number">3</span>) <span class="keyword">result</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--- rsult: 250</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> regexp_substr(<span class="string">'1,7,250'</span>,<span class="string">'[^,]+'</span>,<span class="number">1</span>,<span class="keyword">rownum</span>) <span class="keyword">result</span> <span class="keyword">from</span> dual <span class="keyword">connect</span> <span class="keyword">by</span> <span class="keyword">rownum</span> &lt;= regexp_count(<span class="string">'1,7,250'</span>, <span class="string">'[^,]+'</span>);</span><br><span class="line"><span class="comment">--- rsult: </span></span><br><span class="line"><span class="comment">--- 1</span></span><br><span class="line"><span class="comment">--- 7</span></span><br><span class="line"><span class="comment">--- 250</span></span><br></pre></td></tr></table></figure>

<h3 id="LISTAGG"><a href="#LISTAGG" class="headerlink" title="LISTAGG"></a>LISTAGG</h3><blockquote>
<p><a href="https://docs.oracle.com/cd/E11882_01/server.112/e41084/functions089.htm" target="_blank" rel="noopener">listagg - Oracle Docs</a></p>
</blockquote>
<p>LISTAGG(measure_expr [, ‘delimiter’])  WITHIN GROUP (order_by_clause) [OVER query_partition_clause]</p>
<p>在每个分组内，LISTAGG 根据 order by 子句对列进行排序，然后将排序后的结果拼接起来</p>
<ul>
<li>measure_expr：任何基于列的表达式</li>
<li>delimiter：分隔符</li>
<li>order_by_clause：order by 子句决定了列值被拼接的顺序</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">LISTAGG</span> ( ENGLISH_NAME, <span class="string">' &gt; '</span> ) <span class="keyword">WITHIN</span> <span class="keyword">GROUP</span> ( <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">ID</span> ) address </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	GLOBAL_LOCATION </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="keyword">ID</span> <span class="keyword">IN</span> ( <span class="number">1</span>, <span class="number">7</span>, <span class="number">250</span> )</span><br><span class="line">  </span><br><span class="line"><span class="comment">--- result: </span></span><br><span class="line"><span class="comment">--- Asia &gt; China &gt; Shanxi</span></span><br></pre></td></tr></table></figure>

<h3 id="LPAD"><a href="#LPAD" class="headerlink" title="LPAD"></a>LPAD</h3><blockquote>
<p><strong>pad</strong></p>
<p>( padding, padded, pads )</p>
<p>英 [pæd]美 [pæd]</p>
<ul>
<li>n. 衬垫；护具；便笺簿；填补</li>
<li>vi. 步行；放轻脚步走</li>
<li>vt. <strong>填补</strong>；走</li>
<li>n. (Pad)人名；(英)帕德(男子教名 Patrick 的昵称)</li>
</ul>
<p><a href="https://www.techonthenet.com/oracle/functions/lpad.php" target="_blank" rel="noopener">Oracle / PLSQL: LPAD Function - TechOnTheNet</a></p>
</blockquote>
<p>LPAD 函数用一组特定的字符填充字符串的左侧。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LPAD( string1, padded_length [, pad_string] )</span><br></pre></td></tr></table></figure>

<ul>
<li>string1：被填充的字符串，当 string1 为 NULL 或者空字符串时，LPAD 函数失效。</li>
<li>padded_length：填充后返回的结果字符串的长度，当长度小于原来字符串的长度时进行截取。</li>
<li>pad_string：要填充的字符串，默认为空格。</li>
</ul>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>一般在具有层级关系的查询中，根据层级，在某个字段前会拼接相应数量的空格字符，以便更具有可读性。</p>
<p>比如在查看执行计划时使用如下语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">lpad</span>(<span class="string">' '</span>, <span class="number">5</span> * ( <span class="keyword">LEVEL</span> - <span class="number">1</span> )) || operation operation,</span><br><span class="line">	options,</span><br><span class="line">	object_name,</span><br><span class="line">	<span class="keyword">cost</span>,</span><br><span class="line">	<span class="keyword">position</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	plan_table <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="keyword">id</span> = <span class="number">0</span> <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">PRIOR</span> <span class="keyword">id</span> = parent_id;</span><br></pre></td></tr></table></figure>

<h3 id="RPAD"><a href="#RPAD" class="headerlink" title="RPAD"></a>RPAD</h3><p>对比参考 LPAD，RPAD是在右侧填充。</p>
<h2 id="日期处理函数"><a href="#日期处理函数" class="headerlink" title="日期处理函数"></a>日期处理函数</h2><h3 id="ADD-MONTHS"><a href="#ADD-MONTHS" class="headerlink" title="ADD_MONTHS"></a>ADD_MONTHS</h3><blockquote>
<p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28286/functions004.htm" target="_blank" rel="noopener">ADD_MONTHS | Oracle</a></p>
<p><code>ADD_MONTHS</code> returns the date <code>date</code> plus <code>integer</code> months. A month is defined by the session parameter <code>NLS_CALENDAR</code>. The date argument can be a datetime value or any value that can be implicitly converted to <code>DATE</code>. The <code>integer</code> argument can be an integer or any value that can be implicitly converted to an integer. The return type is always <code>DATE</code>, regardless of the datatype of <code>date</code>. If <code>date</code> is the last day of the month or if the resulting month has fewer days than the day component of <code>date</code>, then the result is the last day of the resulting month. Otherwise, the result has the same day component as <code>date</code>.</p>
</blockquote>
<p>语法：ADD_MONTHS(date, integer)</p>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR( ADD_MONTHS( <span class="keyword">SYSDATE</span>, - <span class="number">1</span> ), <span class="string">'YYYY-MM-dd'</span> ) <span class="string">"Last month"</span>, TO_CHAR( <span class="keyword">SYSDATE</span>, <span class="string">'yyyy-MM-dd'</span> ) <span class="string">"Now"</span>, TO_CHAR( ADD_MONTHS( <span class="keyword">SYSDATE</span>, <span class="number">1</span> ), <span class="string">'YYYY-MM-dd'</span> ) <span class="string">"Next month"</span> <span class="keyword">FROM</span> dual;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">"Last month" "Now"	      "Next month"</span><br><span class="line"><span class="comment">------------ ------------ ------------</span></span><br><span class="line">"2019-07-14" "2019-08-14"	"2019-09-14"</span><br></pre></td></tr></table></figure>

<h3 id="LAST-DAY"><a href="#LAST-DAY" class="headerlink" title="LAST_DAY"></a>LAST_DAY</h3><blockquote>
<p><a href="https://docs.oracle.com/database/121/SQLRF/functions096.htm" target="_blank" rel="noopener">LAST_DAY | Oracle</a></p>
<p><code>LAST_DAY</code> returns the date of the last day of the month that contains <code>date</code>. The last day of the month is defined by the session parameter <code>NLS_CALENDAR</code>. The return type is always <code>DATE</code>, regardless of the data type of <code>date</code>.</p>
</blockquote>
<p>语法：LAST_DAY(date)</p>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SYSDATE</span>, <span class="keyword">LAST_DAY</span>( <span class="keyword">SYSDATE</span> ) <span class="string">"Last"</span>, <span class="keyword">LAST_DAY</span>( <span class="keyword">SYSDATE</span> ) - <span class="keyword">SYSDATE</span> <span class="string">"Days Left"</span> <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line">"SYSDATE"             "Last"                "Days Left"</span><br><span class="line"><span class="comment">--------------------- --------------------- -----------</span></span><br><span class="line">"2019-08-14 05:41:01" "2019-08-31 05:41:01"          17</span><br></pre></td></tr></table></figure>



<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><h3 id="COUNT"><a href="#COUNT" class="headerlink" title="COUNT"></a>COUNT</h3><h4 id="按日期统计"><a href="#按日期统计" class="headerlink" title="按日期统计"></a>按日期统计</h4><p>需求：统计收集数量</p>
<p><img data-src="https://i.loli.net/2019/08/14/wImuRzxqEybkW5C.png" alt="pic"></p>
<h5 id="按年统计"><a href="#按年统计" class="headerlink" title="按年统计"></a>按年统计</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(COLLECT_DATE, <span class="string">'yyyy'</span>) <span class="keyword">AS</span> COLLECT_DATE, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> <span class="keyword">COUNT</span> <span class="keyword">FROM</span> COLLECT_RECORD <span class="keyword">GROUP</span> <span class="keyword">BY</span> TO_CHAR(COLLECT_DATE, <span class="string">'yyyy'</span>)</span><br></pre></td></tr></table></figure>

<h5 id="按月统计"><a href="#按月统计" class="headerlink" title="按月统计"></a>按月统计</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(COLLECT_DATE, <span class="string">'yyyy-MM'</span>) <span class="keyword">AS</span> COLLECT_DATE, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> <span class="keyword">COUNT</span> <span class="keyword">FROM</span> COLLECT_RECORD <span class="keyword">GROUP</span> <span class="keyword">BY</span> TO_CHAR(COLLECT_DATE, <span class="string">'yyyy-MM'</span>)</span><br></pre></td></tr></table></figure>

<h5 id="按日统计"><a href="#按日统计" class="headerlink" title="按日统计"></a>按日统计</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(COLLECT_DATE, <span class="string">'yyyy-MM-dd'</span>) <span class="keyword">AS</span> COLLECT_DATE, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> <span class="keyword">COUNT</span> <span class="keyword">FROM</span> COLLECT_RECORD <span class="keyword">GROUP</span> <span class="keyword">BY</span> TO_CHAR(COLLECT_DATE, <span class="string">'yyyy-MM-dd'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="TRUNC"><a href="#TRUNC" class="headerlink" title="TRUNC"></a>TRUNC</h2><blockquote>
<p><a href="https://docs.oracle.com/cd/B10501_01/appdev.920/a96583/cci08r14.htm#1072049" target="_blank" rel="noopener">Documentation | Oracle</a><br>This method returns the Number object truncated at the number of decimal places provided by the parameter specified.</p>
</blockquote>
<p>语法：TRUNC(number, num_digits)</p>
<ul>
<li>number：需要截断取整的数字</li>
<li>num_digits：用于指定取整精度的数字，默认值为 0</li>
</ul>
<p>eg：</p>
<ul>
<li><p>数字</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> trunc(<span class="number">123.458</span>) <span class="keyword">from</span> dual    <span class="comment">--123</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123.458</span>,<span class="number">0</span>) <span class="keyword">from</span> dual  <span class="comment">--123</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123.458</span>,<span class="number">1</span>) <span class="keyword">from</span> dual  <span class="comment">--123.4</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123.458</span>,<span class="number">-1</span>) <span class="keyword">from</span> dual <span class="comment">--120</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123.458</span>,<span class="number">-4</span>) <span class="keyword">from</span> dual <span class="comment">--0</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123.458</span>,<span class="number">4</span>) <span class="keyword">from</span> dual  <span class="comment">--123.458</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123</span>) <span class="keyword">from</span> dual        <span class="comment">--123</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123</span>,<span class="number">1</span>) <span class="keyword">from</span> dual      <span class="comment">--123</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">123</span>,<span class="number">-1</span>) <span class="keyword">from</span> dual     <span class="comment">--120</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>日期</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-08-14 00:00:00  今天的日期</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>, <span class="string">'mm'</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-08-01 00:00:00  当月第一天</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>,<span class="string">'yy'</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-01-01 00:00:00  当年第一天</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>,<span class="string">'dd'</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-08-14 00:00:00  当前年月日</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>,<span class="string">'yyyy'</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-01-01 00:00:00  当年第一天</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>,<span class="string">'d'</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-08-11 00:00:00  当前星期的第一天(星期天)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>, <span class="string">'hh'</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-08-14 03:00:00  当前时间的第一分钟</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="keyword">sysdate</span>, <span class="string">'mi'</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="comment">--2019-08-14 03:56:00  当前时间的第一秒，TRUNC()函数没有秒的精确</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><h3 id="JSON-TABLE"><a href="#JSON-TABLE" class="headerlink" title="JSON_TABLE"></a>JSON_TABLE</h3><blockquote>
<p><a href="https://docs.oracle.com/database/121/SQLRF/functions092.htm" target="_blank" rel="noopener">json_table - Oracle Docs</a></p>
</blockquote>
<p>语法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JSON_TABLE</span><br><span class="line">  ( expr [ FORMAT JSON ], JSON_path_expression</span><br><span class="line">    [ JSON_table_on_error_clause ] JSON_columns_clause )</span><br></pre></td></tr></table></figure>

<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> j_purchaseorder</span><br><span class="line">  (<span class="keyword">id</span> <span class="keyword">RAW</span> (<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">   date_loaded <span class="built_in">TIMESTAMP</span>(<span class="number">6</span>) <span class="keyword">WITH</span> <span class="built_in">TIME</span> ZONE,</span><br><span class="line">   po_document <span class="keyword">CLOB</span> <span class="keyword">CONSTRAINT</span> ensure_json <span class="keyword">CHECK</span> (po_document <span class="keyword">IS</span> <span class="keyword">JSON</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> j_purchaseorder</span><br><span class="line">  <span class="keyword">VALUES</span> (</span><br><span class="line">    SYS_GUID(),</span><br><span class="line">    SYSTIMESTAMP,</span><br><span class="line">    <span class="string">'&#123;"PONumber"              : 1600,</span></span><br><span class="line"><span class="string">      "Reference"             : "ABULL-20140421",</span></span><br><span class="line"><span class="string">       "Requestor"            : "Alexis Bull",</span></span><br><span class="line"><span class="string">       "User"                 : "ABULL",</span></span><br><span class="line"><span class="string">       "CostCenter"           : "A50",</span></span><br><span class="line"><span class="string">       "ShippingInstructions" : &#123;"name"   : "Alexis Bull",</span></span><br><span class="line"><span class="string">                                 "Address": &#123;"street"   : "200 Sporting Green",</span></span><br><span class="line"><span class="string">                                              "city"    : "South San Francisco",</span></span><br><span class="line"><span class="string">                                              "state"   : "CA",</span></span><br><span class="line"><span class="string">                                              "zipCode" : 99236,</span></span><br><span class="line"><span class="string">                                              "country" : "United States of America"&#125;,</span></span><br><span class="line"><span class="string">                                 "Phone" : [&#123;"type" : "Office", "number" : "909-555-7307"&#125;,</span></span><br><span class="line"><span class="string">                                            &#123;"type" : "Mobile", "number" : "415-555-1234"&#125;]&#125;,</span></span><br><span class="line"><span class="string">       "Special Instructions" : null,</span></span><br><span class="line"><span class="string">       "AllowPartialShipment" : true,</span></span><br><span class="line"><span class="string">       "LineItems" : [&#123;"ItemNumber" : 1,</span></span><br><span class="line"><span class="string">                       "Part" : &#123;"Description" : "One Magic Christmas",</span></span><br><span class="line"><span class="string">                                 "UnitPrice"   : 19.95,</span></span><br><span class="line"><span class="string">                                 "UPCCode"     : 13131092899&#125;,</span></span><br><span class="line"><span class="string">                       "Quantity" : 9.0&#125;,</span></span><br><span class="line"><span class="string">                      &#123;"ItemNumber" : 2,</span></span><br><span class="line"><span class="string">                       "Part" : &#123;"Description" : "Lethal Weapon",</span></span><br><span class="line"><span class="string">                                 "UnitPrice"   : 19.95,</span></span><br><span class="line"><span class="string">                                 "UPCCode"     : 85391628927&#125;,</span></span><br><span class="line"><span class="string">                       "Quantity" : 5.0&#125;]&#125;'</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> jt.*</span><br><span class="line"><span class="keyword">FROM</span> j_purchaseorder,</span><br><span class="line">JSON_TABLE(po_document, <span class="string">'$.ShippingInstructions.Phone[*]'</span></span><br><span class="line"><span class="keyword">COLUMNS</span> (row_number <span class="keyword">FOR</span> <span class="keyword">ORDINALITY</span>,</span><br><span class="line">         phone_type <span class="built_in">VARCHAR2</span>(<span class="number">10</span>) <span class="keyword">PATH</span> <span class="string">'$.type'</span>,</span><br><span class="line">         phone_num <span class="built_in">VARCHAR2</span>(<span class="number">20</span>) <span class="keyword">PATH</span> <span class="string">'$.number'</span>))</span><br><span class="line"><span class="keyword">AS</span> jt;</span><br><span class="line"></span><br><span class="line">ROW_NUMBER PHONE_TYPE PHONE_NUM</span><br><span class="line"><span class="comment">---------- ---------- --------------------</span></span><br><span class="line">         1 Office     909-555-7307</span><br><span class="line">         2 Mobile     415-555-1234</span><br></pre></td></tr></table></figure>

<h2 id="分析函数"><a href="#分析函数" class="headerlink" title="分析函数"></a>分析函数</h2><h3 id="ROW-NUMBER"><a href="#ROW-NUMBER" class="headerlink" title="ROW_NUMBER"></a>ROW_NUMBER</h3><blockquote>
<p><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions137.htm" target="_blank" rel="noopener">row_number - Oracle Docs</a></p>
</blockquote>
<p>语法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ROW_NUMBER( )</span><br><span class="line">   OVER ([ query_partition_clause ] order_by_clause)</span><br></pre></td></tr></table></figure>

<p>eg：查找最新一条收集任务</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	* </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> ct.* , row_number () <span class="keyword">over</span> ( <span class="keyword">ORDER</span> <span class="keyword">BY</span> ct.CREATE_DATE <span class="keyword">DESC</span> ) rn <span class="keyword">FROM</span> COLLECT_TASK ct ) </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	rn = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ID 	COLLECTOR_ID CITY_ID CREATE_BY CREATE_DATE 	      UPDATE_BY UPDATE_DATE 	     DEL_FLAG RN </span><br><span class="line">--- ------------ ------- --------- ------------------ --------- ------------------ -------- --</span><br><span class="line">135 176 	       5185 	 1 	       26&#x2F;8&#x2F;2019 17:23:37 1 	      26&#x2F;8&#x2F;2019 17:25:14 0 	      1</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>Oracle</tag>
        <tag>SQL-Function</tag>
      </tags>
  </entry>
  <entry>
    <title>Scenic Strategy</title>
    <url>/2019/02/03/Scenic-Strategy/</url>
    <content><![CDATA[<img data-src="http://staticnew.mayi.com/resourcesWeb/travel/images/zixun/201509030020127533.jpg" width="100%"/>

<a id="more"></a>

<h2 id="景点攻略"><a href="#景点攻略" class="headerlink" title="景点攻略"></a>景点攻略</h2><blockquote>
<p><a href="https://www.meet99.com/lvyou" target="_blank" rel="noopener">景点大全</a></p>
</blockquote>
<h2 id="金鸡湖景区"><a href="#金鸡湖景区" class="headerlink" title="金鸡湖景区"></a>金鸡湖景区</h2><p>门票<br>金鸡湖免费，摩天轮乐园成人80元，学生40元/人。<br>开放时间<br>全天。金鸡湖音乐喷泉的时间：周五周六晚上20:00-20:30</p>
<p><img data-src="http://jinjilake.sipac.gov.cn/images/yxjjh/yxjjh_wh.png" alt=""></p>
<p>景区内目前有3个游客接待中心，分别是北门游客中心、南门游客中心和博览游客中心。这里可以免费获取旅游手册，资讯旅游信息，租借婴儿椅、轮椅等，还能寄送明信片。</p>
<h2 id="拙政园"><a href="#拙政园" class="headerlink" title="拙政园"></a>拙政园</h2><blockquote>
<p><a href="https://www.baidu.com/link?url=grc1aIl18kWGOdDq8Mqa8biQ5gH_L_h-fThoI4uKjGMYNCO4g7d1bTCKxy6_G2N-NT8R9n7qG-1qtBS5fjNoia9fULDznfN7fr_ku1NmjyVCDk7lauTzs89plubteNBgVyr905Ni2iRSWCzkY3JJDgcUDy383rBzQYMqaFdWNnNZHBAkbMmnmjbeprSNFx91YCZXqyrKPKB0ONJzjfN-YzwWFyYgxDjxgRx4v9kJLnYbuOsZguDs6L-dYQXESXJhQsXkvR6w5uPk0Gg0dsSuxpjo5mMMIpCO8-mFRHCj6pqnNQqdKET7IYZY6iy5gOqihT-qxBwYdhsT2o19TLCTD3XBdJhzIuWvHx7Es-H1jeHzwsb3DwX6kFRgqvTM55gAzT0IsHdAz5gh5oLiX7iTrXKeFMX0elI7SVfBeim616hR3Bv9W_haYvrS63si8XR41TtobevSyyH3bOgTz46iJtEieeCgG2neSKLf7fMQNixsBtK7lcX_MOhlU65_q5c6p2zERiYNAjUhcxP6FLoUelGlJX8JE2F19Hh5OyB493gBxslDsF9xoh1fHTN-7MFo8OlIvI0S5mqH2qiMf1DMdCUe7lPkWC7_41aRdPdK0P91okYLnLCr009xwDOF3Nw7pKS6Y4TV7dgPtS8cg3fIcncF91-ktjFmFbvHiqO6ao3dwbz51UcgTZ66fJt8MF4_KIHxK3xT0yp13x7BwOUhiQCGLpxlCjEQyGt3NcN87I2n4J0rg13TSsyaNbajEvYFNpjPCQV4_sPndk2bj5ZI6mYQyA_6JTxlNvb3G2afdmRHHLjEi78R2exewsnhQX2knEbIetIRD6AINEuc5cELJMAEHDqKaVbLIZNZzm_L38kDNmwPJTtyUcSBZpGwwbo2z5yyRic51VFLdfx8oUQkWftCgnEEAJgX8Se4hMXbbPsrWldec7OHSlkCTrCuZ4IOYK6z2kVR3UQKE4qiP5n8j_&wd=&eqid=8dac39ec0000553e000000065c566595" target="_blank" rel="noopener">苏州拙政园官网</a></p>
</blockquote>
<p>园林门票</p>
<p><strong>园林票价</strong></p>
<ul>
<li><strong>淡季 70元/位 1月  2月  3月  6月  11月  12月</strong></li>
<li><strong>旺季 90元/位 4月  5月  7月  8月  9 月  10月</strong></li>
</ul>
<p><strong>开园时间</strong> </p>
<ul>
<li><strong>7:30～17:30（3月1日～11月15日）</strong></li>
<li><strong>7:30～17:00（11月16日～次年2月29日）</strong></li>
</ul>
<p><strong>[</strong> <strong>减免门票入园规定]</strong><br>1、身高在1.4米以下儿童（含1.4米）由成人携带免票入园（不包括学生团队春秋游）；6周岁（含6周岁以下儿童）凭有效证件，由成人携带免票入园。<br>2、6周岁（不含6周岁）到18周岁（含18周岁）未成年人、本科及以下全日制在校学生（不含函授、成人教育及短期培训生、交流生和研究生），须凭本人有效学生证和身份证件享受半价优惠。<br>3、凭苏州市老干部局、苏州市园林和绿化管理局发放的离休干部游园证可免票入园。<br>4、现役军人、军队离退休干部凭有效证件可免票入园，革命伤残军人持国务院颁发的伤残军人证免票入园。<br>5、70周岁以上的老年人，持《高龄证》或居民身份证可免票入园；60至69周岁的老年人凭《老年人优待证》或身份证等有效证件可半价优惠。<br>6、全国“劳动模范”、市区市级以上（含市级）劳动模范凭苏州市园林和绿化管理局和苏州市总工会发放的“游园证”可免票入园。<br>7、持有苏州市环卫工人“荣誉证书”的市区居民，凭证书可免票入园。<br>8、全国残疾人员凭有效证件免票入园。<br>9、导游人员持有导游证和旅行社委派行程单带团实行免票。</p>
<p>以上政策规定自2014年6月30日起执行。</p>
<p><strong>以上优惠政策仅供参考，最终解释权归景区所有，以咨询景区实际答复为准。咨询热线：962015</strong></p>
<p>拙政园，位于江苏省苏州市，始建于明正德初年（16世纪初），是江南古典园林的代表作品。拙政园与北京颐和园、承德避暑山庄、苏州留园一起被誉为中国四大名园。</p>
<p>拙政园位于苏州城东北隅（东北街178号），截至2014年，仍是苏州存在的最大的古典园林，占地78亩（约合5.2公顷）。全园以水为中心，山水萦绕，厅榭精美，花木繁茂，具有浓郁的江南水乡特色。花园分为东、中、西三部分，东花园开阔疏朗，中花园是全园精华所在，西花园建筑精美，各具特色。园南为住宅区，体现典型江南地区传统民居多进的格局。园南还建有苏州园林博物馆，是国内唯一的园林专题博物馆。</p>
<p>1961年3月，拙政园被列为首批全国重点文物保护单位，1991年被国家计委、旅游局、建设部列为国家级特殊游览参观点。1997年联合国教科文组织批准列入《世界遗产名录》。2007年被国家旅游局评为首批国家AAAAA级旅游景区。</p>
<p>中国四大名园分别为：江苏省苏州市拙政园、 北京市海淀区颐和园、河北省承德市避暑山庄、江苏省苏州市留园。</p>
<p>苏州四大园林——沧浪亭、狮子林、拙政园和留园，分别代表着宋、元、明、清四个朝代的艺术风格，被称为苏州“四大名园”。</p>
<h2 id="苏州博物馆"><a href="#苏州博物馆" class="headerlink" title="苏州博物馆"></a>苏州博物馆</h2><blockquote>
<p><a href="http://trust.baidu.com/vstar/official/intro?type=gw" target="_blank" rel="noopener">苏州博物馆官网</a></p>
</blockquote>
<ul>
<li><p>门票</p>
<p>大成殿:30人民币；联票(大成殿、王谢古居):32人民币 (1月1日-12月31日 周一-周日) </p>
</li>
<li><p>开放时间</p>
<p>09:00-17:00；停止入场时间:16:00 (1月1日-12月31日 周二-周日) tips: 周一闭馆(国家法定节假日除外) ，本馆遇有重大活动或重要设备设施维修保养时，可根据需要临时闭馆，届时将告示公众。</p>
</li>
</ul>
<p>个人预约。简单注册一下就可以预约了，一个账号可以预约三个人。预约成功以后有二维码和短信，参观的时候带着身份证直接走到博物馆正门出示一下就可以进入了。请记得提前几天预约，周一博物馆不开放，平常9:00-17:00，四点就不能入馆了。请不要带食物、茶水、饮料进入。拍摄文物时请不要打开闪光灯。</p>
<p>不能带水和食物进入的.</p>
<p>在进入博物馆的时候要过安检的,我看到有人当时就把水喝光才进去的.没有寄存处的哦,</p>
<p>周一的时候是闭馆的,在周二和周五的营业时间是早上九点和下午五点,但是下午四点就不让进馆了.</p>
<p>所以在周一或者下午四点后就不要再去了.</p>
<p>新馆大门是入口，忠王府大门是出口</p>
<ol>
<li>参观人数过多时博物馆会实行限流，建议尽量避开周末和节假日前往</li>
<li>安检，不能携带食物和有色饮料，不能穿拖鞋进馆；馆内温度常年在20摄氏度左右，请注意衣着适宜；70岁以上老人、残疾人有专门的绿色通道。</li>
<li>有时会有特别展览（需购票），但不影响游客免费参观基本陈列。</li>
<li>博物馆提供专人讲解服务，每场100元起。</li>
<li>该景点与狮子林、苏州园林博物馆、苏州民俗博物馆等相近，可一并游览。</li>
</ol>
<h2 id="平江路-1小时"><a href="#平江路-1小时" class="headerlink" title="平江路(1小时)"></a>平江路(1小时)</h2><blockquote>
<p><a href="http://www.pingjiangroad.com/blogs/909.html" target="_blank" rel="noopener">苏州平江路旅游攻略</a></p>
</blockquote>
<p>平江路是苏州的一条历史老街，是一条沿河的小路，其河名为平江河。平江路历史街区是苏州古城迄今为止保存最为完整的一个区域，堪称古城缩影。对照南宋《平江图》及明末《苏州府城内水道总图》，平江路基本延续了唐宋以来的城坊格局，并至今保持着活力。</p>
<p>宋时苏州称“平江”，取名缘于此。平江路古名十泉里，因该路有古井十口的缘故。但清乾隆《长洲县志》学宫图中，已标作“平江大路”，自清同治《苏州府志》起，本路一直称作平江路，《姑苏图》等也均标平江路。</p>
<p>长1606.8米，宽3.2米，1985年改弹石路面为长方石人字形路面。2004年5月，平江路完成保护与整治工程，路面改建传统长条石横铺彻成。两侧支巷多为历史悠久的小巷，路以“水陆并行，河街相邻”特色著称，西侧平江河即为古城内“三横四直”干流中第四直河，宽5～6米，从南端苑桥到北端华阳桥，中间共有11座桥东西向跨越其上。</p>
<p>狐狸家手工酸…2809人去过 2<br>鸡脚旮旯(邾长巷)1700人去过 3<br>平江路历史街区1567人去过 4<br>皇城秘制鸡爪388人去过 5<br>桃花源记(平江店)611人去过 6<br>品芳茶社(平江…464人去过 7<br>鱼食饭稻土灶…568人去过 8<br>旧人家吃食104人去过</p>
<h2 id="乌镇"><a href="#乌镇" class="headerlink" title="乌镇"></a>乌镇</h2><blockquote>
<p><a href="http://www.baidu.com/link?url=AHieag_AeO2jaBjej02WLpGhAdrTmPNN6mwA0Q7ypZYxGNhUqWefFl7sXPXy3wsC" target="_blank" rel="noopener">乌镇旅游官方网站</a></p>
<p><a href="http://www.mafengwo.cn/mdd/cityroute/10434_139.html" target="_blank" rel="noopener">乌镇精华1日线路</a></p>
</blockquote>
<p>东栅：120元/人</p>
<p>西栅：150元/人</p>
<p>东西栅联票：200元/人</p>
<p>游览车：非住宿客人10元/人，住宿客人免费乘坐。景区内南线及北线游览车停靠点都有设置二维码叫车服务，方便快捷，减少等待时间</p>
<p>游船：拼包船（限8人）：60元/人（成人）、30元/人（1.5米以下儿童）；单包船：480元/艘（限8人）</p>
<p><a href="http://www.mafengwo.cn/poi/14972.html" target="_blank" rel="noopener">江南百床馆(30分钟)</a> → <a href="http://www.mafengwo.cn/poi/14958.html" target="_blank" rel="noopener">乌镇东栅景区-江南民俗馆(20分钟)</a> → <a href="http://www.mafengwo.cn/poi/14960.html" target="_blank" rel="noopener">宏源泰染坊(30分钟)</a> → <a href="http://www.mafengwo.cn/poi/15152.html" target="_blank" rel="noopener">江南木雕陈列馆(0.5-1小时)</a> → <a href="http://www.mafengwo.cn/poi/32299.html" target="_blank" rel="noopener">乌镇东栅景区-茅盾故居(30分钟)</a> → <a href="http://www.mafengwo.cn/poi/15514.html" target="_blank" rel="noopener">草木本色染坊(30分钟)</a> → <a href="http://www.mafengwo.cn/poi/14982.html" target="_blank" rel="noopener">乌镇西栅景区-昭明书院(30分钟)</a> → <a href="http://www.mafengwo.cn/poi/14965.html" target="_blank" rel="noopener">乌镇邮局(30分钟)</a>→ <a href="http://www.mafengwo.cn/poi/15023.html" target="_blank" rel="noopener">乌镇西栅景区-白莲塔(30分钟)</a> → <a href="http://www.mafengwo.cn/poi/1308.html" target="_blank" rel="noopener">女红街(30分钟)</a></p>
<p>东栅很小，一个充实的上午轻轻松松可以逛完的。</p>
<p>开放时间</p>
<p>07:00-18:00(东栅景区) (5月1日-9月30日 周一-周日)<br>07:00-17:30(东栅景区) (10月1日-次年4月30日 周一-周日)09:00-22:00(西栅景区) (10月1日-次年4月30日 周一-周日)</p>
<p>乌镇景区与高德地图合作，在高德地图上打造的首个人文智慧景区产品，进一步提升了乌镇景区游客游玩体验度。在计划出游前，游客可在高德地图搜索“乌镇”，“一键”直达乌镇“景区门户”，在这里不仅能看到景区动态信息，还可在线购门票、定酒店，查询官方推荐玩法、交通路线等信息。</p>
<h2 id="西湖"><a href="#西湖" class="headerlink" title="西湖"></a>西湖</h2><p>一山 <a href="https://baike.baidu.com/item/%E5%AD%A4%E5%B1%B1" target="_blank" rel="noopener">孤山</a><br>二塔 <a href="https://baike.baidu.com/item/%E9%9B%B7%E5%B3%B0%E5%A1%94" target="_blank" rel="noopener">雷峰塔</a>和<a href="https://baike.baidu.com/item/%E4%BF%9D%E4%BF%B6%E5%A1%94" target="_blank" rel="noopener">保俶塔</a><br>三岛 <strong>小瀛洲</strong> <strong>湖心亭</strong> <strong>阮公墩</strong><br>三堤 <strong>白堤</strong> <strong>苏堤</strong> <strong>杨公堤</strong><br>西湖十景<br>环湖街道</p>
<p>最初的十景景目为<a href="https://baike.baidu.com/item/%E5%B9%B3%E6%B9%96%E7%A7%8B%E6%9C%88" target="_blank" rel="noopener">平湖秋月</a>、<a href="https://baike.baidu.com/item/%E8%8B%8F%E5%A0%A4%E6%98%A5%E6%99%93" target="_blank" rel="noopener">苏堤春晓</a>、<a href="https://baike.baidu.com/item/%E6%96%AD%E6%A1%A5%E6%AE%8B%E9%9B%AA" target="_blank" rel="noopener">断桥残雪</a>、<a href="https://baike.baidu.com/item/%E9%9B%B7%E5%B3%B0%E5%A4%95%E7%85%A7" target="_blank" rel="noopener">雷峰夕照</a>、<a href="https://baike.baidu.com/item/%E5%8D%97%E5%B1%8F%E6%99%9A%E9%92%9F" target="_blank" rel="noopener">南屏晚钟</a>、<a href="https://baike.baidu.com/item/%E6%9B%B2%E8%8B%91%E9%A3%8E%E8%8D%B7" target="_blank" rel="noopener">曲苑风荷</a>、<a href="https://baike.baidu.com/item/%E8%8A%B1%E6%B8%AF%E8%A7%82%E9%B1%BC" target="_blank" rel="noopener">花港观鱼</a>、<a href="https://baike.baidu.com/item/%E6%9F%B3%E6%B5%AA%E9%97%BB%E8%8E%BA" target="_blank" rel="noopener">柳浪闻莺</a>、<a href="https://baike.baidu.com/item/%E4%B8%89%E6%BD%AD%E5%8D%B0%E6%9C%88" target="_blank" rel="noopener">三潭印月</a><strong>、</strong>两峰插云。</p>
<p>最后新十景确定为<a href="https://baike.baidu.com/item/%E4%BA%91%E6%A0%96%E7%AB%B9%E5%BE%84" target="_blank" rel="noopener">云栖竹径</a>、<a href="https://baike.baidu.com/item/%E6%BB%A1%E9%99%87%E6%A1%82%E9%9B%A8" target="_blank" rel="noopener">满陇桂雨</a>、<a href="https://baike.baidu.com/item/%E8%99%8E%E8%B7%91%E6%A2%A6%E6%B3%89" target="_blank" rel="noopener">虎跑梦泉</a>、<a href="https://baike.baidu.com/item/%E9%BE%99%E4%BA%95%E9%97%AE%E8%8C%B6" target="_blank" rel="noopener">龙井问茶</a>、<a href="https://baike.baidu.com/item/%E4%B9%9D%E6%BA%AA%E7%83%9F%E6%A0%91" target="_blank" rel="noopener">九溪烟树</a>、<a href="https://baike.baidu.com/item/%E5%90%B4%E5%B1%B1%E5%A4%A9%E9%A3%8E" target="_blank" rel="noopener">吴山天风</a>、<a href="https://baike.baidu.com/item/%E9%98%AE%E5%A2%A9%E7%8E%AF%E7%A2%A7" target="_blank" rel="noopener">阮墩环碧</a>、<a href="https://baike.baidu.com/item/%E9%BB%84%E9%BE%99%E5%90%90%E7%BF%A0" target="_blank" rel="noopener">黄龙吐翠</a>、<a href="https://baike.baidu.com/item/%E7%8E%89%E7%9A%87%E9%A3%9E%E4%BA%91" target="_blank" rel="noopener">玉皇飞云</a>、<a href="https://baike.baidu.com/item/%E5%AE%9D%E7%9F%B3%E6%B5%81%E9%9C%9E" target="_blank" rel="noopener">宝石流霞</a>。</p>
<p>2007年，杭州市政府进行“三评西湖十景”和名称征集，<a href="https://baike.baidu.com/item/%E7%81%B5%E9%9A%90%E5%AF%BA" target="_blank" rel="noopener">灵隐寺</a>等一批景点入围，成为三评西湖十景。确定为<a href="https://baike.baidu.com/item/%E7%81%B5%E9%9A%90%E7%A6%85%E8%B8%AA" target="_blank" rel="noopener">灵隐禅踪</a>、<a href="https://baike.baidu.com/item/%E5%85%AD%E5%92%8C%E5%90%AC%E6%B6%9B" target="_blank" rel="noopener">六和听涛</a>、<a href="https://baike.baidu.com/item/%E5%B2%B3%E5%A2%93%E6%A0%96%E9%9C%9E" target="_blank" rel="noopener">岳墓栖霞</a>、<a href="https://baike.baidu.com/item/%E6%B9%96%E6%BB%A8%E6%99%B4%E9%9B%A8" target="_blank" rel="noopener">湖滨晴雨</a>、<a href="https://baike.baidu.com/item/%E9%92%B1%E7%A5%A0%E8%A1%A8%E5%BF%A0" target="_blank" rel="noopener">钱祠表忠</a>、<a href="https://baike.baidu.com/item/%E4%B8%87%E6%9D%BE%E4%B9%A6%E7%BC%98" target="_blank" rel="noopener">万松书缘</a>、<a href="https://baike.baidu.com/item/%E6%9D%A8%E5%A0%A4%E6%99%AF%E8%A1%8C" target="_blank" rel="noopener">杨堤景行</a>、<a href="https://baike.baidu.com/item/%E4%B8%89%E5%8F%B0%E4%BA%91%E6%B0%B4" target="_blank" rel="noopener">三台云水</a>、<a href="https://baike.baidu.com/item/%E6%A2%85%E5%9D%9E%E6%98%A5%E6%97%A9" target="_blank" rel="noopener">梅坞春早</a>、<a href="https://baike.baidu.com/item/%E5%8C%97%E8%A1%97%E6%A2%A6%E5%AF%BB" target="_blank" rel="noopener">北街梦寻</a>。</p>
<table>
<thead>
<tr>
<th>南宋时期</th>
<th>康熙题字</th>
<th>现代通用名</th>
<th>新西湖十景</th>
<th>三评西湖十景</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://baike.baidu.com/item/%E5%B9%B3%E6%B9%96%E7%A7%8B%E6%9C%88/71330" target="_blank" rel="noopener">平湖秋月</a></td>
<td>沿用</td>
<td>沿用</td>
<td><a href="https://baike.baidu.com/item/%E4%BA%91%E6%A0%96%E7%AB%B9%E5%BE%84" target="_blank" rel="noopener">云栖竹径</a></td>
<td><a href="https://baike.baidu.com/item/%E7%81%B5%E9%9A%90%E7%A6%85%E8%B8%AA" target="_blank" rel="noopener">灵隐禅踪</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E8%8B%8F%E5%A0%A4%E6%98%A5%E6%99%93" target="_blank" rel="noopener">苏堤春晓</a></td>
<td>沿用</td>
<td>沿用</td>
<td><a href="https://baike.baidu.com/item/%E4%B9%9D%E6%BA%AA%E7%83%9F%E6%A0%91" target="_blank" rel="noopener">九溪烟树</a></td>
<td><a href="https://baike.baidu.com/item/%E5%85%AD%E5%92%8C%E5%90%AC%E6%B6%9B" target="_blank" rel="noopener">六和听涛</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E6%96%AD%E6%A1%A5%E6%AE%8B%E9%9B%AA/7576" target="_blank" rel="noopener">断桥残雪</a></td>
<td>沿用</td>
<td>沿用</td>
<td><a href="https://baike.baidu.com/item/%E8%99%8E%E8%B7%91%E6%A2%A6%E6%B3%89" target="_blank" rel="noopener">虎跑梦泉</a></td>
<td><a href="https://baike.baidu.com/item/%E5%B2%B3%E5%A2%93%E6%A0%96%E9%9C%9E" target="_blank" rel="noopener">岳墓栖霞</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E9%9B%B7%E5%B3%B0%E5%A4%95%E7%85%A7" target="_blank" rel="noopener">雷峰夕照</a></td>
<td>雷峰西照</td>
<td>雷峰夕照</td>
<td><a href="https://baike.baidu.com/item/%E9%BB%84%E9%BE%99%E5%90%90%E7%BF%A0" target="_blank" rel="noopener">黄龙吐翠</a></td>
<td><a href="https://baike.baidu.com/item/%E6%B9%96%E6%BB%A8%E6%99%B4%E9%9B%A8" target="_blank" rel="noopener">湖滨晴雨</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E5%8D%97%E5%B1%8F%E6%99%9A%E9%92%9F/24619" target="_blank" rel="noopener">南屏晚钟</a></td>
<td>南屏晓钟</td>
<td>南屏晚钟</td>
<td><a href="https://baike.baidu.com/item/%E6%BB%A1%E9%99%87%E6%A1%82%E9%9B%A8" target="_blank" rel="noopener">满陇桂雨</a></td>
<td><a href="https://baike.baidu.com/item/%E9%92%B1%E7%A5%A0%E8%A1%A8%E5%BF%A0" target="_blank" rel="noopener">钱祠表忠</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E6%9B%B2%E9%99%A2%E9%A3%8E%E8%8D%B7/71334" target="_blank" rel="noopener">曲院风荷</a></td>
<td>沿用</td>
<td>沿用</td>
<td><a href="https://baike.baidu.com/item/%E7%8E%89%E7%9A%87%E9%A3%9E%E4%BA%91" target="_blank" rel="noopener">玉皇飞云</a></td>
<td><a href="https://baike.baidu.com/item/%E4%B8%87%E6%9D%BE%E4%B9%A6%E7%BC%98" target="_blank" rel="noopener">万松书缘</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E8%8A%B1%E6%B8%AF%E8%A7%82%E9%B1%BC" target="_blank" rel="noopener">花港观鱼</a></td>
<td>沿用</td>
<td>沿用</td>
<td><a href="https://baike.baidu.com/item/%E9%BE%99%E4%BA%95%E9%97%AE%E8%8C%B6" target="_blank" rel="noopener">龙井问茶</a></td>
<td><a href="https://baike.baidu.com/item/%E6%9D%A8%E5%A0%A4%E6%99%AF%E8%A1%8C" target="_blank" rel="noopener">杨堤景行</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E6%9F%B3%E6%B5%AA%E9%97%BB%E8%8E%BA/33243" target="_blank" rel="noopener">柳浪闻莺</a></td>
<td>沿用</td>
<td>沿用</td>
<td><a href="https://baike.baidu.com/item/%E5%AE%9D%E7%9F%B3%E6%B5%81%E9%9C%9E" target="_blank" rel="noopener">宝石流霞</a></td>
<td><a href="https://baike.baidu.com/item/%E4%B8%89%E5%8F%B0%E4%BA%91%E6%B0%B4" target="_blank" rel="noopener">三台云水</a></td>
</tr>
<tr>
<td><a href="https://baike.baidu.com/item/%E4%B8%89%E6%BD%AD%E5%8D%B0%E6%9C%88/37099" target="_blank" rel="noopener">三潭印月</a></td>
<td>沿用</td>
<td>沿用</td>
<td><a href="https://baike.baidu.com/item/%E5%90%B4%E5%B1%B1%E5%A4%A9%E9%A3%8E" target="_blank" rel="noopener">吴山天风</a></td>
<td><a href="https://baike.baidu.com/item/%E6%A2%85%E5%9D%9E%E6%98%A5%E6%97%A9" target="_blank" rel="noopener">梅坞春早</a></td>
</tr>
<tr>
<td>两峰插云</td>
<td>双峰插云</td>
<td><a href="https://baike.baidu.com/item/%E5%8F%8C%E5%B3%B0%E6%8F%92%E4%BA%91" target="_blank" rel="noopener">双峰插云</a></td>
<td><a href="https://baike.baidu.com/item/%E9%98%AE%E5%A2%A9%E7%8E%AF%E7%A2%A7" target="_blank" rel="noopener">阮墩环碧</a></td>
<td><a href="https://baike.baidu.com/item/%E5%8C%97%E8%A1%97%E6%A2%A6%E5%AF%BB" target="_blank" rel="noopener">北街梦寻</a></td>
</tr>
</tbody></table>
<h2 id="断桥残雪"><a href="#断桥残雪" class="headerlink" title="断桥残雪"></a>断桥残雪</h2><p>断桥残雪是西湖上著名的景色，以冬雪时远观桥面若隐若现于湖面而称著。属于西湖十景之一。断桥残雪是欣赏西湖雪景之佳地，中国著名的民间传说《白蛇传》，为断桥景物增添了浪漫的色彩。</p>
<p>·是《白蛇传》中许仙、白娘子的相会之地，也给这座长桥平添许多浪漫色彩。<br>·冬雪初下，桥的阳面冰雪消融，但阴面仍被残雪覆盖，从高处看桥似断非断，形成著名的“断桥残雪”。<br>·可以作为游玩西湖的起点。从断桥上白堤去孤山，依次游玩西湖周边的各个景点。</p>
<h2 id="白堤"><a href="#白堤" class="headerlink" title="白堤"></a>白堤</h2><p>白堤原名“白沙堤”，是将杭州市区与风景区相连的纽带，东起“断桥残雪”，经锦带桥向西，止于“平湖秋月”，长约2里。在唐即称白沙堤、沙堤，其后在宋、明又称孤山路、十锦塘。白堤横亘湖上，把西湖划分为外湖和里湖，并将孤山和北山连接在一起。白堤的风景，四季分明：春桃夏柳，秋桂冬雪，具是风采独特。</p>
<p>白堤原名白沙堤，为贮蓄湖水灌溉农田而建。旧日以白沙铺地，今已改为柏油路面。早在一千多年前的唐朝，就以风光旖旎而著称。人们以为这条堤是<a href="https://baike.baidu.com/item/%E7%99%BD%E5%B1%85%E6%98%93" target="_blank" rel="noopener">白居易</a>主持修筑的，就叫它白堤。实际上白居易任杭州刺史时，曾在旧日<a href="https://baike.baidu.com/item/%E9%92%B1%E5%A1%98%E9%97%A8" target="_blank" rel="noopener">钱塘门</a>外的石涵桥附近修筑了一条堤，称为白公堤，如今已经无迹可寻了。今日人们所知的白堤，虽与白居易主持修筑的白堤不在一个方位，但杭州人民为缅怀这位对杭州作出杰出贡献的“老市长”，仍把它命名为白堤。</p>
<h2 id="孤山"><a href="#孤山" class="headerlink" title="孤山"></a>孤山</h2><p>孤山位于浙江省杭州市西湖风景区旁，是西湖的一个著名景点。孤山是西湖中最大的岛屿，面积20公顷，山高38米，是文物胜迹荟萃之地。现有胜景30处，走在山间小径颇有山林的感觉。<br>主要景点有：放鹤亭、林和靖墓、西泠印社，玛瑙坡、一眼泉水、文澜阁、中山公园、清行宫、敬一书院、秋瑾墓、六一泉、苏曼殊墓园、半壁亭等。<br>孤山碧波环绕，山间花木繁茂，亭台楼阁错落别致，是一座融自然美和艺术美为一体的立体园林，闻其名便知，乃湖中一孤峙之岛，孤山景色早在唐宋已闻名遐迩，唐诗人白居易有“孤山寺北贾亭西，水面初平云脚低”，明代凌云翰有“冻木晨闻尾毕浦，孤山景好胜披图”的佳句。更有宋代隐居诗人林和靖墓寝，流传着有”梅妻鹤子”之说。<br>林逋是以杰出的咏梅诗词闻名于世的。他隐居孤山躬耕农桑并大量植梅，写出了不少咏梅佳句，其中《山园小梅》传出后脍炙人口，“疏影横斜水清浅，暗香浮动月黄昏”，在诗词界引起了轰动，成为从古至今咏梅的第一佳句，无人能与伦比。<br>冬天是探梅、赏雪胜地。孤山的雪景最为引人入胜。雪后山：“兀峙水中，后带葛岭，高低层叠，塑雪平铺；日光初照，与全湖波光相激射，璀璨夺目”。泛舟湖上，如见琼楼玉宇，遍山一色银装。若置峰山间，宜往放鹤亭踏雪寻梅，除了檀香梅急性先开，其他如宫粉梅俏丽香浓，朱砂梅紫艳色重，绿萼梅洁白素雅，洒金梅红白相间，各逞妖娆，各具情趣，扬眉有《孤山的梅》，更反映出对梅的追求与向往。</p>
<h2 id="曲院风荷"><a href="#曲院风荷" class="headerlink" title="曲院风荷"></a>曲院风荷</h2><p>曲院风荷位于西湖西侧，<a href="https://baike.baidu.com/item/%E5%B2%B3%E9%A3%9E%E5%BA%99/2182214" target="_blank" rel="noopener">岳飞庙</a>前面。南宋时，此有一座官家酿酒的作坊，取<a href="https://baike.baidu.com/item/%E9%87%91%E6%B2%99" target="_blank" rel="noopener">金沙</a>涧的溪水造曲酒，闻名国内。附近的池塘种有菱荷，每当夏日风起，酒香荷香沁人心脾，因名“曲院风荷”。总占地面积12.65万平方米，总建筑面积268000万平米。</p>
<h2 id="苏堤春晓"><a href="#苏堤春晓" class="headerlink" title="苏堤春晓"></a>苏堤春晓</h2><p>苏堤春晓，西湖十景之一。南宋时，苏堤春晓被列为西湖十景之首，元代又称之为“六桥烟柳”而列入钱塘十景。<br>“苏堤春晓”景观是指寒冬过后，苏堤报春的美妙景色。<br>苏堤南起南屏山麓，北到栖霞岭下，全长近三公里，是北宋大诗人苏东坡任杭州知州时，疏浚西湖，利用挖出的葑泥构筑而成。后人为了纪念苏东坡治理西湖的功绩将她命名为苏堤。长堤卧波，连接了南山北山，给西湖增添了一道妩媚的风景线。</p>
<h2 id="花港观鱼"><a href="#花港观鱼" class="headerlink" title="花港观鱼"></a>花港观鱼</h2><p>花港观鱼是由花、港、鱼为特色的风景点。<a href="https://baike.baidu.com/item/%E8%A5%BF%E6%B9%96%E5%8D%81%E6%99%AF/562" target="_blank" rel="noopener">西湖十景</a>之一。地处<a href="https://baike.baidu.com/item/%E8%8B%8F%E5%A0%A4" target="_blank" rel="noopener">苏堤</a>南段西侧。1964年二期扩建工程告竣后，占地面积达20公顷。全园分为红鱼池、<a href="https://baike.baidu.com/item/%E7%89%A1%E4%B8%B9%E5%9B%AD/74926" target="_blank" rel="noopener">牡丹园</a>、花港、<a href="https://baike.baidu.com/item/%E5%A4%A7%E8%8D%89%E5%9D%AA/3401892" target="_blank" rel="noopener">大草坪</a>、密林地五个景区。与<a href="https://baike.baidu.com/item/%E9%9B%B7%E5%B3%B0%E5%A1%94/427171" target="_blank" rel="noopener">雷峰塔</a>、<a href="https://baike.baidu.com/item/%E5%87%80%E6%85%88%E5%AF%BA/65580" target="_blank" rel="noopener">净慈寺</a>隔苏堤相望。</p>
<p>红鱼池位于园中部偏南处，是全园游赏的中心区域。池岸曲折自然，池中堆土成岛，池上架设曲桥，倚桥栏俯看，数千尾金鳞红鱼结队往来，泼刺戏水。</p>
<h2 id="吴山广场"><a href="#吴山广场" class="headerlink" title="吴山广场"></a>吴山广场</h2><p>吴山广场，位于杭州<a href="https://baike.baidu.com/item/%E4%B8%8A%E5%9F%8E%E5%8C%BA" target="_blank" rel="noopener">上城区</a>延安路1号，与杭州市中心<a href="https://baike.baidu.com/item/%E6%AD%A6%E6%9E%97%E5%B9%BF%E5%9C%BA/2839269" target="_blank" rel="noopener">武林广场</a>沿<a href="https://baike.baidu.com/item/%E5%BB%B6%E5%AE%89%E8%B7%AF/5911005" target="_blank" rel="noopener">延安路</a>南北呼应。占地8万平方米，1999年9月建成。是杭州主城区大型广场之一、距离<a href="https://baike.baidu.com/item/%E8%A5%BF%E6%B9%96/4668821" target="_blank" rel="noopener">西湖</a>水域最近的城市广场，<a href="https://baike.baidu.com/item/%E6%B2%B3%E5%9D%8A%E8%A1%97/5006437" target="_blank" rel="noopener">河坊街</a>、<a href="https://baike.baidu.com/item/%E6%9D%AD%E5%B7%9E%E5%8D%9A%E7%89%A9%E9%A6%86/5133976" target="_blank" rel="noopener">杭州博物馆</a>、<a href="https://baike.baidu.com/item/%E5%8D%97%E5%AE%8B%E5%BE%A1%E8%A1%97/2099138" target="_blank" rel="noopener">南宋御街</a>等旅游景点也紧邻吴山广场。<a href="https://baike.baidu.com/item/%E6%96%B0%E8%A5%BF%E6%B9%96%E5%8D%81%E6%99%AF/4551684" target="_blank" rel="noopener">新西湖十景</a>“<a href="https://baike.baidu.com/item/%E5%90%B4%E5%B1%B1%E5%A4%A9%E9%A3%8E/6342522" target="_blank" rel="noopener">吴山天风</a>”也位于此。</p>
<h2 id="西湖音乐喷泉"><a href="#西湖音乐喷泉" class="headerlink" title="西湖音乐喷泉"></a>西湖音乐喷泉</h2><p><a href="https://baike.baidu.com/item/%E8%A5%BF%E6%B9%96/4668821" target="_blank" rel="noopener">西湖</a>音乐喷泉位于湖滨三公园附近湖面上，长126米的“<a href="https://baike.baidu.com/item/%E9%9F%B3%E4%B9%90%E5%96%B7%E6%B3%89/1632227" target="_blank" rel="noopener">音乐喷泉</a>”向人们展露迷人风姿。 2016年5月1日晚间，西湖音乐喷泉经过大半年的整改，重新开放。</p>
<p>演出时间是每晚19:00、20:00各一场，每场播放三曲。</p>
<h2 id="灵隐飞来峰"><a href="#灵隐飞来峰" class="headerlink" title="灵隐飞来峰"></a>灵隐飞来峰</h2><p><a href="https://baike.baidu.com/item/%E7%81%B5%E9%9A%90/2696217" target="_blank" rel="noopener">灵隐</a>一带的山峰怪石嵯峨，风景绝异，印度僧人慧理称：“此乃中天竺国灵鹫山之小岭，不知何以飞来？”，因此称为“<a href="https://baike.baidu.com/item/%E9%A3%9E%E6%9D%A5%E5%B3%B0/13032771" target="_blank" rel="noopener">飞来峰</a>”。 飞来峰是江南少见的古代石窟艺术瑰宝，有着<a href="https://baike.baidu.com/item/%E5%A4%AA%E5%A7%A5%E5%B1%B1/607313" target="_blank" rel="noopener">太姥山</a>的灵石峭壁，<a href="https://baike.baidu.com/item/%E5%85%94%E8%80%B3%E5%B2%AD/15903933" target="_blank" rel="noopener">兔耳岭</a>的石峰见景之美，可与四川<a href="https://baike.baidu.com/item/%E5%A4%A7%E8%B6%B3%E7%9F%B3%E5%88%BB/209440" target="_blank" rel="noopener">大足石刻</a>媲美。<a href="https://baike.baidu.com/item/%E8%8B%8F%E4%B8%9C%E5%9D%A1/53970" target="_blank" rel="noopener">苏东坡</a>曾有“溪山处处皆可庐，最爱灵隐飞来峰”的诗句。</p>
<p>门票信息：45.00元（不含灵隐寺）灵隐寺：30.00元</p>
<p>开放时间：07:00~18:00</p>
<p><img data-src="https://gss0.bdstatic.com/94o3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D220/sign=288b38fca6c379317968812bdbc5b784/63d9f2d3572c11dff99745d96a2762d0f603c282.jpg" alt="杭州飞来峰"></p>
<h2 id="灵隐寺"><a href="#灵隐寺" class="headerlink" title="灵隐寺"></a>灵隐寺</h2><p><a href="https://baike.baidu.com/item/%E7%81%B5%E9%9A%90%E5%AF%BA/110918" target="_blank" rel="noopener">灵隐寺</a>，又名云林寺，位于<a href="https://baike.baidu.com/item/%E6%B5%99%E6%B1%9F%E7%9C%81" target="_blank" rel="noopener">浙江省</a><a href="https://baike.baidu.com/item/%E6%9D%AD%E5%B7%9E%E5%B8%82" target="_blank" rel="noopener">杭州市</a>，背靠<a href="https://baike.baidu.com/item/%E5%8C%97%E9%AB%98%E5%B3%B0/309548" target="_blank" rel="noopener">北高峰</a>，面朝<a href="https://baike.baidu.com/item/%E9%A3%9E%E6%9D%A5%E5%B3%B0/13032771" target="_blank" rel="noopener">飞来峰</a>，始建于<a href="https://baike.baidu.com/item/%E4%B8%9C%E6%99%8B/456028" target="_blank" rel="noopener">东晋</a>咸和元年（326年），占地面积约87000平方米。灵隐寺开山祖师为西印度僧人<a href="https://baike.baidu.com/item/%E6%85%A7%E7%90%86/3665551" target="_blank" rel="noopener">慧理</a><a href="https://baike.baidu.com/item/%E5%92%8C%E5%B0%9A/189974" target="_blank" rel="noopener">和尚</a>。<a href="https://baike.baidu.com/item/%E5%8D%97%E6%9C%9D/7131305" target="_blank" rel="noopener">南朝</a><a href="https://baike.baidu.com/item/%E6%A2%81%E6%AD%A6%E5%B8%9D" target="_blank" rel="noopener">梁武帝</a>赐田并扩建。五代<a href="https://baike.baidu.com/item/%E5%90%B4%E8%B6%8A%E7%8E%8B" target="_blank" rel="noopener">吴越王</a><a href="https://baike.baidu.com/item/%E9%92%B1%E9%95%A0" target="_blank" rel="noopener">钱镠</a>命请永明<a href="https://baike.baidu.com/item/%E5%BB%B6%E5%AF%BF%E5%A4%A7%E5%B8%88" target="_blank" rel="noopener">延寿大师</a>重兴开拓，并赐名灵隐新寺。<a href="https://baike.baidu.com/item/%E5%AE%8B%E5%AE%81%E5%AE%97/1242434" target="_blank" rel="noopener">宋宁宗</a>嘉定年间，灵隐寺被誉为江南禅宗“五山”之一。清顺治年间，禅宗巨匠具德和尚住持灵隐，筹资重建，仅建殿堂时间就前后历十八年之久，其规模之宏伟跃居“东南之冠”  。清康熙二十八年（1689年），<a href="https://baike.baidu.com/item/%E5%BA%B7%E7%86%99%E5%B8%9D/613801" target="_blank" rel="noopener">康熙帝</a>南巡时，赐名 “云林禅寺”。</p>
<p>灵隐寺主要以天王殿、大雄宝殿、药师殿、法堂、华严殿为中轴线，两边附以五百罗汉堂、济公殿、华严阁、大悲楼、方丈楼等建筑构成。现任方丈是光泉法师。</p>
<p>浙江灵隐寺为全国重点文物保护单位 。</p>
<h2 id="雷峰塔"><a href="#雷峰塔" class="headerlink" title="雷峰塔"></a>雷峰塔</h2><p>雷峰塔（Leifeng Pagoda）又名黄妃塔、皇妃塔、西关砖塔，位于<a href="https://baike.baidu.com/item/%E6%B5%99%E6%B1%9F%E7%9C%81/190275" target="_blank" rel="noopener">浙江省</a>会<a href="https://baike.baidu.com/item/%E6%9D%AD%E5%B7%9E%E5%B8%82/200167" target="_blank" rel="noopener">杭州市</a><a href="https://baike.baidu.com/item/%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%8C%BA/1361587" target="_blank" rel="noopener">西湖风景区</a>南岸夕照山的雷峰上。雷峰塔为<a href="https://baike.baidu.com/item/%E5%90%B4%E8%B6%8A" target="_blank" rel="noopener">吴越</a>忠懿王<a href="https://baike.baidu.com/item/%E9%92%B1%E5%BC%98%E4%BF%B6" target="_blank" rel="noopener">钱弘俶</a>因黄妃得子建，初名“皇妃塔”因地建于雷峰，后人改称“雷峰塔”。</p>
<p>中国民间故事《<a href="https://baike.baidu.com/item/%E7%99%BD%E8%9B%87%E4%BC%A0/17510" target="_blank" rel="noopener">白蛇传</a>》中，法海和尚骗<a href="https://baike.baidu.com/item/%E8%AE%B8%E4%BB%99/1817443" target="_blank" rel="noopener">许仙</a>至金山，<a href="https://baike.baidu.com/item/%E7%99%BD%E5%A8%98%E5%AD%90/328475" target="_blank" rel="noopener">白娘子</a>水漫金山救许仙，被<a href="https://baike.baidu.com/item/%E6%B3%95%E6%B5%B7/13681912" target="_blank" rel="noopener">法海</a>镇在雷峰塔下。后小青苦练法力，终于打败了法海，雷峰塔倒塌，白素贞获救。</p>
<p>旧雷峰塔已于1924年倒塌，后重建，新建的雷峰塔为中国首座彩色铜雕宝塔。<a href="https://baike.baidu.com/item/%E9%9B%B7%E5%B3%B0%E5%A4%95%E7%85%A7/2195468" target="_blank" rel="noopener">雷峰夕照</a>为<a href="https://baike.baidu.com/item/%E8%A5%BF%E6%B9%96%E5%8D%81%E6%99%AF/562" target="_blank" rel="noopener">西湖十景</a>之一。是西湖重要景区之一。</p>
<h2 id="柳浪闻莺"><a href="#柳浪闻莺" class="headerlink" title="柳浪闻莺"></a>柳浪闻莺</h2><p><a href="https://baike.baidu.com/item/%E6%9F%B3%E6%B5%AA%E9%97%BB%E8%8E%BA/33243" target="_blank" rel="noopener">柳浪闻莺</a>是<a href="https://baike.baidu.com/item/%E8%A5%BF%E6%B9%96" target="_blank" rel="noopener">西湖</a>十景之五，位于西湖东南岸，<a href="https://baike.baidu.com/item/%E6%B8%85%E6%B3%A2%E9%97%A8" target="_blank" rel="noopener">清波门</a>处的大型公园。分友谊、闻莺、聚景、南园四个景区。柳丛衬托着<a href="https://baike.baidu.com/item/%E7%B4%AB%E6%A5%A0/2038693" target="_blank" rel="noopener">紫楠</a>、雪松、广玉兰、梅花等异木名花。<a href="https://baike.baidu.com/item/%E5%8D%97%E5%AE%8B/457341" target="_blank" rel="noopener">南宋</a>时，这里是京城最大的<a href="https://baike.baidu.com/item/%E5%BE%A1%E8%8A%B1%E5%9B%AD/2146652" target="_blank" rel="noopener">御花园</a>，称<a href="https://baike.baidu.com/item/%E8%81%9A%E6%99%AF%E5%9B%AD/9713444" target="_blank" rel="noopener">聚景园</a>。当时园内有会芳殿和三堂、九亭，以及柳浪桥和学士桥。清代恢复柳浪闻莺旧景。有柳洲之名。其间黄莺飞舞，竞相啼鸣，故有“柳浪闻莺”之称。</p>
<h2 id="河坊街"><a href="#河坊街" class="headerlink" title="河坊街"></a>河坊街</h2><p>河坊街位于<a href="https://baike.baidu.com/item/%E5%90%B4%E5%B1%B1/14967" target="_blank" rel="noopener">吴山</a>脚下，是<a href="https://baike.baidu.com/item/%E6%B8%85%E6%B2%B3%E5%9D%8A/3021178" target="_blank" rel="noopener">清河坊</a>的一部分，属于杭州<a href="https://baike.baidu.com/item/%E8%80%81%E5%9F%8E%E5%8C%BA/1074312" target="_blank" rel="noopener">老城区</a>， 旧时，与中山中路相交得“清河坊四拐角”，自民国以来，分别为<a href="https://baike.baidu.com/item/%E5%AD%94%E5%87%A4%E6%98%A5%E9%A6%99%E7%B2%89%E5%BA%97/6703175" target="_blank" rel="noopener">孔凤春香粉店</a>、宓大昌旱烟、<a href="https://baike.baidu.com/item/%E4%B8%87%E9%9A%86/52150" target="_blank" rel="noopener">万隆</a>火腿店、张允升帽庄四家各踞一角，成为当时远近闻名得区片。</p>
<p>河坊街为杭州历史文化街区，街上最具影响的有<a href="https://baike.baidu.com/item/%E8%83%A1%E9%9B%AA%E5%B2%A9%E6%95%85%E5%B1%85/427332" target="_blank" rel="noopener">胡雪岩故居</a>和<a href="https://baike.baidu.com/item/%E6%9C%B1%E7%82%B3%E4%BB%81%E9%93%9C%E9%9B%95%E8%89%BA%E6%9C%AF%E5%8D%9A%E7%89%A9%E9%A6%86/8450477" target="_blank" rel="noopener">朱炳仁铜雕艺术博物馆</a>，成为此街的一大亮点。</p>
<p>河坊街位于吴山脚下，是清河坊的一部分，属于杭州老城区，东起江城路，向西越南北向得建国南路、中河中路、中山中路、华光路、劳动路至<a href="https://baike.baidu.com/item/%E5%8D%97%E5%B1%B1%E8%B7%AF/3117771" target="_blank" rel="noopener">南山路</a>，路长1800多米，<a href="https://baike.baidu.com/item/%E5%90%B4%E5%B1%B1%E5%B9%BF%E5%9C%BA/4236241" target="_blank" rel="noopener">吴山广场</a>至中山中路段为步行街，青石板路面，路宽13米，其余路宽32米。旧时，与中山中路相交得“清河坊四拐角”，自民国以来，分别为孔凤春香粉店、宓大昌旱烟、万隆火腿店、张允升帽庄四家各踞一角，成为当时远近闻名的区片。杭城闻名的“五杭”（杭粉、杭剪、杭扇、杭烟、杭线）就出与此。 这里特色小吃、 古玩字画、商铺云集。老字号、杭州特色各类店铺约有一百余家。</p>
]]></content>
  </entry>
  <entry>
    <title>Site Collection</title>
    <url>/2018/12/26/Site-Collection/</url>
    <content><![CDATA[<img data-src="https://images.unsplash.com/photo-1522542550221-31fd19575a2d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=500&q=60" width="100%"/>

<a id="more"></a>

<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><h3 id="10-Sites-for-Free-Stock-Photos"><a href="#10-Sites-for-Free-Stock-Photos" class="headerlink" title="10 Sites for Free Stock Photos"></a>10 Sites for Free Stock Photos</h3><ol>
<li><a href="https://unsplash.com/" target="_blank" rel="noopener">Unsplash</a></li>
<li><a href="https://gratisography.com/" target="_blank" rel="noopener">Gratisography</a></li>
<li><a href="https://morguefile.com/" target="_blank" rel="noopener">Morguefile</a></li>
<li><a href="https://pixabay.com/" target="_blank" rel="noopener">Pixabay</a></li>
<li><a href="http://www.stockvault.net/" target="_blank" rel="noopener">Stockvault</a></li>
<li><a href="https://www.pexels.com/" target="_blank" rel="noopener">Pexels</a></li>
<li><a href="https://picjumbo.com/" target="_blank" rel="noopener">Picjumbo</a></li>
<li><a href="https://www.pikwizard.com/" target="_blank" rel="noopener">Pikwizard</a></li>
<li><a href="https://www.rawpixel.com/" target="_blank" rel="noopener">Rawpixel</a></li>
<li><a href="https://www.reshot.com/" target="_blank" rel="noopener">Reshot</a></li>
</ol>
<h3 id="Wallroom"><a href="#Wallroom" class="headerlink" title="Wallroom"></a>Wallroom</h3><blockquote>
<p><a href="https://wallroom.io/" target="_blank" rel="noopener">高质量壁纸网站</a></p>
</blockquote>
<h2 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h2><h3 id="wikeHow"><a href="#wikeHow" class="headerlink" title="wikeHow"></a>wikeHow</h3><blockquote>
<p><a href="https://zh.wikihow.com" target="_blank" rel="noopener">任何人做任何事</a></p>
</blockquote>
<h3 id="程序员的个性化网址导航：GitNavi-com"><a href="#程序员的个性化网址导航：GitNavi-com" class="headerlink" title="程序员的个性化网址导航：GitNavi.com"></a><a href="http://www.gitnavi.com/u/judasn/" target="_blank" rel="noopener">程序员的个性化网址导航：GitNavi.com</a></h3><h2 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h2><p><a href="https://lai.yuweining.cn/" target="_blank" rel="noopener">不死鸟 - 分享为王</a></p>
<p><a href="http://www.yinwang.org/#" target="_blank" rel="noopener">当然我在扯淡</a></p>
<p><a href="https://www.liuchuo.net/" target="_blank" rel="noopener">柳婼 の blog</a> ——浙大柳神</p>
<p><a href="http://www.youmeek.com/" target="_blank" rel="noopener">YouMeek</a></p>
<p><a href="https://www.hifreud.com/" target="_blank" rel="noopener">Freud’s Blog</a></p>
<h2 id="开发者站点"><a href="#开发者站点" class="headerlink" title="开发者站点"></a>开发者站点</h2><p><a href="http://www.androidchina.net/" target="_blank" rel="noopener">Android 开发中文站</a></p>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><p><a href="https://github.com/apachecn/awesome-algorithm" target="_blank" rel="noopener">awesome-algorithm</a></p>
<h3 id="RESTful"><a href="#RESTful" class="headerlink" title="RESTful"></a>RESTful</h3><p><a href="https://github.com/restcookbook/restcookbook" target="_blank" rel="noopener">restcookbook</a></p>
<h3 id="Best-websites-a-programmer-should-visit"><a href="#Best-websites-a-programmer-should-visit" class="headerlink" title="Best-websites-a-programmer-should-visit"></a><a href="https://github.com/sdmg15/Best-websites-a-programmer-should-visit" target="_blank" rel="noopener">Best-websites-a-programmer-should-visit</a></h3><p>该仓库收集对程序员有用的网址，包含问题查找、技术新闻、技术博客、开源社区、英文提升、新奇的玩意儿、视频教程、在线工具等数十个方向的内容。</p>
<h3 id="适合后端开发者的前端-React-Admin"><a href="#适合后端开发者的前端-React-Admin" class="headerlink" title="适合后端开发者的前端 React-Admin"></a><a href="https://github.com/satan31415/umi-admin" target="_blank" rel="noopener">适合后端开发者的前端 React-Admin</a></h3><h3 id="List-of-Free-Learning-Resources"><a href="#List-of-Free-Learning-Resources" class="headerlink" title="List of Free Learning Resources"></a><a href="https://github.com/EbookFoundation/free-programming-books" target="_blank" rel="noopener">List of Free Learning Resources</a></h3><h3 id="Coding-Interview-University"><a href="#Coding-Interview-University" class="headerlink" title="Coding Interview University"></a><a href="https://github.com/jwasham/coding-interview-university" target="_blank" rel="noopener">Coding Interview University</a></h3><h2 id="GitBook"><a href="#GitBook" class="headerlink" title="GitBook"></a>GitBook</h2><h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><blockquote>
<p><a href="https://www.gitbook.com/book/alleniverson/java-design-patterns" target="_blank" rel="noopener">Java Design Patterns</a></p>
</blockquote>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><blockquote>
<p><a href="https://legacy.gitbook.com/book/yeasy/docker_practice" target="_blank" rel="noopener">Docker —— 从入门到实践</a></p>
</blockquote>
<h3 id="Linux-内核揭密（中文）"><a href="#Linux-内核揭密（中文）" class="headerlink" title="Linux 内核揭密（中文）"></a><a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/index.html" target="_blank" rel="noopener">Linux 内核揭密</a>（中文）</h3><p>本书是<a href="https://github.com/0xAX/linux-insides" target="_blank" rel="noopener">《Linux inside》</a>一书的中译，介绍 Linux 内核知识，从计算机通电讲起，需要 C 语言和汇编语言的知识。</p>
<h2 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h2><h3 id="IntelliJ-IDEA-使用教程"><a href="#IntelliJ-IDEA-使用教程" class="headerlink" title="IntelliJ IDEA 使用教程"></a><a href="http://wiki.jikexueyuan.com/project/intellij-idea-tutorial" target="_blank" rel="noopener">IntelliJ IDEA 使用教程</a></h3><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><h3 id="Office-模板和主题"><a href="#Office-模板和主题" class="headerlink" title="Office 模板和主题"></a><a href="https://templates.office.com/" target="_blank" rel="noopener">Office 模板和主题</a></h3>]]></content>
      <categories>
        <category>Collection</category>
      </categories>
      <tags>
        <tag>Site</tag>
      </tags>
  </entry>
  <entry>
    <title>Size of Object in Java</title>
    <url>/2020/09/17/Size-of-Object-in-Java/</url>
    <content><![CDATA[<img data-src="https://i.ytimg.com/vi/gaGEt0oYpBA/maxresdefault.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://www.jianshu.com/p/9d729c9c94c4" target="_blank" rel="noopener">如何计算Java对象所占内存的大小</a></p>
</blockquote>
<h2 id="Java-对象内存结构"><a href="#Java-对象内存结构" class="headerlink" title="Java 对象内存结构"></a>Java 对象内存结构</h2><p>在HotSpot虚拟机里，对象在堆内存中的存储布局可以划分为三个部分：对象头（Header）、实例数据（Instance Data）和对齐填充（Padding）。</p>
<h3 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h3><p>HotSpot 虚拟机对象的对象头部分包括两类信息。第一类是用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等，这部分数据的长度在32位和64位的虚拟机（未开启压缩指针）中分别为 32 个比特和 64 个比特，官方称它 为“Mark Word”。</p>
<p>对象头的另外一部分是类型指针（kclass），即对象指向它的类型元数据的指针，Java虚拟机通过这个指针来确定该对象是哪个类的实例。如果对象是一个Java数组，那在对象头中还必须有一块用于记录数组长度的数据。同样，这部分数据的长度在 32 位和 64 位的虚拟机（未开启指针压缩）中分别为32个比特和64个比特。</p>
<h4 id="指针压缩"><a href="#指针压缩" class="headerlink" title="指针压缩"></a>指针压缩</h4><p>从 JDK 1.6 update14 开始，64 bit JVM 正式支持了 <code>-XX:+UseCompressedOops</code> 这个可以压缩指针，起到节约内存占用的新参数。</p>
<p>所以，当开启指针压缩后，对象头的大小为：</p>
<p>32位虚拟机对象头大小= Mark Word（4B）+ kclass(4B) = 8B</p>
<p>64位虚拟机对象头大小= Mark Word（8B）+ kclass(4B) = 12B</p>
<h3 id="实例数据"><a href="#实例数据" class="headerlink" title="实例数据"></a>实例数据</h3><p>8 种基本类型和 reference 大小在虚拟机上都是固定的,见下表</p>
<table>
<thead>
<tr>
<th>Primitive Type</th>
<th>Memory Required(bytes)</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>1</td>
</tr>
<tr>
<td>byte</td>
<td>1</td>
</tr>
<tr>
<td>short</td>
<td>2</td>
</tr>
<tr>
<td>char</td>
<td>2</td>
</tr>
<tr>
<td>int</td>
<td>4</td>
</tr>
<tr>
<td>float</td>
<td>4</td>
</tr>
<tr>
<td>long</td>
<td>8</td>
</tr>
<tr>
<td>double</td>
<td>8</td>
</tr>
<tr>
<td>Reference</td>
<td>4</td>
</tr>
</tbody></table>
<h3 id="对齐填充"><a href="#对齐填充" class="headerlink" title="对齐填充"></a>对齐填充</h3><p>由于 HotSpot 虚拟机的自动内存管理系统要求对象起始地址必须是 8 字节的整数倍，换句话说就是任何对象的大小都必须是8字节的整数倍。对象头部分已经被精心设计成正好是8字节的倍数（1倍或者2倍），因此，如果对象实例数据部分没有对齐的话，就需要通过对齐填充来补全。</p>
<h2 id="使用-Instrumentation-获取对象大小"><a href="#使用-Instrumentation-获取对象大小" class="headerlink" title="使用 Instrumentation 获取对象大小"></a>使用 Instrumentation 获取对象大小</h2><blockquote>
<p><a href="https://www.iteye.com/blog/yueyemaitian-2033046" target="_blank" rel="noopener">一个对象占用多少字节？</a></p>
<p><a href="https://juejin.im/post/6844904022101475342" target="_blank" rel="noopener">https://juejin.im/post/6844904022101475342</a></p>
</blockquote>
<p><code>Instrumentation</code> 是 Java SE 5 引入的特性，通过构建一个独立于应用程序的代理程序（Agent），使用 <code>Instrumentation</code> 来监测和协助运行在 JVM 上的程序，甚至能够实现字节码修改。简单的说，<code>Instrumentation</code> 实现了一个虚拟机层面的 AOP 。</p>
<p>这个类的唯一实现类 InstrumentationImpl 的构造方法是私有的，在创建时，需要依赖一个 nativeAgent，和运行环境所支持的一些预定义类信息，我们在代码中无法直接实例化它，需要在 JVM 启动时，通过指定代理的方式，让 JVM 来实例化它。</p>
<p>使用 <code>Instrumentation</code> 的 <code>getObjectSize()</code> 方法获取对象大小。</p>
<p><code>Instrumentation</code> 作为代理程序，使用虚拟机参数 javaagent 来指定。</p>
<h3 id="Instrumentation-的使用"><a href="#Instrumentation-的使用" class="headerlink" title="Instrumentation 的使用"></a><code>Instrumentation</code> 的使用</h3><ol>
<li><p>创建代理类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectShallowSize</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Instrumentation inst;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String agentArgs, Instrumentation instP)</span> </span>&#123;</span><br><span class="line">        inst = instP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">sizeOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> inst.getObjectSize(o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打包</p>
<p>在 ObjectShallowSize.java 路径下新建 /META-INF/MANIFEST.MF 指定 Premain-Class 内容为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Manifest-Version: 1.0</span><br><span class="line">Premain-Class: ObjectShallowSize</span><br></pre></td></tr></table></figure>

<p>编译 ObjectShallowSize.java</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">javac ObjectShallowSize.java</span><br></pre></td></tr></table></figure>

<p>打包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jar cvfm java-agent-sizeof.jar META-INF/MANIFEST.MF .</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<p>创建测试类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSizeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(ObjectShallowSize.sizeOf(<span class="keyword">new</span> ObjectSizeTest()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译测试类</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">javac ObjectSizeTest.java</span><br></pre></td></tr></table></figure>

<p>运行测试类</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -javaagent:java-agent-sizeof.jar ObjectSizeTest</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><img data-src="/post_image/image-20200917150706508.png" alt="image-20200917150706508"></p>
<p>理论值：Mark Word（8B）+ kclass(4B) + Padding(4B) = <code>16B</code></p>
<p>实际值：<code>16B</code></p>
<h4 id="添加实例变量"><a href="#添加实例变量" class="headerlink" title="添加实例变量"></a>添加实例变量</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSizeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(ObjectShallowSize.sizeOf(<span class="keyword">new</span> ObjectSizeTest()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>理论值：Mark Word（8B）+ kclass(4B) + i(4B) = <code>16B</code></p>
<p>实际值:<code>16B</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSizeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(ObjectShallowSize.sizeOf(<span class="keyword">new</span> ObjectSizeTest()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>理论值：Mark Word（8B）+ kclass(4B) + i(4B) + j(4B)+Padding(4B) = <code>24B</code></p>
<p>实际值：<code>24B</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class ObjectSizeTest &#123;</span><br><span class="line"></span><br><span class="line">    private int i;</span><br><span class="line">    private int j;</span><br><span class="line">    private String s;</span><br><span class="line">    private boolean aBoolean;</span><br><span class="line">    private char c;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(ObjectShallowSize.sizeOf(new ObjectSizeTest()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>理论值：Mark Word（8B）+ kclass(4B) + i(4B) + j(4B) + aBoolean(1B) + c(2B) + Paddding(1B) + s(4B) + Paddding(4B) = <code>32B</code></p>
<p>实际值：<code>32B</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class ObjectSizeTest &#123;</span><br><span class="line"></span><br><span class="line">    private String s;</span><br><span class="line">    private int i1;</span><br><span class="line">    private byte b1;</span><br><span class="line">    private byte b2;</span><br><span class="line">    private int i2;</span><br><span class="line">    private Object obj;</span><br><span class="line">    private byte b3;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(ObjectShallowSize.sizeOf(new ObjectSizeTest()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>理论值：Mark Word（8B）+ kclass(4B) + s(4B) + i1(4B) + b1(1B) + b2(1B) +  2(padding) + i2(4B) + obj(4B)+ b3(1B) + Paddding(7B) = <code>40B</code></p>
<p>实际值：<code>32B</code></p>
<p>HotSpot虚拟机中，实例字段的存储顺序会受到虚拟机分配策略参数（<code>-XX：FieldsAllocationStyle</code> 参数）和字段在 Java 源码中定义顺序的影响。<br>HotSpot 虚拟机默认的分配顺序为 longs/doubles、ints、shorts/chars、bytes/booleans、oops（Ordinary Object Pointers，OOPs），从以上默认的分配策略中可以看到，相同宽度的字段总是被分配到一起存<br>放，在满足这个前提条件的情况下，在父类中定义的变量会出现在子类之前。如果HotSpot虚拟机的 <code>+XX：CompactFields</code> 参数值为true（默认就为true），那子类之中较窄的变量也允许插入父类变量的空隙之中，以节省出一点点空间。</p>
<p>因此上述情况下，内存分配情况为：</p>
<p>理论值：Mark Word（8B）+ kclass(4B) + i1(4B) + i2(4B) + b1(1B) + b2(1B) + b3(1B) + Paddding(1B) + s(4B) + obj(4B) = <code>32B</code></p>
<p>实际值：<code>32B</code></p>
<p>对于实例变量为对象的，实际应该通过反射机制取出 Java 对象中实例变量，递归计算累加出实际大小。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectShallowSize</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Instrumentation inst;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> agentArgs 是 premain 函数得到的程序参数，随同 “– javaagent”一起传入。</span></span><br><span class="line"><span class="comment">     *                  与 main 函数不同的是，这个参数是一个字符串而不是一个字符串数组，如果程序参数有多个，程序将自行解析这个字符串。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> instP     是一个 java.lang.instrument.Instrumentation 的实例，由 JVM 自动传入。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bli@skystartrade.com</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2020-09-17 11:54</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String agentArgs, Instrumentation instP)</span> </span>&#123;</span><br><span class="line">        inst = instP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接计算当前对象占用空间大小，包括</span></span><br><span class="line"><span class="comment">     * 当前类及超类的基本类型实例字段大小、</span></span><br><span class="line"><span class="comment">     * 引用类型实例字段引用大小、</span></span><br><span class="line"><span class="comment">     * 实例基本类型数组总占用空间、</span></span><br><span class="line"><span class="comment">     * 实例引用类型数组引用本身占用空间大小</span></span><br><span class="line"><span class="comment">     * &lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 但是不包括超类继承下来的和当前类声明的实例引用字段的对象本身的大小、</span></span><br><span class="line"><span class="comment">     * 实例引用数组引用的对象本身的大小</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bli@skystartrade.com</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2020-09-17 17:09</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">sizeOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> inst.getObjectSize(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归计算当前对象占用空间总大小，包括当前类和超类的实例字段大小以及实例字段引用对象大小</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bli@skystartrade.com</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2020-09-17 17:12</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">fullSizeOf</span><span class="params">(Object objP)</span> <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        Set&lt;Object&gt; visited = <span class="keyword">new</span> HashSet&lt;Object&gt;();</span><br><span class="line">        <span class="comment">// 双端队列（Double Ended Queue）</span></span><br><span class="line">        Deque&lt;Object&gt; toBeQueue = <span class="keyword">new</span> ArrayDeque&lt;Object&gt;();</span><br><span class="line">        toBeQueue.add(objP);</span><br><span class="line">        <span class="keyword">long</span> size = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">while</span> (toBeQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Object obj = toBeQueue.poll();</span><br><span class="line">            <span class="comment">// sizeOf的时候已经计基本类型和引用的长度，包括数组</span></span><br><span class="line">            size += skipObject(visited, obj) ? <span class="number">0L</span> : sizeOf(obj);</span><br><span class="line">            Class&lt;?&gt; tmpObjClass = obj.getClass();</span><br><span class="line">            <span class="keyword">if</span> (tmpObjClass.isArray()) &#123;</span><br><span class="line">                <span class="comment">// 基本类型名字长度是2，例如 int[] -&gt; "[I"</span></span><br><span class="line">                <span class="keyword">if</span> (tmpObjClass.getName().length() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, len = Array.getLength(obj); i &lt; len; i++) &#123;</span><br><span class="line">                        Object tmp = Array.get(obj, i);</span><br><span class="line">                        <span class="keyword">if</span> (tmp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="comment">// 非基本类型需要深度遍历其对象</span></span><br><span class="line">                            toBeQueue.add(Array.get(obj, i));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (tmpObjClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    Field[] fields = tmpObjClass.getDeclaredFields();</span><br><span class="line">                    <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (Modifier.isStatic(field.getModifiers())   <span class="comment">//静态不计</span></span><br><span class="line">                                || field.getType().isPrimitive()) &#123;    <span class="comment">//基本类型不重复计</span></span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                        Object fieldValue = field.get(obj);</span><br><span class="line">                        <span class="keyword">if</span> (fieldValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        toBeQueue.add(fieldValue);</span><br><span class="line">                    &#125;</span><br><span class="line">                    tmpObjClass = tmpObjClass.getSuperclass();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * String.intern的对象不计；</span></span><br><span class="line"><span class="comment">     * 计算过的不计，也避免死循环</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bli@skystartrade.com</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2020-09-17 17:15</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">skipObject</span><span class="params">(Set&lt;Object&gt; visited, Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String &amp;&amp; obj == ((String) obj).intern()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> visited.contains(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Softs and Tools</title>
    <url>/2018/12/27/Softs-and-Tools/</url>
    <content><![CDATA[<img data-src="https://images.pexels.com/photos/147413/twitter-facebook-together-exchange-of-information-147413.jpeg?cs=srgb&dl=app-applications-apps-147413.jpg&fm=jpg" width="100%"/>

<a id="more"></a>

<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><h3 id="截屏"><a href="#截屏" class="headerlink" title="截屏"></a>截屏</h3><p><strong>FastStone</strong></p>
<blockquote>
<p><a href="https://blog.csdn.net/moxiaoya1314/article/details/79952787" target="_blank" rel="noopener">FastStone Capture(FSCapture) 注册码</a></p>
</blockquote>
<h2 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h2><h3 id="录屏"><a href="#录屏" class="headerlink" title="录屏"></a>录屏</h3><blockquote>
<p><a href="https://www.bandicam.cn/" target="_blank" rel="noopener">Bandicam</a></p>
<p><a href="https://www.52pojie.cn/thread-657951-1-1.html" target="_blank" rel="noopener">Bandicam万能注册机</a></p>
</blockquote>
<h3 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h3><blockquote>
<p><a href="https://www.adobe.com/cn/products/premiere/free-trial-download.html" target="_blank" rel="noopener">Premiere Pro</a></p>
<p><a href="http://www.carrotchou.blog/7783.html" target="_blank" rel="noopener">Adobe Premiere Pro CC 2018 v12.1.2 特别破解版</a></p>
</blockquote>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><h3 id="IDM"><a href="#IDM" class="headerlink" title="IDM"></a>IDM</h3><blockquote>
<p><a href="https://blog.csdn.net/miao_9/article/details/72852903" target="_blank" rel="noopener">配置IDM不限速下载百度云的大文件</a></p>
<p><a href="https://www.internetdownloadmanager.com/" target="_blank" rel="noopener">下载最新版本IDM</a> </p>
</blockquote>
<p>Internet Download Manager（简称IDM）是一个用于Windows系统的下载管理器，它是共享软件，免费试用期为30天，但是每月均有一段时间优惠。</p>
]]></content>
      <categories>
        <category>Software</category>
      </categories>
      <tags>
        <tag>Tool</tag>
        <tag>Software</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Boot And Template Engine</title>
    <url>/2020/03/17/Spring-Boot-And-Template-Engine/</url>
    <content><![CDATA[<img data-src="https://image.slidesharecdn.com/comparing-template-engines-jvm-131107023934-phpapp01/95/shootout-template-engines-for-the-jvm-6-638.jpg?cb=1432717139" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://spring.io/blog/2012/10/30/spring-mvc-from-jsp-and-tiles-to-thymeleaf" target="_blank" rel="noopener">Spring MVC: from JSP and Tiles to Thymeleaf</a></p>
</blockquote>
<h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><blockquote>
<p><a href="https://www.tutorialspoint.com/spring_boot/spring_boot_thymeleaf.htm" target="_blank" rel="noopener">Spring Boot - Thymeleaf - Tutorialspoint</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Spring Boot Hot Swap with Intellij IDEA</title>
    <url>/2019/12/04/Spring-Boot-Hot-Swap-with-Intellij-IDEA/</url>
    <content><![CDATA[<img data-src="https://i.ytimg.com/vi/VWF7vCJSqrA/maxresdefault.jpg" width="100%"/>

<a id="more"></a>

<h2 id="Spring-Boot-热部署"><a href="#Spring-Boot-热部署" class="headerlink" title="Spring Boot 热部署"></a>Spring Boot 热部署</h2><blockquote>
<p><a href="https://dzone.com/articles/spring-boot-application-live-reload-hot-swap-with" target="_blank" rel="noopener">Spring Boot Application Live Reload (Hot Swap) With Intellij IDEA</a></p>
<p><a href="https://www.youtube.com/watch?v=VWF7vCJSqrA" target="_blank" rel="noopener">Spring Boot 101 (Part 8) - Live Reload / Hot Swap | YouTube</a></p>
<p><a href="https://blog.csdn.net/sdaujsj1/article/details/101992877" target="_blank" rel="noopener">springboot idea 热部署配置</a></p>
</blockquote>
<ol>
<li><p>添加 devtool 依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：还需要添加 maven 插件，否则无效</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>IDEA 开启自动编译</p>
<p>Settings –&gt; Build, Execution, Deployment –&gt; Compiler –&gt; Build project automatically</p>
</li>
<li><p>IDEA 开启 automake 功能</p>
<p><code>CTRL + SHIFT + ALT + /</code> –&gt; Registry –&gt; compiler.automake.allow.when.app.running</p>
<p>注意：调整触发热部署的延迟时间</p>
<p>compiler.automake.trigger.delay</p>
<p>compiler.document.save.trigger.delay</p>
</li>
<li><p>IDEA 配置更新时触发事件</p>
<p>Edit Configuration –&gt; On ‘Update’ action –&gt; Update classes and resources</p>
<p>注意：官方不推荐设置在失焦(On frame deactivation)的时候更新</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Spring-Boot</category>
      </categories>
      <tags>
        <tag>Hot-Swap</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Boot Mutiple Environment Configuration</title>
    <url>/2019/11/28/Spring-Boot-Mutiple-Environment-Configuration/</url>
    <content><![CDATA[<img data-src="https://miamioh.edu/_files/images/it-services/news-articles/2017/08/dev-graphic.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="http://www.jerome.xin/articles/spring-boot-multi-environment-configuration" target="_blank" rel="noopener">Spring Boot 多环境配置</a></p>
</blockquote>
<h2 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># common properties</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">@profiles.active@</span></span><br></pre></td></tr></table></figure>



<h2 id="application-dev-yml"><a href="#application-dev-yml" class="headerlink" title="application-dev.yml"></a>application-dev.yml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># dev properties</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>



<h2 id="application-test-yml"><a href="#application-test-yml" class="headerlink" title="application-test.yml"></a>application-test.yml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># test properties</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>



<h2 id="application-prod-yml"><a href="#application-prod-yml" class="headerlink" title="application-prod.yml"></a>application-prod.yml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># prod properties</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure>



<h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Development environment --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Test environment --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>test<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Production environment --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="HelloController-java"><a href="#HelloController-java" class="headerlink" title="HelloController.java"></a>HelloController.java</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gzhennaxia.admin.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bo li</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-11-28 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.profiles.active&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String environment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"env"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"The Environment is "</span> + environment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/11/28/zqRYIDZbMgh7JLs.png" alt=""></p>
<h2 id="环境切换"><a href="#环境切换" class="headerlink" title="环境切换"></a>环境切换</h2><h3 id="默认环境"><a href="#默认环境" class="headerlink" title="默认环境"></a>默认环境</h3><p>在项目的<code>pom.xml</code>中，使用<code>&lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</code>这段配置，定义了<code>dev</code>为项目的默认环境。所以当开发中启动项目会默认使用<code>application-dev.yml</code>的配置。在控制台的日志的第二行会有这么一段日志<code>The following profiles are active: dev</code>，表示已经加载了开发环境相关的配置。</p>
<h3 id="通过Maven打包时指定环境"><a href="#通过Maven打包时指定环境" class="headerlink" title="通过Maven打包时指定环境"></a>通过<code>Maven</code>打包时指定环境</h3><p>使用<code>Maven</code>命令<code>mvn clean package -Pprod</code>对项目的进行打包，然后直接使用<code>java -jar xxx.jar</code>命令启动项目。会发现日志输出了<code>The following profiles are active: prod</code>，说明使用的是生产环境。</p>
<h3 id="使用命令启动时指定环境"><a href="#使用命令启动时指定环境" class="headerlink" title="使用命令启动时指定环境"></a>使用命令启动时指定环境</h3><p>首先使用<code>Maven</code>命令<code>mvn clean package</code>对项目进行打包，然后先使用<code>java -jar xxx.jar</code>命令启动项目。会发现日志输出了<code>The following profiles are active: dev</code>，说明启动的是开发环境。接下来使用<code>java -jar xxx.jar --spring.profiles.active=test</code>命令启动项目，会发现日志输出了<code>The following profiles are active: test</code>。</p>
]]></content>
      <categories>
        <category>Spring-Boot</category>
      </categories>
      <tags>
        <tag>Spring-Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Tour 2020</title>
    <url>/2020/01/03/Spring-Tour-2020/</url>
    <content><![CDATA[<img data-src="https://image.freepik.com/free-vector/2020_147586-36.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="http://www.visitbeijing.com.cn/" target="_blank" rel="noopener">北京旅游网</a></p>
</blockquote>
<h2 id="总揽"><a href="#总揽" class="headerlink" title="总揽"></a>总揽</h2><iframe  width='100%' height='700' frameBorder='0' src='https://libo9527.github.io/static/map/amap/2020-0124-0131/all/index.html'>
</iframe>

<h2 id="往返线路"><a href="#往返线路" class="headerlink" title="往返线路"></a>往返线路</h2><iframe  width='100%' height='700' frameBorder='0' src='https://libo9527.github.io/static/map/amap/2020-0124-0131/round-trip-route-map/index.html'>
</iframe>

<h3 id="深圳-北京"><a href="#深圳-北京" class="headerlink" title="深圳 - 北京"></a>深圳 - 北京</h3><table>
<thead>
<tr>
<th>车次/航班</th>
<th>起始站</th>
<th>终点站</th>
<th>起始时间</th>
<th>到达时间</th>
<th>票价</th>
<th>状态</th>
<th>乘客</th>
<th>渠道</th>
<th>账号</th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://www.huochepiao.com/search/chaxun/resultc.asp?txtCheCi=K1348" target="_blank" rel="noopener">K1348</a></td>
<td>深圳</td>
<td>长沙</td>
<td>2020-01-24 08:10</td>
<td>2020-01-24 18:13</td>
<td>硬座：112</td>
<td><sapn style="color: green; font-weight: bolder;">已出票</span></td>
<td>李博</td>
<td>12306</td>
<td>twhssz</td>
</tr>
<tr>
<td>海航HU7136</td>
<td>长沙黄花机场T2</td>
<td>北京首都机场T1</td>
<td>2020-01-24 21:45</td>
<td>2020-01-24 23:55</td>
<td>机票：¥238<br />燃油：¥50</td>
<td><sapn style="color: green; font-weight: bolder;">已出票</span></td>
<td>李博</td>
<td></td>
<td></td>
</tr>
<tr>
<td>K6618</td>
<td>深圳</td>
<td>长沙</td>
<td>2020-01-17 01:05</td>
<td>2020-01-18 11:50</td>
<td>候补：113</td>
<td><sapn style="color: #E99B47; font-weight: bolder;">候补中</span></td>
<td>李博</td>
<td>12306</td>
<td><a href="mailto:871759358@qq.com">871759358@qq.com</a></td>
</tr>
<tr>
<td></td>
<td>长沙</td>
<td>北京西</td>
<td></td>
<td></td>
<td></td>
<td><sapn style="color: red; font-weight: bolder;">未定</span></td>
<td>李博</td>
<td></td>
<td></td>
</tr>
<tr>
<td>中国联合航空KN5806</td>
<td>岳阳</td>
<td>北京</td>
<td>2020-01-20 15:40</td>
<td>2020-01-20 18:00</td>
<td>机票：200<br />机建燃油：50</td>
<td><sapn style="color: green; font-weight: bolder;">已出票</span></td>
<td>李博</td>
<td>飞猪</td>
<td>18598046892</td>
</tr>
<tr>
<td>K6608</td>
<td>广州</td>
<td>长沙</td>
<td>2020-01-18 23:39</td>
<td>2020-01-19 07:57</td>
<td>候补硬座：98</td>
<td><sapn style="color: #E99B47; font-weight: bolder;">候补中</span></td>
<td>李博</td>
<td>12306</td>
<td>twhssz</td>
</tr>
<tr>
<td>Z168</td>
<td>广州东</td>
<td>长沙</td>
<td>2020-01-18 22:56</td>
<td>2020-01-19 07:01</td>
<td>候补硬座：98</td>
<td><sapn style="color: #E99B47; font-weight: bolder;">候补中</span></td>
<td>李博</td>
<td>12306</td>
<td>twhssz</td>
</tr>
<tr>
<td>Z122</td>
<td>广州</td>
<td>长沙</td>
<td>2020-01-18 22:18</td>
<td>2020-01-19 05:28</td>
<td>候补硬座：98</td>
<td><sapn style="color: #E99B47; font-weight: bolder;">候补中</span></td>
<td>李博</td>
<td>12306</td>
<td>18829718001</td>
</tr>
<tr>
<td>K436</td>
<td>广州</td>
<td>长沙</td>
<td>2020-01-18 22:31</td>
<td>2020-01-19 06:28</td>
<td>候补硬座：98</td>
<td><sapn style="color: #E99B47; font-weight: bolder;">候补中</span></td>
<td>李博</td>
<td>12306</td>
<td>18829718001</td>
</tr>
<tr>
<td>K9013</td>
<td>东莞东</td>
<td>长沙</td>
<td>2020-01-18 19:52</td>
<td>2020-01-19 05:50</td>
<td>候补硬座：129</td>
<td><sapn style="color: #E99B47; font-weight: bolder;">候补中</span></td>
<td>李博</td>
<td>12306</td>
<td><a href="mailto:752797707@qq.com">752797707@qq.com</a></td>
</tr>
<tr>
<td>K437</td>
<td>东莞东</td>
<td>长沙</td>
<td>2020-01-18 20:49</td>
<td>2020-01-19 06:28</td>
<td>候补硬座：129</td>
<td><sapn style="color: #E99B47; font-weight: bolder;">候补中</span></td>
<td>李博</td>
<td>12306</td>
<td><a href="mailto:752797707@qq.com">752797707@qq.com</a></td>
</tr>
<tr>
<td></td>
<td>深圳</td>
<td>东莞东</td>
<td></td>
<td></td>
<td></td>
<td><sapn style="color: red; font-weight: bolder;">未定</span></td>
<td>李博</td>
<td>12306</td>
<td></td>
</tr>
<tr>
<td></td>
<td>深圳</td>
<td>长沙</td>
<td></td>
<td></td>
<td></td>
<td><sapn style="color: red; font-weight: bolder;">未定</span></td>
<td>李博</td>
<td>12306</td>
<td></td>
</tr>
<tr>
<td></td>
<td>深圳</td>
<td>广州</td>
<td></td>
<td></td>
<td></td>
<td><sapn style="color: red; font-weight: bolder;">未定</span></td>
<td>李博</td>
<td>12306</td>
<td></td>
</tr>
</tbody></table>
<h3 id="大荔-北京"><a href="#大荔-北京" class="headerlink" title="大荔 - 北京"></a>大荔 - 北京</h3><table>
<thead>
<tr>
<th>车次/航班</th>
<th>起始站</th>
<th>终点站</th>
<th>起始时间</th>
<th>到达时间</th>
<th>票价</th>
<th>状态</th>
<th>乘客</th>
<th>渠道</th>
<th>账号</th>
</tr>
</thead>
<tbody><tr>
<td>D2518</td>
<td>大荔</td>
<td>太原南</td>
<td>2020-01-15 13:38</td>
<td>2020-01-15 16:45</td>
<td>二等座：¥143/人</td>
<td><sapn style="color: green; font-weight: bolder;">已出票</span><br/><sapn style="color: #31E69D; font-weight: bolder;">1 车 6D、6F号</span></td>
<td>阿爸、阿妈</td>
<td>12306</td>
<td>阿姐</td>
</tr>
<tr>
<td>G624</td>
<td>太原南</td>
<td>北京西</td>
<td>2020-01-15 18:07</td>
<td>2020-01-15 20:57</td>
<td>二等座：¥197/人</td>
<td><sapn style="color: green; font-weight: bolder;">已出票</span><br/><sapn style="color: #31E69D; font-weight: bolder;">11 车 10D、10F号</span></td>
<td>阿爸、阿妈</td>
<td>12306</td>
<td>阿姐</td>
</tr>
</tbody></table>
<h2 id="行程规划"><a href="#行程规划" class="headerlink" title="行程规划"></a>行程规划</h2><h2 id="景点手册"><a href="#景点手册" class="headerlink" title="景点手册"></a>景点手册</h2><blockquote>
<p><a href="http://www.horiba.com/fileadmin/uploads/Scientific/Documents/Events/2016/Beijing_travel.pdf" target="_blank" rel="noopener">北京 | 携程 </a></p>
<p><a href="http://www.backpackers.com.tw/forum/attachment.php?attachmentid=190843&d=1271301962" target="_blank" rel="noopener">游多多官方系列攻略—北京</a></p>
<p><a href="http://m.tuniucdn.com/filebroker/cdn/olb/01/99/0199c00a574af76ec137aed7cb2bc8e3.pdf?alias=" target="_blank" rel="noopener">皇城脚下• 锦绣都城 | 途牛</a></p>
<p><a href="https://bigfile.mafengwo.net/s9/M00/F2/29/wKgBs1awezyAaaNsAGMMhOS7IMs700.pdf" target="_blank" rel="noopener">北京 | 蚂蜂窝</a></p>
</blockquote>
<h3 id="关于北京"><a href="#关于北京" class="headerlink" title="关于北京"></a>关于北京</h3><h4 id="区域分化"><a href="#区域分化" class="headerlink" title="区域分化"></a>区域分化</h4><p>北京一共 16 个区，大约由四环路以内的中心城区和十个边缘集团组成。二环路以内的东城、西城两个区是传统上的中心城区。随着城市的扩张，朝阳区、海淀区、丰台区和石景山区也被认为是城内地区，形成了“城六区”的概念。</p>
<ul>
<li><p>城六区之中心城区(2)<br>  东城区、西城区</p>
</li>
<li><p>城六区之近郊区(4)</p>
<p>朝阳区、丰台区、石景山区、海淀区</p>
</li>
<li><p>远郊区(10)<br>门头沟区、房山区、通州区、顺义区、昌平区、大兴区、怀柔区、平谷区、密云区、延庆区、</p>
</li>
</ul>
<p><img data-src="https://img.vim-cn.com/b6/931274eab4b8efc975a15eba0ac286c5c88f64.jpg" alt="image.png"></p>
<h4 id="环路"><a href="#环路" class="headerlink" title="环路"></a>环路</h4><p>北京的二环三环指的是环城快速路。自2018年8月20日大七环全线通车以来，北京一共有二环、三环、四环、五环、六环、七环六条环城高速路。</p>
<p><img data-src="http://5b0988e595225.cdn.sohucs.com/images/20180831/21272b8b9d7a45e7b7505be76a6f7b81.jpeg" alt=""></p>
<h5 id="一环"><a href="#一环" class="headerlink" title="一环"></a>一环</h5><p><img data-src="http://5b0988e595225.cdn.sohucs.com/images/20180831/281e55bd73ab452fba0dfd140df4fa87.jpeg" alt=""></p>
<p>上个世纪50年代初，北京内外城城墙还都在。在内城有条环路，走有轨电车,这条有轨电车线路围绕紫禁城环绕一圈。从天安门前开始，往西到西单；折向北，过西四，到平安里（现改为平安大道）；折向东，到地安门；折向北，到鼓楼；折向东，过交道口到北新桥；折向南，过东四到东单；折向西，回到天安门前。这就是北京的一环，现已不再认为是环路。</p>
<h5 id="二环"><a href="#二环" class="headerlink" title="二环"></a>二环</h5><p>二环路全长32.7公里。是在原来的<strong>北京城墙</strong>的位置上修建的城市快速环路。在地上工程进行的同时，地下修建了环线地铁。于20世纪60年代起建，<strong>晚于三环</strong>的20世纪50年代末。其中，在内城墙基础上的北半环1980年底全线通车；在外城基础上的南半环在1991年底通车。1992年，北京也是中国第一条全封闭、全立交、没有交通信号灯的城市快速路——二环路全线竣工通车。</p>
<h5 id="三环"><a href="#三环" class="headerlink" title="三环"></a>三环</h5><p>三环路全长48.3公里，始建于20世纪50年代，<strong>比二环还要早</strong>。东、南、北三环早于1958年建成通车，那时人们<strong>将东、南、北三段俗称为“三环路”</strong>，西三环1981年底建成通车。三环路是北京第一条建成通车的环路。经80年代多处改扩建，逐渐成为快速环路。唯独玉泉营环岛一处，直到1999年国庆前，才改造成立交桥，从此三环路作为全立交的城市快速路全线建成。</p>
<h5 id="四环"><a href="#四环" class="headerlink" title="四环"></a>四环</h5><p>四环路平均距离北京市中心点约8公里，全长65.3公里。主路双向八车道，全封闭、全立交，被认为是<strong>国内有史以来市区道路建设标准最高、规模最大</strong>的城市快速环路。整个四环路的建设持续了十余年。1999年中华人民共和国成立五十周年之际，东四环路建成并通车。到2001年6月，整个四环路全部连成一体。</p>
<h5 id="五环"><a href="#五环" class="headerlink" title="五环"></a>五环</h5><p>五环路全程98.58公里，2003年以前因为被认为是北京市区最外围的一圈高速公路，名称曾为“公路一环”，于2003年11月1日全线建成并通车，通车后属于收费高速公路，后为缓解交通，于2004年1月1日停止收费。</p>
<h5 id="六环"><a href="#六环" class="headerlink" title="六环"></a>六环</h5><p>六环路全程187.6公里，是连接北京第一圈卫星城的一条环形高速公路，以前的名称曾为“公路二环”。2001年年底，六环路第一期工程-通马黄段（连接通州、马驹桥、黄村）建成并通车。2009年9月12号随着六环路最后一段西六环的建成通车，全长187.6公里的北京六环路全线贯通。</p>
<h5 id="七环"><a href="#七环" class="headerlink" title="七环"></a>七环</h5><p><img data-src="http://5b0988e595225.cdn.sohucs.com/images/20180831/7da54aa1645741e5af98c184e8cc1cdf.jpeg" alt=""></p>
<p>北京七环路全名北京大外环高速公路，又称京津冀环线高速公路。总里程约940公里，其中北京市境内约90公里，河北省境内约850公里。于2018年8月20日全线通车。至此，河北省按顺时针方向已有京承、密涿、承平、京秦、京哈、京台、大广、京港澳、京昆、京新、京藏11条高速公路呈聚合状直达北京。</p>
<h3 id="交通"><a href="#交通" class="headerlink" title="交通"></a>交通</h3><h4 id="一卡通"><a href="#一卡通" class="headerlink" title="一卡通"></a>一卡通</h4><ul>
<li>地铁不打折，公交 4 折。</li>
<li>地铁站，公交总站基本上都有售卖点。</li>
<li>地铁公交都是上车刷卡下车刷卡，不然就扣全程钱。</li>
<li>卡押金20，余额超一百不给退，卡损坏不退押金。</li>
<li>一人一卡，不可一卡多人。</li>
</ul>
<h3 id="故宫"><a href="#故宫" class="headerlink" title="故宫"></a><a href="https://libo9527.github.io/2020/01/10/Forbidden-City/" target="_blank" rel="noopener">故宫</a></h3><blockquote>
<p><a href="https://www.dpm.org.cn/Home.html" target="_blank" rel="noopener">故宫博物院</a></p>
<p><a href="http://webapp.vizen.cn/gugong_app_pc/index.html" target="_blank" rel="noopener">全景故宫</a></p>
<p><a href="http://tv.cntv.cn/videoset/C15339" target="_blank" rel="noopener">《故宫》_纪录片_视频_央视网</a></p>
</blockquote>
<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><ul>
<li>中国明清两代皇朝的宫殿</li>
<li>世界上保留最大最完整的宫殿建筑群</li>
<li>故宫的整座城池建造暗合五行阴阳学说，是中国传统风水理念的完美实践作品。</li>
<li>北京故宫（旧称紫禁城）——明、清两代皇宫的遗址。</li>
<li>1987年，被联合国教科文组织列入“世界文化遗产”名录。</li>
</ul>
<h4 id="购票说明"><a href="#购票说明" class="headerlink" title="购票说明"></a>购票说明</h4><ul>
<li>门票提前10天预售，售完为止。</li>
<li>故宫购票实行实名制，所有观众需录入身份证或护照信息方可预定。</li>
<li>下单时填写了二代身份证号的观众可在入院日当日持身份证或户口本原件在任意检票口直接入院，无须兑换纸质门票。</li>
</ul>
<h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p>除法定节假日，故宫博物院全年实行周一闭馆。</p>
<p><img data-src="https://gugong.ktmtech.cn/Content/images/canguantime.png" alt=""></p>
<h4 id="路线"><a href="#路线" class="headerlink" title="路线"></a>路线</h4><ul>
<li>午门（南门）：只作为参观入口，观众一律从午门进入故宫；</li>
<li>神武门（北门）：只作为参观出口；</li>
<li>东华门（东门）：只作为参观出口；</li>
</ul>
<h4 id="票务政策"><a href="#票务政策" class="headerlink" title="票务政策"></a>票务政策</h4><h5 id="门票价格："><a href="#门票价格：" class="headerlink" title="门票价格："></a>门票价格：</h5><p>（1）每年4月1日至10月31日为旺季，大门票60元/人；<br>（2）每年11月1日至次年3月31日为淡季，大门票40元/人。<br>（3）珍宝馆（即进入宁寿宫区，还包括戏曲馆、石鼓馆）参观门票：10元/人。<br>（4）钟表馆（即进入奉先殿区）参观门票：10元/人。</p>
<h5 id="主开放区优惠政策（不含珍宝馆、钟表馆）："><a href="#主开放区优惠政策（不含珍宝馆、钟表馆）：" class="headerlink" title="主开放区优惠政策（不含珍宝馆、钟表馆）："></a>主开放区优惠政策（不含珍宝馆、钟表馆）：</h5><p>（2）6周岁（不含6周岁）至18周岁（含18周岁）未成年人，可凭身份证、户口本或护照购买学生票，20元/人。<br>（3）60岁以上（含60岁）老年人凭身份证原件，门票半价优惠。<br>（6）6周岁（含6周岁）以下或身高1.2米（含1.2米）以下儿童免票参观。<br>（7）残疾人凭残疾人证件，免票参观。</p>
<h5 id="内馆优惠政策（珍宝馆、钟表馆）："><a href="#内馆优惠政策（珍宝馆、钟表馆）：" class="headerlink" title="内馆优惠政策（珍宝馆、钟表馆）："></a>内馆优惠政策（珍宝馆、钟表馆）：</h5><p>（2）6周岁（不含6周岁）至18周岁（含18周岁）未成年人，可凭身份证、户口本或护照购买学生票，5元/人。<br>（3）60岁以上（含60岁）老年人凭身份证原件，门票半价优惠，5元/人。<br>（6）6周岁（含6周岁）以下或身高1.2米（含1.2米）以下儿童免票参观。<br>（7）残疾人凭残疾人证件，免票参观。</p>
<h4 id="客服服务时间"><a href="#客服服务时间" class="headerlink" title="客服服务时间"></a>客服服务时间</h4><p>旺季（每年4月1日至10月31日）8:30-16:15<br>淡季（每年11月1日至次年3月31日）8:30-15:45<br>注：除法定节假日，故宫博物院全年实行周一闭馆，闭馆期间不提供服务。</p>
<h4 id="观众守则"><a href="#观众守则" class="headerlink" title="观众守则"></a>观众守则</h4><ul>
<li>禁止吸烟。</li>
<li>禁止刻画涂写。</li>
<li>在展厅请勿使用闪光灯和三脚架拍照。</li>
<li>请勿随地吐痰。</li>
<li>请勿乱丢垃圾废物。</li>
</ul>
<h3 id="长城"><a href="#长城" class="headerlink" title="长城"></a>长城</h3><h4 id="八达岭长城"><a href="#八达岭长城" class="headerlink" title="八达岭长城"></a>八达岭长城</h4><blockquote>
<p>八达岭长城是万里长城的精华，也是最具代表性的明长城之一。这里海拔高达1015米，地势险要，城关坚固，历来是兵家必争之地。如今登上八达岭长城，极目长天，只见群山逶迤，峰峦叠嶂，万里长城如一条巨龙腾跃在万古苍茫之中，十分壮观。</p>
</blockquote>
<h5 id="门票"><a href="#门票" class="headerlink" title="门票"></a>门票</h5><p>旺季45元（4月1日至10月31日），淡季40元（11月1日至次年3月31日）。</p>
<h5 id="开放时间"><a href="#开放时间" class="headerlink" title="开放时间"></a>开放时间</h5><p>夏季6:30-19:00；冬季7:00-18:00</p>
<h5 id="交通-1"><a href="#交通-1" class="headerlink" title="交通"></a>交通</h5><ol>
<li>旅游专线车每天早晨在市区的前门楼东侧、天安门广场历史博物馆门前、崇文门路口东南角等地发车，票价：往返36元/人，一小时可以到达。</li>
<li>乘地铁等车辆到德胜门下车，乘919路公交车直达八达岭长城脚下，普通车每人7元，空调车每人12元，5分钟发一辆车。</li>
<li>到八达岭的城际列车现已开通，从北京北站出发，一等票价17元，二等票价14元，首班车6:08分发车，到达八达岭时间是7:07。</li>
</ol>
<h4 id="慕田峪长城"><a href="#慕田峪长城" class="headerlink" title="慕田峪长城"></a>慕田峪长城</h4><h4 id="黄花城水长城"><a href="#黄花城水长城" class="headerlink" title="黄花城水长城"></a>黄花城水长城</h4><h4 id="司马台长城"><a href="#司马台长城" class="headerlink" title="司马台长城"></a>司马台长城</h4><h4 id="金山岭长城"><a href="#金山岭长城" class="headerlink" title="金山岭长城"></a>金山岭长城</h4><h4 id="古北口长城"><a href="#古北口长城" class="headerlink" title="古北口长城"></a>古北口长城</h4><h3 id="天安门广场"><a href="#天安门广场" class="headerlink" title="天安门广场"></a>天安门广场</h3><ul>
<li>世界上最大的广场</li>
</ul>
<h3 id="天坛"><a href="#天坛" class="headerlink" title="天坛"></a>天坛</h3><blockquote>
<p><a href="http://www.tiantanpark.com" target="_blank" rel="noopener">天坛公园</a></p>
</blockquote>
<h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><ul>
<li>帝王祭天的场所，是古人和上天沟通的圣地</li>
<li>中国现存最大的古代祭祀性建筑群，北京的地标建筑之一。</li>
<li>公园面积273公顷，是紫禁城的4倍。</li>
<li>春节期间，丹陛桥有百人祭天乐舞表演，不容错过。</li>
<li>门票：旺季15元，淡季10元。开放时间：A、四大门：6:00-21:00（20:00停止售票）B、景点：3－6月：8:00-17:30（16:00停止售票）；7－10月：8:00-18:00（16:30停止售票）；11－2月：8:00-17:00（15:30停止售票）。地址：东城区天坛路交通：5号线天坛东门站下，步行3分钟即达；公交车乘6、34、106路天坛北门站下</li>
</ul>
<iframe  width='100%' height='900' frameBorder='0' src='http://www.tiantanpark.com/centre.html'>
</iframe>

<h4 id="公园大门"><a href="#公园大门" class="headerlink" title="公园大门"></a>公园大门</h4><p>1、开放时间：旺季6:00-21:00，淡季6:30-21:00</p>
<p>2、大门售票时间：旺季6:00-20:00 淡季 6:30-20:00</p>
<p>3、联票售票时间：旺季8:00-16:00 淡季8:00-15:30</p>
<p>4、静园时间：22:00</p>
<h4 id="景点-（含祈年殿、回音壁圜丘、神乐署）"><a href="#景点-（含祈年殿、回音壁圜丘、神乐署）" class="headerlink" title="景点:（含祈年殿、回音壁圜丘、神乐署）"></a>景点:（含祈年殿、回音壁圜丘、神乐署）</h4><p>1、售票时间：旺季8:00-16:30 淡季8:00-16:00</p>
<p>2、开放时间：旺季8:00-17:30 淡季 8:00-17:00</p>
<p>3、 北神厨、北宰牲亭、斋宫：每周二至周日上午9:00-12:00 下午13:00-16:00<br>门票：凭本人身份证在相应门票兑换处换票进入。</p>
<h4 id="天坛公园游览票种及价格"><a href="#天坛公园游览票种及价格" class="headerlink" title="天坛公园游览票种及价格"></a>天坛公园游览票种及价格</h4><table>
<thead>
<tr>
<th>票种</th>
<th>价格</th>
<th>优惠票</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>旺季门票</td>
<td>15元(￥)</td>
<td>7.5元(￥)</td>
<td>1、旺季：每年4月1日至当年10月31日。 <br /> 2、淡季：每年11月1日至次年3月31日。  <br />3、依据北京市物价局 “京价（收）字【2001】008号”，执行时间：2001年2月1日。</td>
</tr>
<tr>
<td>旺季联票(含门票、祈年殿、回音壁圜丘)</td>
<td>34元(￥)</td>
<td>17元(￥)</td>
<td></td>
</tr>
<tr>
<td>淡季门票</td>
<td>10元(￥)</td>
<td>5元(￥)</td>
<td></td>
</tr>
<tr>
<td>淡季联票</td>
<td>28元(￥)</td>
<td>14元(￥)</td>
<td></td>
</tr>
<tr>
<td>景点票联票(含祈年殿、回音壁圜丘)</td>
<td>20元(￥)</td>
<td>10元(￥)</td>
<td></td>
</tr>
<tr>
<td>神乐署门票</td>
<td>10元(￥)</td>
<td>5元(￥)</td>
<td>依据北京市发改委“京发改【2004】1822号”</td>
</tr>
<tr>
<td>月票</td>
<td>15元(￥)</td>
<td>15元(￥)</td>
<td>1、依据北京市物价局“京价（收）字【2001】008号”，执行时间：2001年2月1日。<br /> 2、本市居民凭身份证、常住本市的外地人员凭相关部门开具的证明，每月月末四天内购买月票。</td>
</tr>
</tbody></table>
<h3 id="颐和园"><a href="#颐和园" class="headerlink" title="颐和园"></a>颐和园</h3><blockquote>
<p><a href="http://www.summerpalace-china.com/" target="_blank" rel="noopener">颐和园</a><br><a href="http://s.visitbeijing.com.cn/html/j-101407_gl.shtml" target="_blank" rel="noopener">颐和园 | 北京旅游网</a></p>
</blockquote>
<h4 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h4><ul>
<li>世界上现存规模最大的皇家园林，被誉为皇家园林博物馆。</li>
<li>中国四大名园（另三座为承德避暑山庄、苏州拙政园、苏州留园）之一。</li>
<li>园内一大特色是长廊，以精美的绘画著称，有546幅西湖胜景和8000多幅人物故事、山水花鸟。</li>
</ul>
<h4 id="游园路线"><a href="#游园路线" class="headerlink" title="游园路线"></a>游园路线</h4><h5 id="东宫门入园"><a href="#东宫门入园" class="headerlink" title="东宫门入园"></a>东宫门入园</h5><p>东宫门&gt;&gt;仁寿殿&gt;&gt;文昌院&gt;&gt;玉澜堂、宜芸馆&gt;&gt;乐寿堂&gt;&gt;长廊&gt;&gt;排云殿&gt;&gt;佛香阁&gt;&gt;石舫&gt;&gt;耕织图景区&gt;&gt;如意门。 （约3小时行程）</p>
<p>东宫门&gt;&gt;仁寿殿&gt;&gt;文昌院&gt;&gt;玉澜堂、宜芸馆&gt;&gt;乐寿堂&gt;&gt;长廊&gt;&gt;排云殿&gt;&gt;佛香阁&gt;&gt;石舫&gt;&gt;乘船至南湖岛&gt;&gt;十七孔桥&gt;&gt;铜牛&gt;&gt;新建宫门。 （约2.5小时行程）</p>
<p>东宫门&gt;&gt;仁寿殿&gt;&gt;文昌院&gt;&gt;玉澜堂、宜芸馆&gt;&gt;乐寿堂&gt;&gt;长廊&gt;&gt;排云殿&gt;&gt;佛香阁&gt;&gt;苏州街&gt;&gt;北宫门。（约2小时行程）</p>
<p>东宫门&gt;&gt;仁寿殿&gt;&gt;文昌院&gt;&gt;玉澜堂、宜芸馆&gt;&gt;乐寿堂&gt;&gt;长廊&gt;&gt;排云殿&gt;&gt;佛香阁&gt;&gt;苏州街&gt;&gt;澹宁堂&gt;&gt;谐趣园&gt;&gt;东宫门。 （约2.5小时行程）</p>
<h5 id="北宫门入园"><a href="#北宫门入园" class="headerlink" title="北宫门入园"></a>北宫门入园</h5><p>北宫门&gt;&gt;苏州街&gt;&gt;四大部洲&gt;&gt;佛香阁&gt;&gt;排云殿&gt;&gt;长廊&gt;&gt;石舫&gt;&gt;乘船至南湖岛&gt;&gt;十七孔桥&gt;&gt;铜牛&gt;&gt;昆明湖东堤&gt;&gt;文昌院&gt;&gt;玉澜堂、宜芸馆&gt;&gt;乐寿堂 &gt;&gt;仁寿殿&gt;&gt;东宫门。 （约3小时行程）</p>
<p>北宫门&gt;&gt;苏州街&gt;&gt;澹宁堂&gt;&gt;谐趣园&gt;&gt;仁寿殿&gt;&gt;玉澜堂、宜芸馆&gt;&gt;文昌院&gt;&gt;乐寿堂&gt;&gt;长廊&gt;&gt;排云殿&gt;&gt;佛香阁&gt;&gt;石舫&gt;&gt;耕织图景区&gt;&gt;如意门。 （约2.5小时行程）</p>
<p>北宫门&gt;&gt;苏州街&gt;&gt;石舫&gt;&gt;长廊&gt;&gt;排云殿&gt;&gt;佛香阁&gt;&gt;乐寿堂&gt;&gt;文昌院&gt;&gt;仁寿殿&gt;&gt;东宫门。 （约2小时行程）</p>
<h5 id="新建宫门入园"><a href="#新建宫门入园" class="headerlink" title="新建宫门入园"></a>新建宫门入园</h5><p>新建宫门&gt;&gt;昆明湖东堤&gt;&gt;文昌院&gt;&gt;仁寿殿&gt;&gt;玉澜堂、宜芸馆&gt;&gt;乐寿堂&gt;&gt;长廊&gt;&gt;排云殿&gt;&gt;佛香阁&gt;&gt;苏州街&gt;&gt;北宫门。（约2.5小时行程）</p>
<p>新建宫门&gt;&gt;南湖岛&gt;&gt;十七孔桥&gt;&gt;铜牛&gt;&gt;乘船至石舫&gt;&gt;耕织图景区&gt;&gt;苏州街&gt;&gt;佛香阁&gt;&gt;排云殿&gt;&gt;长廊&gt;&gt;乐寿堂&gt;&gt;玉澜堂、宜芸馆&gt;&gt;文昌院&gt;&gt;仁寿殿&gt;&gt;东宫门。 （约3小时行程）</p>
<p><img data-src="http://s.visitbeijing.com.cn/uploadfile/2015/0727/20150727094829536.jpg" alt=""></p>
<h3 id="圆明园"><a href="#圆明园" class="headerlink" title="圆明园"></a>圆明园</h3><blockquote>
<p><a href="http://www.yuanmingyuanpark.cn/" target="_blank" rel="noopener">圆明园遗址公园</a></p>
</blockquote>
<h4 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h4><ul>
<li>被誉为“一切造园艺术的典范”和“万园之园”</li>
</ul>
<h4 id="门票价格"><a href="#门票价格" class="headerlink" title="门票价格"></a>门票价格</h4><h5 id="售票处"><a href="#售票处" class="headerlink" title="售票处"></a>售票处</h5><ul>
<li>绮春园宫门(售票窗口5个，节假日期间售票窗口8个)</li>
<li>长春园东门（售票窗口2个）</li>
<li>二宫门（售票窗口1个）</li>
<li>藻园门（售票窗口1个）</li>
</ul>
<h5 id="①大门门票："><a href="#①大门门票：" class="headerlink" title="①大门门票："></a>①大门门票：</h5><ul>
<li>成人门票：10元/人次；</li>
<li>半价门票：5元/人次；</li>
</ul>
<h5 id="②西洋楼遗址景区（含大水法、展览馆、迷宫）"><a href="#②西洋楼遗址景区（含大水法、展览馆、迷宫）" class="headerlink" title="②西洋楼遗址景区（含大水法、展览馆、迷宫）"></a>②西洋楼遗址景区（含大水法、展览馆、迷宫）</h5><ul>
<li>成人门票：15元/人次；</li>
<li>半价门票：5元/人次；</li>
</ul>
<h5 id="③圆明园盛时全景模型展"><a href="#③圆明园盛时全景模型展" class="headerlink" title="③圆明园盛时全景模型展"></a>③圆明园盛时全景模型展</h5><ul>
<li>成人门票：10元/人次；</li>
<li>半价门票：5元/人次；</li>
</ul>
<h5 id="首道门门票优惠减免规定"><a href="#首道门门票优惠减免规定" class="headerlink" title="首道门门票优惠减免规定"></a>首道门门票优惠减免规定</h5><p>1、6周岁（含6周岁）或1.2 米(含1.2米 )以下儿童免票；<br>2、60周岁（含60周岁）以上老年人凭老年证或身份证免票；<br>6、残疾人持残疾证件免票；<br>14、门票当日有效，售出后概不退换。</p>
<h5 id="园中园门票优惠减免规定"><a href="#园中园门票优惠减免规定" class="headerlink" title="园中园门票优惠减免规定"></a>园中园门票优惠减免规定</h5><p>1、6周岁（含6周岁）或1.2 米(含1.2米)以下儿童免票；<br>2、60周岁（含60周岁）以上老年人凭老年证或身份证免票；<br>6、残疾人持残疾证件免票；<br>13、门票当日有效，售出后概不退换。</p>
<h4 id="景区卫生间位置分布"><a href="#景区卫生间位置分布" class="headerlink" title="景区卫生间位置分布"></a>景区卫生间位置分布</h4><p><img data-src="http://www.yuanmingyuanpark.cn/lyfw/llxx/201012/W020181225383396550738.jpg" alt=""></p>
<h4 id="公园开放时间："><a href="#公园开放时间：" class="headerlink" title="公园开放时间："></a>公园开放时间：</h4><p>1月—3月15日、10月16日—12月  售票时间：7:00—17:30  开闭园时间：7:00—19:30</p>
<p>3月16日—4月、9月—10月15日   售票时间：7:00—18:00  开闭园时间：7:00—20:00</p>
<p>5月—8月  售票时间：7:00—19:00  开闭园时间：7:00—21:00</p>
<h3 id="什刹海"><a href="#什刹海" class="headerlink" title="什刹海"></a>什刹海</h3><blockquote>
<p><a href="http://www.wanderbee.com/zh-CN/articles/explore-old-beijing/" target="_blank" rel="noopener">漫步什刹海，寻味老北京</a></p>
</blockquote>
<p><img data-src="http://www.wanderbee.com/assets/article-images/explore-old-beijing-01.jpg" alt=""></p>
<h4 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h4><ul>
<li>什刹海盛产贵族，王府大院、名人故居扎堆于此。</li>
</ul>
<h4 id="门票-1"><a href="#门票-1" class="headerlink" title="门票"></a>门票</h4><p>什刹海是免费的，但是进入某些景点需要门票</p>
<ul>
<li>宋庆龄故居：20元</li>
</ul>
<h4 id="开放时间-1"><a href="#开放时间-1" class="headerlink" title="开放时间"></a>开放时间</h4><p>全天</p>
<ul>
<li>宋庆龄故居：09:00~17:30</li>
</ul>
<h3 id="恭王府"><a href="#恭王府" class="headerlink" title="恭王府"></a>恭王府</h3><h4 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h4><ul>
<li>“一座恭王府，半部清朝史”是历史地理学家侯仁之对恭王府的评价。</li>
<li>恭王府前身为乾隆时大学士和珅的邸宅。和珅在当时可列入世界级富翁行列，他的野史和传说被人津津乐道。之后咸丰帝将府邸转赐其弟奕忻，成为恭王府。</li>
</ul>
<h4 id="门票-2"><a href="#门票-2" class="headerlink" title="门票"></a>门票</h4><p>套票：70元（含门票、专业讲解员、参观开放的景厅及展厅、观看王府大戏楼、并在戏楼内欣赏北京传统节目演出、品尝王府盖碗茶和小吃）。<br>如果只是参观恭王府，门票为40元。</p>
<h4 id="开放时间-2"><a href="#开放时间-2" class="headerlink" title="开放时间"></a>开放时间</h4><p>旺季7:30-16:30；淡季8:30-16:00</p>
<h3 id="雍和宫"><a href="#雍和宫" class="headerlink" title="雍和宫"></a>雍和宫</h3><blockquote>
<p>雍和宫原来是雍正皇帝的府邸，雍正登基后将其升为行宫，赐名“雍和宫”。乾隆登基后将雍和宫辟为藏传佛教格鲁派寺院。这里也就成为清廷联系藏、蒙等上层政治、宗教人士的地方。雍和宫还是藏传佛教艺术品的宝库，其中紫檀木雕刻的五百罗汉山，金丝楠木雕龙的大佛龛和十八米高的白檀木大佛成为雍和宫木雕工艺的三绝，以大、奇、精著称。</p>
</blockquote>
<h4 id="门票-3"><a href="#门票-3" class="headerlink" title="门票"></a>门票</h4><p>25元</p>
<h4 id="开放时间-3"><a href="#开放时间-3" class="headerlink" title="开放时间"></a>开放时间</h4><p>9:00-16:30</p>
<h3 id="明十三陵明"><a href="#明十三陵明" class="headerlink" title="明十三陵明"></a>明十三陵明</h3><blockquote>
<p>十三陵是中国明朝皇帝的墓葬群，13座皇陵均依山而筑，形成了体系完整、规模宏大、气势磅礴的陵寝建筑群。十三陵严格按照中国传统风水学说，从选址到规划设计都十分注重建筑与自然山川、水流和植被的和谐统一，追求”天造地设”的完美境界，用以体现”天人合一”的哲学观点，充分展示了中国传统文化的丰富内涵。</p>
</blockquote>
<h4 id="门票-4"><a href="#门票-4" class="headerlink" title="门票"></a>门票</h4><blockquote>
<p>注：旺季4月至10月，淡季11月至次年3月。 </p>
</blockquote>
<ul>
<li>定陵</li>
</ul>
<p>旺季65元、淡季45元；</p>
<ul>
<li>长陵</li>
</ul>
<p>旺季45元、淡季35元；</p>
<ul>
<li>昭陵</li>
</ul>
<p>旺季35元、淡季25元；</p>
<ul>
<li>总神道</li>
</ul>
<p>旺季35元、淡季25元。</p>
<ul>
<li>四点联票135元，携程优惠价115元。</li>
</ul>
<h4 id="开放时间-4"><a href="#开放时间-4" class="headerlink" title="开放时间"></a>开放时间</h4><ul>
<li>定陵</li>
</ul>
<p>旺季8:00-17:30，淡季8:30-17:00；</p>
<ul>
<li>长陵</li>
</ul>
<p>旺季8:00-17:00；淡季8:30-16:30；</p>
<ul>
<li>昭陵</li>
</ul>
<p>旺季8:30-17:00，淡季8:30-16:30；</p>
<ul>
<li>总神道</li>
</ul>
<p>旺季8:10-17:50，淡季8:30-17:00。</p>
]]></content>
      <categories>
        <category>Tour</category>
      </categories>
      <tags>
        <tag>Tour</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Tour 2019</title>
    <url>/2019/01/28/Spring-Tour/</url>
    <content><![CDATA[<img data-src="http://wx1.sinaimg.cn/large/005M2pcYgy1fzg88oizf2j30b607e0ug.jpg" width="100%"/>

<a id="more"></a>

<h2 id="2019-年新春游"><a href="#2019-年新春游" class="headerlink" title="2019 年新春游"></a>2019 年新春游</h2><h3 id="总体规划"><a href="#总体规划" class="headerlink" title="总体规划"></a>总体规划</h3><p>上海 ~ 苏州 ~ 乌镇 ~ 杭州</p>
<h4 id="成员"><a href="#成员" class="headerlink" title="成员"></a>成员</h4><p>李博，李永斌，吕聪慧，李艳红，王钰溪，李一萍，李欣芮，李欣楠</p>
<h4 id="总站点分布图"><a href="#总站点分布图" class="headerlink" title="总站点分布图"></a><a href="http://c.dituhui.com/maps/1977946" target="_blank" rel="noopener">总站点分布图</a></h4><iframe  width='100%' height='400' frameBorder='0' src='http://c.dituhui.com/maps/1977946/embed'></iframe><div style='margin-bottom:5px'> <strong> <a href='http://c.dituhui.com/maps/1977946' title='' target='_blank'>2019春游地图</a> </strong> 分享自 <strong><a href='http://c.dituhui.com' target='_blank'>地图慧</a></strong> </div></iframe>
#### [地铁线路图](http://map.amap.com/subway/index.html)

<iframe  width='100%' height='1000' frameBorder='0' src='http://map.amap.com/subway/index.html'></iframe>
#### 费用

<p><a href="">费用明细表</a></p>
<h2 id="上海"><a href="#上海" class="headerlink" title="上海"></a>上海</h2><h3 id="天气"><a href="#天气" class="headerlink" title="天气"></a>天气</h3><iframe width="100%" scrolling="no" height="60" frameborder="0" allowtransparency="true" src="//i.tianqi.com/index.php?c=code&id=12&icon=1&py=shanghai&num=5&site=12"></iframe>
### 住宿

<p><strong>2019-02-04 14:00:00 ~ 2019-02-05 12:00:00</strong></p>
<p><a href="http://hotels.huazhu.com/hotel/detail/2012011?CheckInDate=2019-02-04&CheckOutDate=2019-02-05" target="_blank" rel="noopener">汉庭上海浦东机场T2航站楼酒店</a></p>
<p>双床房：李博，李永斌</p>
<p>双床房：吕聪慧，李一萍，李欣芮，李欣楠</p>
<p><strong>2019-02-05 14:00:00 ~ 2019-02-07 12:00:00</strong></p>
<p><a href="http://hotels.huazhu.com/Hotel/Detail?HotelId=2001245" target="_blank" rel="noopener">汉庭上海中环沪南路酒店</a></p>
<p>双床房：吕聪慧，李欣芮，李永斌，李博</p>
<p>双床房：李一萍，李欣芮，李艳红，王钰溪</p>
<h3 id="第一天"><a href="#第一天" class="headerlink" title="第一天"></a>第一天</h3><h4 id="住宿"><a href="#住宿" class="headerlink" title="住宿"></a>住宿</h4><p>2019-02-04 14:00:00 ~ 2019-02-05 12:00:00</p>
<p><a href="http://hotels.huazhu.com/hotel/detail/2012011?CheckInDate=2019-02-04&CheckOutDate=2019-02-05" target="_blank" rel="noopener">汉庭上海浦东机场T2航站楼酒店</a></p>
<p>双床房：李博，李永斌</p>
<p>双床房：吕聪慧，李一萍，李欣芮，李欣楠</p>
<h4 id="路线"><a href="#路线" class="headerlink" title="路线"></a>路线</h4><p>老城隍庙旅游区(2小时) → 豫园(1小时) → 南京路步行街(3小时) → 外滩(1小时) → 外白渡桥(30分钟)</p>
<ul>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310115&from%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E6%B5%A6%E4%B8%9C%E6%9C%BA%E5%9C%BAT2%E8%88%AA%E7%AB%99%E6%A5%BC%E5%BA%97&from%5Bid%5D=B00157HL4Y-from&from%5Bpoitype%5D=100105&from%5Blnglat%5D=121.76788199999999%2C31.211475&from%5Bmodxy%5D=&type=bus&policy=0&to%5Bid%5D=B0FFHGJ1YN-to&to%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E4%B8%AD%E7%8E%AF%E6%B2%AA%E5%8D%97%E8%B7%AF%E5%BA%97&to%5Blnglat%5D=121.562351%2C31.163604&to%5Bmodxy%5D=121.562517%2C31.16354&to%5Bpoitype%5D=100105&to%5Badcode%5D=310115&dateTime=now" target="_blank" rel="noopener">汉庭上海浦东机场T2航站楼酒店 - 汉庭上海中环沪南路酒店</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310115&from%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E4%B8%AD%E7%8E%AF%E6%B2%AA%E5%8D%97%E8%B7%AF%E5%BA%97&from%5Bid%5D=B0FFHGJ1YN-from&from%5Bpoitype%5D=100105&from%5Blnglat%5D=121.56235100000004%2C31.163604&from%5Bmodxy%5D=121.562517%2C31.16354&to%5Badcode%5D=310101&to%5Bname%5D=%E4%B8%8A%E6%B5%B7%E5%9F%8E%E9%9A%8D%E5%BA%99&to%5Bid%5D=B00155FHOA-to&to%5Bpoitype%5D=110205&to%5Blnglat%5D=121.49251200000003%2C31.225722&to%5Bmodxy%5D=121.492575%2C31.225336&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">汉庭上海中环沪南路酒店 - 老城隍庙</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310101&from%5Bname%5D=%E4%B8%8A%E6%B5%B7%E5%9F%8E%E9%9A%8D%E5%BA%99&from%5Bid%5D=B00155FHOA-from&from%5Bpoitype%5D=110205&from%5Blnglat%5D=121.49251200000003%2C31.225722&from%5Bmodxy%5D=121.492575%2C31.225336&to%5Badcode%5D=310101&to%5Bname%5D=%E8%B1%AB%E5%9B%AD&to%5Bid%5D=B00155MF55-to&to%5Bpoitype%5D=110202&to%5Blnglat%5D=121.491983%2C31.227029&to%5Bmodxy%5D=121.491487%2C31.22785&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">城隍庙 - 豫园</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B00155MF55-from&from%5Bname%5D=%E8%B1%AB%E5%9B%AD&from%5Blnglat%5D=121.491983%2C31.227029&from%5Bmodxy%5D=121.491487%2C31.22785&from%5Bpoitype%5D=110202&from%5Badcode%5D=310101&to%5Badcode%5D=310101&to%5Bname%5D=%E5%8D%97%E4%BA%AC%E8%B7%AF%E6%AD%A5%E8%A1%8C%E8%A1%97&to%5Bid%5D=B0FFF5VNSV-to&to%5Bpoitype%5D=061001&to%5Blnglat%5D=121.47979700000002%2C31.235742&to%5Bmodxy%5D=121.484843%2C31.237513&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">豫园 - 南京路步行街</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310101&from%5Bname%5D=%E5%8D%97%E4%BA%AC%E8%B7%AF%E6%AD%A5%E8%A1%8C%E8%A1%97&from%5Bid%5D=B0FFF5VNSV-from&from%5Bpoitype%5D=061001&from%5Blnglat%5D=121.47979700000002%2C31.235742&from%5Bmodxy%5D=121.484843%2C31.237513&to%5Badcode%5D=310101&to%5Bname%5D=%E5%A4%96%E6%BB%A9&to%5Bid%5D=B00155FXB3-to&to%5Bpoitype%5D=110200&to%5Blnglat%5D=121.49060199999997%2C31.237767&to%5Bmodxy%5D=121.492255%2C31.233005&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">南京路步行街 - 外滩</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310101&from%5Bname%5D=%E5%A4%96%E6%BB%A9&from%5Bid%5D=B00155FXB3-from&from%5Bpoitype%5D=110200&from%5Blnglat%5D=121.49060199999997%2C31.237767&from%5Bmodxy%5D=121.492255%2C31.233005&to%5Bname%5D=%E5%A4%96%E7%99%BD%E6%B8%A1%E6%A1%A5&to%5Blnglat%5D=121.490185%2C31.243425&to%5Bid%5D=B00155IL1T-to&to%5Bpoitype%5D=&to%5Badcode%5D=310000&to%5Bmodxy%5D=121.490185%2C31.243425&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">外滩 - 外白渡桥</a></li>
<li><a href="https://www.amap.com/dir?from%5Bname%5D=%E5%A4%96%E7%99%BD%E6%B8%A1%E6%A1%A5&from%5Blnglat%5D=121.490185%2C31.243425&from%5Bid%5D=B00155IL1T-from&from%5Bpoitype%5D=&from%5Badcode%5D=310000&from%5Bmodxy%5D=121.490185%2C31.243425&to%5Bid%5D=B0FFHGJ1YN-to&to%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E4%B8%AD%E7%8E%AF%E6%B2%AA%E5%8D%97%E8%B7%AF%E5%BA%97&to%5Blnglat%5D=121.562351%2C31.163604&to%5Bmodxy%5D=121.562517%2C31.16354&to%5Bpoitype%5D=100105&to%5Badcode%5D=310115&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">外白渡桥 - 汉庭上海中环沪南路酒店</a></li>
</ul>
<h3 id="第二天"><a href="#第二天" class="headerlink" title="第二天"></a>第二天</h3><h4 id="住宿-1"><a href="#住宿-1" class="headerlink" title="住宿"></a>住宿</h4><p>2019-02-05 14:00:00 ~ 2019-02-06 12:00:00</p>
<p><a href="http://hotels.huazhu.com/Hotel/Detail?HotelId=2001245" target="_blank" rel="noopener">汉庭上海中环沪南路酒店</a></p>
<p>双床房：吕聪慧，李欣芮，李永斌，李博</p>
<p>双床房：李一萍，李欣芮，李艳红，王钰溪</p>
<h4 id="景点"><a href="#景点" class="headerlink" title="景点"></a>景点</h4><p>迪士尼 <a href="https://libo9527.github.io/2019/01/31/Travel-Strategy-of-Disney/" target="_blank" rel="noopener">迪士尼攻略</a></p>
<p><a href="http://www.mafengwo.cn/poi/4988.html" target="_blank" rel="noopener">上海朱家角古镇旅游区</a>(3小时) → 上海博物馆(1小时) → 中华艺术宫(2小时) → 田子坊(1小时) → 上海新天地(1小时)</p>
<h4 id="路线-1"><a href="#路线-1" class="headerlink" title="路线"></a>路线</h4><ul>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B0FFHGJ1YN-from&from%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E4%B8%AD%E7%8E%AF%E6%B2%AA%E5%8D%97%E8%B7%AF%E5%BA%97&from%5Blnglat%5D=121.562351%2C31.163604&from%5Bmodxy%5D=121.562517%2C31.16354&from%5Bpoitype%5D=100105&from%5Badcode%5D=310115&to%5Bname%5D=%E6%9C%B1%E5%AE%B6%E8%A7%92%E5%8F%A4%E9%95%87&to%5Blnglat%5D=121.05388%2C31.109867&to%5Bid%5D=B001558F5I-to&to%5Bpoitype%5D=110202&to%5Badcode%5D=310000&to%5Bmodxy%5D=121.053613%2C31.114342&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">汉庭上海中环沪南路酒店 - 朱家角古镇</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B001558F5I-from&from%5Bname%5D=%E6%9C%B1%E5%AE%B6%E8%A7%92%E5%8F%A4%E9%95%87&from%5Blnglat%5D=121.05388%2C31.109867&from%5Bmodxy%5D=121.053613%2C31.114342&from%5Bpoitype%5D=110202&from%5Badcode%5D=310118&to%5Badcode%5D=310101&to%5Bname%5D=%E4%B8%8A%E6%B5%B7%E5%8D%9A%E7%89%A9%E9%A6%86&to%5Bid%5D=B001535BBC-to&to%5Bpoitype%5D=140100&to%5Blnglat%5D=121.47552999999999%2C31.228245&to%5Bmodxy%5D=121.476137%2C31.227577&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">朱家角古镇旅游区 - 上海博物馆</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310101&from%5Bname%5D=%E4%B8%8A%E6%B5%B7%E5%8D%9A%E7%89%A9%E9%A6%86&from%5Bid%5D=B001535BBC-from&from%5Bpoitype%5D=140100&from%5Blnglat%5D=121.47552999999999%2C31.228245&from%5Bmodxy%5D=121.476137%2C31.227577&to%5Badcode%5D=310115&to%5Bname%5D=%E4%B8%AD%E5%8D%8E%E8%89%BA%E6%9C%AF%E5%AE%AB&to%5Bid%5D=B00155L9WI&to%5Bpoitype%5D=140100&to%5Blnglat%5D=121.49472500000002%2C31.184385&to%5Bmodxy%5D=121.493502%2C31.184149&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">上海博物馆 - 中华艺术宫</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310115&from%5Bname%5D=%E4%B8%AD%E5%8D%8E%E8%89%BA%E6%9C%AF%E5%AE%AB&from%5Bid%5D=B00155L9WI-from&from%5Bpoitype%5D=140100&from%5Blnglat%5D=121.49472500000002%2C31.184385&from%5Bmodxy%5D=121.493502%2C31.184149&to%5Badcode%5D=310101&to%5Bname%5D=%E7%94%B0%E5%AD%90%E5%9D%8A&to%5Bid%5D=B00155HO6Y-to&to%5Bpoitype%5D=061000&to%5Blnglat%5D=121.46841699999999%2C31.208032&to%5Bmodxy%5D=121.469361%2C31.207774&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">中华艺术宫 - 田子坊</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310101&from%5Bname%5D=%E7%94%B0%E5%AD%90%E5%9D%8A&from%5Bid%5D=B00155HO6Y-from&from%5Bpoitype%5D=061000&from%5Blnglat%5D=121.46841699999999%2C31.208032&from%5Bmodxy%5D=121.469361%2C31.207774&to%5Badcode%5D=310101&to%5Bname%5D=%E4%B8%8A%E6%B5%B7%E6%96%B0%E5%A4%A9%E5%9C%B0%E9%A9%AC%E5%BD%93%E8%B7%AF&to%5Bid%5D=B00155KUM0&to%5Bpoitype%5D=120201&to%5Blnglat%5D=121.47495000000004%2C31.219921&to%5Bmodxy%5D=121.475037%2C31.218473&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">田子坊 - 上海新天地</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310101&from%5Bname%5D=%E4%B8%8A%E6%B5%B7%E6%96%B0%E5%A4%A9%E5%9C%B0%E9%A9%AC%E5%BD%93%E8%B7%AF&from%5Bid%5D=B00155KUM0-from&from%5Bpoitype%5D=120201&from%5Blnglat%5D=121.47495000000004%2C31.219921&from%5Bmodxy%5D=121.475037%2C31.218473&to%5Badcode%5D=310115&to%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E4%B8%AD%E7%8E%AF%E6%B2%AA%E5%8D%97%E8%B7%AF%E5%BA%97&to%5Bid%5D=B0FFHGJ1YN&to%5Bpoitype%5D=100105&to%5Blnglat%5D=121.56235100000004%2C31.163604&to%5Bmodxy%5D=121.562517%2C31.16354&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">上海新天地 - 汉庭上海中环沪南路酒店</a></li>
</ul>
<h3 id="第三天"><a href="#第三天" class="headerlink" title="第三天"></a>第三天</h3><h4 id="住宿-2"><a href="#住宿-2" class="headerlink" title="住宿"></a>住宿</h4><p>2019-02-06 14:00:00 ~ 2019-02-07 12:00:00</p>
<p><a href="http://hotels.huazhu.com/Hotel/Detail?HotelId=2001245" target="_blank" rel="noopener">汉庭上海中环沪南路酒店</a></p>
<p>双床房：吕聪慧，李欣芮，李永斌，李博</p>
<p>双床房：李一萍，李欣芮，李艳红，王钰溪</p>
<h4 id="景点-1"><a href="#景点-1" class="headerlink" title="景点"></a>景点</h4><p><a href="http://www.mafengwo.cn/poi/3782250.html?sfrom=ginfo_img_poi" target="_blank" rel="noopener">崇明岛</a>(4小时) → 陆家嘴(2小时) → 东方明珠(2小时) → 上海环球金融中心(1小时)</p>
<h4 id="路线-2"><a href="#路线-2" class="headerlink" title="路线"></a>路线</h4><ul>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310115&from%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E4%B8%AD%E7%8E%AF%E6%B2%AA%E5%8D%97%E8%B7%AF%E5%BA%97&from%5Bid%5D=B0FFHGJ1YN-from&from%5Bpoitype%5D=100105&from%5Blnglat%5D=121.56235100000004%2C31.163604&from%5Bmodxy%5D=121.562517%2C31.16354&to%5Badcode%5D=310106&to%5Bname%5D=%E4%B8%8A%E6%B5%B7%E7%AB%99&to%5Bid%5D=B00155KSDE&to%5Bpoitype%5D=150200&to%5Blnglat%5D=121.455739%2C31.249563&to%5Bmodxy%5D=121.45452%2C31.247485&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">汉庭上海中环沪南路酒店 - 上海站</a>（行李寄存）</li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310106&from%5Bname%5D=%E4%B8%8A%E6%B5%B7%E7%AB%99&from%5Bid%5D=B00155KSDE-from&from%5Bpoitype%5D=150200&from%5Blnglat%5D=121.455739%2C31.249563&from%5Bmodxy%5D=121.45452%2C31.247485&to%5Badcode%5D=310151&to%5Bname%5D=%E5%B4%87%E6%98%8E%E5%B2%9B&to%5Bid%5D=B00155PJEA&to%5Bpoitype%5D=190202&to%5Blnglat%5D=121.63505800000001%2C31.576855&to%5Bmodxy%5D=&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">上海站 - 崇明岛</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310151&from%5Bname%5D=%E5%B4%87%E6%98%8E%E5%B2%9B&from%5Bid%5D=B00155PJEA-from&from%5Bpoitype%5D=190202&from%5Blnglat%5D=121.63505800000001%2C31.576855&from%5Bmodxy%5D=&to%5Badcode%5D=310115&to%5Bname%5D=%E9%99%86%E5%AE%B6%E5%98%B4&to%5Bid%5D=B00156EVQO-to&to%5Bpoitype%5D=190700&to%5Blnglat%5D=121.5025%2C31.237015&to%5Bmodxy%5D=121.50288%2C31.237136&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">崇明岛 - 陆家嘴</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310115&from%5Bname%5D=%E9%99%86%E5%AE%B6%E5%98%B4&from%5Bid%5D=B00156EVQO-from&from%5Bpoitype%5D=190700&from%5Blnglat%5D=121.5025%2C31.237015&from%5Bmodxy%5D=121.50288%2C31.237136&to%5Badcode%5D=310115&to%5Bname%5D=%E4%B8%9C%E6%96%B9%E6%98%8E%E7%8F%A0%E5%B9%BF%E6%92%AD%E7%94%B5%E8%A7%86%E5%A1%94&to%5Bid%5D=B00150F6D6-to&to%5Bpoitype%5D=110202&to%5Blnglat%5D=121.49980900000003%2C31.239666&to%5Bmodxy%5D=121.501072%2C31.23935&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">陆家嘴 - 东方明珠</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310115&from%5Bname%5D=%E4%B8%9C%E6%96%B9%E6%98%8E%E7%8F%A0%E5%B9%BF%E6%92%AD%E7%94%B5%E8%A7%86%E5%A1%94&from%5Bid%5D=B00150F6D6-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=121.49980900000003%2C31.239666&from%5Bmodxy%5D=121.501072%2C31.23935&to%5Bid%5D=B00155IR0X&to%5Bname%5D=%E4%B8%8A%E6%B5%B7%E7%8E%AF%E7%90%83%E9%87%91%E8%9E%8D%E4%B8%AD%E5%BF%83%E8%A7%82%E5%85%89%E5%8E%85&to%5Blnglat%5D=121.507061%2C31.234424&to%5Bmodxy%5D=121.506703%2C31.234309&to%5Bpoitype%5D=110202&to%5Badcode%5D=310115&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">东方明珠 - 上海环球金融中心</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=310115&from%5Bname%5D=%E4%B8%8A%E6%B5%B7%E7%8E%AF%E7%90%83%E9%87%91%E8%9E%8D%E4%B8%AD%E5%BF%83&from%5Bid%5D=B00155MLEY-from&from%5Bpoitype%5D=120201&from%5Blnglat%5D=121.50776100000002%2C31.234339&from%5Bmodxy%5D=121.50773%2C31.23559&to%5Bid%5D=B00155KSDE-to&to%5Bname%5D=%E4%B8%8A%E6%B5%B7%E7%AB%99&to%5Blnglat%5D=121.455739%2C31.249563&to%5Bmodxy%5D=121.45452%2C31.247485&to%5Bpoitype%5D=150200&to%5Badcode%5D=310106&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">上海环球金融中心 - 上海站</a></li>
<li><a href="http://trains.ctrip.com/TrainBooking/Search.aspx?from=shanghai&to=suzhou&day=2019-02-07&number=&fromCn=%25E4%25B8%258A%25E6%25B5%25B7&toCn=%25E8%258B%258F%25E5%25B7%259E&mkt_header=bdkx" target="_blank" rel="noopener">上海站 - 苏州站</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=320508&from%5Bname%5D=%E8%8B%8F%E5%B7%9E%E7%AB%99&from%5Bid%5D=B0200172JB&from%5Bpoitype%5D=150200&from%5Blnglat%5D=120.61084199999999%2C31.329724&from%5Bmodxy%5D=120.610444%2C31.330798&to%5Bid%5D=B020018ASM&to%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E8%8B%8F%E5%B7%9E%E8%8B%8F%E8%A0%A1%E8%B7%AF%E5%BA%97&to%5Blnglat%5D=120.615901%2C31.244855&to%5Bmodxy%5D=120.615529%2C31.24485&to%5Bpoitype%5D=100105&to%5Badcode%5D=320506&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">苏州站 - 汉庭苏州苏蠡路酒店</a></li>
</ul>
<h2 id="苏州"><a href="#苏州" class="headerlink" title="苏州"></a>苏州</h2><p><a href="http://map.baidu.com/?subwayShareId=suzhou,224" target="_blank" rel="noopener">苏州地铁线路图-百度地图</a></p>
<h3 id="天气-1"><a href="#天气-1" class="headerlink" title="天气"></a>天气</h3><iframe width="100%" scrolling="no" height="60" frameborder="0" allowtransparency="true" src="//i.tianqi.com/index.php?c=code&id=12&icon=1&py=suzhou&num=5&site=12"></iframe>
### 住宿

<p>2019-02-07 14:00:00 ~ 2019-02-09 12:00:00</p>
<p><a href="http://hotels.huazhu.com/hotel/detail?HotelId=2150214&CheckInDate=2019-02-07&CheckOutDate=2019-02-09" target="_blank" rel="noopener">汉庭苏州苏蠡路酒店</a></p>
<p>双床房：吕聪慧，李欣芮，李永斌，李博</p>
<p>双床房：李一萍，李欣芮，李艳红，王钰溪</p>
<h3 id="路线-3"><a href="#路线-3" class="headerlink" title="路线"></a>路线</h3><p>金鸡湖景区(2小时) → 拙政园(2小时) → 苏州博物馆(2小时) → 平江路(1小时)</p>
<ul>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=320506&from%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E8%8B%8F%E5%B7%9E%E8%8B%8F%E8%A0%A1%E8%B7%AF%E5%BA%97&from%5Bid%5D=B020018ASM&from%5Bpoitype%5D=100105&from%5Blnglat%5D=120.61590100000001%2C31.244855&from%5Bmodxy%5D=120.615529%2C31.24485&to%5Badcode%5D=320506&to%5Bname%5D=%E9%87%91%E9%B8%A1%E6%B9%96%E6%99%AF%E5%8C%BA&to%5Bid%5D=B020019OXQ&to%5Bpoitype%5D=110202&to%5Blnglat%5D=120.70095300000003%2C31.303466&to%5Bmodxy%5D=120.704358%2C31.323084&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">汉庭苏州苏蠡路酒店 - 金鸡湖景区</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=320506&from%5Bname%5D=%E9%87%91%E9%B8%A1%E6%B9%96%E6%99%AF%E5%8C%BA&from%5Bid%5D=B020019OXQ-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=120.70095300000003%2C31.303466&from%5Bmodxy%5D=120.704358%2C31.323084&to%5Badcode%5D=320508&to%5Bname%5D=%E6%8B%99%E6%94%BF%E5%9B%AD&to%5Bid%5D=B020001R2Q&to%5Bpoitype%5D=110202&to%5Blnglat%5D=120.629029%2C31.32416&to%5Bmodxy%5D=120.63063%2C31.323278&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">金鸡湖景区 - 拙政园</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=320508&from%5Bname%5D=%E6%8B%99%E6%94%BF%E5%9B%AD&from%5Bid%5D=B020001R2Q-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=120.629029%2C31.32416&from%5Bmodxy%5D=120.63063%2C31.323278&to%5Badcode%5D=320508&to%5Bname%5D=%E8%8B%8F%E5%B7%9E%E5%8D%9A%E7%89%A9%E9%A6%86&to%5Bid%5D=B020001285-to&to%5Bpoitype%5D=140100&to%5Blnglat%5D=120.627654%2C31.323&to%5Bmodxy%5D=120.627848%2C31.322573&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">拙政园 - 苏州博物馆</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=320508&from%5Bname%5D=%E8%8B%8F%E5%B7%9E%E5%8D%9A%E7%89%A9%E9%A6%86&from%5Bid%5D=B020001285-from&from%5Bpoitype%5D=140100&from%5Blnglat%5D=120.627654%2C31.323&from%5Bmodxy%5D=120.627848%2C31.322573&to%5Badcode%5D=320508&to%5Bname%5D=%E5%B9%B3%E6%B1%9F%E8%B7%AF&to%5Bid%5D=B02000K4XZ&to%5Bpoitype%5D=110202&to%5Blnglat%5D=120.63225999999997%2C31.318832&to%5Bmodxy%5D=120.632246%2C31.318878&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">苏州博物馆 - 平江路</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=320508&from%5Bname%5D=%E5%B9%B3%E6%B1%9F%E8%B7%AF&from%5Bid%5D=B02000K4XZ-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=120.63225999999997%2C31.318832&from%5Bmodxy%5D=120.632246%2C31.318878&to%5Badcode%5D=320506&to%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E8%8B%8F%E5%B7%9E%E8%8B%8F%E8%A0%A1%E8%B7%AF%E5%BA%97&to%5Bid%5D=B020018ASM&to%5Bpoitype%5D=100105&to%5Blnglat%5D=120.61590100000001%2C31.244855&to%5Bmodxy%5D=120.615529%2C31.24485&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">平江路 - 汉庭苏州苏蠡路酒店</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=320506&from%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E8%8B%8F%E5%B7%9E%E8%8B%8F%E8%A0%A1%E8%B7%AF%E5%BA%97&from%5Bid%5D=B020018ASM-from&from%5Bpoitype%5D=100105&from%5Blnglat%5D=120.61590100000001%2C31.244855&from%5Bmodxy%5D=120.615529%2C31.24485&to%5Badcode%5D=320508&to%5Bname%5D=%E8%8B%8F%E5%B7%9E%E5%8D%97%E9%97%A8%E6%B1%BD%E8%BD%A6%E5%AE%A2%E8%BF%90%E7%AB%99&to%5Bid%5D=B0FFFDX8ZR&to%5Bpoitype%5D=150400&to%5Blnglat%5D=120.63746400000002%2C31.278791&to%5Bmodxy%5D=120.637909%2C31.280558&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">汉庭苏州苏蠡路酒店 - 苏州南门汽车客运站</a></li>
<li><a href="https://bus.ctrip.com/busListn.html?from=%E8%8B%8F%E5%B7%9E&to=%E4%B9%8C%E9%95%87&date=2019-01-31&ctm_ref=baidu_pc&allianceid=1020737&sid=1618449" target="_blank" rel="noopener">苏州南门汽车客运站 - 乌镇客运站</a></li>
</ul>
<h2 id="乌镇"><a href="#乌镇" class="headerlink" title="乌镇"></a>乌镇</h2><h3 id="天气-2"><a href="#天气-2" class="headerlink" title="天气"></a>天气</h3><iframe width="100%" scrolling="no" height="60" frameborder="0" allowtransparency="true" src="//i.tianqi.com/index.php?c=code&id=12&icon=1&py=tongxiang&num=5&site=12"></iframe>
### 路线

<p>西栅景区(2小时) → 东栅景区(2小时)</p>
<ul>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330483&from%5Bname%5D=%E4%B9%8C%E9%95%87%E6%B1%BD%E8%BD%A6%E7%AB%99&from%5Bid%5D=B023D045MA&from%5Bpoitype%5D=150400&from%5Blnglat%5D=120.49405300000001%2C30.731302&from%5Bmodxy%5D=120.494128%2C30.731987&to%5Badcode%5D=330483&to%5Bname%5D=%E4%B9%8C%E9%95%87%E8%A5%BF%E6%A0%85%E6%99%AF%E5%8C%BA&to%5Bid%5D=B023D02SCY&to%5Bpoitype%5D=110202&to%5Blnglat%5D=120.48380900000001%2C30.74965&to%5Bmodxy%5D=120.492176%2C30.747969&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">乌镇客运站（行李寄存） - 西栅景区</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330483&from%5Bname%5D=%E4%B9%8C%E9%95%87%E8%A5%BF%E6%A0%85%E6%99%AF%E5%8C%BA&from%5Bid%5D=B023D02SCY-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=120.48380900000001%2C30.74965&from%5Bmodxy%5D=120.492176%2C30.747969&to%5Bid%5D=B023D03VEN&to%5Bname%5D=%E4%B9%8C%E9%95%87%E4%B8%9C%E6%A0%85%E6%99%AF%E5%8C%BA&to%5Blnglat%5D=120.496901%2C30.739693&to%5Bmodxy%5D=120.497805%2C30.736884&to%5Bpoitype%5D=110202&to%5Badcode%5D=330483&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">西栅景区 - 东栅景区</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023D03VEN-from&from%5Bname%5D=%E4%B9%8C%E9%95%87%E4%B8%9C%E6%A0%85%E6%99%AF%E5%8C%BA&from%5Blnglat%5D=120.496901%2C30.739693&from%5Bmodxy%5D=120.497805%2C30.736884&from%5Bpoitype%5D=110202&from%5Badcode%5D=330483&to%5Badcode%5D=330483&to%5Bname%5D=%E4%B9%8C%E9%95%87%E6%B1%BD%E8%BD%A6%E7%AB%99&to%5Bid%5D=B023D045MA-to&to%5Bpoitype%5D=150400&to%5Blnglat%5D=120.49405300000001%2C30.731302&to%5Bmodxy%5D=120.494128%2C30.731987&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">东栅景区 - 乌镇客运站</a></li>
<li><a href="https://bus.ctrip.com/busListn.html?from=%E4%B9%8C%E9%95%87&to=%E6%9D%AD%E5%B7%9E&date=2019-02-08" target="_blank" rel="noopener">乌镇客运站 - 杭州客运中心站</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B0AAW3-from&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E6%B1%BD%E8%BD%A6%E5%AE%A2%E8%BF%90%E4%B8%AD%E5%BF%83%E7%AB%99&from%5Blnglat%5D=120.279002%2C30.31307&from%5Bmodxy%5D=120.276727%2C30.311674&from%5Bpoitype%5D=150400&from%5Badcode%5D=330104&to%5Bid%5D=B023B1D1X1&to%5Bname%5D=%E6%B5%B7%E5%8F%8B%E9%85%92%E5%BA%97%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E5%A4%A7%E9%81%93%E5%BA%97&to%5Blnglat%5D=120.173872%2C30.247483&to%5Bmodxy%5D=120.173872%2C30.247682&to%5Bpoitype%5D=100105&to%5Badcode%5D=330102&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">杭州客运中心站 - 海友杭州西湖大道酒店</a></li>
</ul>
<h2 id="杭州"><a href="#杭州" class="headerlink" title="杭州"></a>杭州</h2><h3 id="总述"><a href="#总述" class="headerlink" title="总述"></a>总述</h3><iframe width="100%" scrolling="no" height="60" frameborder="0" allowtransparency="true" src="//i.tianqi.com/index.php?c=code&id=12&icon=1&py=hangzhou&num=5&site=12"></iframe>
### 住宿

<p>2019-02-09 14:00:00 ~ 2019-02-11 12:00:00</p>
<p><a href="http://hotels.huazhu.com/hotel/detail/3100092?CheckInDate=2019-02-09&CheckOutDate=2019-02-11" target="_blank" rel="noopener">海友杭州西湖大道酒店</a></p>
<p>双床房：吕聪慧，李欣芮，李永斌，李博</p>
<p>双床房：李一萍，李欣芮，李艳红，王钰溪</p>
<h3 id="第一天-1"><a href="#第一天-1" class="headerlink" title="第一天"></a>第一天</h3><h4 id="路线-4"><a href="#路线-4" class="headerlink" title="路线"></a>路线</h4><p>断桥残雪(10分钟) → 白堤(20分钟) → 孤山(1-2小时) → 楼外楼(孤山路店)(1小时) → 曲院风荷(1小时) → 苏堤春晓(30分钟) → 花港观鱼(1小时) → 吴山广场(1小时) → 西湖音乐喷泉(10分钟)</p>
<ul>
<li><a href="https://www.amap.com/dir?from%5Bname%5D=%E6%B5%B7%E5%8F%8B%E9%85%92%E5%BA%97%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E5%A4%A7%E9%81%93%E5%BA%97&from%5Blnglat%5D=120.173872%2C30.247483&from%5Bid%5D=B023B1D1X1&from%5Bpoitype%5D=100105&from%5Badcode%5D=330100&from%5Bmodxy%5D=120.173872%2C30.247682&to%5Badcode%5D=330106&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E6%96%AD%E6%A1%A5%E6%AE%8B%E9%9B%AA&to%5Bid%5D=B023B01EE6&to%5Bpoitype%5D=110202&to%5Blnglat%5D=120.15119500000003%2C30.258105&to%5Bmodxy%5D=120.1523%2C30.259286&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">海友杭州西湖大道酒店 - 断桥残雪</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330106&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E6%96%AD%E6%A1%A5%E6%AE%8B%E9%9B%AA&from%5Bid%5D=B023B01EE6-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=120.15119500000003%2C30.258105&from%5Bmodxy%5D=120.1523%2C30.259286&to%5Bid%5D=B0FFFTYEG4-to&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E7%99%BD%E5%A0%A4&to%5Blnglat%5D=120.149202%2C30.255651&to%5Bmodxy%5D=120.151323%2C30.258179&to%5Bpoitype%5D=110200&to%5Badcode%5D=330106&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">断桥残雪 - 白堤</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B0FFFTYEG4-from&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E7%99%BD%E5%A0%A4&from%5Blnglat%5D=120.149202%2C30.255651&from%5Bmodxy%5D=120.151323%2C30.258179&from%5Bpoitype%5D=110200&from%5Badcode%5D=330106&to%5Badcode%5D=330106&to%5Bname%5D=%E5%AD%A4%E5%B1%B1&to%5Bid%5D=B023B197QF&to%5Bpoitype%5D=190203&to%5Blnglat%5D=120.14275199999997%2C30.251897&to%5Bmodxy%5D=&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">白堤 - 孤山</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330106&from%5Bname%5D=%E5%AD%A4%E5%B1%B1&from%5Bid%5D=B023B197QF-from&from%5Bpoitype%5D=190203&from%5Blnglat%5D=120.14275199999997%2C30.251897&from%5Bmodxy%5D=&to%5Bid%5D=B023B09325&to%5Bname%5D=%E6%A5%BC%E5%A4%96%E6%A5%BC%E5%AD%A4%E5%B1%B1%E8%B7%AF%E5%BA%97&to%5Blnglat%5D=120.140682%2C30.250322&to%5Bmodxy%5D=120.140682%2C30.250322&to%5Bpoitype%5D=050101&to%5Badcode%5D=330106&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">孤山 - 楼外楼(孤山路店)</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B09325-from&from%5Bname%5D=%E6%A5%BC%E5%A4%96%E6%A5%BC%E5%AD%A4%E5%B1%B1%E8%B7%AF%E5%BA%97&from%5Blnglat%5D=120.140682%2C30.250322&from%5Bmodxy%5D=120.140682%2C30.250322&from%5Bpoitype%5D=050101&from%5Badcode%5D=330106&to%5Badcode%5D=330106&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E6%9B%B2%E9%99%A2%E9%A3%8E%E8%8D%B7&to%5Bid%5D=B023B0253E&to%5Bpoitype%5D=110200&to%5Blnglat%5D=120.13550199999997%2C30.251182&to%5Bmodxy%5D=120.132344%2C30.252057&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">楼外楼(孤山路店) - 曲院风荷</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330106&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E6%9B%B2%E9%99%A2%E9%A3%8E%E8%8D%B7&from%5Bid%5D=B023B0253E-from&from%5Bpoitype%5D=110200&from%5Blnglat%5D=120.13550199999997%2C30.251182&from%5Bmodxy%5D=120.132344%2C30.252057&to%5Badcode%5D=330106&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E8%8B%8F%E5%A0%A4%E6%98%A5%E6%99%93&to%5Bid%5D=B023B02070&to%5Bpoitype%5D=110200&to%5Blnglat%5D=120.13796000000002%2C30.24388&to%5Bmodxy%5D=120.138022%2C30.243896&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">曲院风荷 - 苏堤春晓</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330106&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E8%8B%8F%E5%A0%A4%E6%98%A5%E6%99%93&from%5Bid%5D=B023B02070-from&from%5Bpoitype%5D=110200&from%5Blnglat%5D=120.13796000000002%2C30.24388&from%5Bmodxy%5D=120.138022%2C30.243896&to%5Bid%5D=B023B023B2&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E8%8A%B1%E6%B8%AF%E8%A7%82%E9%B1%BC&to%5Blnglat%5D=120.142121%2C30.232194&to%5Bmodxy%5D=120.14246%2C30.232125&to%5Bpoitype%5D=110200&to%5Badcode%5D=330106&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">苏堤春晓 - 花港观鱼</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B023B2-from&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E8%8A%B1%E6%B8%AF%E8%A7%82%E9%B1%BC&from%5Blnglat%5D=120.142121%2C30.232194&from%5Bmodxy%5D=120.14246%2C30.232125&from%5Bpoitype%5D=110200&from%5Badcode%5D=330106&to%5Badcode%5D=330102&to%5Bname%5D=%E5%90%B4%E5%B1%B1%E6%99%AF%E5%8C%BA%E5%90%B4%E5%B1%B1%E5%B9%BF%E5%9C%BA%E8%A3%85%E4%BF%AE%E4%B8%AD&to%5Bid%5D=B023B0A5KT&to%5Bpoitype%5D=110105&to%5Blnglat%5D=120.16377999999997%2C30.239222&to%5Bmodxy%5D=120.162583%2C30.2398&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">花港观鱼 - 吴山广场</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330102&from%5Bname%5D=%E5%90%B4%E5%B1%B1%E6%99%AF%E5%8C%BA%E5%90%B4%E5%B1%B1%E5%B9%BF%E5%9C%BA%E8%A3%85%E4%BF%AE%E4%B8%AD&from%5Bid%5D=B023B0A5KT-from&from%5Bpoitype%5D=110105&from%5Blnglat%5D=120.16377999999997%2C30.239222&from%5Bmodxy%5D=120.162583%2C30.2398&to%5Bid%5D=B023B08WZ7-to&to%5Bname%5D=%E8%A5%BF%E6%B9%96%E9%9F%B3%E4%B9%90%E5%96%B7%E6%B3%89%E8%A1%A8%E6%BC%94&to%5Blnglat%5D=120.160970%2C30.253778&to%5Bmodxy%5D=120.161481%2C30.253925&to%5Bpoitype%5D=220106&to%5Badcode%5D=330102&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">吴山广场 - 西湖音乐喷泉</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B08WZ7-from&from%5Bname%5D=%E8%A5%BF%E6%B9%96%E9%9F%B3%E4%B9%90%E5%96%B7%E6%B3%89%E8%A1%A8%E6%BC%94&from%5Blnglat%5D=120.160970%2C30.253778&from%5Bmodxy%5D=120.161481%2C30.253925&from%5Bpoitype%5D=220106&from%5Badcode%5D=330102&to%5Bid%5D=B023B1D1X1&to%5Bname%5D=%E6%B5%B7%E5%8F%8B%E9%85%92%E5%BA%97%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E5%A4%A7%E9%81%93%E5%BA%97&to%5Blnglat%5D=120.173872%2C30.247483&to%5Bmodxy%5D=120.173872%2C30.247682&to%5Bpoitype%5D=100105&to%5Badcode%5D=330102&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">西湖音乐喷泉 - 海友杭州西湖大道酒店</a></li>
</ul>
<h3 id="第二天-1"><a href="#第二天-1" class="headerlink" title="第二天"></a>第二天</h3><h4 id="路线-5"><a href="#路线-5" class="headerlink" title="路线"></a>路线</h4><p>灵隐飞来峰(1小时) → 灵隐寺(1-2小时) → 雷峰塔(2小时) → 柳浪闻莺(1小时) → 河坊街(1-2小时)</p>
<ul>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B1D1X1&from%5Bname%5D=%E6%B5%B7%E5%8F%8B%E9%85%92%E5%BA%97%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E5%A4%A7%E9%81%93%E5%BA%97&from%5Blnglat%5D=120.173872%2C30.247483&from%5Bmodxy%5D=120.173872%2C30.247682&from%5Bpoitype%5D=100105&from%5Badcode%5D=330102&to%5Bid%5D=B023B05MJE&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E7%81%B5%E9%9A%90%E9%A3%9E%E6%9D%A5%E5%B3%B0&to%5Blnglat%5D=120.102244%2C30.239433&to%5Bmodxy%5D=120.105344%2C30.240648&to%5Bpoitype%5D=110200&to%5Badcode%5D=330106&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">海友杭州西湖大道酒店 - 灵隐飞来峰</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B05MJE-from&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E7%81%B5%E9%9A%90%E9%A3%9E%E6%9D%A5%E5%B3%B0&from%5Blnglat%5D=120.102244%2C30.239433&from%5Bmodxy%5D=120.105344%2C30.240648&from%5Bpoitype%5D=110200&from%5Badcode%5D=330106&to%5Badcode%5D=330106&to%5Bname%5D=%E7%81%B5%E9%9A%90%E5%AF%BA&to%5Bid%5D=B023B02842&to%5Bpoitype%5D=110202&to%5Blnglat%5D=120.10119299999997%2C30.238169&to%5Bmodxy%5D=120.105346%2C30.240649&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">灵隐飞来峰 - 灵隐寺</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330106&from%5Bname%5D=%E7%81%B5%E9%9A%90%E5%AF%BA&from%5Bid%5D=B023B02842-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=120.10119299999997%2C30.238169&from%5Bmodxy%5D=120.105346%2C30.240649&to%5Badcode%5D=330106&to%5Bname%5D=%E9%9B%B7%E5%B3%B0%E5%A1%94%E6%99%AF%E5%8C%BA&to%5Bid%5D=B023B09LKR-to&to%5Bpoitype%5D=110202&to%5Blnglat%5D=120.14887199999998%2C30.230895&to%5Bmodxy%5D=120.149266%2C30.230364&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">灵隐寺 - 雷峰塔</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330106&from%5Bname%5D=%E9%9B%B7%E5%B3%B0%E5%A1%94%E6%99%AF%E5%8C%BA&from%5Bid%5D=B023B09LKR-from&from%5Bpoitype%5D=110202&from%5Blnglat%5D=120.14887199999998%2C30.230895&from%5Bmodxy%5D=120.149266%2C30.230364&to%5Bid%5D=B023B0247C&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E6%9F%B3%E6%B5%AA%E9%97%BB%E8%8E%BA&to%5Blnglat%5D=120.158000%2C30.239366&to%5Bmodxy%5D=120.158221%2C30.239325&to%5Bpoitype%5D=110200&to%5Badcode%5D=330102&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">雷峰塔 - 柳浪闻莺</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B0247C-from&from%5Bname%5D=%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E9%A3%8E%E6%99%AF%E5%90%8D%E8%83%9C%E5%8C%BA-%E6%9F%B3%E6%B5%AA%E9%97%BB%E8%8E%BA&from%5Blnglat%5D=120.158000%2C30.239366&from%5Bmodxy%5D=120.158221%2C30.239325&from%5Bpoitype%5D=110200&from%5Badcode%5D=330102&to%5Badcode%5D=330102&to%5Bname%5D=%E6%B2%B3%E5%9D%8A%E8%A1%97&to%5Bid%5D=B0FFGQ772L-to&to%5Bpoitype%5D=190301&to%5Blnglat%5D=120.16863000000001%2C30.240099&to%5Bmodxy%5D=&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">柳浪闻莺 - 河坊街</a></li>
<li><a href="https://www.amap.com/dir?from%5Badcode%5D=330102&from%5Bname%5D=%E6%B2%B3%E5%9D%8A%E8%A1%97&from%5Bid%5D=B0FFGQ772L-from&from%5Bpoitype%5D=190301&from%5Blnglat%5D=120.16863000000001%2C30.240099&from%5Bmodxy%5D=&to%5Bid%5D=B023B1D1X1-to&to%5Bname%5D=%E6%B5%B7%E5%8F%8B%E9%85%92%E5%BA%97%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E5%A4%A7%E9%81%93%E5%BA%97&to%5Blnglat%5D=120.173872%2C30.247483&to%5Bmodxy%5D=120.173872%2C30.247682&to%5Bpoitype%5D=100105&to%5Badcode%5D=330102&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">河坊街- 海友杭州西湖大道酒店</a></li>
<li><a href="https://www.amap.com/dir?from%5Bid%5D=B023B1D1X1-from&from%5Bname%5D=%E6%B5%B7%E5%8F%8B%E9%85%92%E5%BA%97%E6%9D%AD%E5%B7%9E%E8%A5%BF%E6%B9%96%E5%A4%A7%E9%81%93%E5%BA%97&from%5Blnglat%5D=120.173872%2C30.247483&from%5Bmodxy%5D=120.173872%2C30.247682&from%5Bpoitype%5D=100105&from%5Badcode%5D=330102&to%5Bid%5D=B023B07ERI-to&to%5Bname%5D=%E6%9D%AD%E5%B7%9E%E7%AB%99&to%5Blnglat%5D=120.182839%2C30.243403&to%5Bmodxy%5D=120.181827%2C30.244185&to%5Bpoitype%5D=150200&to%5Badcode%5D=330102&type=walk&policy=0&dateTime=now" target="_blank" rel="noopener">海友杭州西湖大道酒店 - 杭州站</a></li>
</ul>
]]></content>
      <categories>
        <category>Strategy</category>
      </categories>
      <tags>
        <tag>Tour</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Algorithm</title>
    <url>/2019/01/05/Study-Notes-of-Algorithm/</url>
    <content><![CDATA[<img data-src="https://www.kaleandcaramel.com/wp-content/uploads/2018/06/honest-insta-word-cloud.png" width="100%"/>

<a id="more"></a>

<h2 id="排名算法"><a href="#排名算法" class="headerlink" title="排名算法"></a>排名算法</h2><blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html" target="_blank" rel="noopener">基于用户投票的排名算法（一）：Delicious和Hacker News</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_reddit.html" target="_blank" rel="noopener">基于用户投票的排名算法（二）：Reddit</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_stack_overflow.html" target="_blank" rel="noopener">基于用户投票的排名算法（三）：Stack Overflow</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_newton_s_law_of_cooling.html" target="_blank" rel="noopener">基于用户投票的排名算法（四）：牛顿冷却定律</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_wilson_score_interval.html" target="_blank" rel="noopener">基于用户投票的排名算法（五）：威尔逊区间</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_bayesian_average.html" target="_blank" rel="noopener">基于用户投票的排名算法（六）：贝叶斯平均</a></p>
</blockquote>
<h3 id="Hacker-News"><a href="#Hacker-News" class="headerlink" title="Hacker News"></a>Hacker News</h3><p><img data-src="https://i.loli.net/2018/12/12/5c10c01fd8f48.png" alt=""></p>
<p>P：表示帖子的得票数，减去1是为了忽略发帖人的投票。</p>
<p>T：表示距离发帖的时间（单位为小时），加上2是为了防止最新的帖子导致分母过小（之所以选择2，可能是因为从原始文章出现在其他网站，到转贴至Hacker News，平均需要两个小时）。</p>
<p>G：表示”重力因子”（gravityth power），即将帖子排名往下拉的力量，默认值为1.8</p>
<p>结论：</p>
<ol>
<li>得票越多，排名越高。</li>
<li>发帖时间越新，排名越高。或者说，帖子的排名会随着时间不断下降。（经过24小时之后，所有帖子的得分基本上都小于1）</li>
<li><strong>重力因子G</strong>数值大小决定了排名随时间下降的速度。G值越大，排名下降得越快。</li>
</ol>
<p>缺点：用户只能投赞成票，不允许用户投反对票</p>
<h3 id="Reddit"><a href="#Reddit" class="headerlink" title="Reddit"></a>Reddit</h3><p><img data-src="https://i.loli.net/2018/12/12/5c10c8a584474.png" alt=""></p>
<p>t：帖子的新旧程度，<code>t = 发贴时间 - 2005年12月8日7:46:43</code>，单位为秒，用unix时间戳计算。</p>
<p>x：赞成票与反对票的差，<code>x = 赞成票 - 反对票</code></p>
<p>y：投票方向，y是一个符号变量，表示对文章的总体看法。如果赞成票居多，y就是+1；如果反对票居多，y就是-1；如果赞成票和反对票相等，y就是0。</p>
<p><img data-src="https://i.loli.net/2018/12/12/5c10c965abb44.png" alt=""></p>
<p>z：帖子的受肯定（否定）的程度，z表示赞成票与反对票之间差额的绝对值。如果对某个帖子的评价，越是一边倒，z就越大。如果赞成票等于反对票，z就等于1。</p>
<p><img data-src="https://i.loli.net/2018/12/12/5c10c9b792fa4.png" alt=""></p>
<p>总结：</p>
<ol>
<li>赞成票与反对票的差额z越大，得分越高。</li>
<li>差额越大，分数越不受投票影响。</li>
<li>帖子越新，分数越高。分数会随时间下降</li>
</ol>
<p>缺点：不利于赞成票和反对票都比较高，但两者非常接近的情况。假定同一时间有两个帖子发表，文章A有1张赞成票（发帖人投的）、0张反对票，文章B有1000张赞成票、1000张反对票，那么A的排名会高于B。</p>
<p><strong>Reddit的排名，基本上由发帖时间决定，超级受欢迎的文章会排在最前面，一般性受欢迎的文章、有争议的文章都不会很靠前。</strong>这决定了Reddit是一个符合大众口味的社区，不是一个很激进、可以展示少数派想法的地方。</p>
<h3 id="Stack-Overflow"><a href="#Stack-Overflow" class="headerlink" title="Stack Overflow"></a>Stack Overflow</h3><p><img data-src="https://i.loli.net/2018/12/12/5c10d5fa90af2.png" alt=""></p>
<p><strong>Qviews：问题的浏览次数</strong></p>
<p>问题的浏览次数越多，就代表越受关注，得分也就越高。取对数的用意是当访问量越来越大，它对得分的影响将不断变小。</p>
<p><strong>Qscore：问题得分</strong></p>
<p>Qscore = 赞成票 - 反对票</p>
<p><strong>Qanswers：回答的数量</strong></p>
<p>回答的数量代表有多少人参与这个问题。这个值越大，得分将成倍放大。这里需要注意的是，如果无人回答，Qscore再高也没用，意味着再好的问题，也必须有人回答，否则进不了热点问题排行榜。</p>
<p><strong>Ascores：回答得分</strong></p>
<p>“回答”比”问题”更有意义。这一项的得分越高，就代表回答的质量越高。</p>
<p>简单加总的设计还不够全面。<strong>首先</strong>，一个正确的回答胜过一百个无用的回答，简单加总会导致，1个得分为100的回答与100个得分为1的回答，总得分相同。<strong>其次</strong>，由于得分会出现负值，因此那些特别差的回答，会拉低正确回答的得分。</p>
<p><strong>Qage：距离问题发表的时间</strong></p>
<p>随着时间流逝，这个值都会越变越大，导致分母增大，因此总得分会越来越小。</p>
<p><strong>Qupdated：距离最后一个回答的时间</strong></p>
<p>随着时间流逝，这个值都会越变越大，导致分母增大，因此总得分会越来越小。</p>
<p><strong>总结</strong></p>
<p>Stack Overflow热点问题的排名，与<strong>参与度</strong>（Qviews和Qanswers）和<strong>质量</strong>（Qscore和Ascores）成正比，与<strong>时间</strong>（Qage和Qupdated）成反比。</p>
<h2 id="分布式ID生成算法"><a href="#分布式ID生成算法" class="headerlink" title="分布式ID生成算法"></a>分布式ID生成算法</h2><h3 id="Twitter-SnowFlake"><a href="#Twitter-SnowFlake" class="headerlink" title="Twitter SnowFlake"></a>Twitter SnowFlake</h3><blockquote>
<p><a href="https://github.com/twitter-archive/snowflake" target="_blank" rel="noopener">snowflake</a></p>
<p><a href="https://www.lanindex.com/twitter-snowflake%EF%BC%8C64%E4%BD%8D%E8%87%AA%E5%A2%9Eid%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3/" target="_blank" rel="noopener">Twitter-Snowflake，64位自增ID算法详解</a></p>
<p><a href="https://blog.csdn.net/yangding_/article/details/52768906" target="_blank" rel="noopener">Twitter Snowflake算法详解</a></p>
</blockquote>
<p>把<strong>时间戳</strong>，<strong>工作机器id</strong>，<strong>序列号</strong>组合在一起。</p>
<p><img data-src="https://www.lanindex.com/wp-content/uploads/2015/04/snowflake-64bit.jpg" alt=""></p>
<p>​    默认情况下 41bit 的时间戳可以支持该算法使用到 2082 年，10bit 的工作机器 id 可以支持1024台机器，序列号持 1 毫秒产生 4096 个自增序列 id。SnowFlake 的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生 ID 碰撞(由数据中心 ID 和机器 ID 作区分)，并且效率较高，经测试，SnowFlake 每秒能够产生 26 万 ID 左右。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Twitter_Snowflake</span></span><br><span class="line"><span class="comment"> * SnowFlake的结构如下(每部分用-分开):</span></span><br><span class="line"><span class="comment"> * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000</span></span><br><span class="line"><span class="comment"> * 1位标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是0，负数是1，id一般是正数，所以最高位是0</span></span><br><span class="line"><span class="comment"> * 41位时间截(毫秒级)，注意，41位时间截不是存储当前时间的时间截，而是存储时间截的差值（当前时间截 - 开始时间截)得到的值）</span></span><br><span class="line"><span class="comment"> * 这里的的开始时间截，一般是我们的id生成器开始使用的时间，由我们程序来指定的（如下下面程序IdWorker类的startTime属性）。</span></span><br><span class="line"><span class="comment"> * 41位的时间截，可以使用69年： (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69</span></span><br><span class="line"><span class="comment"> * 10位的数据机器位，可以部署1024个节点，包括5位datacenterId和5位workerId</span></span><br><span class="line"><span class="comment"> * 12位序列，毫秒内的计数，12位的计数顺序号支持每个节点每毫秒(同一机器，同一时间截)产生4096个ID序号</span></span><br><span class="line"><span class="comment"> * 加起来刚好64位，为一个Long型。</span></span><br><span class="line"><span class="comment"> * SnowFlake的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据中心ID和机器ID作区分)，并且效率较高，经测试，SnowFlake每秒能够产生26万ID左右。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SnowflakeIdWorker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ==============================Fields===========================================</span></span><br><span class="line">    <span class="comment">/** 开始时间截 (2015-01-01) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> twepoch = <span class="number">1420041600000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 机器id所占的位数 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> workerIdBits = <span class="number">5L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 数据标识id所占的位数 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> datacenterIdBits = <span class="number">5L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 支持的最大机器id，结果是31 (这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> maxWorkerId = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; workerIdBits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 支持的最大数据标识id，结果是31 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> maxDatacenterId = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; datacenterIdBits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 序列在id中占的位数 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> sequenceBits = <span class="number">12L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 机器ID向左移12位 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> workerIdShift = sequenceBits;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 数据标识id向左移17位(12+5) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> datacenterIdShift = sequenceBits + workerIdBits;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 时间截向左移22位(5+5+12) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 生成序列的掩码，这里为4095 (0b111111111111=0xfff=4095) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> sequenceMask = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; sequenceBits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 工作机器ID(0~31) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> workerId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 数据中心ID(0~31) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> datacenterId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 毫秒内序列(0~4095) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> sequence = <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 上次生成ID的时间截 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> lastTimestamp = -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==============================Constructors=====================================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workerId 工作ID (0~31)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datacenterId 数据中心ID (0~31)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SnowflakeIdWorker</span><span class="params">(<span class="keyword">long</span> workerId, <span class="keyword">long</span> datacenterId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(String.format(<span class="string">"worker Id can't be greater than %d or less than 0"</span>, maxWorkerId));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(String.format(<span class="string">"datacenter Id can't be greater than %d or less than 0"</span>, maxDatacenterId));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.workerId = workerId;</span><br><span class="line">        <span class="keyword">this</span>.datacenterId = datacenterId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ==============================Methods==========================================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得下一个ID (该方法是线程安全的)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SnowflakeId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">long</span> <span class="title">nextId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> timestamp = timeGen();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (timestamp &lt; lastTimestamp) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                    String.format(<span class="string">"Clock moved backwards.  Refusing to generate id for %d milliseconds"</span>, lastTimestamp - timestamp));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果是同一时间生成的，则进行毫秒内序列</span></span><br><span class="line">        <span class="keyword">if</span> (lastTimestamp == timestamp) &#123;</span><br><span class="line">            sequence = (sequence + <span class="number">1</span>) &amp; sequenceMask;</span><br><span class="line">            <span class="comment">//毫秒内序列溢出</span></span><br><span class="line">            <span class="keyword">if</span> (sequence == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//阻塞到下一个毫秒,获得新的时间戳</span></span><br><span class="line">                timestamp = tilNextMillis(lastTimestamp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//时间戳改变，毫秒内序列重置</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            sequence = <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上次生成ID的时间截</span></span><br><span class="line">        lastTimestamp = timestamp;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//移位并通过或运算拼到一起组成64位的ID</span></span><br><span class="line">        <span class="keyword">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) <span class="comment">//</span></span><br><span class="line">                | (datacenterId &lt;&lt; datacenterIdShift) <span class="comment">//</span></span><br><span class="line">                | (workerId &lt;&lt; workerIdShift) <span class="comment">//</span></span><br><span class="line">                | sequence;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 阻塞到下一个毫秒，直到获得新的时间戳</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lastTimestamp 上次生成ID的时间截</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前时间戳</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">tilNextMillis</span><span class="params">(<span class="keyword">long</span> lastTimestamp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> timestamp = timeGen();</span><br><span class="line">        <span class="keyword">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class="line">            timestamp = timeGen();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> timestamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回以毫秒为单位的当前时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前时间(毫秒)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">timeGen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==============================Test=============================================</span></span><br><span class="line">    <span class="comment">/** 测试 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SnowflakeIdWorker idWorker = <span class="keyword">new</span> SnowflakeIdWorker(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">long</span> id = idWorker.nextId();</span><br><span class="line">            System.out.println(Long.toBinaryString(id));</span><br><span class="line">            System.out.println(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="利用位运算计算指定位数的最大值"><a href="#利用位运算计算指定位数的最大值" class="headerlink" title="利用位运算计算指定位数的最大值"></a>利用位运算计算指定位数的最大值</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; len);</span><br></pre></td></tr></table></figure>

<p>eg:  5 位二进制最大值为 31</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-1L &#x3D;</span><br><span class="line">1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111</span><br><span class="line"></span><br><span class="line">-1L &lt;&lt; 5 &#x3D;</span><br><span class="line">1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1110 0000</span><br><span class="line"></span><br><span class="line">-1L ^ (-1L &lt;&lt; len) &#x3D;</span><br><span class="line">  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111</span><br><span class="line">^ 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1110 0000</span><br><span class="line">&#x3D; 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1111</span><br><span class="line">&#x3D; 31(D)</span><br></pre></td></tr></table></figure>

<h2 id="签名算法"><a href="#签名算法" class="headerlink" title="签名算法"></a>签名算法</h2><h3 id="排序加密签名算法"><a href="#排序加密签名算法" class="headerlink" title="排序加密签名算法"></a>排序加密签名算法</h3><blockquote>
<p><a href="https://blog.csdn.net/fengshizty/article/details/48754609" target="_blank" rel="noopener">App开放接口api安全性—Token签名sign的设计与实现</a></p>
</blockquote>
<ol>
<li>按照参数名ASCII码从小到大排序（字典序）</li>
<li>使用URL键值对的格式（即key1=value1&amp;key2=value2…）拼接成字符串。</li>
<li>加密算法对字符串进行加密，得到签名。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>： libo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>： 2019/1/14:15:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SignUtil</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createSign</span><span class="params">(Map&lt;String, String&gt; params, <span class="keyword">boolean</span> encode)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">        Set&lt;String&gt; keysSet = params.keySet();</span><br><span class="line">        Object[] keys = keysSet.toArray();</span><br><span class="line">        Arrays.sort(keys);</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">boolean</span> first = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (Object key : keys) &#123;</span><br><span class="line">            <span class="keyword">if</span> (first) &#123;</span><br><span class="line">                first = <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sb.append(<span class="string">"&amp;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(key).append(<span class="string">"="</span>);</span><br><span class="line">            Object value = params.get(key);</span><br><span class="line">            String valueString = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != value) &#123;</span><br><span class="line">                valueString = String.valueOf(value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (encode) &#123;</span><br><span class="line">                sb.append(URLEncoder.encode(valueString, <span class="string">"UTF-8"</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sb.append(valueString);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> md5(sb.toString()).toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">md5</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        MessageDigest md = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] data = value.getBytes(<span class="string">"utf-8"</span>);</span><br><span class="line">            md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            <span class="keyword">byte</span>[] digestData = md.digest(data);</span><br><span class="line">            <span class="keyword">return</span> toHex(digestData);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toHex</span><span class="params">(<span class="keyword">byte</span> input[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer output = <span class="keyword">new</span> StringBuffer(input.length * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; input.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> current = input[i] &amp; <span class="number">0xff</span>;</span><br><span class="line">            <span class="keyword">if</span> (current &lt; <span class="number">16</span>)</span><br><span class="line">                output.append(<span class="string">"0"</span>);</span><br><span class="line">            output.append(Integer.toString(current, <span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> output.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RC4算法"><a href="#RC4算法" class="headerlink" title="RC4算法"></a>RC4算法</h3><blockquote>
<p><a href="https://blog.csdn.net/White_Idiot/article/details/65937877" target="_blank" rel="noopener">【密码学】RC4加解密原理及其Java和C实现算法</a></p>
<p><a href="https://www.cnblogs.com/zwios/p/4196836.html" target="_blank" rel="noopener">RC4加密解密算法原理与完整源代码实例演示</a></p>
<p><a href="https://www.cnblogs.com/zibility/p/5404478.html" target="_blank" rel="noopener">RC4加密算法</a></p>
</blockquote>
<p><strong>加密原理</strong></p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/2482101-2c5eb05fcc70d1fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt=""></p>
<p><img data-src="https://images2015.cnblogs.com/blog/889809/201604/889809-20160418145446757-1328061961.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RC4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RC4 rc4 = <span class="keyword">new</span> RC4();</span><br><span class="line"></span><br><span class="line">        String plaintext = <span class="string">"helloworld"</span>;</span><br><span class="line">        String key = <span class="string">"key"</span>;</span><br><span class="line"></span><br><span class="line">        String ciphertext = rc4.encrypt(plaintext, key);</span><br><span class="line">        String decryptText = rc4.encrypt(ciphertext, key);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"明文为："</span> + plaintext);</span><br><span class="line">        System.out.println(<span class="string">"密钥为："</span> + key);</span><br><span class="line">        System.out.println(<span class="string">"密文为："</span> + ciphertext);</span><br><span class="line">        System.out.println(<span class="string">"解密为："</span> + decryptText);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 加密</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">encrypt</span><span class="params">(<span class="keyword">final</span> String plaintext, <span class="keyword">final</span> String key)</span> </span>&#123;</span><br><span class="line">        Integer[] S = <span class="keyword">new</span> Integer[<span class="number">256</span>]; <span class="comment">// S盒</span></span><br><span class="line">        Character[] keySchedule = <span class="keyword">new</span> Character[plaintext.length()]; <span class="comment">// 生成的密钥流</span></span><br><span class="line">        StringBuffer ciphertext = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        ksa(S, key);</span><br><span class="line">        rpga(S, keySchedule, plaintext.length());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; plaintext.length(); ++i) &#123;</span><br><span class="line">            ciphertext.append((<span class="keyword">char</span>) (plaintext.charAt(i) ^ keySchedule[i]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ciphertext.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.1 KSA--密钥调度算法--利用key来对S盒做一个置换，也就是对S盒重新排列</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ksa</span><span class="params">(Integer[] s, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i) &#123;</span><br><span class="line">            s[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i) &#123;</span><br><span class="line">            j = (j + s[i] + key.charAt(i % key.length())) % <span class="number">256</span>;</span><br><span class="line">            swap(s, i, j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2 RPGA--伪随机生成算法--利用上面重新排列的S盒来产生任意长度的密钥流</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rpga</span><span class="params">(Integer[] s, Character[] keySchedule, <span class="keyword">int</span> plaintextLength)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; plaintextLength; ++k) &#123;</span><br><span class="line">            i = (i + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">            j = (j + s[i]) % <span class="number">256</span>;</span><br><span class="line">            swap(s, i, j);</span><br><span class="line">            keySchedule[k] = (<span class="keyword">char</span>) (s[(s[i] + s[j]) % <span class="number">256</span>]).intValue();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3 置换</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(Integer[] s, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        Integer mTemp = s[i];</span><br><span class="line">        s[i] = s[j];</span><br><span class="line">        s[j] = mTemp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Android</title>
    <url>/2019/08/30/Study-Notes-of-Android/</url>
    <content><![CDATA[<img data-src="cover" width="100%"/>

<a id="more"></a>

<h2 id="Android屏幕区域划分"><a href="#Android屏幕区域划分" class="headerlink" title="Android屏幕区域划分"></a>Android屏幕区域划分</h2><blockquote>
<p><a href="https://blog.csdn.net/zengruiyue/article/details/100116418" target="_blank" rel="noopener">Android 自定义View之坐标系</a></p>
</blockquote>
<p><img data-src="https://p1htmlkernalweb.mybluemix.net/image/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemVuZ3J1aXl1ZS9hcnRpY2xlL2RldGFpbHMvMTAwMTE2NDE4_aHR0cHM6Ly9pbWctYmxvZy5jc2RuaW1nLmNuLzIwMTkwODI4MTYzNzU5MzIyLnBuZz94LW9zcy1wcm9jZXNzPWltYWdlL3dhdGVybWFyayx0eXBlX1ptRnVaM3BvWlc1bmFHVnBkR2ssc2hhZG93XzEwLHRleHRfYUhSMGNITTZMeTlpYkc5bkxtTnpaRzR1Ym1WMEwzcGxibWR5ZFdsNWRXVT0sc2l6ZV8xNixjb2xvcl9GRkZGRkYsdF83MA==" alt=""></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Apache Commons</title>
    <url>/2019/08/30/Study-Notes-of-Apache-Commons/</url>
    <content><![CDATA[<img data-src="https://commons.apache.org/images/commons-logo.png" width="100%"/>

<a id="more"></a>

<h2 id="Commons-Lang"><a href="#Commons-Lang" class="headerlink" title="Commons Lang"></a>Commons Lang</h2><blockquote>
<h2 id="Commons-Lang-1"><a href="#Commons-Lang-1" class="headerlink" title="Commons Lang"></a>Commons Lang</h2><p>The standard Java libraries fail to provide enough methods for manipulation of its core classes. Apache Commons Lang provides these extra methods.</p>
<p>Lang provides a host of helper utilities for the java.lang API, notably String manipulation methods, basic numerical methods, object reflection, concurrency, creation and serialization and System properties. Additionally it contains basic enhancements to java.util.Date and a series of utilities dedicated to help with building methods, such as hashCode, toString and equals.</p>
</blockquote>
<h3 id="StringEscapeUtils"><a href="#StringEscapeUtils" class="headerlink" title="StringEscapeUtils"></a>StringEscapeUtils</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"&amp;apos;s-Hertogenbosch"</span>);</span><br><span class="line">  System.out.println(StringEscapeUtils.unescapeXml(<span class="string">"&amp;apos;s-Hertogenbosch"</span>));</span><br><span class="line">  <span class="comment">//&amp;apos;s-Hertogenbosch</span></span><br><span class="line">	<span class="comment">//'s-Hertogenbosch</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Apache</category>
        <category>Commons</category>
      </categories>
      <tags>
        <tag>Apache Commons</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Apache POI</title>
    <url>/2019/08/30/Study-Notes-of-Apache-POI/</url>
    <content><![CDATA[<img data-src="http://poi.apache.org/images/project-header.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://poi.apache.org/index.html" target="_blank" rel="noopener">Apache POI</a></p>
</blockquote>
<h2 id="HSSF，XSSF，SXSSF的区别"><a href="#HSSF，XSSF，SXSSF的区别" class="headerlink" title="HSSF，XSSF，SXSSF的区别"></a>HSSF，XSSF，SXSSF的区别</h2><blockquote>
<p><a href="https://blog.csdn.net/SudaDays/article/details/90669237" target="_blank" rel="noopener">POI快速入门教程 | HSSF，XSSF，SXSSF的区别</a></p>
</blockquote>
<p>简单的说，HSSF 对应旧的 xls 格式，XSSF 对应新的 xlsx 格式，SXSSF 是在 XSSF 的基础上，支持导出大批量的 excel 数据。</p>
]]></content>
      <categories>
        <category>Apache</category>
        <category>POI</category>
      </categories>
      <tags>
        <tag>POI</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Axure</title>
    <url>/2019/08/16/Study-Notes-of-Axure/</url>
    <content><![CDATA[<img data-src="http://humbleux.com/wp-content/uploads/edd/2017/03/Axure-responsive-Store-template-1-Cover.png" width="100%"/>

<a id="more"></a>

<h2 id="界面详解"><a href="#界面详解" class="headerlink" title="界面详解"></a>界面详解</h2><blockquote>
<p><a href="https://www.axure.com.cn/78577/" target="_blank" rel="noopener">Axure RP 9 教程—基本功能介绍1-界面介绍</a></p>
</blockquote>
<h2 id="移动画布"><a href="#移动画布" class="headerlink" title="移动画布"></a>移动画布</h2><ul>
<li>Axure RP 9支持负坐标，可以通过按住空格键不放，拖动画布来调整编辑区域的位置。</li>
<li>按住空格键不放，通过鼠标滚轮垂直方向移动画布，按住 Shift 键不放，通过鼠标滚轮水平方向移动画布</li>
<li>点击画布坐标尺左上角的十字交叉（Command + 9）可以回到原点。</li>
</ul>
<h2 id="钢笔"><a href="#钢笔" class="headerlink" title="钢笔"></a>钢笔</h2><h3 id="绘制路径"><a href="#绘制路径" class="headerlink" title="绘制路径"></a>绘制路径</h3><ul>
<li>封闭路径：开始锚点与结束锚点重合</li>
<li>开放路径：双击或ESC</li>
<li>直转曲：按住左键拖动，根据曲线杆调整弯曲方向</li>
</ul>
<h3 id="编辑路径"><a href="#编辑路径" class="headerlink" title="编辑路径"></a>编辑路径</h3><ul>
<li>编辑路径：点击控点激活，拖动锚点编辑</li>
<li>多选：按住 Shift 选</li>
<li>直曲切换：双击锚点/右键选择直或曲</li>
<li>拖动曲线杆调整弯曲程度</li>
<li>按住 Command 可以仅调整一边的弧度</li>
</ul>
<h3 id="锚点增删"><a href="#锚点增删" class="headerlink" title="锚点增删"></a>锚点增删</h3><ul>
<li>点击路径，新建锚点</li>
<li>删除锚点：选择锚点，Del删除/右键删除</li>
</ul>
<h2 id="母版"><a href="#母版" class="headerlink" title="母版"></a>母版</h2><p>母版是为了让页面中某一模块内容可以重复使用，并且在修改内容时能够同步更新。例如网站主导航、页脚等。</p>
<ul>
<li>可以利用动态面板的【固定到浏览器】功能实现网站悬浮小窗口</li>
</ul>
<h2 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h2><h3 id="屏幕尺寸"><a href="#屏幕尺寸" class="headerlink" title="屏幕尺寸"></a>屏幕尺寸</h3><p>屏幕大小，屏幕对角线的长度，单位是英寸，1英寸 = 2.54 厘米</p>
<h3 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h3><p>屏幕拥有的像素总数以及屏幕水平（宽）和垂直（高）方向的像素数量，单位为像素。</p>
<h3 id="像素密度"><a href="#像素密度" class="headerlink" title="像素密度"></a>像素密度</h3><p>ppi（pixels per inch）指每英寸所拥有的像素数。</p>
<p>计算公式：<br>$$<br>\sqrt(X^2 + Y^2) / Z<br>$$</p>
<ul>
<li>X：垂直像素数</li>
<li>Y：水平像素数</li>
<li>Z：屏幕尺寸</li>
<li>即：对角线上的像素数除以屏幕对角线长度</li>
</ul>
<h4 id="ppi-与-dpi"><a href="#ppi-与-dpi" class="headerlink" title="ppi 与 dpi"></a>ppi 与 dpi</h4><p>dpi（dot per inch）指每英寸所能印刷出来的网点数，是衡量打印机打印精度的主要参数之一。</p>
<h3 id="视网膜屏幕"><a href="#视网膜屏幕" class="headerlink" title="视网膜屏幕"></a>视网膜屏幕</h3><p>当你拿的手机距离你约 25-30 厘米，如果手机 ppi 达到 300 以上，你的眼睛将无法分辨出像素点。这就是苹果提出的视网膜屏幕。</p>
<h3 id="Android-开发单位"><a href="#Android-开发单位" class="headerlink" title="Android 开发单位"></a>Android 开发单位</h3><p>Android 程序开发统一使用虚拟尺寸单位：dp/dip（Density-independent pixels）、sp（Scale-independent Pixels）</p>
<ul>
<li>dp/dip：用于 Android 元素尺寸，如按钮、导航尺寸</li>
<li>sp：用于 Android 字体尺寸大小</li>
</ul>
<h2 id="插入-SVG"><a href="#插入-SVG" class="headerlink" title="插入 SVG"></a>插入 SVG</h2><ol>
<li>将 SVG 文件拖入画布或者双击图片元件导入 SVG 文件</li>
<li>选中图片右键选择【转换 SVG 图片为形状】</li>
</ol>
]]></content>
      <categories>
        <category>Axure</category>
      </categories>
      <tags>
        <tag>Axure</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Bootstrap</title>
    <url>/2019/01/03/Study-Notes-of-Bootstrap/</url>
    <content><![CDATA[<img data-src="https://www.tutorialrepublic.com/lib/images/bootstrap-illustration.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://getbootstrap.com/2.3.2/" target="_blank" rel="noopener">Bootstrap</a></p>
<p><a href="http://www.bootcss.com/" target="_blank" rel="noopener">Bootstrap中文网</a></p>
</blockquote>
<h2 id="BootstrapValidator"><a href="#BootstrapValidator" class="headerlink" title="BootstrapValidator"></a>BootstrapValidator</h2><blockquote>
<p><a href="http://bootstrapvalidator.votintsev.ru/" target="_blank" rel="noopener">BootstrapValidator</a></p>
<p><a href="https://mrbird.cc/BootstrapValidator%E6%8C%87%E5%8D%97.html" target="_blank" rel="noopener">BootstrapValidator指南</a></p>
<p><a href="https://blog.csdn.net/u013938465/article/details/53507109" target="_blank" rel="noopener">BootstrapValidator超详细教程</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(formSelector).bootstrapValidator(&#123;</span><br><span class="line">        excluded: ..., <span class="comment">// 指定不验证的情况</span></span><br><span class="line">        feedbackIcons: ...,	<span class="comment">// 指定验证后验证字段的提示字体图标。（默认是bootstrap风格）</span></span><br><span class="line">        live: <span class="string">'enabled'</span>, <span class="comment">// 生效规则</span></span><br><span class="line">        message: <span class="string">'This value is not valid'</span>,	<span class="comment">// 通用错误提示语</span></span><br><span class="line">        submitButtons: <span class="string">'button[type="submit"]'</span>, <span class="comment">// 指定提交的按钮</span></span><br><span class="line">        trigger: <span class="literal">null</span>, <span class="comment">// 统一触发验证方式</span></span><br><span class="line">        fields: ... <span class="comment">// 表单域配置</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>前端</category>
        <category>Bootstrap</category>
      </categories>
      <tags>
        <tag>Bootstrap</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of CSS</title>
    <url>/2019/07/31/Study-Notes-of-CSS/</url>
    <content><![CDATA[<img data-src="https://miro.medium.com/max/1200/1*OFsc0SD55jhi8cjo7aCA4w.jpeg" width="100%"/>

<a id="more"></a>

<h2 id="垂直居中"><a href="#垂直居中" class="headerlink" title="垂直居中"></a>垂直居中</h2><h3 id="Flexbox-布局中实现元素的水平垂直居中"><a href="#Flexbox-布局中实现元素的水平垂直居中" class="headerlink" title="Flexbox 布局中实现元素的水平垂直居中"></a>Flexbox 布局中实现元素的水平垂直居中</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/justify-content" target="_blank" rel="noopener">justify-content | MDN</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/align-items" target="_blank" rel="noopener">align-items | MDN</a></p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#container</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<iframe height="265" style="width: 100%;" scrolling="no" title="bXmeLr" src="//codepen.io/libo9527/embed/bXmeLr/?height=265&theme-id=0&default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/libo9527/pen/bXmeLr/' target="_blank" rel="noopener">bXmeLr</a> by libo9527
  (<a href='https://codepen.io/libo9527' target="_blank" rel="noopener">@libo9527</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<h2 id="position-sticky"><a href="#position-sticky" class="headerlink" title="position: sticky"></a>position: sticky</h2><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position" target="_blank" rel="noopener">position | MDN</a></p>
<p><a href="https://www.zhangxinxu.com/wordpress/2018/12/css-position-sticky/" target="_blank" rel="noopener">杀了个回马枪，还是说说position:sticky吧« 张鑫旭-鑫空间-鑫生活</a></p>
</blockquote>
<p>需求说明：实现导航的跟随定位效果</p>
<iframe width="100%" height="300" src="https://www.zhangxinxu.com/study/201812/position-sticky.html" frameborder="0" style="max-width:100%;border:1px solid #ddd;"></iframe>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: -webkit-sticky;</span><br><span class="line">    <span class="attribute">position</span>: sticky;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h2><h3 id="vw、vh、vm"><a href="#vw、vh、vm" class="headerlink" title="vw、vh、vm"></a>vw、vh、vm</h3><blockquote>
<p><a href="https://www.zhangxinxu.com/wordpress/2012/09/new-viewport-relative-units-vw-vh-vm-vmin/" target="_blank" rel="noopener">视区相关单位vw, vh..简介以及可实际应用场景</a></p>
</blockquote>
<p>vw 相对于视区的宽度：视区宽度是100vw；vh 相对于视区的高度：视区高度是100vh</p>
<p><strong>“视区”指浏览器内部的可视区域大小</strong>，即<code>window.innerWidth/window.innerHeight</code>大小，不包含任务栏标题栏以及底部工具栏的浏览器区域大小。</p>
<h2 id="CSS截取图片的几种方式"><a href="#CSS截取图片的几种方式" class="headerlink" title="CSS截取图片的几种方式"></a>CSS截取图片的几种方式</h2><ol>
<li><p>div元素，使用 background-position：Xpx Ypx，配合 width 和 height</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div_bg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">   <span class="selector-class">.div_bg</span></span></span><br><span class="line">        &#123;</span><br><span class="line">            width: 550px;</span><br><span class="line">            height: 113px;</span><br><span class="line">            background-image: url(img/bk_title_all.jpg);</span><br><span class="line">            background-repeat: no-repeat;</span><br><span class="line">            background-position: 0px -599px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="去除inline-block元素间间距的N种方法"><a href="#去除inline-block元素间间距的N种方法" class="headerlink" title="去除inline-block元素间间距的N种方法"></a><a href="https://www.zhangxinxu.com/wordpress/2012/04/inline-block-space-remove-%E5%8E%BB%E9%99%A4%E9%97%B4%E8%B7%9D/" target="_blank" rel="noopener">去除inline-block元素间间距的N种方法</a></h2><ol>
<li>去掉HTML中的空格，自然间距就木有了。</li>
</ol>
]]></content>
      <categories>
        <category>Front-end</category>
        <category>CSS</category>
      </categories>
  </entry>
  <entry>
    <title>Study Notes of Docker</title>
    <url>/2019/01/05/Study-Notes-of-Docker/</url>
    <content><![CDATA[<img data-src="http://finworks.com/wp-content/uploads/2017/01/Docker_Logo-500x250.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://legacy.gitbook.com/book/yeasy/docker_practice" target="_blank" rel="noopener">Docker —— 从入门到实践</a></p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。**它是目前最流行的 Linux 容器解决方案。</p>
<p>Docker基于Go语言开发，是DotCloud开源的、可以将任何应用包装在Linux container中运行的工具。</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><h4 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h4><p>​    Docker 镜像是一个<strong>特殊的文件系统</strong>，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>
<h4 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h4><p>​    镜像（<code>Image</code>）和容器（<code>Container</code>）的关系，就像是面向对象程序设计中的 <code>类</code> 和 <code>实例</code> 一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p>
<p>​    容器的实质是进程。</p>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><p><strong>启动 Docker</strong></p>
<blockquote>
<p><a href="https://docs.docker.com/config/daemon/systemd/" target="_blank" rel="noopener">Control Docker with systemd</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<p><strong>列出本地镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><strong>启动容器</strong></p>
<blockquote>
<p><a href="http://www.runoob.com/docker/docker-run-command.html" target="_blank" rel="noopener">Docker run 命令</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>-d:</strong> 后台运行容器，并返回容器ID；</li>
<li><strong>-p:</strong> 端口映射，格式为：主机(宿主)端口:容器端口</li>
<li><strong>–name=”nginx-lb”:</strong> 为容器指定一个名称；</li>
<li><strong>-e username=”ritchie”:</strong> 设置环境变量；</li>
</ul>
<p><strong>查看容器</strong></p>
<blockquote>
<p><a href="http://www.runoob.com/docker/docker-ps-command.html" target="_blank" rel="noopener">Docker ps 命令</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps [OPTIONS]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>-a :</strong>显示所有的容器，包括未运行的。</li>
</ul>
]]></content>
      <categories>
        <category>Study Notes</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Git</title>
    <url>/2019/11/01/Study-Notes-of-Git/</url>
    <content><![CDATA[<img data-src="https://www.linkedin.com/media-proxy/ext?w=1200&h=675&hash=EnUu%2BT9OJGbHiVWYjgwyvE0dids%3D&ora=1%2CaFBCTXdkRmpGL2lvQUFBPQ%2CxAVta5g-0R6plxVUzgUv5K_PrkC9q0RIUJDPBy-kWyaq89KIf3LpesfWfrq8pVgTcCkFkgw1fOuuSC3gFNu1NdCvKg" width="100%"/>

<a id="more"></a>

<h2 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h2><h3 id="remote"><a href="#remote" class="headerlink" title="remote"></a>remote</h3><ul>
<li><p>添加远程主机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> git remote add &lt;主机名&gt; &lt;网址&gt;</span></span><br><span class="line">git remote add origin http://bitbucket.sstparts.com/scm/web/sst-cloud.git</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="branch"><a href="#branch" class="headerlink" title="branch"></a>branch</h3><ul>
<li><p>查看本地分支与远程分支的追踪关系</p>
<blockquote>
<p>-v, -vv, –verbose<br>When in list mode, show sha1 and commit subject line for each head, along with relationship to upstream branch (if any). If given twice, print the name of the upstream branch, as well (see also git remote show <code>&lt;remote&gt;</code>).</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch -vv</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联远程分支</p>
<blockquote>
<p> -u <code>&lt;upstream&gt;</code>, –set-upstream-to=<code>&lt;upstream&gt;</code><br>Set up <code>&lt;branchname&gt;</code>‘s tracking information so <code>&lt;upstream&gt;</code> is considered <code>&lt;branchname&gt;</code>‘s upstream branch. If no <code>&lt;branchname&gt;</code> is specified, then it defaults to the current branch.</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch --set-upstream-to=master</span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line">git bracch -u master</span><br></pre></td></tr></table></figure>
</li>
<li><p>分支重命名</p>
<blockquote>
<p> -m, –move</p>
<p>Move/rename a branch and the corresponding reflog.</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch -m oldBranchName newBranchName</span><br></pre></td></tr></table></figure>

<p>注意：远程分支的重命名需要通过先删除后新建的方式实现。</p>
</li>
</ul>
<h3 id="checkout"><a href="#checkout" class="headerlink" title="checkout"></a>checkout</h3><ul>
<li><p>拉取远程新分支到本地</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -b 本地分支名 origin/远程分支名</span><br></pre></td></tr></table></figure>
<p>另一种方式（这种方式不会切换到新分支，需要手动切换）：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git fetch origin 远程分支名:本地分支名</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="stash"><a href="#stash" class="headerlink" title="stash"></a>stash</h3><ul>
<li><p>查看 stash 列表</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure>
</li>
<li><p>清空 stash 列表</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash clear</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除队列中的第一个</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash drop stash@&#123;0&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p>git 配置有 system 级别、global 和 local 三个，优先级依次递增，也就是配置冲突时优先使用 local 级别的。</p>
<ul>
<li><p>查看当前仓库配置信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --local --list</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="DIFFRENCE"><a href="#DIFFRENCE" class="headerlink" title="DIFFRENCE"></a>DIFFRENCE</h2><ol>
<li><p>pull VS fetch</p>
<p>pull = fetch + merge</p>
</li>
</ol>
<h2 id="账号管理"><a href="#账号管理" class="headerlink" title="账号管理"></a><a href="/2019/06/22/Account-Management-in-Git/">账号管理</a></h2>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Google Calendar API</title>
    <url>/2020/03/02/Study-Notes-of-Google-Calendar-API/</url>
    <content><![CDATA[<img data-src="https://www.techapple.com/wp-content/uploads/2017/10/GOOGLE-CALENDER.jpg" width="100%"/>

<a id="more"></a>

<h2 id="任务安排"><a href="#任务安排" class="headerlink" title="任务安排"></a>任务安排</h2><h3 id="阅读官方文档"><a href="#阅读官方文档" class="headerlink" title="阅读官方文档"></a>阅读官方文档</h3><h4 id="Calendar-API-Google-Developers"><a href="#Calendar-API-Google-Developers" class="headerlink" title="Calendar API | Google Developers"></a><a href="https://developers.google.com/calendar" target="_blank" rel="noopener">Calendar API | Google Developers</a></h4><h5 id="首页"><a href="#首页" class="headerlink" title="首页"></a><del>首页</del></h5><h5 id="指南"><a href="#指南" class="headerlink" title="指南"></a>指南</h5><h6 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a><del>Get Started</del></h6><h6 id="Authorizing-Requests"><a href="#Authorizing-Requests" class="headerlink" title="Authorizing Requests"></a><a href="https://developers.google.com/calendar/auth" target="_blank" rel="noopener">Authorizing Requests</a></h6><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><h6 id="CalendarList"><a href="#CalendarList" class="headerlink" title="CalendarList"></a><a href="https://developers.google.com/calendar/v3/reference/#CalendarList" target="_blank" rel="noopener">CalendarList</a></h6><h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><h6 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h6><h5 id="支持"><a href="#支持" class="headerlink" title="支持"></a>支持</h5><h4 id="Google-API-Client-Libraries-gt-Java"><a href="#Google-API-Client-Libraries-gt-Java" class="headerlink" title="Google API Client Libraries &gt; Java"></a><a href="https://developers.google.com/api-client-library/java" target="_blank" rel="noopener">Google API Client Libraries &gt; Java</a></h4><h5 id="APIs"><a href="#APIs" class="headerlink" title="APIs"></a>APIs</h5><h6 id="Calendar-API-Client-Library-for-Java"><a href="#Calendar-API-Client-Library-for-Java" class="headerlink" title="Calendar API Client Library for Java"></a><a href="https://github.com/googleapis/google-api-java-client-services/tree/master/clients/google-api-services-calendar/v3" target="_blank" rel="noopener">Calendar API Client Library for Java</a></h6><blockquote>
<p><a href="https://developers.google.com/apis-explorer/#p/calendar/v1/" target="_blank" rel="noopener">APIs Explorer for the Calendar API</a></p>
</blockquote>
<h2 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h2><blockquote>
<p><a href="https://developers.google.com/identity/protocols/OAuth2" target="_blank" rel="noopener">Using OAuth 2.0 to Access Google APIs</a></p>
<p><a href="https://developers.google.com/identity/protocols/OAuth2#webserver" target="_blank" rel="noopener">Scenarios: Web server applications</a></p>
<p><a href="https://developers.google.com/api-client-library/java/google-api-java-client/oauth2#authorization_code_flow" target="_blank" rel="noopener">Authorization code flow | Google-API-Client-Library &gt; java</a></p>
<p><a href="https://developers.google.com/oauthplayground" target="_blank" rel="noopener">OAuth 2.0 Playground | Google Developers</a></p>
</blockquote>
<p>认证流程图</p>
<p><img data-src="https://developers.google.com/accounts/images/webflow.png" alt=""></p>
<div class="tabs" id="authorize"><ul class="nav-tabs"><li class="tab active"><a href="#authorize-1">1.获取凭证 →</a></li><li class="tab"><a href="#authorize-2">2.获取 code →</a></li><li class="tab"><a href="#authorize-3">3.获取 token →</a></li><li class="tab"><a href="#authorize-4">4.调用 API →</a></li></ul><div class="tab-content"><div class="tab-pane active" id="authorize-1"><p>在  <a href="https://console.developers.google.com/" target="_blank" rel="noopener">Google API Console</a> 中获取 OAuth 2.0 认证凭证(例如  client ID、client secret)。</p></div><div class="tab-pane" id="authorize-2"><p>…</p></div><div class="tab-pane" id="authorize-3"><blockquote>
<p><a href="https://stackoverflow.com/questions/37314744/google-drive-api-java-client-behind-proxy/39347143#39347143" target="_blank" rel="noopener">ERROR: java.net.SocketTimeoutException: Connect timed out</a></p>
</blockquote></div><div class="tab-pane" id="authorize-4"><blockquote>
<p><a href="https://developers.google.com/calendar/v3/reference/events/list" target="_blank" rel="noopener">Events: list ｜ Calendar API</a></p>
</blockquote></div></div></div>



<p><a href="https://blog.csdn.net/sunnyzyq/article/details/95348788" target="_blank" rel="noopener">Springboot 拦截器 + 自定义注解，实现权限控制</a></p>
]]></content>
      <categories>
        <category>Study Notes</category>
        <category>Google Calendar API</category>
      </categories>
  </entry>
  <entry>
    <title>Study Notes of Guns</title>
    <url>/2018/12/25/Study-Notes-of-Guns/</url>
    <content><![CDATA[<p><img data-src="https://i.loli.net/2018/12/26/5c23433372f23.jpg" alt=""></p>
<a id="more"></a>

<blockquote>
<p>Guns基于SpringBoot 2，致力于做更简洁的后台管理系统，完美整合springmvc + shiro + mybatis-plus + beetl!Guns项目代码简洁，注释丰富，上手容易，同时Guns包含许多基础模块(用户管理，角色管理，部门管理，字典管理等10个模块)，可以直接作为一个后台管理系统的脚手架!</p>
<p><a href="http://stylefeng.cn/" target="_blank" rel="noopener">http://stylefeng.cn</a></p>
</blockquote>
<h2 id="后端分页"><a href="#后端分页" class="headerlink" title="后端分页"></a>后端分页</h2><blockquote>
<p>可参考 Guns 的【日志管理】模块</p>
<p><a href="https://mp.baomidou.com/guide/page.html" target="_blank" rel="noopener">分页插件| MyBatis-Plus</a></p>
</blockquote>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li>前端初始化<a href="http://bootstrap-table.wenzhixin.net.cn/zh-cn/documentation/" target="_blank" rel="noopener">Bootstrap Table</a>时设置分页方式为服务端分页。（<code>static/modular/system/log/log.js</code>）</li>
<li>后端接口使用<code>Guns</code>提供的工具类<code>common.constant.factory.PageFactory</code>来获取<a href="https://mp.baomidou.com/guide/page.html" target="_blank" rel="noopener"><code>MyBatis-Plus</code>分页插件</a>所需的<code>Page</code>对象。</li>
<li>然后将<code>Page</code>对象传递到<code>Mapper</code>层进行查询，<a href="https://mp.baomidou.com/guide/page.html" target="_blank" rel="noopener"><code>MyBatis-Plus</code>分页插件</a>会自动帮你实现分页。</li>
<li>将查询结果放入<code>Page</code>对象的<code>records</code>属性中。</li>
<li>使用<code>Guns</code>的<code>core.common.page.PageInfoBT</code>对分页结果进行封装后返回给前端。</li>
</ol>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ol>
<li>Guns配置分页插件的地方在<code>com.dubbo.pay.config.datasource</code></li>
</ol>
<h2 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h2><blockquote>
<p>参考 Guns 的【用户管理】模块</p>
<p><a href="http://bootstrapvalidator.votintsev.ru/" target="_blank" rel="noopener">BootstrapValidator</a></p>
<p><a href="https://mrbird.cc/BootstrapValidator%E6%8C%87%E5%8D%97.html" target="_blank" rel="noopener">BootstrapValidator指南</a></p>
</blockquote>
<ol>
<li><p>必要的<code>css</code>和<code>js</code>文件在<code>src\main\webapp\WEB-INF\view\common\_container.html</code>文件中引入。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全局css --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"$&#123;ctxPath&#125;/static/css/bootstrap.min.css?v=3.3.6"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"$&#123;ctxPath&#125;/static/css/plugins/validate/bootstrapValidator.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 全局js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;ctxPath&#125;/static/js/jquery.min.js?v=2.1.4"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;ctxPath&#125;/static/js/bootstrap.min.js?v=3.3.6"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;ctxPath&#125;/static/js/plugins/validate/bootstrapValidator.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>HTML 表单</p>
<ul>
<li><p>表单要指定 ID</p>
<figure class="highlight html"><figcaption><span>WEB-INF/view/system/user/user_add.html</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span> <span class="attr">id</span>=<span class="string">"userInfoForm"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>需验证的字段，默认需要以<code>&lt;div class=”form-group”&gt;&lt;/div&gt;</code>包裹（对应错误提示会根据该class值定位），内部<code>&lt;input class=&quot;form-control&quot; /&gt;</code>标签必须有name属性值（作为验证匹配字段）。</p>
<figure class="highlight html"><figcaption><span>WEB-INF/view/system/user/user_add.html</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#input</span> <span class="attr">id</span>=<span class="string">"account"</span> <span class="attr">name</span>=<span class="string">"账户"</span> <span class="attr">underline</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>自定义标签 input ：</p>
<figure class="highlight html"><figcaption><span>WEB-INF/view/common/tags/input.tag</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"col-sm-3 control-label"</span>&gt;</span>$&#123;name&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-9"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"$&#123;id&#125;"</span> <span class="attr">name</span>=<span class="string">"$&#123;id&#125;"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">...</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>表单域配置（<a href="http://bootstrapvalidator.votintsev.ru/validators/" target="_blank" rel="noopener">官方默认验证</a>）</p>
<figure class="highlight js"><figcaption><span>static/modular/system/user/user_info.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> UserInfoDlg = &#123;</span><br><span class="line">    ...</span><br><span class="line">    validateFields: &#123;</span><br><span class="line">        account: &#123;</span><br><span class="line">            validators: &#123;</span><br><span class="line">                notEmpty: &#123;</span><br><span class="line">                    message: <span class="string">'账户不能为空'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>js 入口函数中初始化验证器</p>
<figure class="highlight js"><figcaption><span>static/modular/system/user/user_info.js</span></figcaption><table><tr><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Feng.initValidator(<span class="string">"userInfoForm"</span>, UserInfoDlg.validateFields);</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
</li>
<li><p>提交时手动触发</p>
<figure class="highlight js"><figcaption><span>static/modular/system/user/user_info.js</span></figcaption><table><tr><td class="code"><pre><span class="line">UserInfoDlg.validate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 重置表单所有验证规则</span></span><br><span class="line">    $(<span class="string">'#userInfoForm'</span>).data(<span class="string">"bootstrapValidator"</span>).resetForm();</span><br><span class="line">    <span class="comment">// 触发全部验证</span></span><br><span class="line">    $(<span class="string">'#userInfoForm'</span>).bootstrapValidator(<span class="string">'validate'</span>);</span><br><span class="line">    <span class="comment">// 获取当前表单验证状态</span></span><br><span class="line">    <span class="keyword">return</span> $(<span class="string">"#userInfoForm"</span>).data(<span class="string">'bootstrapValidator'</span>).isValid();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>当提交按钮的<code>type=”submit”</code>时，会在 success 之前自动触发表单验证，Guns 提交按钮为普通按钮，故需要手动触发。</p>
<figure class="highlight html"><figcaption><span>WEB-INF/view/common/tags/button.tag</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="正整数"><a href="#正整数" class="headerlink" title="正整数"></a>正整数</h3><p>方式一：</p>
<p>用 BootstrapValidator 验证正整数时需要适用正则表达式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">validateFields: &#123;</span><br><span class="line">        count: &#123;</span><br><span class="line">            validators: &#123;</span><br><span class="line">                regexp: &#123;</span><br><span class="line">                    regexp: <span class="regexp">/^[1-9]\d*$ /</span>,</span><br><span class="line">                    message: <span class="string">'格式错误，请输入正整数'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p>H5 提供了 number 的<a href="http://www.w3school.com.cn/html5/html_5_form_input_types.asp" target="_blank" rel="noopener">表单类型</a>，用来控制数字输入。</p>
<p>将 input.tag 复制到对应 html 文件，该填的填，该删的删。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-6 b-r"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#input</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">name</span>=<span class="string">"姓名"</span> <span class="attr">underline</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"col-sm-3 control-label"</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-9"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"count"</span> <span class="attr">name</span>=<span class="string">"count"</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">min</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-6"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#input</span> <span class="attr">id</span>=<span class="string">"age"</span> <span class="attr">name</span>=<span class="string">"年龄"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
        <category>Guns</category>
      </categories>
      <tags>
        <tag>Guns</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of HTML</title>
    <url>/2019/08/30/Study-Notes-of-HTML/</url>
    <content><![CDATA[<img data-src="https://engineering.eckovation.com/wp-content/uploads/2017/09/wallhaven-439017.png" width="100%"/>

<a id="more"></a>

<h2 id="支持跨域请求的标签"><a href="#支持跨域请求的标签" class="headerlink" title="支持跨域请求的标签"></a>支持跨域请求的标签</h2><ul>
<li><code>&lt;img src=XXX&gt;</code></li>
<li><code>&lt;link href=XXX&gt;</code></li>
<li><code>&lt;script src=XXX&gt;</code></li>
</ul>
<h2 id="Content-Type"><a href="#Content-Type" class="headerlink" title="Content Type"></a>Content Type</h2><blockquote>
<p> <a href="https://blog.csdn.net/xiaoyu19910321/article/details/79279364" target="_blank" rel="noopener">常见 content-type对应表</a></p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">文件扩展名</th>
<th align="center">Content-Type(Mime-Type)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">.xlsx</td>
<td align="center">application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Front-end</category>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Illustrator</title>
    <url>/2019/08/23/Study-Notes-of-Illustrator/</url>
    <content><![CDATA[<img data-src="https://www.adobe.com/content/dam/acom/en/products/illustrator/max2018/ai-video_1000x494.jpg" width="100%"/>

<a id="more"></a>

<h2 id="以几何中心点为起始点绘制图形"><a href="#以几何中心点为起始点绘制图形" class="headerlink" title="以几何中心点为起始点绘制图形"></a>以几何中心点为起始点绘制图形</h2><p>Alt + 鼠标左键</p>
<h2 id="绘制多边形"><a href="#绘制多边形" class="headerlink" title="绘制多边形"></a>绘制多边形</h2><p>鼠标左键 + ↑ / ↓（增加/减少边数）</p>
<h2 id="绘制星形"><a href="#绘制星形" class="headerlink" title="绘制星形"></a>绘制星形</h2><ul>
<li>鼠标左键 + ↑ / ↓（增加/减少角数）</li>
<li>鼠标左键 + Command（拉伸角）</li>
</ul>
<h2 id="图形旋转"><a href="#图形旋转" class="headerlink" title="图形旋转"></a>图形旋转</h2><p>鼠标左键 + Shift 以 45º 为梯度旋转</p>
<h2 id="再次变换"><a href="#再次变换" class="headerlink" title="再次变换"></a>再次变换</h2><h2 id="在线工具"><a href="#在线工具" class="headerlink" title="在线工具"></a>在线工具</h2><blockquote>
<p><a href="https://www.baidu.com/link?url=yzts6uPF8dwqNWIhicc3LHao1gVTzv9HImeHQt-9zVCQxgTuUAHInTXG8jCuXrdt&wd=&eqid=99d6ef4900009c97000000065d635878" target="_blank" rel="noopener"><em>Color</em> <em>Scheme</em> Designer 3_高级在线配色器_配色网</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Ai</category>
      </categories>
      <tags>
        <tag>Ai</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of JAVA</title>
    <url>/2019/01/07/Study-Notes-of-JAVA/</url>
    <content><![CDATA[<img data-src="https://www.imarslan.com/wp-content/uploads/2018/06/cover.png" width="100%"/>

<a id="more"></a>

<h2 id="包装类"><a href="#包装类" class="headerlink" title="包装类"></a>包装类</h2><h3 id="Integer-与-int"><a href="#Integer-与-int" class="headerlink" title="Integer 与 int"></a>Integer 与 int</h3><p>Integer 是类，提供了很多方法方便使用，而 int 可以保证没有空指针异常，初始值为 0。</p>
<h2 id="BigDecimal"><a href="#BigDecimal" class="headerlink" title="BigDecimal"></a>BigDecimal</h2><h3 id="取余运算"><a href="#取余运算" class="headerlink" title="取余运算"></a>取余运算</h3><p><code>public BigDecimal[] divideAndRemainder(BigDecimal divisor)</code></p>
<h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><blockquote>
<p><a href="http://www.runoob.com/java/java-generics.html" target="_blank" rel="noopener">Java 泛型| 菜鸟教程</a></p>
<p><a href="https://blog.csdn.net/qq_27093465/article/details/73229016" target="_blank" rel="noopener">Java泛型详解：和Class的使用。泛型类，泛型方法的详细使用实例</a></p>
</blockquote>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>​    Java 泛型（generics）是 JDK 5 中引入的一个新特性, 泛型提供了编译时类型安全检测机制，该机制允许程序员在编译时检测到非法的类型。</p>
<p>​    <strong>泛型的本质是参数化类型</strong>，即将类型由原来具体的类型参数化。这种参数类型可以用在类、接口和方法中，分别被称为泛型类、泛型接口、泛型方法。<strong>泛型类型在逻辑上可以看成是多个不同的类型，实际上都是相同的基本类型。</strong></p>
<p>​    ArrayList 就是泛型的典型应用。</p>
<p>​    Java泛型很大程度上只能提供静态类型检查，然后类型的信息就会被擦除。类型擦除就是指 Java 泛型只能用于在编译期间的静态类型检查，然后编译器生成的代码会擦除相应的类型信息（即类型均变为 Object），这样到了运行期间实际上JVM根本就知道泛型所代表的具体类型。这样做的目的是因为Java泛型是1.5之后才被引入的，为了保持向下的兼容性，所以只能做类型擦除来兼容以前的非泛型代码。</p>
<h3 id="相比-Object，泛型的优势"><a href="#相比-Object，泛型的优势" class="headerlink" title="相比 Object，泛型的优势"></a>相比 Object，泛型的优势</h3><ol>
<li>不用强制转换</li>
<li>避开运行时的类型转换错误。在 settValue 时如果传入类型不对，编译时便会报错。</li>
</ol>
<h3 id="字母规范"><a href="#字母规范" class="headerlink" title="字母规范"></a>字母规范</h3><p>虽然在定义泛型时，可以使用任意字母，其意义完全相同，单为了提高可读性，还是用有意义的字母比较好，一般来讲，在不同的情境下使用的字母意义如下：</p>
<ul>
<li>E — Element，常用在 java Collection 里，如：List<E>,Iterator<E>,Set<E></li>
<li>K,V — Key，Value，代表Map的键值对</li>
<li>N — Number，数字</li>
<li>T — Type，类型，如 String，Integer 等等</li>
</ul>
<h3 id="和-T-的区别"><a href="#和-T-的区别" class="headerlink" title="? 和 T 的区别"></a>? 和 T 的区别</h3><p>​    <code>? extends E</code>: 接收E类型或者E的子类型。<code>? super E</code>: 接收E类型或者E的父类型</p>
<p>​    ？和T都表示不确定的类型 ，但如果是 T 的话，函数里面可以对 T 进行操作，比方 <code>T car = getCar()</code>，而不能用 <code>？ car = getCar()</code>。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>Java 中不允许创建泛型数组</li>
</ol>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><h3 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h3><h4 id="nCopies"><a href="#nCopies" class="headerlink" title="nCopies()"></a>nCopies()</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(</span><br><span class="line">    Collections.nCopies(<span class="number">3</span>, <span class="number">0</span>));</span><br><span class="line">  System.out.println(list);</span><br><span class="line">  <span class="comment">// [0, 0, 0]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="fill"><a href="#fill" class="headerlink" title="fill()"></a>fill()</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(</span><br><span class="line">    Collections.nCopies(<span class="number">3</span>, <span class="number">0</span>));</span><br><span class="line">  System.out.println(list);</span><br><span class="line">  <span class="comment">// [0, 0, 0]</span></span><br><span class="line">  Collections.fill(list, <span class="number">1</span>);</span><br><span class="line">  System.out.println(list);</span><br><span class="line">  <span class="comment">// [1, 1, 1]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Collections.nCopies() 只能在创建 List 时填充容器，Collections.fill() 是用来对一个已有容器的填充。</p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3>]]></content>
      <categories>
        <category>Study Notes</category>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>Study Notes of JQuery</title>
    <url>/2019/01/03/Study-Notes-of-JQuery/</url>
    <content><![CDATA[<img data-src="https://blog.teamtreehouse.com/wp-content/uploads/2012/10/jquery.jpg" width="100%"/>

<a id="more"></a>

<h2 id="文档就绪函数"><a href="#文档就绪函数" class="headerlink" title="文档就绪函数"></a>文档就绪函数</h2><blockquote>
<p><a href="https://blog.csdn.net/dongdong9223/article/details/50504518" target="_blank" rel="noopener">JQuery的函数“$(function() {})”的含义及与“$(document).ready(function(){})”的区别</a></p>
<p><a href="https://stackoverflow.com/questions/7642442/what-does-function-do" target="_blank" rel="noopener">What does $(function() {} ); do?</a></p>
<p><a href="http://www.w3school.com.cn/jquery/jquery_syntax.asp" target="_blank" rel="noopener">jQuery 语法</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; ... &#125;);</span><br></pre></td></tr></table></figure>

<p>is just jQuery short-hand for</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; ... &#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>前端</category>
        <category>JQuery</category>
      </categories>
      <tags>
        <tag>JQuery</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of JavaScript</title>
    <url>/2019/07/31/Study-Notes-of-JavaScript/</url>
    <content><![CDATA[<img data-src="https://www.tutorialrepublic.com/lib/images/javascript-illustration.png" width="100%"/>

<a id="more"></a>

<h2 id="ForEach"><a href="#ForEach" class="headerlink" title="ForEach"></a>ForEach</h2><p>JS 中 forEach 遍历数组的时候是无法通过 <code>break</code> 或者 <code>return false</code> 来中断的。</p>
<h2 id="取整"><a href="#取整" class="headerlink" title="取整"></a>取整</h2><h3 id="向下取整"><a href="#向下取整" class="headerlink" title="向下取整"></a>向下取整</h3><blockquote>
<p>向下取整就是在坐标轴上从左到右取离原数最近的整数</p>
<table>
<thead>
<tr>
<th align="center">x</th>
<th align="center">⌊x⌋</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-1.9</td>
<td align="center">-2</td>
</tr>
<tr>
<td align="center">1.9</td>
<td align="center">1</td>
</tr>
</tbody></table>
</blockquote>
<h4 id="number-0"><a href="#number-0" class="headerlink" title="number | 0"></a>number | 0</h4><p>JS 没有整数的概念，所有的数值型都是双精度浮点数。而<a href="https://www.zhihu.com/question/319351649" target="_blank" rel="noopener">浮点数无法直接进行位运算</a>，在用位运算符时，JS 会先把操作数转变成整数再进行位运算，而 0 与其他值异或或者按位或都不会改变操作数，进而实现取整。</p>
<p>但是对于正数来说会进行向下取整，而对于负数则会进行向上取整。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">·&gt; -1.9 | 0</span><br><span class="line">&lt;· -1</span><br><span class="line">-------------</span><br><span class="line">·&gt; -1.1 | 0</span><br><span class="line">&lt;· -1</span><br><span class="line">-------------</span><br><span class="line">·&gt; 1.1 | 0</span><br><span class="line">&lt;· 1</span><br><span class="line">-------------</span><br><span class="line">·&gt; 1.9 | 0</span><br><span class="line">&lt;· 1</span><br></pre></td></tr></table></figure>

<h2 id="树的遍历"><a href="#树的遍历" class="headerlink" title="树的遍历"></a>树的遍历</h2><blockquote>
<p><a href="http://objcer.com/2017/02/26/traverse-the-tree/" target="_blank" rel="noopener">JS 中遍历树| Deng’s Blog</a></p>
<p><a href="https://blog.csdn.net/My_Jobs/article/details/43451187" target="_blank" rel="noopener">二叉树遍历（前序、中序、后序、层次遍历、深度优先、广度优先）</a></p>
</blockquote>
<h3 id="递归遍历"><a href="#递归遍历" class="headerlink" title="递归遍历"></a>递归遍历</h3><p>需求说明：公司项目中要求增加一个排序按钮，对地址树进行排序。排序则需要对树进行遍历，递归的排序子结点。</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="Tree Sort" src="//codepen.io/libo9527/embed/gVjedo/?height=265&theme-id=0&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/libo9527/pen/gVjedo/' target="_blank" rel="noopener">Tree Sort</a> by libo9527
  (<a href='https://codepen.io/libo9527' target="_blank" rel="noopener">@libo9527</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>递归代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">recursive (root) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!root || !root.childNodes) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  root.childNodes.forEach(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.recursive(node)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><h3 id="unshift"><a href="#unshift" class="headerlink" title="unshift()"></a>unshift()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/unshift" target="_blank" rel="noopener">Array.prototype.unshift() | MDN</a></p>
<p><strong>unshift()</strong> 方法将一个或多个元素添加到数组的<strong>开头</strong>，并返回该数组的<strong>新长度</strong>(该方法修改原有数组)</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> array1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(array1.unshift(<span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line"><span class="comment">// expected output: 5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(array1);</span><br><span class="line"><span class="comment">// expected output: Array [4, 5, 1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map()"></a>map()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map" target="_blank" rel="noopener">Array.prototype.map()</a></p>
<p><code>map()</code> 方法创建一个新数组，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果。</p>
</blockquote>
<h3 id="splice"><a href="#splice" class="headerlink" title="splice()"></a>splice()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/splice" target="_blank" rel="noopener">Array.prototype.splice() - MDN</a></p>
<p><strong>splice()</strong> 方法通过删除或替换现有元素或者原地添加新的元素来修改数组,并以数组形式返回被修改的内容。此方法会改变原数组。</p>
</blockquote>
<h4 id="获取数组的最后一个元素"><a href="#获取数组的最后一个元素" class="headerlink" title="获取数组的最后一个元素"></a>获取数组的最后一个元素</h4><blockquote>
<p><a href="https://www.jianshu.com/p/a8d6a1fe4b60" target="_blank" rel="noopener">JavaScript 获取数组的最后一个元素方法（多种）</a></p>
</blockquote>
<p>浅复制的slice方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> args = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> lastElement = args.slice(<span class="number">-1</span>); <span class="comment">// [3]</span></span><br></pre></td></tr></table></figure>

<h3 id="判空"><a href="#判空" class="headerlink" title="判空"></a>判空</h3><blockquote>
<p><a href="https://stackoverflow.com/questions/24403732/check-if-array-is-empty-or-does-not-exist-js" target="_blank" rel="noopener">Check if array is empty or does not exist. JS</a></p>
</blockquote>
<p>Js Array 并没有 isEmpty() 这种直接判空的方法，需要使用如下方式进行判空</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!array || array.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// array empty or does not exist</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="遍历删除子结点"><a href="#遍历删除子结点" class="headerlink" title="遍历删除子结点"></a>遍历删除子结点</h3><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p>具有层级结构的结点数组，如何在遍历的过程中删除所有的子结点</p>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>从后往前遍历数组，然后在遍历过程中删除子结点。需要注意的是<strong>数组中结点的顺序必须保证子结点一定在父结点之后</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> tree = [&#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    name: <span class="string">'Aisa'</span>,</span><br><span class="line">    parentId: <span class="number">0</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">11</span>,</span><br><span class="line">    name: <span class="string">'China'</span>,</span><br><span class="line">    parentId: <span class="number">1</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">'Europe'</span>,</span><br><span class="line">    parentId: <span class="number">0</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">21</span>,</span><br><span class="line">    name: <span class="string">'France'</span>,</span><br><span class="line">    parentId: <span class="number">1</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'########### Before ###########'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'tree:'</span>, tree)</span><br><span class="line">tree.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`name : <span class="subst">$&#123;item.name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ids = tree.map(<span class="function"><span class="params">item</span> =&gt;</span> item.id)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = tree.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="keyword">let</span> node = tree[i]</span><br><span class="line">    <span class="keyword">if</span> (ids.includes(node.parentId)) &#123;</span><br><span class="line">        tree.splice(i, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'########### After ###########'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'tree:'</span>, tree)</span><br><span class="line">tree.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`name : <span class="subst">$&#123;item.name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">########### Before ########### </span><br><span class="line">tree: [&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;Aisa&quot;,&quot;parentId&quot;:0&#125;,&#123;&quot;id&quot;:11,&quot;name&quot;:&quot;China&quot;,&quot;parentId&quot;:1&#125;,&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;Europe&quot;,&quot;parentId&quot;:0&#125;,&#123;&quot;id&quot;:21,&quot;name&quot;:&quot;France&quot;,&quot;parentId&quot;:1&#125;] </span><br><span class="line">name : Aisa </span><br><span class="line">name : China </span><br><span class="line">name : Europe </span><br><span class="line">name : France </span><br><span class="line">########### After ########### </span><br><span class="line">tree: [&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;Aisa&quot;,&quot;parentId&quot;:0&#125;,&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;Europe&quot;,&quot;parentId&quot;:0&#125;] </span><br><span class="line">name : Aisa </span><br><span class="line">name : Europe</span><br></pre></td></tr></table></figure>

<h3 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf()"></a>indexOf()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf" target="_blank" rel="noopener"><code>Array.prototype.indexOf()</code></a></p>
<p><strong>indexOf()</strong>方法返回在数组中可以找到一个给定元素的第一个索引，如果不存在，则返回-1。</p>
</blockquote>
<h3 id="includes"><a href="#includes" class="headerlink" title="includes()"></a>includes()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/includes" target="_blank" rel="noopener"><code>Array.prototype.includes()</code></a></p>
<p><strong>includes()</strong> 方法用来判断一个数组是否包含一个指定的值，根据情况，如果包含则返回 true，否则返回false。</p>
</blockquote>
<h3 id="from"><a href="#from" class="headerlink" title="from()"></a>from()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/from" target="_blank" rel="noopener">Array.from() | MDN</a></p>
<p><code>Array.from()</code> 方法从一个类似数组或可迭代对象中创建一个新的，浅拷贝的数组实例。</p>
</blockquote>
<h4 id="将-Set-转化为-Array"><a href="#将-Set-转化为-Array" class="headerlink" title="将 Set 转化为 Array"></a>将 Set 转化为 Array</h4><blockquote>
<p><a href="https://stackoverflow.com/questions/20069828/how-to-convert-set-to-array" target="_blank" rel="noopener">How to convert Set to Array?</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array = <span class="built_in">Array</span>.from(mySet);</span><br></pre></td></tr></table></figure>

<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><h3 id="add"><a href="#add" class="headerlink" title="add()"></a>add()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set/add" target="_blank" rel="noopener">Set.prototype.add() | MDN</a></p>
<p><code>add()</code> 方法用来向一个 <code>Set</code> 对象的末尾添加一个指定的值。</p>
</blockquote>
<p>Set 没有直接添加一个数组的方法，只能通过构造函数来添加：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">set</span> = new Set(['a', 'b', 'c'])</span><br><span class="line">const arr = ['d', 'e', 'f']</span><br><span class="line">const extendedSet = new Set([ ...<span class="keyword">set</span>, ...arr ])</span><br><span class="line">// Set &#123; <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><h3 id="delete"><a href="#delete" class="headerlink" title="delete()"></a>delete()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map/delete" target="_blank" rel="noopener">Map.prototype.delete()</a></p>
<p><code>delete()</code> 方法用于移除 <code>Map</code> 对象中指定 key 的键值对。</p>
</blockquote>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><h3 id="localeCompare"><a href="#localeCompare" class="headerlink" title="localeCompare()"></a>localeCompare()</h3><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare" target="_blank" rel="noopener">String.prototype.localeCompare() | MDN</a></p>
<p><strong>localeCompare()</strong> 方法返回一个数字来指示一个参考字符串是否在排序顺序前面或之后或与给定字符串相同。</p>
</blockquote>
<p>项目中在对树结点按字母排序时使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">root.childNodes.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (sortDirection === <span class="string">'asc'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a.data.englishName.localeCompare(b.data.englishName)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sortDirection === <span class="string">'desc'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> b.data.englishName.localeCompare(a.data.englishName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h2><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Console/log" target="_blank" rel="noopener">console.log()</a></p>
<p><a href="https://www.cnblogs.com/Wayou/p/chrome-console-tips-and-tricks.html" target="_blank" rel="noopener">Chrome 控制台不完全指南</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">`temp的值为: <span class="subst">$&#123;temp&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Element"><a href="#Element" class="headerlink" title="Element"></a>Element</h2><h3 id="element-className-replace"><a href="#element-className-replace" class="headerlink" title="element.className.replace()"></a>element.className.replace()</h3><blockquote>
<p><a href="https://www.w3schools.com/howto/howto_js_remove_class.asp" target="_blank" rel="noopener">How TO - Remove a Class</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">"myDIV"</span>);</span><br><span class="line">element.classList.remove(<span class="string">"mystyle"</span>);</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Front-end</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Json</title>
    <url>/2020/09/16/Study-Notes-of-Json/</url>
    <content><![CDATA[<img data-src="https://i.ytimg.com/vi/0IoG-mSvWSo/maxresdefault.jpg" width="100%"/>

<a id="more"></a>

<h2 id="Fastjson"><a href="#Fastjson" class="headerlink" title="Fastjson"></a>Fastjson</h2><h3 id="json-string-gt-List"><a href="#json-string-gt-List" class="headerlink" title="json string &gt; List"></a>json string &gt; List</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;User&gt; userList = JSON.parseArray(userStr, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="SimplePropertyPreFilter"><a href="#SimplePropertyPreFilter" class="headerlink" title="SimplePropertyPreFilter"></a>SimplePropertyPreFilter</h3><h4 id="剔除某个属性"><a href="#剔除某个属性" class="headerlink" title="剔除某个属性"></a>剔除某个属性</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 去掉 product 中的 productText 字段</span></span><br><span class="line">SimplePropertyPreFilter filter = <span class="keyword">new</span> SimplePropertyPreFilter();</span><br><span class="line">filter.getExcludes().add(<span class="string">"productText"</span>);</span><br><span class="line">JSON.toJSONString(product, filter);</span><br></pre></td></tr></table></figure>

<h3 id="自定义序列化与反序列化"><a href="#自定义序列化与反序列化" class="headerlink" title="自定义序列化与反序列化"></a>自定义序列化与反序列化</h3><h4 id="自定义序列化"><a href="#自定义序列化" class="headerlink" title="自定义序列化"></a>自定义序列化</h4><blockquote>
<p><a href="http://kimmking.github.io/2017/06/06/json-best-practice/" target="_blank" rel="noopener">JSON最佳实践</a></p>
<p><a href="https://gakkil.gitee.io/2019/12/22/fastjson-de-jin-jie-er/#toc-heading-8" target="_blank" rel="noopener">使用serializeUsing制定属性的序列化类</a></p>
<p><a href="https://howtodoinjava.com/java/string/unescape-html-to-string/" target="_blank" rel="noopener">Java Unescape HTML to String Example - HowToDoInJava</a></p>
</blockquote>
<p>转换 productTitle 字段中包含的 HTML 特殊字符</p>
<ol>
<li><p>自定义序列化器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.text.StringEscapeUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringEscapeSerialization</span> <span class="keyword">implements</span> <span class="title">ObjectSerializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(JSONSerializer serializer, Object object, Object fieldName, Type fieldType, <span class="keyword">int</span> features)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SerializeWriter out = serializer.out;</span><br><span class="line">    <span class="keyword">if</span> (object == <span class="keyword">null</span>) &#123;</span><br><span class="line">      out.writeNull();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (object <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">      out.writeString(StringEscapeUtils.unescapeHtml4((String) object));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用自定义的序列化器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@JSONField</span>(serializeUsing= StringEscapeSerialization<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">private</span> <span class="title">String</span> <span class="title">productTitle</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  Product product = <span class="keyword">new</span> Product();</span><br><span class="line">  product.setProductTitle(<span class="string">"iPhone X Pro &amp;quot;HK&amp;quot;"</span>);</span><br><span class="line">  String s = JSON.toJSONString(product);</span><br><span class="line">  System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;productTitle&quot;:&quot;iPhone X Pro \&quot;HK\&quot;&quot;&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="json-smart"><a href="#json-smart" class="headerlink" title="json-smart"></a>json-smart</h2><h2 id="GSON"><a href="#GSON" class="headerlink" title="GSON"></a>GSON</h2>]]></content>
  </entry>
  <entry>
    <title>Study Notes of Maven</title>
    <url>/2020/03/20/Study-Notes-of-Maven/</url>
    <content><![CDATA[<img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/Maven_logo.svg/1280px-Maven_logo.svg.png" width="100%"/>

<a id="more"></a>

<h2 id="资源文件"><a href="#资源文件" class="headerlink" title="资源文件"></a>资源文件</h2><blockquote>
<p><a href="https://www.cnblogs.com/pixy/p/4798089.html" target="_blank" rel="noopener">maven资源文件的相关配置- XRacoon - 博客园</a></p>
<p><a href="https://blog.csdn.net/qq_41357211/article/details/99855643" target="_blank" rel="noopener">解决springboot配置文件yml中classpath找不到src/main/java下 …</a></p>
</blockquote>
<p>构建Maven项目的时候，如果没有进行特殊的配置，Maven会按照标准的目录结构查找和处理各种类型文件。</p>
<p>src/main/java和src/test/java </p>
<p>这两个目录中的所有*.java文件会分别在comile和test-comiple阶段被编译，编译结果分别放到了target/classes和targe/test-classes目录中，但是这两个目录中的其他文件都会被忽略掉。</p>
<p>src/main/resouces和src/test/resources</p>
<p>这两个目录中的文件也会分别被复制到target/classes和target/test-classes目录中。</p>
<p>target/classes</p>
<p>打包插件默认会把这个目录中的所有内容打入到jar包或者war包中。</p>
]]></content>
  </entry>
  <entry>
    <title>Study Notes of MyBatis</title>
    <url>/2020/03/26/Study-Notes-of-MyBatis/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2020/03/27/aW4oqx6NYpOTibH.png" width="100%"/>

<a id="more"></a>

<h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2><p>单参数，参数类型为 List 时，如果没有用 @param 指明变量名，在 xml 中是识别不到此变量名的，但可以使用 “list” 来代替。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">  <span class="function">List&lt;User&gt; <span class="title">selectByIds</span><span class="params">(List&lt;Long&gt; ids)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByIds"</span> <span class="attr">resultType</span>=<span class="string">"com.gzhennaxia.entity.User"</span>&gt;</span></span><br><span class="line">	select * from users where id in </span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">  	#&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>mybatis 的延迟加载是使用动态代理来实现的，如果是在 3.3.0版本以下，采用的是 CGLib 动态代理，之后的版本采用的是 JAVASSIST。</p>
<h3 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h3><blockquote>
<p>背景：项目中配置了全局的懒加载，但某个接口响应速度太慢，想通过添加缓存层提高响应速度时，发现从 Redis 读取缓存后报错。Google 后发现是 Mybatis 的懒加载导致的。</p>
</blockquote>
<p>当全局开启了延迟加载后，如果某条 sql 需要即时加载时，可以使用 fetchType 属性来开启即时加载。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectCarrierName"</span> <span class="attr">resultType</span>=<span class="string">"string"</span>&gt;</span></span><br><span class="line">  SELECT DISTINCT dc.CARRIERNAME</span><br><span class="line">  FROM DEVICECARRIER dc</span><br><span class="line">  INNER JOIN DEVICECARRIERASSN dcr ON dc.CARRIERID = dcr.CARRIERID</span><br><span class="line">  INNER JOIN PRODUCTDEVICES pd ON dcr.DEVICEID = pd.DEVICEID</span><br><span class="line">  WHERE pd.PRODUCTID = #&#123;productId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"productDetailResult"</span> <span class="attr">type</span>=<span class="string">"com.sst.entity.vo.ProductVo"</span> <span class="attr">autoMapping</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"productId"</span> <span class="attr">column</span>=<span class="string">"PRODUCTID"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"carrierName"</span> <span class="attr">column</span>=<span class="string">"PRODUCTID"</span> <span class="attr">javaType</span>=<span class="string">"java.util.ArrayList"</span> <span class="attr">ofType</span>=<span class="string">"java.lang.String"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">fetchType</span>=<span class="string">"eager"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">select</span>=<span class="string">"selectCarrierName"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getProductDetail"</span> <span class="attr">resultMap</span>=<span class="string">"productDetailResult"</span>&gt;</span></span><br><span class="line">  SELECT PRODUCTID, PRODUCTNAME, PRODUCTPRICE FROM PRODUCTS WHERE PRODUCTID = #&#123;productId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><h3 id="ResultMap-联合主键"><a href="#ResultMap-联合主键" class="headerlink" title="ResultMap 联合主键"></a>ResultMap 联合主键</h3><blockquote>
<p>联合主键和复合主键的区别：</p>
<p>联合主键是多个主键联合后形成的主键，常见于多对多关系表中。</p>
<p>复合主键是同一张表的多列组合成一个主键。</p>
<p>联合主键和复合主键都是多列组合而成，区别在于这些列是否是由其他表的主键而来。</p>
</blockquote>
<p>项目中要查询哪种/那类商品需要用哪种包装材料！每种包装材料有多种不同的尺寸。</p>
<h3 id="包装材料表-PACKAGING-MATERIAL"><a href="#包装材料表-PACKAGING-MATERIAL" class="headerlink" title="包装材料表 PACKAGING_MATERIAL"></a>包装材料表 PACKAGING_MATERIAL</h3><table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Comment</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>NUMBER(20)</td>
<td>主键</td>
</tr>
<tr>
<td>CODE</td>
<td>VARCHAR2(20)</td>
<td>代号</td>
</tr>
<tr>
<td>NAME</td>
<td>VARCHAR2(255)</td>
<td>名称</td>
</tr>
<tr>
<td>LENGTH</td>
<td>VARCHAR2(20)</td>
<td>长度</td>
</tr>
<tr>
<td>WIDTH</td>
<td>VARCHAR2(20)</td>
<td>宽度</td>
</tr>
<tr>
<td>HEIGHT</td>
<td>VARCHAR2(20)</td>
<td>高度</td>
</tr>
</tbody></table>
<h3 id="包装材料-产品关系表-MATERIAL-PRODUCT-REL"><a href="#包装材料-产品关系表-MATERIAL-PRODUCT-REL" class="headerlink" title="包装材料-产品关系表 MATERIAL_PRODUCT_REL"></a>包装材料-产品关系表 MATERIAL_PRODUCT_REL</h3><table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Type</strong></th>
<th><strong>Comment</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>NUMBER(20)</td>
<td>主键</td>
</tr>
<tr>
<td>PACKAGING_MATERIAL_CODE</td>
<td>VARCHAR2(20)</td>
<td>包装材料代号</td>
</tr>
<tr>
<td>PRODUCT_ID</td>
<td>NUMBER(20)</td>
<td>商品ID</td>
</tr>
<tr>
<td>PRODUCT_CATEGORY_ID</td>
<td>NUMBER(20)</td>
<td>商品类别ID</td>
</tr>
<tr>
<td>MAX_PRODUCT_QUANTITY</td>
<td>NUMBER(5)</td>
<td>最大可叠加打包的商品数量</td>
</tr>
<tr>
<td>PACKAGING_LAYER</td>
<td>NUMBER(2)</td>
<td>包几层</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"materialVoMap"</span> <span class="attr">type</span>=<span class="string">"com.sst.entity.vo.PackagingMaterialVo"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 联合主键 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"PACKAGING_MATERIAL_CODE"</span> <span class="attr">property</span>=<span class="string">"packagingMaterialCode"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"PRODUCT_ID"</span> <span class="attr">property</span>=<span class="string">"productId"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"PRODUCT_CATEGORY_ID"</span> <span class="attr">property</span>=<span class="string">"productCategoryId"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"MAX_PRODUCT_QUANTITY"</span> <span class="attr">property</span>=<span class="string">"maxProductQuantity"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"PACKAGING_LAYER"</span> <span class="attr">property</span>=<span class="string">"packagingLayer"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"packagingMaterials"</span> <span class="attr">ofType</span>=<span class="string">"com.sst.entity.po.PackagingMaterialPo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"ID"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"NAME"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"CODE"</span> <span class="attr">property</span>=<span class="string">"code"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"LENGTH"</span> <span class="attr">property</span>=<span class="string">"length"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"WIDTH"</span> <span class="attr">property</span>=<span class="string">"width"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"HEIGHT"</span> <span class="attr">property</span>=<span class="string">"height"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultMap</span>=<span class="string">"materialVoMap"</span>&gt;</span></span><br><span class="line">  SELECT</span><br><span class="line">  mpr.PACKAGING_MATERIAL_CODE,</span><br><span class="line">  mpr.PRODUCT_ID,</span><br><span class="line">  mpr.PRODUCT_CATEGORY_ID,</span><br><span class="line">  mpr.MAX_PRODUCT_QUANTITY,</span><br><span class="line">  mpr.PACKAGING_LAYER,</span><br><span class="line">  pm.ID,</span><br><span class="line">  pm.NAME,</span><br><span class="line">  pm.CODE,</span><br><span class="line">  pm.LENGTH,</span><br><span class="line">  pm.WIDTH,</span><br><span class="line">  pm.HEIGHT</span><br><span class="line">  FROM</span><br><span class="line">  ( SELECT * FROM MATERIAL_PRODUCT_REL WHERE PRODUCT_ID IN</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"productIds"</span> <span class="attr">item</span>=<span class="string">"productId"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">    #&#123;productId&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  OR PRODUCT_CATEGORY_ID IN</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"categoryIds"</span> <span class="attr">item</span>=<span class="string">"categoryId"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">    #&#123;categoryId&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  ) mpr</span><br><span class="line">  LEFT JOIN PACKAGING_MATERIAL pm ON mpr.PACKAGING_MATERIAL_CODE = pm.CODE</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>Study Notes of MySQL</title>
    <url>/2018/06/09/Study-Notes-of-MySQL/</url>
    <content><![CDATA[<p><img data-src="https://upload.wikimedia.org/wikipedia/zh/thumb/6/62/MySQL.svg/1200px-MySQL.svg.png" alt=""></p>
<a id="more"></a>

<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>单行注释：–</p>
<p>多行注释：/* */</p>
<h2 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h2><p><strong>修改自增 ID 起始值</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table tablename AUTO_INCREMENT&#x3D;1;</span><br></pre></td></tr></table></figure>

<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><ol>
<li><p><code>IN</code>运算符不要嵌套使用，效率会急剧下降。因此一般使用连接查询，而不使用子查询。</p>
<p>执行子查询时，MYSQL 需要创建临时表，查询完毕后再删除这些临时表，所以，子查询的速度慢。</p>
</li>
</ol>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h3><h4 id="DATE-FORMAT"><a href="#DATE-FORMAT" class="headerlink" title="DATE_FORMAT"></a>DATE_FORMAT</h4><blockquote>
<p><a href="http://www.w3school.com.cn/sql/func_date_format.asp" target="_blank" rel="noopener">MySQL DATE_FORMAT() 函数</a></p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_date-format" target="_blank" rel="noopener">DATE_FORMAT(date,format)</a></p>
</blockquote>
<p>DATE_FORMAT() 函数用于以不同的格式显示日期/时间数据。</p>
<p>eg: 输出格式为：YYYY-mm-dd HH:ss</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line"><span class="keyword">DATE_FORMAT</span>(startTime,<span class="string">"%Y-%m-%d %H:%i"</span>) <span class="keyword">AS</span> startTime,</span><br><span class="line"><span class="keyword">DATE_FORMAT</span>(endTime,<span class="string">"%Y-%m-%d %H:%i"</span>) <span class="keyword">AS</span> endTime</span><br><span class="line"><span class="keyword">from</span> tableName;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>%a</td>
<td>缩写星期名</td>
</tr>
<tr>
<td>%b</td>
<td>缩写月名</td>
</tr>
<tr>
<td>%c</td>
<td>月，数值</td>
</tr>
<tr>
<td>%D</td>
<td>带有英文前缀的月中的天</td>
</tr>
<tr>
<td>%d</td>
<td>月的天，数值(00-31)</td>
</tr>
<tr>
<td>%e</td>
<td>月的天，数值(0-31)</td>
</tr>
<tr>
<td>%f</td>
<td>微秒</td>
</tr>
<tr>
<td>%H</td>
<td>小时 (00-23)</td>
</tr>
<tr>
<td>%h</td>
<td>小时 (01-12)</td>
</tr>
<tr>
<td>%I</td>
<td>小时 (01-12)</td>
</tr>
<tr>
<td>%i</td>
<td>分钟，数值(00-59)</td>
</tr>
<tr>
<td>%j</td>
<td>年的天 (001-366)</td>
</tr>
<tr>
<td>%k</td>
<td>小时 (0-23)</td>
</tr>
<tr>
<td>%l</td>
<td>小时 (1-12)</td>
</tr>
<tr>
<td>%M</td>
<td>月名</td>
</tr>
<tr>
<td>%m</td>
<td>月，数值(00-12)</td>
</tr>
<tr>
<td>%p</td>
<td>AM 或 PM</td>
</tr>
<tr>
<td>%r</td>
<td>时间，12-小时（hh:mm:ss AM 或 PM）</td>
</tr>
<tr>
<td>%S</td>
<td>秒(00-59)</td>
</tr>
<tr>
<td>%s</td>
<td>秒(00-59)</td>
</tr>
<tr>
<td>%T</td>
<td>时间, 24-小时 (hh:mm:ss)</td>
</tr>
<tr>
<td>%U</td>
<td>周 (00-53) 星期日是一周的第一天</td>
</tr>
<tr>
<td>%u</td>
<td>周 (00-53) 星期一是一周的第一天</td>
</tr>
<tr>
<td>%V</td>
<td>周 (01-53) 星期日是一周的第一天，与 %X 使用</td>
</tr>
<tr>
<td>%v</td>
<td>周 (01-53) 星期一是一周的第一天，与 %x 使用</td>
</tr>
<tr>
<td>%W</td>
<td>星期名</td>
</tr>
<tr>
<td>%w</td>
<td>周的天 （0=星期日, 6=星期六）</td>
</tr>
<tr>
<td>%X</td>
<td>年，其中的星期日是周的第一天，4 位，与 %V 使用</td>
</tr>
<tr>
<td>%x</td>
<td>年，其中的星期一是周的第一天，4 位，与 %v 使用</td>
</tr>
<tr>
<td>%Y</td>
<td>年，4 位</td>
</tr>
<tr>
<td>%y</td>
<td>年，2 位</td>
</tr>
</tbody></table>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><h4 id="CONCAT"><a href="#CONCAT" class="headerlink" title="CONCAT"></a>CONCAT</h4><blockquote>
<p><a href="https://www.w3cschool.cn/sql/sz8w1ozt.html" target="_blank" rel="noopener">SQL CONCAT() 函数</a></p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_concat" target="_blank" rel="noopener">CONCAT(str1,str2,…)</a></p>
</blockquote>
<p><strong>CONCAT</strong> 函数用于将两个字符串连接为一个字符串</p>
<p>eg: </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">SQL&gt; SELECT CONCAT('FIRST ', 'SECOND');</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| CONCAT('FIRST ', 'SECOND') |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| FIRST SECOND               |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>在 MyBatis 中常用于编写模糊查询语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"list"</span> <span class="attr">resultType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    select * from tableName</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"condition != null and condition != ''"</span>&gt;</span></span><br><span class="line">        where fieldName like CONCAT('%',#&#123;condition&#125;,'%')</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>MySql 中<code>select null + 1</code>的结果是<code>null</code></li>
</ul>
]]></content>
      <categories>
        <category>Notes</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of NPM</title>
    <url>/2019/08/30/Study-Notes-of-NPM/</url>
    <content><![CDATA[<img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Npm-logo.svg/1200px-Npm-logo.svg.png" width="100%"/>

<a id="more"></a>

<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>快速生成<code>package.json</code>文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> --yes 参数能够帮助我们快速生成默认的package.json</span></span><br><span class="line">npm init --yes</span><br></pre></td></tr></table></figure>

<h2 id="npm-运行模块命令"><a href="#npm-运行模块命令" class="headerlink" title="npm 运行模块命令"></a>npm 运行模块命令</h2><blockquote>
<p><a href="https://blog.csdn.net/qq_21998595/article/details/80460673" target="_blank" rel="noopener">关于局部安装npm模块找不到命令的问题分析及解决方案</a></p>
</blockquote>
<p>命令行运行 npm 局部安装的包：</p>
<ol>
<li><p>在相应命令前加上路径 <code>node_modules/.bin/</code></p>
<p>例如：<code>node_modules/.bin/lessc 1-nest.less test.css</code></p>
</li>
<li><p>package.json 中配置 scripts</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "lessc": "less index.js"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
]]></content>
      <categories>
        <category>npm</category>
      </categories>
      <tags>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Nginx</title>
    <url>/2020/10/21/Study-Notes-of-Nginx/</url>
    <content><![CDATA[<img data-src="https://www.nginx.com/wp-content/uploads/2018/08/NGINX-logo-rgb-large.png" width="100%"/>

<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote>
<p>Nginx是异步框架的网页服务器，也可以用作反向代理、负载平衡器和HTTP缓存。该软件由伊戈尔·赛索耶夫创建并于2004年首次公开发布。2011年成立同名公司以提供支持。2019年3月11日，Nginx公司被F5 Networks以6.7亿美元收购。 Nginx是免费的开源软件，根据类BSD许可证的条款发布。 <a href="https://zh.wikipedia.org/zh-cn/Nginx" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<p>Nginx 是一款轻量级的 WEB 服务器，采用事件驱动的异步非阻塞处理方式，具有极好的 IO 性能，时常用于<strong>反向代理</strong>、<strong>负载均衡</strong>和HTTP缓存。</p>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h2><h3 id="为什么说-Nginx-是轻量级的-WEB-服务器？"><a href="#为什么说-Nginx-是轻量级的-WEB-服务器？" class="headerlink" title="为什么说 Nginx 是轻量级的 WEB 服务器？"></a>为什么说 Nginx 是轻量级的 WEB 服务器？</h3><blockquote>
<p>什么是轻量级的 WEB 服务器?</p>
</blockquote>
<p>由于 Nginx 采用 Reactor 模型，使得使用一个进程就可以处理多个请求，而重量级服务器对于每个请求都需要一个进程处理，进程会占用资源，当并发量大的时候，会导致很高的内存占用和CPU占用，也就是所谓的“重量级”。</p>
<p>也就是说，轻量级与重量级是指占用机器资源的大小，占用资源多的叫重量级，占用少的叫轻量级。</p>
]]></content>
      <categories>
        <category>Study Notes</category>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Oracle</title>
    <url>/2019/08/07/Study-Notes-of-Oracle/</url>
    <content><![CDATA[<img data-src="https://www.datocms-assets.com/2885/1522106007-oracle.png" width="100%"/>

<a id="more"></a>

<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h3><blockquote>
<p><a href="https://blog.csdn.net/huoyin/article/details/1921148" target="_blank" rel="noopener">查看oracle数据库(database)的版本命令_花果山-CSDN博客</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> v$<span class="keyword">version</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">version</span> <span class="keyword">from</span> v$<span class="keyword">instance</span>;</span><br><span class="line"><span class="keyword">Select</span> <span class="keyword">version</span> <span class="keyword">FROM</span> Product_component_version   <span class="keyword">Where</span> <span class="keyword">SUBSTR</span>(PRODUCT,<span class="number">1</span>,<span class="number">6</span>)=<span class="string">'Oracle'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a><a href="https://libo9527.github.io/2019/08/14/SQL-Functions-in-ORACLE/" target="_blank" rel="noopener">函数</a></h2><h2 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">USER</span> ( <span class="keyword">ID</span>, USERNAME, <span class="keyword">PASSWORD</span>, CREATE_DATE, DEL_FLAG ) </span><br><span class="line">  <span class="keyword">SELECT</span> SEQ_USER.nextval, t.* </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">'zhangsan'</span> USERNAME, <span class="string">'zxode23'</span> <span class="keyword">PASSWORD</span>, <span class="keyword">SYSDATE</span> CREATE_DATE, <span class="number">0</span> DEL_FLAG <span class="keyword">FROM</span> dual </span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">'lisi'</span> USERNAME, <span class="string">'9fhd2fd'</span> <span class="keyword">PASSWORD</span>, <span class="keyword">SYSDATE</span> CREATE_DATE, <span class="number">0</span> DEL_FLAG <span class="keyword">FROM</span> dual </span><br><span class="line">    ) t</span><br></pre></td></tr></table></figure>

<p>MyBatis 批量插入，使用序列做自增ID</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertList"</span>&gt;</span></span><br><span class="line">  INSERT INTO USER ( ID, USERNAME, PASSWORD, CREATE_DATE, DEL_FLAG )</span><br><span class="line">  SELECT SEQ_USER.nextval, t.* FROM</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">"UNION ALL"</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">    SELECT #&#123;item.USERNAME&#125; USERNAME, #&#123;item.PASSWORD&#125; PASSWORD, SYSDATE CREATE_DATE, 0 DEL_FLAG FROM dual</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  t</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>union all：不去重</p>
<p>union：去重</p>
<h2 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h2><h3 id="缺省值-NULL"><a href="#缺省值-NULL" class="headerlink" title="缺省值 NULL"></a>缺省值 NULL</h3><ul>
<li><p>Oracle 在 Order by 时认为 null 是最大值，所以如果是 ASC 升序则排在最后，DESC 降序则排在最前。</p>
</li>
<li><p>可以使用 nulls first 或者 nulls last 语法来控制 NULL 的位置。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">---将 null 始终放在最前</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">TABLE</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COLUMN</span> <span class="keyword">nulls</span> <span class="keyword">first</span></span><br><span class="line"><span class="comment">---将 null 始终放在最后</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">TABLE</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COLUMN</span> <span class="keyword">nulls</span> <span class="keyword">last</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">... ORDER BY 1</span><br></pre></td></tr></table></figure>

<p>ORDER BY 后面跟数字，代表排序字段为查询结果字段中的第几个。</p>
<p>例如</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ID</span>, <span class="keyword">NAME</span>, EMAIL, PHONE <span class="keyword">FROM</span> SYS_USER <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ID</span>, <span class="keyword">NAME</span>, EMAIL, PHONE <span class="keyword">FROM</span> SYS_USER <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">ID</span></span><br></pre></td></tr></table></figure>



<h2 id="EXISTS"><a href="#EXISTS" class="headerlink" title="EXISTS"></a>EXISTS</h2><blockquote>
<p><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/conditions012.htm" target="_blank" rel="noopener">EXISTS Condition | Oracle</a></p>
<p>An <code>EXISTS</code> condition tests for existence of rows in a subquery.</p>
</blockquote>
<p>一般情况下公司数据库不会加外健来关联两张表，查询时为了避免数据不存在会使用 EXISTS 进行过滤。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	d.department_id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	departments d </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">EXISTS</span> ( </span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		* </span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		employees e </span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">	d.department_id = e.department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="GROUP-BY-VS-PARTITION-BY"><a href="#GROUP-BY-VS-PARTITION-BY" class="headerlink" title="GROUP BY VS PARTITION BY"></a>GROUP BY VS PARTITION BY</h2><blockquote>
<p>Oracle 对于 GROUP BY 是严格的，oracle 中规定，使用 group by 时，select 后面所有不是聚合函数的字段，都必须出现在 group by 后面，否则会报错：“ORA-00979: not a GROUP BY expression”。而 MySQL 则不同，如果 SELECT 出来的字段在 GROUP BY 后面没有出现，那么会随机取出一个值。</p>
</blockquote>
<blockquote>
<p><a href="https://asktom.oracle.com/pls/asktom/asktom.search?tag=partition-by-and-group-by" target="_blank" rel="noopener">partition by and group by | Oracle</a></p>
<p>Totally different things.</p>
<p>GROUP BY is about aggregation. Take ‘n’ rows and reduce the number of rows (by summing, or max, or min etc)..But we are <em>consolidating</em> some data.</p>
<p>PARTITION BY is about carving up data into chunks. Take ‘n’ rows, apply some rule to split the rows into buckets…but will still have ‘n’ rows.</p>
</blockquote>
<ul>
<li>GROUP BY 是关于聚合函数的，PARTITION BY 是敢于分析函数的。</li>
<li>对于 n 行数据，GROUP BY 返回的肯定小于等于 n 行，而 PARTITION BY 会返回 n 行。</li>
</ul>
<p>eg：求各部门员工工资总和</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用分组函数GROUP BY方式</span></span><br><span class="line"><span class="keyword">SELECT</span> deptno 部门编号,<span class="keyword">SUM</span>(sal) 部门工资总和 <span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno;</span><br><span class="line"><span class="comment">-- 结果</span></span><br><span class="line"><span class="comment">-----------------------</span></span><br><span class="line">| 部门编号 | 部门工资总和 |</span><br><span class="line">| 30 | 10900 |</span><br><span class="line">| 20 | 10575 |</span><br><span class="line">| 10 | 9250 |</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用分析函数 PARTITION BY方式</span></span><br><span class="line"><span class="keyword">SELECT</span> deptno 部门编号,<span class="keyword">SUM</span>(SAL) <span class="keyword">OVER</span> (<span class="keyword">partition</span> <span class="keyword">by</span> sal) 部门工资总和 <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">| 部门编号 | 部门工资总和 |</span><br><span class="line">|	30 | 1450 |</span><br><span class="line">|	30 | 1500 |</span><br><span class="line">|	30 | 3200 |</span><br><span class="line">|	20 | 3200 |</span><br><span class="line">|	30 | 3500 |</span><br><span class="line">|	30 | 3500 |</span><br><span class="line">|	10 | 1800 |</span><br><span class="line">|	10 | 2450 |</span><br><span class="line">|	30 | 2850 |</span><br><span class="line">|	20 | 2975 |</span><br><span class="line">|	20 | 6000 |</span><br><span class="line">|	20 | 6000 |</span><br><span class="line">|	10 | 5000 |</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line"><span class="keyword">SELECT</span> deptno 部门编号 ,ename 员工姓名, sal 员工工资, <span class="keyword">SUM</span>(sal) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> deptno <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) 所在部门工资总和  <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">----------------------------------------------</span></span><br><span class="line">| 部门编号 | 员工姓名 | 员工工资 | 所在部门工资总和 |</span><br><span class="line">| 10 | MILLER | 1800 | 1800 |</span><br><span class="line">| 10 | CLARK | 2450 | 4250 |</span><br><span class="line">| 10 | KING | 5000 | 9250 |</span><br><span class="line">| 20 | ADAMS | 1600 | 1600 |</span><br><span class="line">| 20 | JONES | 2975 | 4575 |</span><br><span class="line">| 20 | SCOTT | 3000 | 10575 |</span><br><span class="line">| 20 | FORD | 3000 | 10575 |</span><br><span class="line">| 30 | JAMES | 1450 | 1450 |</span><br><span class="line">| 30 | TURNER | 1500 | 2950 |</span><br><span class="line">| 30 | ALLEN | 1600 | 4550 |</span><br><span class="line">| 30 | WARD | 1750 | 8050 |</span><br><span class="line">| 30 | MARTIN | 1750 | 8050 |</span><br><span class="line">| 30 | BLAKE | 2850 | 10900 |</span><br></pre></td></tr></table></figure>

<h2 id="递归查询"><a href="#递归查询" class="headerlink" title="递归查询"></a>递归查询</h2><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> tablename <span class="keyword">WHERE</span> ... <span class="keyword">START</span> <span class="keyword">WITH</span> ... <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">PRIOR</span> ...</span><br></pre></td></tr></table></figure>

<p>eg：</p>
<p>地址表 GLOBAL_LOCATION</p>
<p><img data-src="https://i.loli.net/2019/08/13/6nlYZxW5zsLbfAC.png" alt="pic"></p>
<ul>
<li><p>查询北京所有的子孙节点</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ID</span>, PARENT_ID, <span class="keyword">NAME</span> <span class="keyword">FROM</span> GLOBAL_LOCATION <span class="keyword">START</span> <span class="keyword">WITH</span> PARENT_ID = <span class="number">247</span> <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">PRIOR</span> <span class="keyword">ID</span> = PARENT_ID</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询海淀所有的祖先节点</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ID</span>, PARENT_ID, <span class="keyword">NAME</span> <span class="keyword">FROM</span> GLOBAL_LOCATION <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="keyword">ID</span> = <span class="number">3026</span> <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">PRIOR</span> PARENT_ID = <span class="keyword">ID</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h2><h3 id="查看执行计划的方法"><a href="#查看执行计划的方法" class="headerlink" title="查看执行计划的方法"></a>查看执行计划的方法</h3><ol>
<li>Explain Plan For SQL<ul>
<li>不实际执行 SQL 语句，生成的计划未必是真实执行的计划</li>
<li>必须要有 plan_table 表</li>
</ul>
</li>
<li>SQLPLUS AUTOTRACE<ul>
<li>除 set autotrace traceably explain 外均实际执行 SQL，但仍未必是真实计划</li>
<li>必须要有 plan_table</li>
<li>它只是简单的在后台执行 “explain plan” 并且调用 “dbms_xplan.display”；</li>
</ul>
</li>
<li>SQL TRACE<ul>
<li>需要启用 10046 或者 SQL_TRACE</li>
<li>一般用 tkprof 看的更清楚些，当然 10046 里本身也有执行计划信息</li>
</ul>
</li>
<li>V$SQL 和 V$SQL_PLAN<ul>
<li>可以查询到多个子游标的计划信息了，但是看起来比较费劲</li>
</ul>
</li>
<li>Enterprise Manager<ul>
<li>可以图形化显示执行计划，但并非所有环境有 EM 可用</li>
</ul>
</li>
<li>其他第三方工具<ul>
<li>注意 PL/SQL developer 之类工具 F5 看到的执行计划未必是真实的。</li>
</ul>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">lpad</span>(<span class="string">'-'</span>, <span class="number">5</span> * ( <span class="keyword">LEVEL</span> - <span class="number">1</span> )) || operation operation,</span><br><span class="line">	options,</span><br><span class="line">	object_name,</span><br><span class="line">	<span class="keyword">cost</span>,</span><br><span class="line">	<span class="keyword">position</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	plan_table <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="keyword">id</span> = <span class="number">0</span> <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">PRIOR</span> <span class="keyword">id</span> = parent_id;</span><br></pre></td></tr></table></figure>



<h2 id="Comprehensive-examples-in-work"><a href="#Comprehensive-examples-in-work" class="headerlink" title="Comprehensive examples in work"></a>Comprehensive examples in work</h2><h3 id="地址树远程搜索"><a href="#地址树远程搜索" class="headerlink" title="地址树远程搜索"></a>地址树远程搜索</h3><p>需求说明：input 框中输入地址，远程搜索出匹配节点，由于同名地址到存在，要求将完整地址一同显示。</p>
<p><img data-src="https://i.loli.net/2019/08/10/TCvoScY2A7Vajd8.png" alt="pic"></p>
<p>表结构：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">"SKYSTAR"</span>.<span class="string">"GLOBAL_LOCATION_copy1"</span> (</span><br><span class="line">  <span class="string">"ID"</span> <span class="built_in">NUMBER</span>(<span class="number">20</span>) <span class="keyword">VISIBLE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line">  <span class="string">"PARENT_ID"</span> <span class="built_in">NUMBER</span>(<span class="number">20</span>) <span class="keyword">VISIBLE</span> ,</span><br><span class="line">  <span class="string">"PATH"</span> <span class="built_in">VARCHAR2</span>(<span class="number">100</span> <span class="keyword">BYTE</span>) <span class="keyword">VISIBLE</span> ,</span><br><span class="line">  <span class="string">"ENGLISH_NAME"</span> <span class="built_in">VARCHAR2</span>(<span class="number">255</span> <span class="keyword">BYTE</span>) <span class="keyword">VISIBLE</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>样例数据：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"GLOBAL_LOCATION"</span>(<span class="string">"ID"</span>, <span class="string">"PARENT_ID"</span>, <span class="string">"PATH"</span>, <span class="string">"ENGLISH_NAME"</span>) <span class="keyword">VALUES</span> (<span class="string">'250'</span>, <span class="string">'7'</span>, <span class="string">',1,7,250,'</span>, <span class="string">'Shanxi'</span>);</span><br></pre></td></tr></table></figure>

<ol>
<li><p>根据输入查找节点</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ID</span>, ENGLISH_NAME, <span class="keyword">PATH</span> <span class="keyword">FROM</span> GLOBAL_LOCATION <span class="keyword">WHERE</span> <span class="keyword">UPPER</span>(ENGLISH_NAME) <span class="keyword">LIKE</span> <span class="string">'%'</span> || <span class="keyword">UPPER</span>(<span class="comment">#&#123;NAME&#125;) || '%'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>去掉 PATH 前后的 <code>,</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>( <span class="string">',1,7,250,'</span>, <span class="number">2</span>, <span class="keyword">LENGTH</span>( <span class="string">',1,7,250,'</span> ) - <span class="number">2</span> ) <span class="keyword">FROM</span> dual</span><br></pre></td></tr></table></figure>
</li>
<li><p>将去掉前后 <code>,</code> 的路径 PATH 按 <code>,</code> 分割得到祖先 ID</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	REGEXP_SUBSTR( <span class="string">'1,7,250'</span>, <span class="string">'[^,]+'</span>, <span class="number">1</span>, <span class="keyword">ROWNUM</span> ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	dual <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">ROWNUM</span> &lt;= <span class="keyword">LENGTH</span>( <span class="string">'1,7,250'</span> ) - <span class="keyword">LENGTH</span>(REGEXP_REPLACE( <span class="string">'1,7,250'</span>, <span class="string">','</span>, <span class="string">''</span> )) + <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查找所有祖先节点，并使用 <code>&gt;</code> 连接</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">LISTAGG</span> ( ENGLISH_NAME, <span class="string">' &gt; '</span> ) <span class="keyword">WITHIN</span> <span class="keyword">GROUP</span> ( <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">ID</span> ) address </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="keyword">ID</span>, ENGLISH_NAME <span class="keyword">FROM</span> GLOBAL_LOCATION <span class="keyword">WHERE</span> <span class="keyword">ID</span> <span class="keyword">IN</span> ( <span class="number">1</span>, <span class="number">7</span>, <span class="number">250</span> ) )</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>汇总后的 SQL：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">ID</span>,</span><br><span class="line">    ENGLISH_NAME,</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        <span class="keyword">LISTAGG</span> ( ENGLISH_NAME, <span class="string">' &gt; '</span> ) <span class="keyword">WITHIN</span> <span class="keyword">GROUP</span> ( <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">ID</span> ) ADDRESS</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            <span class="keyword">ID</span>,</span><br><span class="line">            ENGLISH_NAME</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            GLOBAL_LOCATION</span><br><span class="line">        <span class="keyword">WHERE</span> <span class="keyword">ID</span> <span class="keyword">IN</span> (</span><br><span class="line">            <span class="keyword">SELECT</span></span><br><span class="line">                REGEXP_SUBSTR( t1.ADDRESS, <span class="string">'[^,]+'</span>, <span class="number">1</span>, <span class="keyword">ROWNUM</span> )</span><br><span class="line">            <span class="keyword">FROM</span></span><br><span class="line">                dual <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">ROWNUM</span> &lt;= <span class="keyword">LENGTH</span>( t1.address ) - <span class="keyword">LENGTH</span>(REGEXP_REPLACE( t1.ADDRESS, <span class="string">','</span>, <span class="string">''</span> )) + <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line">) FULL_ADDRESS</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        <span class="keyword">ID</span>,</span><br><span class="line">        ENGLISH_NAME,</span><br><span class="line">        ( <span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>( gl.PATH, <span class="number">2</span>, <span class="keyword">LENGTH</span>( gl.PATH ) - <span class="number">2</span> ) <span class="keyword">FROM</span> dual ) ADDRESS</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    ( <span class="keyword">SELECT</span> <span class="keyword">ID</span>, ENGLISH_NAME, <span class="keyword">PATH</span> <span class="keyword">FROM</span> GLOBAL_LOCATION <span class="keyword">WHERE</span> <span class="keyword">UPPER</span>( ENGLISH_NAME ) <span class="keyword">LIKE</span> <span class="string">'%'</span> || <span class="keyword">UPPER</span>( <span class="string">'shan'</span> ) || <span class="string">'%'</span> ) gl</span><br><span class="line">) t1</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/08/10/F6XYRiD7Q29OHrE.png" alt="pic"></p>
<p><img data-src="https://i.loli.net/2019/08/10/NL9lIHtJnXxmC38.png" alt="pic"></p>
<a href="/2019/09/17/Using-Triggers-in-ORACLE/" title="触发器（TRIGGER）">触发器（TRIGGER）</a>

<h3 id="Top-n"><a href="#Top-n" class="headerlink" title="Top n"></a>Top n</h3><blockquote>
<p><a href="https://oracle-base.com/articles/misc/top-n-queries" target="_blank" rel="noopener">Top-N Queries</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">USERS</span> <span class="keyword">WHERE</span> <span class="keyword">ROWNUM</span> &lt; <span class="number">10</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">ID</span> <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h3 id="分组-Top-n"><a href="#分组-Top-n" class="headerlink" title="分组 Top n"></a>分组 Top n</h3><blockquote>
<p><a href="https://blog.csdn.net/weixin_30692143/article/details/95742271" target="_blank" rel="noopener">oracle中分组排序取TOP n_weixin_30692143的博客-CSDN …</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	* </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> u.ID, u.NAME, row_number () <span class="keyword">over</span> ( <span class="keyword">partition</span> <span class="keyword">BY</span> <span class="keyword">GROUP_ID</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">ID</span> ) rn <span class="keyword">FROM</span> <span class="keyword">USERS</span> u ) </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	rn &lt; <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="链接查询-vs-子查询"><a href="#链接查询-vs-子查询" class="headerlink" title="链接查询 vs 子查询"></a>链接查询 vs 子查询</h3><h2 id="ERROR"><a href="#ERROR" class="headerlink" title="ERROR"></a>ERROR</h2><h3 id="ORA-03113"><a href="#ORA-03113" class="headerlink" title="ORA-03113"></a>ORA-03113</h3><blockquote>
<p><a href="https://blog.csdn.net/zwk626542417/article/details/39667999" target="_blank" rel="noopener">Oracle错误——ORA-03113:通信通道的文件结尾 解决办法</a></p>
</blockquote>
<h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>Oracle 中使用 <code>COUNT(DISTINCT xxx)</code> 时出现：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ORA-03113：<span class="keyword">end</span>-<span class="keyword">of</span>-<span class="keyword">file</span> <span class="keyword">on</span> communication  channel</span><br></pre></td></tr></table></figure>

<p>而且只有在原始表中执行会报这个错，将原始表复制后再执行又不报错，或者把 <code>DISTINCT</code> 去掉再执行也不报错。</p>
<h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    t.address_cityTown <span class="keyword">AS</span> <span class="keyword">ID</span>,</span><br><span class="line">    gl.PATH,</span><br><span class="line">    <span class="keyword">COUNT</span>( <span class="keyword">DISTINCT</span> t.id ) <span class="keyword">AS</span> collectedQTY</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    cr.id,</span><br><span class="line">    jt.*</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    ( <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> CUSTOMER_RAW <span class="keyword">WHERE</span> DEL_FLAG = <span class="number">0</span> ) cr,</span><br><span class="line">    JSON_TABLE (</span><br><span class="line">    <span class="keyword">DATA</span>,</span><br><span class="line">    <span class="string">'$.generalInfo.address[*]'</span> <span class="keyword">COLUMNS</span> ( row_number <span class="keyword">FOR</span> <span class="keyword">ORDINALITY</span>, address_cityTown <span class="built_in">NUMBER</span> ( <span class="number">20</span> ) <span class="keyword">PATH</span> <span class="string">'$.cityTown'</span> )) <span class="keyword">AS</span> jt</span><br><span class="line">    ) t</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> GLOBAL_LOCATION gl <span class="keyword">ON</span> t.address_cityTown = gl.ID</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">    t.address_cityTown,</span><br><span class="line">    gl.PATH</span><br></pre></td></tr></table></figure>

<h4 id="TABLE"><a href="#TABLE" class="headerlink" title="TABLE"></a>TABLE</h4><blockquote>
<p><a href="/download/CUSTOMER_RAW.sql">CUSTOMER_RAW.sql</a></p>
</blockquote>
<h3 id="ORA-04098"><a href="#ORA-04098" class="headerlink" title="ORA-04098"></a>ORA-04098</h3><blockquote>
<p><a href="https://www.cnblogs.com/enternal07/p/6762752.html" target="_blank" rel="noopener">Oracle触发器，解决ORA-04098: 触发器 ‘USER.DECTUSERTEST_TRI’ 无效且未通过重新验证</a></p>
</blockquote>
<h4 id="问题描述-1"><a href="#问题描述-1" class="headerlink" title="问题描述"></a>问题描述</h4><p>创建了一个触发器，在执行触发事件的 SQL 时报错：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ORA-04098: trigger 'SKYSTAR.COUNT_COLLECTED_QTY' is invalid and failed re-validation</span><br></pre></td></tr></table></figure>

<h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">TRIGGER</span> Count_Collected_Qty </span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">INSERT</span>  </span><br><span class="line"><span class="keyword">ON</span> CUSTOMER_RAW_TEST</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">each</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">UPDATE</span> GLOBAL_LOCATION_TEST <span class="keyword">SET</span> COLLECTED_QTY = COLLECTED_QTY + <span class="number">1</span> </span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<h4 id="触发-SQL"><a href="#触发-SQL" class="headerlink" title="触发 SQL"></a>触发 SQL</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"CUSTOMER_RAW_TEST"</span>(<span class="string">"ID"</span>, <span class="string">"DATA"</span>, <span class="string">"SOURCE_TYPE_ID"</span>, <span class="string">"STATUS"</span>, <span class="string">"CREATE_BY"</span>, <span class="string">"CREATE_DATE"</span>, <span class="string">"UPDATE_BY"</span>, <span class="string">"UPDATE_DATE"</span>, <span class="string">"DEL_FLAG"</span>, <span class="string">"GOOGLE_FLAG"</span>, <span class="string">"GOOGLE_ADDRESS"</span>, <span class="string">"PROCESS_FLAG"</span>) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">'5'</span>, <span class="string">'&#123;"generalInfo":&#123;"address":[&#123;"country":5100,"countryName":"Test Country A","state":5110,"stateName":"Test State AA","cityTown":5111,"cityTownName":"Test City AAA"&#125;]&#125;&#125;'</span>, <span class="string">'1'</span>, <span class="string">'213'</span>, <span class="string">'1435'</span>, <span class="keyword">TO_DATE</span>(<span class="string">'2019-09-16 15:36:37'</span>, <span class="string">'SYYYY-MM-DD HH24:MI:SS'</span>), <span class="string">'1435'</span>, <span class="keyword">TO_DATE</span>(<span class="string">'2019-09-16 15:36:37'</span>, <span class="string">'SYYYY-MM-DD HH24:MI:SS'</span>), <span class="string">'0'</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>

<h4 id="TABLE-1"><a href="#TABLE-1" class="headerlink" title="TABLE"></a>TABLE</h4><p><a href="/download/GLOBAL_LOCATION_TEST.sql">GLOBAL_LOCATION_TEST.sql</a></p>
<p><a href="/download/CUSTOMER_RAW_TEST.sql">CUSTOMER_RAW_TEST.sql</a></p>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>触发操作中的 SQL 语句没有加 <code>;</code></p>
<h3 id="ORA-00933"><a href="#ORA-00933" class="headerlink" title="ORA-00933"></a>ORA-00933</h3><h4 id="问题描述-2"><a href="#问题描述-2" class="headerlink" title="问题描述"></a>问题描述</h4><p>union/union all 连接的语句中只能有一个 order by （不包含子查询中的）否则会报 <code>SQL command not properly ended</code>。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> p.productId, p.productTitle, p.price, p.productQty, i.imagesId, i.imagesType, i.imagesPath</span><br><span class="line"><span class="keyword">FROM</span> PRODUCTS p</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> PRODUCTIMAGES <span class="keyword">pi</span> <span class="keyword">ON</span> p.PRODUCTID = pi.PRODUCTID</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> IMAGES i <span class="keyword">ON</span> pi.IMAGESID = i.IMAGESID</span><br><span class="line"><span class="keyword">WHERE</span> p.PRODUCTID = <span class="number">123</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> i.imagesType, i.imagesId </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> p.productId, p.productTitle, p.price, p.productQty, i.imagesId, i.imagesTitle, i.imagesType, i.imagesPath</span><br><span class="line"><span class="keyword">FROM</span> PRODUCTS p</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> PRODUCTIMAGES <span class="keyword">pi</span> <span class="keyword">ON</span> p.PRODUCTID = pi.PRODUCTID</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> IMAGES i <span class="keyword">ON</span> pi.IMAGESID = i.IMAGESID</span><br><span class="line"><span class="keyword">WHERE</span> p.PRODUCTID = <span class="number">456</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> i.imagesType, i.imagesId</span><br></pre></td></tr></table></figure>

<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>将 order by 放在子查询中</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    p.productId, p.productTitle, p.price, p.productQty, i.imagesId, i.imagesType, i.imagesPath</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    PRODUCTS p</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            pi.PRODUCTID, img.IMAGESID, img.TYPE, img.imagesTitle, img.imagesType, img.imagesPath</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            PRODUCTIMAGES <span class="keyword">pi</span></span><br><span class="line">            <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> IMAGES img <span class="keyword">ON</span> pi.IMAGESID = img.IMAGESID</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> img.TYPE, img.IMAGESID</span><br><span class="line">    ) i <span class="keyword">ON</span> p.PRODUCTID = i.PRODUCTID</span><br><span class="line"><span class="keyword">WHERE</span> p.PRODUCTID = <span class="number">123</span> </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    p.productId, p.productTitle, p.price, p.productQty, i.imagesId, i.imagesTitle, i.imagesType, i.imagesPath</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    PRODUCTS p</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            pi.PRODUCTID, img.IMAGESID, img.TYPE, img.imagesTitle, img.imagesType, img.imagesPath</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            PRODUCTIMAGES <span class="keyword">pi</span></span><br><span class="line">            <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> IMAGES img <span class="keyword">ON</span> pi.IMAGESID = img.IMAGESID</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> img.TYPE, img.IMAGESID</span><br><span class="line">    ) i <span class="keyword">ON</span> p.PRODUCTID = i.PRODUCTID</span><br><span class="line"><span class="keyword">WHERE</span> p.PRODUCTID = <span class="number">456</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Regular Expression</title>
    <url>/2020/02/24/Study-Notes-of-Regular-Expression/</url>
    <content><![CDATA[<img data-src="https://blog.malwarebytes.com/wp-content/uploads/2018/08/regex_puzzle-900x506.jpg" width="100%"/>

<a id="more"></a>

<h2 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h2><blockquote>
<p><a href="https://github.com/ziishaned/learn-regex" target="_blank" rel="noopener">learn-regex | GitHub</a></p>
</blockquote>
<h2 id="什么是正则表达式？"><a href="#什么是正则表达式？" class="headerlink" title="什么是正则表达式？"></a>什么是正则表达式？</h2><blockquote>
<span class="label info">正则表达式</span><mark>是</mark>一组由字母和符号组成的<span class="label info">特殊文本</span>，它可以<mark>用来</mark>从文本中找出满足你想要的格式的句子。
</blockquote>
<h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><blockquote>
<p>元字符<mark>不</mark>代表他们本身的字面意思，他们都有特殊的含义。</p>
</blockquote>
<table>
<thead>
<tr>
<th>元字符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>匹配<span class="label info">任意</span><span class="label danger">单个</span>字符<mark>除了</mark>换行符。</td>
</tr>
<tr>
<td>[ ]</td>
<td>字符集。匹配方括号内的任意字符。</td>
</tr>
<tr>
<td>[^ ]</td>
<td>否定的字符种类。匹配<mark>除了</mark>方括号里的任意字符</td>
</tr>
<tr>
<td>*</td>
<td>匹配 <mark>&gt;=0</mark> 个重复的在 <code>*</code> 号之前的字符。</td>
</tr>
<tr>
<td>+</td>
<td>匹配 <mark>&gt;=1</mark> 个重复的 <code>+</code> 号前的字符。</td>
</tr>
<tr>
<td>?</td>
<td>标记 <code>?</code> 之前的字符为<mark>可选</mark>.</td>
</tr>
<tr>
<td>{n,m}</td>
<td>匹配 num 个大括号之间的字符 (n &lt;= num &lt;= m).</td>
</tr>
<tr>
<td>(xyz)</td>
<td>字符集，匹配与 xyz <mark>完全相等</mark>的字符串.</td>
</tr>
<tr>
<td>|</td>
<td>或元字符，匹配符号<span class="label info">前</span><mark>或</mark><span class="label info">后</span>的字符.</td>
</tr>
<tr>
<td>\</td>
<td>转义字符，用于匹配一些<mark>保留字符</mark> `[ ] ( ) { } . * + ? ^ $ \</td>
</tr>
<tr>
<td>^</td>
<td>正则表达式的<mark>开始符号</mark>.</td>
</tr>
<tr>
<td>$</td>
<td>正则表达式的<mark>结束符号</mark>.</td>
</tr>
</tbody></table>
<h3 id="元字符-1"><a href="#元字符-1" class="headerlink" title="元字符 ."></a>元字符 <code>.</code></h3><h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集 []"></a>字符集 <code>[]</code></h3><p>方括号用来指定一个字符集。</p>
<ol>
<li><p>括号中的字符集<mark>不关心顺序</mark>。</p>
<p>表达式<code>[Tt]he</code> 匹配 <code>the</code> 和 <code>The</code></p>
</li>
<li><p>方括号的点号<mark>就</mark>表示点号</p>
<p>表达式 <code>ar[.]</code> 匹配 <code>ar.</code>字符串</p>
</li>
</ol>
<h4 id="否定字符集"><a href="#否定字符集" class="headerlink" title="否定字符集"></a>否定字符集</h4><p>一般来说 <code>^</code> 表示一个字符串的开头，但当它用在方括号里面的开头时，它表示这个字符集是否定的。 例如，表达式 <a href="https://regex101.com/r/nNNlq3/1" target="_blank" rel="noopener"><code>[^c]ar</code></a> 匹配一个后面跟着 <code>ar</code> 的除了 <code>c</code> 的任意字符。</p>
<h3 id="重复次数"><a href="#重复次数" class="headerlink" title="重复次数"></a>重复次数</h3><p>后面跟着元字符 <code>+</code>，<code>*</code> or <code>?</code> 的，用来指定匹配子模式的次数。 这些元字符在不同的情况下有着不同的含义。</p>
<h4 id="元字符-2"><a href="#元字符-2" class="headerlink" title="元字符 *"></a>元字符 <code>*</code></h4><p><code>*</code> 号匹配在 <code>*</code> 之前的字符出现 <mark>&gt;=0</mark> 次。 例如，表达式 <code>a*</code> 匹配 0个或者多个以 a 开头的字符。表达式 <a href="https://regex101.com/r/7m8me5/1" target="_blank" rel="noopener"><code>[a-z]*</code></a> 匹配所有以小写字母开头的字符串。</p>
<p><code>*</code> 元字符和 <code>.</code> 元字符搭配可以匹配所有的字符(<code>.*</code>)。</p>
<p><code>*</code> 和空格元字符 <code>\s</code> 连起来用，如表达式 <a href="https://regex101.com/r/gGrwuz/1" target="_blank" rel="noopener"><code>\s*cat\s*</code></a> 匹配以 0个或多个空格开头，中间是 cat，并且以 0个或多个空格结尾的字符串。</p>
<h4 id="元字符-3"><a href="#元字符-3" class="headerlink" title="元字符 +"></a>元字符 <code>+</code></h4><p><code>+</code> 元字符匹配 <code>+</code> 号之前的字符出现 <mark>&gt;=1</mark> 次。 例如表达式 <a href="https://regex101.com/r/Dzf9Aa/1" target="_blank" rel="noopener"><code>c.+t</code></a> 匹配以字母 <code>c</code> 开头以 <code>t</code> 结尾，中间跟着至少一个字符的字符串。</p>
<h4 id="元字符-4"><a href="#元字符-4" class="headerlink" title="元字符 ?"></a>元字符 <code>?</code></h4><p>元字符 <code>?</code> 表示前面的字符为<mark>可选字符</mark>，即出现 0 次或 1 次。 例如，表达式 <a href="https://regex101.com/r/kPpO2x/1" target="_blank" rel="noopener"><code>[T]?he</code></a> 匹配字符串 <code>he</code> 和 <code>The</code>。</p>
<h3 id="元字符-5"><a href="#元字符-5" class="headerlink" title="元字符 {}"></a>元字符 <code>{}</code></h3><p>在正则表达式中 <code>{}</code> 是一个量词，常用来表示一个或一组字符可以重复出现的次数。 例如，表达式 <a href="https://regex101.com/r/juM86s/1" target="_blank" rel="noopener"><code>[0-9]{2,3}</code></a> 匹配最少 2 位最多 3 位 0~9 的数字。</p>
<p>可以省略第二个参数。 例如，<a href="https://regex101.com/r/Gdy4w5/1" target="_blank" rel="noopener"><code>[0-9]{2,}</code></a> 匹配至少两位 0~9 的数字。</p>
<p>如果逗号也省略掉，则表示重复固定的次数。 例如，<a href="https://regex101.com/r/Sivu30/1" target="_blank" rel="noopener"><code>[0-9]{3}</code></a> 匹配 3 位 0~9 的数字</p>
<h3 id="元字符-6"><a href="#元字符-6" class="headerlink" title="元字符 ()"></a>元字符 <code>()</code></h3><p>元字符 <code>()</code> 表示将括号内的子模式绑定为一个组，将这个组作为一个新的子模式进行匹配。</p>
<p>例如之前说的 <code>{}</code> 是用来表示前面一个字符出现指定次数。但如果在 <code>{}</code> 前用括号将一串字符括起来，则表示整个括号内的字符重复 N 次。例如，表达式 <code>(ab)*</code> 匹配连续出现 0 个或多个 <code>ab</code>。</p>
<p>还可以在 <code>()</code> 中用 <code>|</code> 表示或。例如，<a href="https://regex101.com/r/tUxrBG/1" target="_blank" rel="noopener"><code>(c|g|p)ar</code></a> 匹配 <code>car</code> 或 <code>gar</code> 或 <code>par</code>.</p>
<h3 id="元字符-7"><a href="#元字符-7" class="headerlink" title="元字符 |"></a>元字符 <code>|</code></h3><p>元字符 <code>|</code> 表示或，用作判断条件。</p>
<p>例如 <a href="https://regex101.com/r/fBXyX0/1" target="_blank" rel="noopener"><code>(T|t)he|car</code></a> 匹配 <code>(T|t)he</code> 或 <code>car</code>。</p>
<h3 id="元字符-8"><a href="#元字符-8" class="headerlink" title="元字符 \"></a>元字符 <code>\</code></h3><p>元字符 <code>\</code> 用于转义紧跟其后的字符。用于转义 <code>{ } [ ] / \ + * . $ ^ | ?</code> 这些特殊字符。如果想要匹配这些特殊字符则要在其前面加上反斜线 <code>\</code>。</p>
<p>例如 <code>.</code> 是用来匹配除换行符外的所有单个字符的。如果想要匹配句子中的 <code>.</code> 则要写成 <code>\.</code>。</p>
<p>例如 <a href="https://regex101.com/r/DOc5Nu/1" target="_blank" rel="noopener"><code>(f|c|m)at\.?</code></a> 匹配以 <code>f</code> 或者 <code>c</code> 或者 <code>m</code> 开头，中间是 <code>mt</code>，后面有 0 个或者 1 个 <code>.</code></p>
<h3 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h3><p>正则表达式中，想要匹配指定开头或结尾的字符串就要使用到锚点。<code>^</code> 指定开头，<code>$</code> 指定结尾。</p>
<h3 id="元字符-9"><a href="#元字符-9" class="headerlink" title="元字符 ^"></a>元字符 <code>^</code></h3><p><code>^</code> 用来检查匹配的字符串是否在所匹配字符串的开头。</p>
<p>例如，在 <code>abc</code> 中使用表达式 <code>^a</code> 会得到结果 <code>a</code>。但如果使用 <code>^b</code> 将匹配不到任何结果。因为在字符串 <code>abc</code> 中并没有以 <code>b</code> 开头的字符串。</p>
<p>例如，<a href="https://regex101.com/r/jXrKne/1" target="_blank" rel="noopener"><code>^(T|t)he</code></a> 匹配以 <code>The</code> 或 <code>the</code> 开头的字符串。</p>
<h3 id="元字符-10"><a href="#元字符-10" class="headerlink" title="元字符 $"></a>元字符 <code>$</code></h3><p>与 <code>^</code> 同理，元字符 <code>$</code> 用来检查匹配的字符串是否在所匹配字符串的结尾。</p>
<p>例如，<a href="https://regex101.com/r/t0AkOd/1" target="_blank" rel="noopener"><code>(at\.)$</code></a> 匹配以 <code>at.</code> 结尾的字符串。</p>
<h2 id="简写字符集"><a href="#简写字符集" class="headerlink" title="简写字符集"></a>简写字符集</h2><p>正则表达式提供一些常用的字符集简写。如下:</p>
<table>
<thead>
<tr>
<th>简写</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>除<mark>换</mark>行符外的所有单个字符</td>
</tr>
<tr>
<td>\w</td>
<td>匹配所有<mark>字母数字</mark>，等同于 <code>[a-zA-Z0-9_]</code></td>
</tr>
<tr>
<td>\W</td>
<td>匹配所有<mark>非字母数字</mark>，即符号，等同于： <code>[^\w]</code></td>
</tr>
<tr>
<td>\d</td>
<td>匹配<mark>数字</mark>： <code>[0-9]</code></td>
</tr>
<tr>
<td>\D</td>
<td>匹配<mark>非数字</mark>： <code>[^\d]</code></td>
</tr>
<tr>
<td>\s</td>
<td>匹配所有<mark>空格字符</mark>，等同于： <code>[\t\n\f\r\p{Z}]</code></td>
</tr>
<tr>
<td>\S</td>
<td>匹配所有<mark>非空格字符</mark>： <code>[^\s]</code></td>
</tr>
<tr>
<td>\f</td>
<td>匹配一个<mark>换页符</mark></td>
</tr>
<tr>
<td>\n</td>
<td>匹配一个<mark>换行符</mark></td>
</tr>
<tr>
<td>\r</td>
<td>匹配一个<mark>回车符</mark></td>
</tr>
<tr>
<td>\t</td>
<td>匹配一个<mark>制表符</mark></td>
</tr>
<tr>
<td>\v</td>
<td>匹配一个<mark>垂直制表符</mark></td>
</tr>
<tr>
<td>\p</td>
<td>匹配 CR/LF（等同于 <code>\r\n</code>），用来匹配 DOS 行<mark>终止符</mark></td>
</tr>
</tbody></table>
<h2 id="零宽度断言"><a href="#零宽度断言" class="headerlink" title="零宽度断言"></a>零宽度断言</h2><p>零宽度断言用来指定一个<mark>位置(零宽度)</mark>，这个位置应该满足一定的<mark>条件(断言)</mark>。断言其实就相当于一个布尔值，只能是 0 或者 1。</p>
<p>由零宽度断言的定义可以看出来，它必须和和其他的表达式结合起来使用才具有意义，否则单纯的零宽度断言表达式的匹配结果就是个位置，什么字符都没有！</p>
<p>零宽度断言共四种：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>?=</td>
<td>正先行断言</td>
</tr>
<tr>
<td>?!</td>
<td>负先行断言</td>
</tr>
<tr>
<td>?&lt;=</td>
<td>正后发断言</td>
</tr>
<tr>
<td>?&lt;!</td>
<td>负后发断言</td>
</tr>
</tbody></table>
<p>理解：</p>
<ul>
<li>正/负：指是否满足条件(即断言)，正(负)表示(不)满足。</li>
<li>先行/后发：指的是位置(最终的匹配结果)和条件(即断言)的前后关系，先行(后发)指位置在条件前(后)。</li>
</ul>
<p>另外，零宽度断言都要用括号扩起来。</p>
<h3 id="正先行断言"><a href="#正先行断言" class="headerlink" title="正先行断言 ?="></a>正先行断言 <code>?=</code></h3><p>语法：<code>表达式1(?=表达式2)</code></p>
<p>表示满足表达式1的字符串后面必须跟着满足表达式2的字符串，结果只返回满足匹配表达式1的字符串。</p>
<p>例如，表达式 <a href="https://regex101.com/r/IDDARt/1" target="_blank" rel="noopener"><code>(T|t)he(?=\sfat)</code></a> 匹配 <code>The</code> 或者 <code>the</code>，而且 <code>The</code> 和 <code>the</code> 后面紧跟着 <code>空格fat</code>。</p>
<h3 id="负先行断言"><a href="#负先行断言" class="headerlink" title="负先行断言 ?!"></a>负先行断言 <code>?!</code></h3><p>语法：<code>表达式1(?=表达式2)</code></p>
<p>表示满足表达式1的字符串后面必须<mark>不</mark>能跟着满足表达式2的字符串，结果只返回满足匹配表达式1的字符串。</p>
<p>例如，表达式 <a href="https://regex101.com/r/V32Npg/1" target="_blank" rel="noopener"><code>(T|t)he(?!\sfat)</code></a> 匹配 <code>The</code> 或者 <code>the</code>，而且 <code>The</code> 和 <code>the</code> 后面<mark>不</mark>跟着 <code>空格fat</code>。</p>
<h3 id="正后发断言-lt"><a href="#正后发断言-lt" class="headerlink" title="正后发断言 ?&lt;="></a>正后发断言 <code>?&lt;=</code></h3><p>语法：<code>(?&lt;=表达式1)表达式2</code></p>
<p>表示满足表达式2的字符串<mark>前</mark>面面必须能跟着满足表达式1的字符串，结果只返回满足匹配表达式2的字符串。</p>
<p>例如，表达式 <a href="https://regex101.com/r/avH165/1" target="_blank" rel="noopener"><code>(?&lt;=(T|t)he\s)(fat|mat)</code></a> 匹配 <code>fat</code> 和 <code>mat</code>，且其前面跟着 <code>The空格</code> 或 <code>the空格</code>。</p>
<h3 id="负后发断言-lt"><a href="#负后发断言-lt" class="headerlink" title="负后发断言 ?&lt;!"></a>负后发断言 <code>?&lt;!</code></h3><p>语法：<code>(?&lt;!表达式1)表达式2</code></p>
<p>表示满足表达式2的字符串<mark>前</mark>面面必须<mark>不</mark>能跟着满足表达式1的字符串，结果只返回满足匹配表达式2的字符串。</p>
<p>例如，表达式 <a href="https://regex101.com/r/8Efx5G/1" target="_blank" rel="noopener"><code>(?&lt;!(T|t)he\s)(cat)</code></a> 匹配 <code>cat</code>，且其前<mark>不</mark>跟着 <code>The</code> 或 <code>the</code>。</p>
<h2 id="标志"><a href="#标志" class="headerlink" title="标志"></a>标志</h2><p>标志也叫<span class="label info">模式修正符</span>，因为它可以用来修改表达式的搜索结果。 这些标志可以任意的组合使用，它也是整个正则表达式的一部分。</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>i</td>
<td>忽略大小写。</td>
</tr>
<tr>
<td>g</td>
<td>全局搜索。</td>
</tr>
<tr>
<td>m</td>
<td>多行修饰符：锚点元字符 <code>^</code> <code>$</code> 工作范围在每行的起始。</td>
</tr>
</tbody></table>
<h3 id="忽略大小写（Case-Insensitive）"><a href="#忽略大小写（Case-Insensitive）" class="headerlink" title="忽略大小写（Case Insensitive）"></a>忽略大小写（Case Insensitive）</h3><p>修正符 <code>i</code> 用于忽略大小写。 例如，表达式 <a href="https://regex101.com/r/ahfiuh/1" target="_blank" rel="noopener"><code>/The/gi</code></a> 表示在全局搜索 <code>The</code>，在后面的 <code>i</code> 将其条件修改为忽略大小写，则变成搜索 <code>the</code> 和 <code>The</code>，<code>g</code> 表示全局搜索。</p>
<h3 id="全局搜索（Global-search）"><a href="#全局搜索（Global-search）" class="headerlink" title="全局搜索（Global search）"></a>全局搜索（Global search）</h3><p>修正符 <code>g</code> 常用于执行一个全局搜索匹配，即不仅仅返回第一个匹配的，而是返回全部。 例如，表达式 <a href="https://regex101.com/r/dO1nef/1" target="_blank" rel="noopener"><code>/.(at)/g</code></a> 表示全局搜索 <code>非换行符以外任意单个字符</code> 后面跟着 <code>at</code>。</p>
<h3 id="多行修正符（Multiline）"><a href="#多行修正符（Multiline）" class="headerlink" title="多行修正符（Multiline）"></a>多行修正符（Multiline）</h3><p>多行修正符 <code>m</code> 用于执行一个多行匹配。</p>
<p>之前介绍的 <code>^</code> 和 <code>$</code> 用于检查模式是否是在待检测字符串的开头或结尾。但我们如果想要它在<mark>每</mark>行的开头和结尾生效，我们需要用到多行修正符 <code>m</code>。</p>
<p>例如，表达式 <a href="https://regex101.com/r/E88WE2/1" target="_blank" rel="noopener"><code>/at(.)?$/gm</code></a> 表示小写字符 <code>a</code> 后跟小写字符 <code>t</code> ，末尾再跟上一个除换行符以外的任意字符，再根据 <code>m</code> 修正符，现在表达式匹配每行的结尾。</p>
<h3 id="贪婪匹配与惰性匹配（Greedy-vs-lazy-matching）"><a href="#贪婪匹配与惰性匹配（Greedy-vs-lazy-matching）" class="headerlink" title="贪婪匹配与惰性匹配（Greedy vs lazy matching）"></a>贪婪匹配与惰性匹配（Greedy vs lazy matching）</h3><p>正则表达式默认采用贪婪匹配模式，在该模式下意味着会匹配尽可能长的子串。我们可以使用 <code>?</code> 将贪婪匹配模式转化为惰性匹配模式。</p>
<p>例如 <a href="https://regex101.com/r/AyAdgJ/1" target="_blank" rel="noopener"><code>/(.*at)/</code></a> 表示匹配以 <code>at</code> 结尾，前面有任意多个非换行字符的子字符串中长度最<mark>长</mark>的一个。</p>
<p>而 <a href="https://regex101.com/r/AyAdgJ/2" target="_blank" rel="noopener"><code>/(.*?at)/</code></a> 表示匹配以 <code>at</code> 结尾，前面有任意多个非换行字符的子字符串中长度最短的一个。</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><h3 id="以某个字符串开始字符串，并且以另一个字符串结尾字符串"><a href="#以某个字符串开始字符串，并且以另一个字符串结尾字符串" class="headerlink" title="以某个字符串开始字符串，并且以另一个字符串结尾字符串"></a>以某个字符串开始字符串，并且以另一个字符串结尾字符串</h3><p>例如要搜索以 <code>https://img.alicdn.com</code> 开始，以 <code>jpg_80x80.jpg</code> 结束的子字符串。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:\&#x2F;\&#x2F;img\.alicdn\.com.*jpg_80x80\.jpg</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Study Notes</category>
        <category>Regular Expression</category>
      </categories>
  </entry>
  <entry>
    <title>Study Notes of Shell</title>
    <url>/2020/03/07/Study-Notes-of-Shell/</url>
    <content><![CDATA[<img data-src="https://www.runoob.com/wp-content/uploads/2015/12/post-shell-script.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://www.yinwang.org/blog-cn/2013/03/29/scripting-language" target="_blank" rel="noopener">https://www.yinwang.org/blog-cn/2013/03/29/scripting-language</a></p>
<p><a href="https://www.learnshell.org/" target="_blank" rel="noopener">https://www.learnshell.org/</a></p>
<p><a href="https://www.tutorialspoint.com/unix/shell_scripting.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/unix/shell_scripting.htm</a></p>
<p><a href="http://www.freeos.com/guides/lsst/" target="_blank" rel="noopener">http://www.freeos.com/guides/lsst/</a></p>
<p><a href="https://linuxconfig.org/bash-scripting-tutorial-for-beginners" target="_blank" rel="noopener">https://linuxconfig.org/bash-scripting-tutorial-for-beginners</a></p>
<p><a href="https://bash.cyberciti.biz/guide/Main_Page" target="_blank" rel="noopener">https://bash.cyberciti.biz/guide/Main_Page</a></p>
<p><a href="https://book.douban.com/subject/26854226/" target="_blank" rel="noopener">https://book.douban.com/subject/26854226/</a></p>
<p><a href="https://coding.imooc.com/class/314.html" target="_blank" rel="noopener">https://coding.imooc.com/class/314.html</a></p>
</blockquote>
<h2 id="Shell脚本编程30分钟入门"><a href="#Shell脚本编程30分钟入门" class="headerlink" title="Shell脚本编程30分钟入门"></a>Shell脚本编程30分钟入门</h2><blockquote>
<p><a href="https://github.com/qinjx/30min_guides/blob/master/shell.md" target="_blank" rel="noopener">https://github.com/qinjx/30min_guides/blob/master/shell.md</a></p>
</blockquote>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>shell 编程只需要一个编写代码的<strong>文本编辑器</strong>和一个能解释执行的<strong>脚本解释器</strong>就可以了。</p>
<h4 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h4><p>当前主流的操作系统都支持 shell  编程，本文档所述的shell 编程是指 Linux 下的 shell，讲的基本都是POSIX标准下的功能，所以，也适用于Unix及BSD（如Mac OS）。</p>
<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><p>Linux 默认自带 shell 解释器。</p>
<h5 id="Mac-OS"><a href="#Mac-OS" class="headerlink" title="Mac OS"></a>Mac OS</h5><p>Mac OS不仅带了sh、bash这两个最基础的解释器，还内置了ksh、csh、zsh等不常用的解释器。</p>
<h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><p>windows 出厂时没有内置 shell 解释器，需要自行安装，为了同时能用 grep, awk, curl 等工具，最好装一个 cygwin或者 mingw 来模拟linux环境。</p>
<ul>
<li><a href="http://www.cygwin.com/" target="_blank" rel="noopener">cygwin</a></li>
<li><a href="http://www.mingw.org/" target="_blank" rel="noopener">mingw</a></li>
</ul>
<h4 id="脚本解释器"><a href="#脚本解释器" class="headerlink" title="脚本解释器"></a>脚本解释器</h4><h5 id="sh"><a href="#sh" class="headerlink" title="sh"></a>sh</h5><p>即 Bourne shell，POSIX(Portable Operating System Interface)标准的 shell 解释器，它的二进制文件路径通常是 /bin/sh，由Bell Labs开发。</p>
<h5 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h5><p>Bash 是 Bourne shell 的替代品，属 GNU Project，二进制文件路径通常是 /bin/bash。业界通常混用 bash、sh 和 shell，比如你会经常在招聘运维工程师的文案中见到：熟悉 Linux Bash 编程，精通 Shell 编程。</p>
<p>在CentOS里，/bin/sh是一个指向/bin/bash的符号链接:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@centosraw ~]# ls -l /bin/*sh</span><br><span class="line">-rwxr-xr-x. 1 root root 903272 Feb 22 05:09 /bin/bash</span><br><span class="line">-rwxr-xr-x. 1 root root 106216 Oct 17  2012 /bin/dash</span><br><span class="line">lrwxrwxrwx. 1 root root      4 Mar 22 10:22 /bin/sh -&gt; bash</span><br></pre></td></tr></table></figure>

<p>但在Mac OS上不是，/bin/sh和/bin/bash是两个不同的文件，尽管它们的大小只相差100字节左右:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iMac:~ wuxiao$ ls -l /bin/*sh</span><br><span class="line">-r-xr-xr-x  1 root  wheel  1371648  6 Nov 16:52 /bin/bash</span><br><span class="line">-rwxr-xr-x  2 root  wheel   772992  6 Nov 16:52 /bin/csh</span><br><span class="line">-r-xr-xr-x  1 root  wheel  2180736  6 Nov 16:52 /bin/ksh</span><br><span class="line">-r-xr-xr-x  1 root  wheel  1371712  6 Nov 16:52 /bin/sh</span><br><span class="line">-rwxr-xr-x  2 root  wheel   772992  6 Nov 16:52 /bin/tcsh</span><br><span class="line">-rwxr-xr-x  1 root  wheel  1103984  6 Nov 16:52 /bin/zsh</span><br></pre></td></tr></table></figure>

<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a><del>运行</del></h4><h2 id="归纳总结"><a href="#归纳总结" class="headerlink" title="归纳总结"></a>归纳总结</h2><h3 id="指定脚本解释器"><a href="#指定脚本解释器" class="headerlink" title="指定脚本解释器"></a>指定脚本解释器</h3><p>“#!”是一个约定的标记，它告诉系统这个脚本需要什么解释器来执行。</p>
<h3 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h3><p>运行 Shell 脚本有两种方法。</p>
<h4 id="作为可执行程序"><a href="#作为可执行程序" class="headerlink" title="作为可执行程序"></a>作为可执行程序</h4><ol>
<li><p>赋予可执行权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod +x test.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test.sh</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="作为解释器参数"><a href="#作为解释器参数" class="headerlink" title="作为解释器参数"></a>作为解释器参数</h4><p>这种运行方式是直接运行解释器，其参数就是shell脚本的文件名，如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/bin/sh test.sh</span><br></pre></td></tr></table></figure>

<p>这种方式运行的脚本，不需要在第一行指定解释器信息，写了也没用。</p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>定义变量时，变量名<strong>不</strong>加美元符号 <code>$</code>，如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">your_name="xxx"</span><br></pre></td></tr></table></figure>

<p>注意，变量名和等号之间<strong>不</strong>能有空格，这可能和你熟悉的所有编程语言都不一样。</p>
<h5 id="声明变量类型"><a href="#声明变量类型" class="headerlink" title="声明变量类型"></a>声明变量类型</h5><p>Shell 中的变量是弱类型的，默认是字符串类型，可以使用 <code>declare</code> 命令来声明变量类型。</p>
<p>语法：<code>declare [+/-][选项] 变量名</code></p>
<ul>
<li><code>-</code>：给变量设定类型属性</li>
<li><code>+</code>：取消变量的类型属性</li>
<li><code>-a</code>：将变量声明为数组类型</li>
<li><code>-i</code>：将变量声明为整型(integer)</li>
<li><code>-x</code>：将变量声明为环境变量</li>
<li><code>-r</code>：将变量声明为只读变量</li>
<li><code>-x</code>：显示指定要声明的变量类型</li>
</ul>
<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><p>调用一个定义过的变量，只要在变量名前面加美元符号 <code>$</code> 即可，如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">your_name="xxx"</span><br><span class="line">echo $your_name</span><br><span class="line">echo $&#123;your_name&#125;</span><br></pre></td></tr></table></figure>

<p>变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界，比如下面这种情况：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for skill in Ada Coffe Action Java; do</span><br><span class="line">	echo "I am good at $&#123;skill&#125;Script"</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>如果不给skill变量加花括号，写成 <code>echo &quot;I am good at $skillScript&quot;</code>，解释器就会把​<code>$skillScript</code> 当成一个变量，代码执行结果就不是我们期望的样子了。</p>
<p>推荐给所有变量加上花括号，这是个好的编程习惯。IntelliJ IDEA 编写 shell script 时，会提示加花括号。</p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>以 <code>#</code> 开头的行就是注释，会被解释器忽略。</p>
<h4 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h4><p>sh 里没有多行注释，只能每一行加一个 # 号。</p>
<p>如果在开发过程中，遇到大段的代码需要临时注释起来，过一会儿又取消注释，怎么办呢？每一行加个 # 符号太费力了，可以把这一段要注释的代码用一对花括号括起来，定义成一个函数，没有地方调用这个函数，这块代码就不会执行，达到了和注释一样的效果。</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>字符串是 shell 编程中最常用的数据类型，字符串可以用单引号，也可以用双引号，也可以不用引号。单双引号的区别跟 PHP 类似。</p>
<h4 id="单引号"><a href="#单引号" class="headerlink" title="单引号"></a>单引号</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">str='this is a string'</span><br></pre></td></tr></table></figure>

<p>单引号字符串的限制：</p>
<ul>
<li>单引号里的<strong>任何</strong>字符都会原样输出，单引号字符串中的变量是<strong>无效</strong>的</li>
<li>单引号字串中不能出现单引号（对单引号使用转义符后<strong>也</strong>不行）</li>
</ul>
<h4 id="双引号"><a href="#双引号" class="headerlink" title="双引号"></a>双引号</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">your_name='xxx'</span><br><span class="line">str="Hello, I know your are \"$your_name\"! \n"</span><br></pre></td></tr></table></figure>

<ul>
<li>双引号里可以有变量</li>
<li>双引号里可以出现转义字符</li>
</ul>
<h4 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h4><h5 id="拼接字符串"><a href="#拼接字符串" class="headerlink" title="拼接字符串"></a>拼接字符串</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">your_name="xxx"</span><br><span class="line">greeting="hello, "$your_name" !"</span><br><span class="line">greeting_1="hello, $&#123;your_name&#125; !"</span><br><span class="line"></span><br><span class="line">echo $greeting $greeting_1</span><br></pre></td></tr></table></figure>

<h5 id="获取字符串长度"><a href="#获取字符串长度" class="headerlink" title="获取字符串长度"></a>获取字符串长度</h5><p>语法：<code><span>${</span><span>#string}</span></code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">string="abcd"</span><br><span class="line">echo $&#123;#string&#125; #输出：4</span><br></pre></td></tr></table></figure>

<h5 id="提取子字符串"><a href="#提取子字符串" class="headerlink" title="提取子字符串"></a>提取子字符串</h5><p>语法：</p>
<ol>
<li><code>${string:position}</code>：在 <code>$string</code> 中, 从位置 <code>$position</code> 开始提取子串</li>
<li><code>${string:position:length}</code>：在 <code>$string</code> 中, 从位置<code>$position</code> 开始提取长度为 <code>$length</code> 的子串</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">string="alibaba is a great company"</span><br><span class="line">echo $&#123;string:1:4&#125; #输出：liba</span><br></pre></td></tr></table></figure>

<h5 id="查找字符索引"><a href="#查找字符索引" class="headerlink" title="查找字符索引"></a>查找字符索引</h5><p>语法：<code>expr index &quot;$string&quot; c</code></p>
<ol>
<li>查找结果的是第一个符合条件的字符所在的位置</li>
<li>这里的索引并不是从0开始，而是从1开始算起，如果返回0，则表示查找失败</li>
<li>当 <code>c</code> 是一个字符串时，结果是遍历 <code>$string</code> 的每个字符，当该字符在 <code>c</code> 中时，返回其位置。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">string="alibaba is a great company"</span><br><span class="line">echo `expr index "$string" i`</span><br><span class="line"><span class="meta">#</span><span class="bash">输出：3，这个语句的意思是：找出字母 i 在这句话中的位置，要在linux下运行，mac下会报错</span></span><br><span class="line"></span><br><span class="line">echo `expr index "$string" si`</span><br><span class="line"><span class="meta">#</span><span class="bash">输出：3，因为在 <span class="variable">$string</span> 中先出现 si 中的 i，其位置是3</span></span><br></pre></td></tr></table></figure>

<h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><p>shell 的流程控制内不可为空语句，如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (...) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="comment">//do nothing</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 sh/bash 里可不能这么写，如果else分支没有语句执行，就不要写这个else。</p>
<h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><h5 id="if"><a href="#if" class="headerlink" title="if"></a>if</h5><h6 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if condition</span><br><span class="line">then</span><br><span class="line">	command1 </span><br><span class="line">	command2</span><br><span class="line">	...</span><br><span class="line">	commandN </span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>写成一行（适用于终端命令提示符）：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if `ps -ef | grep ssh`;  then echo hello; fi</span><br></pre></td></tr></table></figure>

<h5 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h5><h6 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if condition</span><br><span class="line">then</span><br><span class="line">	command1 </span><br><span class="line">	command2</span><br><span class="line">	...</span><br><span class="line">	commandN</span><br><span class="line">else</span><br><span class="line">	command</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h5 id="if-else-if-else"><a href="#if-else-if-else" class="headerlink" title="if else-if else"></a>if else-if else</h5><h6 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if condition1</span><br><span class="line">then</span><br><span class="line">	command1</span><br><span class="line">elif condition2</span><br><span class="line">	command2</span><br><span class="line">else</span><br><span class="line">	commandN</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h5 id="case"><a href="#case" class="headerlink" title="case"></a>case</h5><h6 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">case "$&#123;opt&#125;" in</span><br><span class="line">	"Install-Puppet-Server" )</span><br><span class="line">		install_master $1</span><br><span class="line">		exit</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	"Install-Puppet-Client" )</span><br><span class="line">		install_client $1</span><br><span class="line">		exit</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	"Config-Puppet-Server" )</span><br><span class="line">		config_puppet_master</span><br><span class="line">		exit</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	"Config-Puppet-Client" )</span><br><span class="line">		config_puppet_client</span><br><span class="line">		exit</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	"Exit" )</span><br><span class="line">		exit</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	* ) echo "Bad option, please choose again"</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>每个 case 分支后面要跟一个右圆括号，用两个分号表示 break。</p>
<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><h5 id="for"><a href="#for" class="headerlink" title="for"></a>for</h5><h6 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for var in item1 item2 ... itemN</span><br><span class="line">do</span><br><span class="line">	command1</span><br><span class="line">	command2</span><br><span class="line">	...</span><br><span class="line">	commandN</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>写成一行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for var in item1 item2 ... itemN; do command1; command2… done;</span><br></pre></td></tr></table></figure>

<h6 id="C-风格的-for-循环"><a href="#C-风格的-for-循环" class="headerlink" title="C 风格的 for 循环"></a>C 风格的 for 循环</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for (( EXP1; EXP2; EXP3 ))</span><br><span class="line">do</span><br><span class="line">	command1</span><br><span class="line">	command2</span><br><span class="line">	command3</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h5 id="while"><a href="#while" class="headerlink" title="while"></a>while</h5><h6 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">while condition</span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h6 id="死循环"><a href="#死循环" class="headerlink" title="死循环"></a>死循环</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">while :</span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 或者 ###</span></span></span><br><span class="line"></span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 或者 ###</span></span></span><br><span class="line"></span><br><span class="line">for (( ; ; ))</span><br></pre></td></tr></table></figure>

<h5 id="until"><a href="#until" class="headerlink" title="until"></a>until</h5><h6 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">until condition</span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Study Notes</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Spring Boot</title>
    <url>/2018/05/31/Study-Notes-of-Spring-Boot/</url>
    <content><![CDATA[<img data-src="https://pic3.zhimg.com/v2-8315cb308b890c7087edfc088043f572_720w.jpg?source=172ae18b" width="100%"/>

<a id="more"></a>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h3><blockquote>
<p><a href="https://blog.csdn.net/qq_42564846/article/details/84566822" target="_blank" rel="noopener">史上最全面的Spring Boot配置文件详解</a></p>
</blockquote>
<p>配置文件中的字符串尽量不要有下划线。配置中 key 不能带下划线，value 可以。</p>
<h3 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h3><blockquote>
<p><a href="https://yulaiz.com/spring-boot-maven-profiles/" target="_blank" rel="noopener">Spring-Boot application.yml 文件拆分，实现 maven 多环境动态启用 Profiles</a></p>
<p><a href="https://blog.csdn.net/qq_42564846/article/details/84566822#t12" target="_blank" rel="noopener">多配置文件</a></p>
</blockquote>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="CrossOrigin"><a href="#CrossOrigin" class="headerlink" title="@CrossOrigin"></a>@CrossOrigin</h3><blockquote>
<p><a href="http://www.spring4all.com/article/177" target="_blank" rel="noopener">SpringBoot 实现前后端分离的跨域访问（CORS）</a></p>
</blockquote>
<p><strong>什么是跨域HTTP请求</strong></p>
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/28562290" target="_blank" rel="noopener">跨域的那些事儿</a></p>
</blockquote>
<p>浏览器的同源策略会导致跨域，这里同源策略又分为以下两种</p>
<ol>
<li>DOM 同源策略：禁止对不同源页面 DOM 进行操作。这里主要场景是 iframe 跨域的情况，不同域名的 iframe 是限制互相访问的。</li>
<li>XmlHttpRequest 同源策略：禁止使用 XHR 对象向不同源的服务器地址发起 HTTP 请求。</li>
</ol>
<p>只要协议、域名、端口有任何一个不同，都被当作是不同的域，之间的请求就是跨域操作。</p>
<h2 id="数据源"><a href="#数据源" class="headerlink" title="数据源"></a>数据源</h2><h3 id="SpringBoot-中-JPA-的使用"><a href="#SpringBoot-中-JPA-的使用" class="headerlink" title="SpringBoot 中 JPA 的使用"></a><a href="">SpringBoot 中 JPA 的使用</a></h3><h2 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h2><ol>
<li><p>@EnableCaching</p>
<p>启动类上加该注解</p>
</li>
<li><p>查询方法上添加注解<code>@Cacheable(value = &quot;cacheName&quot;, key=&quot;#id&quot;)</code>，缓存本质是一个 map。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(value = <span class="string">"cacheName"</span>, key=<span class="string">"#id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getXXX</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新和删除方法上添加注解<code>@CacheEvict(value = “cacheName”, key = “#id”)</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CacheEvict</span>(value = <span class="string">"cacheName"</span>, key=<span class="string">"#id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteXXX</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong>使用原则</strong>：需要过期时间使用 redis，不需要过期时间使用 spring cache</p>
<h2 id="Spring-Boot项目中设置Content-Type的方法"><a href="#Spring-Boot项目中设置Content-Type的方法" class="headerlink" title="Spring Boot项目中设置Content-Type的方法"></a>Spring Boot项目中设置Content-Type的方法</h2><p><strong>一种比较简单优雅的方法是在注解@RequestMapping中添加produces参数即可</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/collection"</span>, produces=<span class="string">"application/json;charset=UTF-8"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">(String op)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="面试"><a href="#面试" class="headerlink" title="面试"></a>面试</h2><h3 id="Spring-Boot-的启动流程"><a href="#Spring-Boot-的启动流程" class="headerlink" title="Spring Boot 的启动流程"></a>Spring Boot 的启动流程</h3><ol>
<li><p>创建 <code>SpringApplication</code> 实例</p>
<ul>
<li><p>推断应用类型（SERVLET/REACTIVE/NONE）</p>
<p>classpath 路径下如果存在 <code>javax.servlet.Servlet</code> 和 <code>org.springframework.web.context.ConfigurableWebApplicationContext</code> 这两个类，那么就认为是 SERVLET 类型。</p>
</li>
<li><p>加载<strong>应用上下文初始化器</strong>(ApplicationContextInitializer)</p>
<p>使用<strong>Spring工厂加载器</strong>(SpringFactoriesLoader) 加载 classpath 下所有的 ApplicationContextInitializer。</p>
</li>
<li><p>加载<strong>应用监听器</strong>(ApplicationListener)</p>
<p>使用<strong>Spring工厂加载器</strong>(SpringFactoriesLoader) 加载 classpath 下所有的 ApplicationListener。</p>
</li>
<li><p>推断 main 方法所在类</p>
<p>从方法调用栈中找出 main 方法所在类。</p>
</li>
</ul>
</li>
<li><p>调用 <code>SpringApplication</code> 实例的 <code>run()</code> 方法</p>
<ul>
<li><p>通过<strong>应用事件广播器</strong>(ApplicationEventMulticaster)广播 starting 事件</p>
</li>
<li><p>创建并配置 Environment。</p>
<p>比如 PropertySource（属性文件源）、profile</p>
</li>
</ul>
</li>
</ol>
<h3 id="Spring-Boot-自动配置原理"><a href="#Spring-Boot-自动配置原理" class="headerlink" title="Spring Boot 自动配置原理"></a>Spring Boot 自动配置原理</h3><blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/136469945" target="_blank" rel="noopener">SpringBoot自动配置的原理详解</a></p>
<p><a href="https://blog.csdn.net/u014745069/article/details/83820511" target="_blank" rel="noopener">Spring Boot面试杀手锏————自动配置原理</a></p>
</blockquote>
<p>Spring Boot 项目的启动类上有一个注解，叫 <code>@SpringBootApplication</code>，这个注解是一个组合注解，主要有 <code>@SpringBootConfiguration</code>、<code>@EnableAutoConfiguration</code>、<br><code>@ComponentScan</code> 这三个注解组成。</p>
<p>其中 <code>@EnableAutoConfiguration</code> 注解启动了 Spring Boot 的自动配置功能，这个注解也是一个派生注解，它通过 <code>@Import</code> 注解将 spring-boot-autoconfigure 模块 <code>META-INF</code> 目录下的 spring.factories 文件中 key 为 EnableAutoConfiguration 的自动配置类全部加载进来。</p>
<blockquote>
<p>Spring Boot 的自动配置本质上就是 Spring 中 JavaConfig 方式的容器配置类</p>
</blockquote>
<p>这些自动配置类会根据其上的 <code>@Condition</code> 相关注解在一定条件下被注入到容器中。</p>
<p>自动配置类是通过 <code>@EnableCongfigurationProperties</code> 与相关的配置属性类相关联，而这些配置属性类则是通过 <code>@ConfigurationProperties</code> 注解指定前缀，进而与 Spring Boot 全局配置文件中的配置相关联的。</p>
<h3 id="Resource-和-Autowired-区别"><a href="#Resource-和-Autowired-区别" class="headerlink" title="@Resource 和 @Autowired 区别"></a>@Resource 和 @Autowired 区别</h3><ol>
<li>@Autowired 是 spring 提供的注解，@Resource 是 JDK1.6 后支持的注解</li>
<li>@Autowired 按类型注入(和 @Qualifier 搭配使用指示名称)，@Resource 按名称注入</li>
</ol>
<h3 id="Spring-如何解决循环依赖问题？"><a href="#Spring-如何解决循环依赖问题？" class="headerlink" title="Spring 如何解决循环依赖问题？"></a>Spring 如何解决循环依赖问题？</h3><p>Spring 中通过构造器注入时如果存在循环依赖则会报错，如果通过 Set 方法注入则不会报错。</p>
<p>三种解决方式：</p>
<ol>
<li><p>@Lazy</p>
<p>在其中一个依赖注入的地方添加 @Lazy 注解即可</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceA</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="meta">@Lazy</span></span><br><span class="line">  <span class="keyword">private</span> ServiceB serviceB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>setter 注入</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceA</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ServiceB serviceB;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServiceB</span><span class="params">(ServiceB serviceB)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.serviceB = serviceB;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 的 setter 注入方式是通过<strong>三级缓存</strong>来解决循环引用问题的。</p>
</li>
<li><p>@PostConstruct</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceA</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ServiceB serviceB;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.serviceB.setServiceA(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Order-VS-DependsOn"><a href="#Order-VS-DependsOn" class="headerlink" title="@Order VS @DependsOn"></a>@Order VS @DependsOn</h3><p>@Order 注解并<a href="https://cloud.tencent.com/developer/article/1531861" target="_blank" rel="noopener">不能</a>指定 bean 的加载顺序，它适用于 AOP 的优先级，以及将多个 Bean 注入到集合时，这些 bean 在集合中的顺序。</p>
<p>@DependsOn 注解可以控制 bean 的实例化顺序(但是<a href="https://cloud.tencent.com/developer/article/1531864" target="_blank" rel="noopener">不保证</a>初始化顺序)。实例化就是创建实例，为其分配内存空间，而初始化是在实例化之后为其属性赋初始值。</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Spring Security</title>
    <url>/2019/12/05/Study-Notes-of-Spring-Security/</url>
    <content><![CDATA[<img data-src="https://miro.medium.com/max/2560/1*bQV578ujCEPGvy9ZVemdUg.jpeg" width="100%"/>

<a id="more"></a>

<blockquote>
<p>版本说明：</p>
<p>Spring Boot：2.2.1.RELEASE</p>
<p>Spring Security：</p>
</blockquote>
<h2 id="Spring-Security-简介"><a href="#Spring-Security-简介" class="headerlink" title="Spring Security 简介"></a>Spring Security 简介</h2><blockquote>
<p><a href="https://www.springcloud.cc/spring-security.html" target="_blank" rel="noopener">Spring Security参考 | Spring Cloud 中文网</a></p>
</blockquote>
<h2 id="初级使用：默认用户认证"><a href="#初级使用：默认用户认证" class="headerlink" title="初级使用：默认用户认证"></a>初级使用：默认用户认证</h2><ol>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>只要加入依赖，项目中所有接口都会被自动保护起来。默认用户名为：user，密码在项目启动后自动生成。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Using generated security password: 6c920ced-f1c1-4604-96f7-f0ce4e46f5d4</span><br></pre></td></tr></table></figure>

<p>也可以通过配置文件<code>application.properties</code>指定用户名密码</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.security.user.username</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">spring.security.user.username</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问接口，将重定向到默认登陆页面，登陆成功之后，就会自动跳转到原来都接口。</p>
<p><img data-src="http://www.javaboy.org/images/boot/25-2.png" alt=""></p>
<p>另外：也可以使用 postman 来发送登陆请求（需要将登陆信息放在请求头中，避免重定向到登陆页面）</p>
<p><img data-src="http://www.javaboy.org/images/boot/25-3.png" alt=""></p>
<p>通过以上两种不同的登录方式，可以看出，Spring Security 支持 form 表单和 HttpBasic 两种不同的认证方式，对应到源码是<code>.formLogin()</code>和<code>.httpBasic()</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfigurerAdapter</span> <span class="keyword">implements</span> <span class="title">WebSecurityConfigurer</span>&lt;<span class="title">WebSecurity</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.logger.debug(<span class="string">"Using default configure(HttpSecurity). If subclassed this will potentially override subclass configure(HttpSecurity)."</span>);</span><br><span class="line">        ((HttpSecurity) ((HttpSecurity) ((AuthorizedUrl) http.authorizeRequests()</span><br><span class="line">                .anyRequest())</span><br><span class="line">                .authenticated()</span><br><span class="line">                .and())</span><br><span class="line">                .formLogin()</span><br><span class="line">                .and())</span><br><span class="line">                .httpBasic();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="中级使用：内存用户认证"><a href="#中级使用：内存用户认证" class="headerlink" title="中级使用：内存用户认证"></a>中级使用：内存用户认证</h2><p>创建 Security 配置类</p>
<figure class="highlight java"><figcaption><span>SecurityConfig</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        PasswordEncoder encoder = PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">        <span class="comment">// 在内存中认证</span></span><br><span class="line">        auth.inMemoryAuthentication()</span><br><span class="line">                .withUser(<span class="string">"admin"</span>).password(encoder.encode(<span class="string">"admin"</span>)).roles(<span class="string">"admin"</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">"user"</span>).password(encoder.encode(<span class="string">"user"</span>)).roles(<span class="string">"user"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="高级使用：数据库用户认证"><a href="#高级使用：数据库用户认证" class="headerlink" title="高级使用：数据库用户认证"></a>高级使用：数据库用户认证</h2><p>实现 UserDetailsService 接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        User user = userService.selectUserByUsername(username);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"Username not exist!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"user"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> org.springframework.security.core.userdetails.User(username, user.getPassword(), authorities);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>SecurityConfig.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailService userDetailService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.userDetailsService(userDetailService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="前后端分离后的认证"><a href="#前后端分离后的认证" class="headerlink" title="前后端分离后的认证"></a>前后端分离后的认证</h2><blockquote>
<p><a href="https://aijishu.com/a/1060000000015544" target="_blank" rel="noopener">SpringBootSecurity学习（12）前后端分离版之简单登录</a></p>
</blockquote>
<p>前后端分离后，后端不再需要提供登陆页面，只需要配置登陆地址即可。</p>
<h3 id="开启授权认证"><a href="#开启授权认证" class="headerlink" title="开启授权认证"></a>开启授权认证</h3><figure class="highlight java"><figcaption><span>SecurityConfigurerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 开启授权认证</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        http.authorizeRequests().anyRequest().authenticated();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置处理登陆请求的-API-地址"><a href="#配置处理登陆请求的-API-地址" class="headerlink" title="配置处理登陆请求的 API 地址"></a>配置处理登陆请求的 API 地址</h3><figure class="highlight java"><figcaption><span>SecurityConfigurerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 处理登陆请求的接口：/user/login</span></span><br><span class="line"><span class="comment">         * 登陆接口用户名参数名：username</span></span><br><span class="line"><span class="comment">         * 登陆接口密码参数名：password</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        http.formLogin().loginProcessingUrl(<span class="string">"/user/login"</span>).usernameParameter(<span class="string">"username"</span>).passwordParameter(<span class="string">"password"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置登陆成功处理器"><a href="#配置登陆成功处理器" class="headerlink" title="配置登陆成功处理器"></a>配置登陆成功处理器</h3><figure class="highlight java"><figcaption><span>SecurityConfigurerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 登陆成功处理器：登陆成功后直接返回 JSON 数据</span></span><br><span class="line"><span class="comment">         * 默认的成功处理器（SimpleUrlAuthenticationSuccessHandler）是进行页面跳转。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        http.formLogin().successHandler(<span class="keyword">new</span> AuthenticationSuccessHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                httpServletResponse.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">                httpServletResponse.getWriter().write(<span class="string">"&#123;\"code\": \"200\", \"msg\": \"登录成功\"&#125;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>默认登陆成功处理器源码截取</strong></p>
<figure class="highlight java"><figcaption><span>SimpleUrlAuthenticationSuccessHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleUrlAuthenticationSuccessHandler</span> <span class="keyword">extends</span> <span class="title">AbstractAuthenticationTargetUrlRequestHandler</span> <span class="keyword">implements</span> <span class="title">AuthenticationSuccessHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleUrlAuthenticationSuccessHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleUrlAuthenticationSuccessHandler</span><span class="params">(String defaultTargetUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setDefaultTargetUrl(defaultTargetUrl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handle(request, response, authentication);</span><br><span class="line">        <span class="keyword">this</span>.clearAuthenticationAttributes(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">clearAuthenticationAttributes</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        HttpSession session = request.getSession(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">            session.removeAttribute(<span class="string">"SPRING_SECURITY_LAST_EXCEPTION"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>AbstractAuthenticationTargetUrlRequestHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractAuthenticationTargetUrlRequestHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        String targetUrl = <span class="keyword">this</span>.determineTargetUrl(request, response, authentication);</span><br><span class="line">        <span class="keyword">if</span> (response.isCommitted()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.logger.debug(<span class="string">"Response has already been committed. Unable to redirect to "</span> + targetUrl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.redirectStrategy.sendRedirect(request, response, targetUrl);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置登陆失败处理器"><a href="#配置登陆失败处理器" class="headerlink" title="配置登陆失败处理器"></a>配置登陆失败处理器</h3><figure class="highlight java"><figcaption><span>SecurityConfigurerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 登陆失败处理器</span></span><br><span class="line"><span class="comment">         * 默认处理器（SimpleUrlAuthenticationFailureHandler）将重定向到登陆页面</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        http.formLogin().failureHandler(<span class="keyword">new</span> AuthenticationFailureHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                httpServletResponse.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">                httpServletResponse.getWriter().write(<span class="string">"&#123;\"code\": \"500\", \"msg\": \"登录失败\"&#125;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>默认登陆失败处理器源码截取</strong></p>
<figure class="highlight java"><figcaption><span>SimpleUrlAuthenticationFailureHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleUrlAuthenticationFailureHandler</span> <span class="keyword">implements</span> <span class="title">AuthenticationFailureHandler</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.defaultFailureUrl == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.logger.debug(<span class="string">"No failure URL set, sending 401 Unauthorized error"</span>);</span><br><span class="line">            response.sendError(HttpStatus.UNAUTHORIZED.value(), HttpStatus.UNAUTHORIZED.getReasonPhrase());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.saveException(request, exception);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.forwardToDestination) &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(<span class="string">"Forwarding to "</span> + <span class="keyword">this</span>.defaultFailureUrl);</span><br><span class="line">                request.getRequestDispatcher(<span class="keyword">this</span>.defaultFailureUrl).forward(request, response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(<span class="string">"Redirecting to "</span> + <span class="keyword">this</span>.defaultFailureUrl);</span><br><span class="line">                <span class="keyword">this</span>.redirectStrategy.sendRedirect(request, response, <span class="keyword">this</span>.defaultFailureUrl);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/12/10/mDavjnKlXk5CQO8.png" alt=""></p>
<h3 id="配置认证异常处理器"><a href="#配置认证异常处理器" class="headerlink" title="配置认证异常处理器"></a>配置认证异常处理器</h3><figure class="highlight java"><figcaption><span>SecurityConfigurerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 认证异常（未登陆/登陆过期等）处理器</span></span><br><span class="line"><span class="comment">         * 默认处理器（LoginUrlAuthenticationEntryPoint）将重定向到登陆页面</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        http.exceptionHandling().authenticationEntryPoint(<span class="keyword">new</span> AuthenticationEntryPoint() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commence</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                httpServletResponse.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">                httpServletResponse.getWriter().write(<span class="string">"&#123;\"code\": \"401\", \"msg\": \"登陆已过期或未登陆\"&#125;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>默认认证异常处理器源码截取</strong></p>
<figure class="highlight java"><figcaption><span>LoginUrlAuthenticationEntryPoint.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginUrlAuthenticationEntryPoint</span> <span class="keyword">implements</span> <span class="title">AuthenticationEntryPoint</span>, <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        String redirectUrl = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.useForward) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.forceHttps &amp;&amp; <span class="string">"http"</span>.equals(request.getScheme())) &#123;</span><br><span class="line">                redirectUrl = <span class="keyword">this</span>.buildHttpsRedirectUrlForRequest(request);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (redirectUrl == <span class="keyword">null</span>) &#123;</span><br><span class="line">                String loginForm = <span class="keyword">this</span>.determineUrlToUseForThisRequest(request, response, authException);</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">"Server side forward to: "</span> + loginForm);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                RequestDispatcher dispatcher = request.getRequestDispatcher(loginForm);</span><br><span class="line">                dispatcher.forward(request, response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            redirectUrl = <span class="keyword">this</span>.buildRedirectUrlToLoginPage(request, response, authException);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.redirectStrategy.sendRedirect(request, response, redirectUrl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/12/10/unCSeMidlUhOj8s.png" alt=""></p>
<h3 id="配置权限异常处理器"><a href="#配置权限异常处理器" class="headerlink" title="配置权限异常处理器"></a>配置权限异常处理器</h3><figure class="highlight java"><figcaption><span>SecurityConfigurerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 开启方法级别的权限注解</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(securedEnabled = <span class="keyword">true</span>, prePostEnabled = <span class="keyword">true</span>, jsr250Enabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 权限异常处理器</span></span><br><span class="line"><span class="comment">         * 默认处理器（AccessDeniedHandlerImpl）将返回状态码为 403 的响应</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        http.exceptionHandling().accessDeniedHandler(<span class="keyword">new</span> AccessDeniedHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                httpServletResponse.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">                httpServletResponse.getWriter().write(<span class="string">"&#123;\"code\": \"402\", \"msg\": \"权限不足\"&#125;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口方法上使用注解<code>@PreAuthorize</code>配置权限</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.profiles.active&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String environment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"env"</span>)</span><br><span class="line">    <span class="meta">@PreAuthorize</span>(<span class="string">"hasRole('user')"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"The Environment is "</span> + environment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：如果配置了全局异常处理器，权限异常处理器就会失效，权限异常会先被全局异常处理器处理而到不了权限异常处理器。解决办法参考<a href="https://libo9527.github.io/2019/12/10/AccessDeniedHandler-of-Spring-Security-not-Working-While-GlobalExceptionHandler-existing/" target="_blank" rel="noopener">这里</a></p>
<p><strong>默认权限异常处理器源码截取</strong></p>
<figure class="highlight java"><figcaption><span>AccessDeniedHandlerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessDeniedHandlerImpl</span> <span class="keyword">implements</span> <span class="title">AccessDeniedHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!response.isCommitted()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.errorPage != <span class="keyword">null</span>) &#123;</span><br><span class="line">                request.setAttribute(<span class="string">"SPRING_SECURITY_403_EXCEPTION"</span>, accessDeniedException);</span><br><span class="line">                response.setStatus(HttpStatus.FORBIDDEN.value());</span><br><span class="line">                RequestDispatcher dispatcher = request.getRequestDispatcher(<span class="keyword">this</span>.errorPage);</span><br><span class="line">                dispatcher.forward(request, response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                response.sendError(HttpStatus.FORBIDDEN.value(), HttpStatus.FORBIDDEN.getReasonPhrase());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/12/10/4eroj3GJS51gMP8.png" alt=""></p>
<h2 id="整合-JWT"><a href="#整合-JWT" class="headerlink" title="整合 JWT"></a>整合 JWT</h2><blockquote>
<p><a href="https://aijishu.com/a/1060000000015716" target="_blank" rel="noopener">SpringBootSecurity学习（13）前后端分离版之JWT</a></p>
<p><a href="https://github.com/jwtk/jjwt#table-of-contents" target="_blank" rel="noopener">jjwt | GitHub</a></p>
</blockquote>
<p>使用 session 和 cookie 来维护登录状态的扩展性不好，使用 JWT 的 token 验证方式则可以很好的适应分布式场景的需求。</p>
<h3 id="导入-jjwt-包"><a href="#导入-jjwt-包" class="headerlink" title="导入 jjwt 包"></a>导入 jjwt 包</h3><figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Uncomment this next dependency if you want to use RSASSA-PSS (PS256, PS384, PS512) algorithms:</span></span><br><span class="line"><span class="comment">&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">    &lt;artifactId&gt;bcprov-jdk15on&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">    &lt;version&gt;1.60&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;scope&gt;runtime&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">&lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="关闭-Session"><a href="#关闭-Session" class="headerlink" title="关闭 Session"></a>关闭 Session</h3><figure class="highlight java"><figcaption><span>SecurityConfigurerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(securedEnabled = <span class="keyword">true</span>, prePostEnabled = <span class="keyword">true</span>, jsr250Enabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>源码截取</strong></p>
<figure class="highlight java"><figcaption><span>SessionCreationPolicy.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SessionCreationPolicy &#123;</span><br><span class="line">	<span class="comment">/** Always create an &#123;<span class="doctag">@link</span> HttpSession&#125; */</span></span><br><span class="line">	ALWAYS,</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Spring Security will never create an &#123;<span class="doctag">@link</span> HttpSession&#125;, but will use the</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> HttpSession&#125; if it already exists</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	NEVER,</span><br><span class="line">	<span class="comment">/** Spring Security will only create an &#123;<span class="doctag">@link</span> HttpSession&#125; if required */</span></span><br><span class="line">	IF_REQUIRED,</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Spring Security will never create an &#123;<span class="doctag">@link</span> HttpSession&#125; and it will never use it</span></span><br><span class="line"><span class="comment">	 * to obtain the &#123;<span class="doctag">@link</span> SecurityContext&#125;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	STATELESS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JWT-工具类"><a href="#JWT-工具类" class="headerlink" title="JWT 工具类"></a>JWT 工具类</h3><figure class="highlight java"><figcaption><span>JWTUtil.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JWTUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Key KEY = Keys.secretKeyFor(SignatureAlgorithm.HS256);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HEADER_TOKEN_NAME = <span class="string">"Authentication-Token"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">genericToken</span><span class="params">(SysUser user)</span> </span>&#123;</span><br><span class="line">        user.setPassword(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setIssuer(<span class="string">"gzhennaxia"</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())</span><br><span class="line">                .claim(<span class="string">"user"</span>, JSON.toJSONString(user))</span><br><span class="line">                .signWith(KEY)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SysUser <span class="title">parseToken2User</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        Jws&lt;Claims&gt; jws = Jwts.parser()</span><br><span class="line">                .requireIssuer(<span class="string">"gzhennaxia"</span>)</span><br><span class="line">                .setSigningKey(KEY)</span><br><span class="line">                .parseClaimsJws(token);</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(jws.getBody().get(<span class="string">"user"</span>).toString(), SysUser<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改登录成功处理器"><a href="#修改登录成功处理器" class="headerlink" title="修改登录成功处理器"></a>修改登录成功处理器</h3><figure class="highlight java"><figcaption><span>AuthenticationSuccessHandlerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationSuccessHandlerImpl</span> <span class="keyword">implements</span> <span class="title">AuthenticationSuccessHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        User user = (User) authentication.getPrincipal();</span><br><span class="line">        httpServletResponse.setHeader(JWTUtil.HEADER_TOKEN_NAME, JWTUtil.genericToken(SysUser.builder().username(user.getUsername()).build()));</span><br><span class="line">        httpServletResponse.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">        httpServletResponse.getWriter().write(ReturnVo.errorInJson(CodeEnum.SUCCESS));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置-JWT-过滤器"><a href="#配置-JWT-过滤器" class="headerlink" title="配置 JWT 过滤器"></a>配置 JWT 过滤器</h3><figure class="highlight java"><figcaption><span>JWTAuthenticationFilter.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JWTAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title">GenericFilterBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        String token = request.getHeader(JWTUtil.HEADER_TOKEN_NAME);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                SysUser sysUser = JWTUtil.parseToken2User(token);</span><br><span class="line">                SecurityContextHolder.getContext().setAuthentication(<span class="keyword">new</span> UsernamePasswordAuthenticationToken(sysUser, <span class="keyword">null</span>, sysUser.getAuthorities()));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                servletResponse.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">                <span class="keyword">if</span> (e <span class="keyword">instanceof</span> MissingClaimException) &#123;</span><br><span class="line">                    servletResponse.getWriter().write(ReturnVo.errorInJson(CodeEnum.MISSING_CLAIM));</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> IncorrectClaimException) &#123;</span><br><span class="line">                    servletResponse.getWriter().write(ReturnVo.errorInJson(CodeEnum.INCORRECT_CLAIM));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    servletResponse.getWriter().write(ReturnVo.errorInJson(CodeEnum.UNKNOWN_PARSE_ERROR));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfigurerImpl</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JWTAuthenticationFilter jwtAuthenticationFilter;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用-JSON-格式数据登陆"><a href="#使用-JSON-格式数据登陆" class="headerlink" title="使用 JSON 格式数据登陆"></a>使用 JSON 格式数据登陆</h2><blockquote>
<p><a href="http://www.javaboy.org/2019/0613/springsecurity-json.html" target="_blank" rel="noopener">Spring Security 登录使用 JSON 格式数据</a></p>
<p><a href="https://www.jianshu.com/p/693914564406" target="_blank" rel="noopener">Spring Security配置JSON登录</a></p>
</blockquote>
<p>Spring Security 默认支持的登陆方式为 formLogin，即 Content-Type 为<code>application/x-www-form-urlencoded</code>，如果想要使用 JSON 数据登陆，则需要自定义提取用户名密码的过滤器来替换默认的<code>UsernamePasswordAuthenticationFilter</code>。</p>
<figure class="highlight java"><figcaption><span>CustomerAuthenticationFilter.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title">UsernamePasswordAuthenticationFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        String contentType = request.getContentType();</span><br><span class="line">        <span class="keyword">if</span> (contentType.equals(MediaType.APPLICATION_JSON_VALUE) || contentType.equals(MediaType.APPLICATION_JSON_UTF8_VALUE)) &#123;</span><br><span class="line">            UsernamePasswordAuthenticationToken authRequest;</span><br><span class="line">            <span class="keyword">try</span> (InputStream in = request.getInputStream()) &#123;</span><br><span class="line">                SysUser user = JSON.parseObject(in, SysUser<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                authRequest = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(user.getUsername(), user.getPassword());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                authRequest = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(<span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.attemptAuthentication(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>SecurityConfig.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(securedEnabled = <span class="keyword">true</span>, prePostEnabled = <span class="keyword">true</span>, jsr250Enabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationSuccessHandler authenticationSuccessHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationFailureHandler authenticationFailureHandler;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.addFilterAt(<span class="keyword">this</span>.customerAuthenticationFilter(), UsernamePasswordAuthenticationFilter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">CustomerAuthenticationFilter <span class="title">customerAuthenticationFilter</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        CustomerAuthenticationFilter filter = <span class="keyword">new</span> CustomerAuthenticationFilter();</span><br><span class="line">        filter.setRequiresAuthenticationRequestMatcher(<span class="keyword">new</span> AntPathRequestMatcher(<span class="string">"/user/login"</span>, <span class="string">"POST"</span>));</span><br><span class="line">        filter.setAuthenticationSuccessHandler(authenticationSuccessHandler);</span><br><span class="line">        filter.setAuthenticationFailureHandler(authenticationFailureHandler);</span><br><span class="line">        filter.setAuthenticationManager(<span class="keyword">this</span>.authenticationManagerBean());</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>处理登陆请求的 URL 地址不能通过之前的方式（<code>.formLogin().loginProcessingUrl(&quot;/user/login&quot;)</code>）来配置，需要在自定义过滤器里配置，因为以前的方式配置的是默认的过滤器的，自定义过滤器会替换掉默认的，所以用以前的方式配置的 loginProcessingUrl 就失效了。</li>
<li>自定义的过滤器之所以要在 security 配置类中初始化（使用<code>@Bean</code>的方式而不是直接在类上使用<code>@Component</code>），是因为需要使用<code>WebSecurityConfigurerAdapter</code>的<code>authenticationManagerBean()</code>方法来调用默认的认证管理器，否则需要自定义自己的认证管理器。</li>
</ol>
<h2 id="自定义认证管理器"><a href="#自定义认证管理器" class="headerlink" title="自定义认证管理器"></a>自定义认证管理器</h2><p>为了把提取用户名密码的过滤器从配置类中抽离出来，就需要使用自定义的认证管理器来替换默认的认证管理器（<code>WebSecurityConfigurerAdapter.AuthenticationManagerDelegator</code>）。由于默认的认证管理器是不可继承的（由<code>final</code>修饰），所以通过实现<code>AuthenticationManager</code>接口来自定义，而认证管理器又是通过认证处理器<code>AuthenticationManager</code>提供的认证方法<code>authenticate()</code>最终对用户进行认证的，所以在自定义认证管理器的时候还需要提供认证处理器，可以在认证管理器的构造方法中直接初始化认证处理器，这里使用默认的持久层认证处理器为<code>DaoAuthenticationProvider</code>。</p>
<figure class="highlight java"><figcaption><span>CustomerAuthenticationManagerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerAuthenticationManagerImpl</span> <span class="keyword">implements</span> <span class="title">AuthenticationManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuthenticationProvider provider;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerAuthenticationManagerImpl</span><span class="params">(SecurityUserDetailService userDetailsService)</span> </span>&#123;</span><br><span class="line">        DaoAuthenticationProvider provider = <span class="keyword">new</span> DaoAuthenticationProvider();</span><br><span class="line">        provider.setUserDetailsService(userDetailsService);</span><br><span class="line">        provider.setPasswordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder());</span><br><span class="line">        <span class="keyword">this</span>.provider = provider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        Authentication authenticate = <span class="keyword">this</span>.provider.authenticate(authentication);</span><br><span class="line">        <span class="keyword">if</span> (Objects.nonNull(authenticate)) &#123;</span><br><span class="line">            <span class="keyword">return</span> authenticate;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ProviderNotFoundException(<span class="string">"Authentication failed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>SecurityConfig.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(securedEnabled = <span class="keyword">true</span>, prePostEnabled = <span class="keyword">true</span>, jsr250Enabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerAuthenticationFilter authenticationFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.addFilterAt(authenticationFilter, UsernamePasswordAuthenticationFilter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：和自定义用于提取用户名密码的过滤器道理一样，因为是替换默认的认证处理器，所以 UserDetailsService、PasswordEncoder 等配置需要在初始化认证处理器的地方进行配置，而不能用以前配置默认认证处理器的方式。</p>
<ul>
<li><p>配置默认处理器所需的 UserDetailsService：</p>
<figure class="highlight java"><figcaption><span>SecurityConfig.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SecurityUserDetailService userDetailService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.userDetailsService(userDetailService);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置默认处理器所需的 PasswordEncoder：</p>
<ol>
<li><p>@Bean</p>
<figure class="highlight java"><figcaption><span>SecurityConfig.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在密码前加上加密算法前缀，如<code>{bcrypt}$2a$10$ffHsT7aCssLbKn7zACwOYupOQtxpzRVvIXD8Pveo9rHU4DrSUUyve</code></p>
</li>
</ol>
</li>
</ul>
<h2 id="自定义认证处理器"><a href="#自定义认证处理器" class="headerlink" title="自定义认证处理器"></a>自定义认证处理器</h2><p>如果不想在自定义的认证管理器中使用默认的认证处理器，也可以自定义认证处理器。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerAuthenticationProviderImpl</span> <span class="keyword">extends</span> <span class="title">DaoAuthenticationProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PasswordEncoder PASSWORD_ENCODER = <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        String username = (String) authentication.getPrincipal();</span><br><span class="line">        String password = (String) authentication.getCredentials();</span><br><span class="line">        SysUser user = userService.selectUserByUsername(username);</span><br><span class="line">        user.setRoleList(Collections.singletonList(<span class="keyword">new</span> SysRole(<span class="string">"user"</span>)));</span><br><span class="line">        <span class="keyword">if</span> (PASSWORD_ENCODER.matches(password, user.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password, user.getRoleList());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="keyword">this</span>.messages.getMessage(</span><br><span class="line">                    <span class="string">"AbstractUserDetailsAuthenticationProvider.badCredentials"</span>,</span><br><span class="line">                    <span class="string">"Bad credentials"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doAfterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>CustomerAuthenticationManagerImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerAuthenticationManagerImpl</span> <span class="keyword">implements</span> <span class="title">AuthenticationManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuthenticationProvider provider;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerAuthenticationManagerImpl</span><span class="params">(AuthenticationProvider provider)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.provider = provider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        Authentication authenticate = <span class="keyword">this</span>.provider.authenticate(authentication);</span><br><span class="line">        <span class="keyword">if</span> (Objects.nonNull(authenticate)) &#123;</span><br><span class="line">            <span class="keyword">return</span> authenticate;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ProviderNotFoundException(<span class="string">"Authentication failed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Spring-Security</category>
      </categories>
      <tags>
        <tag>Spring-Security</tag>
      </tags>
  </entry>
  <entry>
    <title>Study Notes of Sqlite</title>
    <url>/2020/03/21/Study-Notes-of-Sqlite/</url>
    <content><![CDATA[<img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/SQLite370.svg/1200px-SQLite370.svg.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://stackoverflow.com/questions/3732422/select-from-nothing" target="_blank" rel="noopener">SELECT from nothing?</a></p>
</blockquote>
<p>It’s not consistent across vendors - Oracle, MySQL, and DB2 support dual:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">'Hello world'</span></span><br><span class="line">  <span class="keyword">FROM</span> DUAL</span><br></pre></td></tr></table></figure>

<p>…while SQL Server, PostgreSQL, and SQLite don’t require the <code>FROM DUAL</code>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">'Hello world'</span></span><br></pre></td></tr></table></figure>

<p>MySQL does support both ways.</p>
<blockquote>
<p><a href="https://github.com/mybatis/mybatis-3/issues/864" target="_blank" rel="noopener">mybatis batch insert oracle table ID use sequence return ID NULL</a></p>
<p><a href="https://blog.csdn.net/top_code/article/details/52404345" target="_blank" rel="noopener">MyBatis 3.3.1 批量插入多行回写自增id</a></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"batchInsert"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">  INSERT INTO tb_user</span><br><span class="line">  (name, password,age, email,gender,register_time)</span><br><span class="line">  VALUES</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"user"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">","</span> &gt;</span></span><br><span class="line">    (#&#123;user.name&#125;,#&#123;user.password&#125;,#&#123;user.age&#125;,#&#123;user.email&#125;,</span><br><span class="line">    #&#123;user.gender&#125;,#&#123;user.registerTime&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键：<code>useGeneratedKeys=&quot;true&quot;</code>, <code>keyProperty=&quot;id&quot;</code></p>
]]></content>
  </entry>
  <entry>
    <title>Study Notes of Vue</title>
    <url>/2019/08/13/Study-Notes-of-Vue/</url>
    <content><![CDATA[<img data-src="https://4.bp.blogspot.com/-QPkAcNH1NUQ/WRfc27-qWFI/AAAAAAAAy6g/74NNXOZ4pywIMCBbExG566EhxupnNDDrACLcB/s1600/vue-newsletter.png" width="100%"/>

<a id="more"></a>

<h2 id="Vue-Loader"><a href="#Vue-Loader" class="headerlink" title="Vue Loader"></a>Vue Loader</h2><h3 id="深度作用选择器"><a href="#深度作用选择器" class="headerlink" title="深度作用选择器"></a>深度作用选择器</h3><p>如果你希望 <code>scoped</code> 样式中的一个选择器能够作用得“更深”，例如<strong>影响子组件</strong>，你可以使用 <code>&gt;&gt;&gt;</code> 操作符：</p>
<p>有些像 Sass 之类的预处理器无法正确解析 <code>&gt;&gt;&gt;</code>。这种情况下你可以使用 <code>/deep/</code> 操作符取而代之——这是一个 <code>&gt;&gt;&gt;</code> 的别名，同样可以正常工作。</p>
<h2 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h2><h3 id="关闭缓存功能"><a href="#关闭缓存功能" class="headerlink" title="关闭缓存功能"></a>关闭缓存功能</h3><iframe height="265" style="width: 100%;" scrolling="no" title="xxKdaPe" src="//codepen.io/libo9527/embed/xxKdaPe/?height=265&theme-id=0&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/libo9527/pen/xxKdaPe/' target="_blank" rel="noopener">xxKdaPe</a> by libo9527
  (<a href='https://codepen.io/libo9527' target="_blank" rel="noopener">@libo9527</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

]]></content>
      <categories>
        <category>Front-end</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Summarized Notes of Java Systematically</title>
    <url>/2020/06/01/Summarized-Notes-of-Java-Systematically/</url>
    <content><![CDATA[<img data-src="https://4a7efb2d53317100f611-1d7064c4f7b6de25658a4199efb34975.ssl.cf1.rackcdn.com/patch-or-perish-java-ftc-tells-oracle-showcase_image-1-p-2014.jpg" width="100%"/>

<a id="more"></a>

<h1 id="Java-语言基础"><a href="#Java-语言基础" class="headerlink" title="Java 语言基础"></a>Java 语言基础</h1><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h3><p>Java 中的数值类型都是有符号的，取值范围是固定的，不会随着机器硬件环境或者操作系统的改变而改变。</p>
<h4 id="为什么需要基本数据类型"><a href="#为什么需要基本数据类型" class="headerlink" title="为什么需要基本数据类型"></a>为什么需要基本数据类型</h4><p>我们都知道在Java语言中，<code>new</code>一个对象是存储在堆里的，我们通过栈中的引用来使用这些对象；所以，对象是比较消耗资源的。</p>
<p>对于经常用到的类型，如 int 等，如果我们每次使用这种变量的时候都需要 new 一个对象的话，就会比较笨重。所以，和 C++ 一样，Java提供了基本数据类型，这种数据的变量不需要使用 new 创建，他们不会在堆上创建，而是直接存储在栈内存中，因此会更加高效。</p>
<h4 id="包装类型"><a href="#包装类型" class="headerlink" title="包装类型"></a>包装类型</h4><p>Java 是一个面向对象的语言，但基本数据类型却不是面向对象的，这在实际使用时存在很多的不便，为了解决这个不足，在设计类时为每个基本数据类型设计了一个对应的类，这样八个和基本数据类型对应的类统称为包装类(Wrapper Class)。</p>
<h5 id="为什么需要包装类"><a href="#为什么需要包装类" class="headerlink" title="为什么需要包装类"></a>为什么需要包装类</h5><p>Java 是一种面向对象语言，很多地方都需要使用对象而不是基本数据类型。比如，在集合类中，我们是无法将 int 、double 等类型放进去的。因为集合要求其元素是 Object 类型。</p>
<p>为了让基本类型也具有对象的特征，就出现了包装类型，它相当于将基本类型“包装起来”，使得它具有了对象的性质，并且为其添加了属性和方法，丰富了基本类型的操作。</p>
<h5 id="自动装箱-拆箱"><a href="#自动装箱-拆箱" class="headerlink" title="自动装箱/拆箱"></a>自动装箱/拆箱</h5><h6 id="自动装箱与自动拆箱的实现原理"><a href="#自动装箱与自动拆箱的实现原理" class="headerlink" title="自动装箱与自动拆箱的实现原理"></a>自动装箱与自动拆箱的实现原理</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span></span>&#123;</span><br><span class="line">    Integer integer=<span class="number">1</span>; <span class="comment">//装箱</span></span><br><span class="line">    <span class="keyword">int</span> i=integer; <span class="comment">//拆箱</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对以上代码进行反编译后可以得到以下代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span></span>&#123;</span><br><span class="line">    Integer integer=Integer.valueOf(<span class="number">1</span>); </span><br><span class="line">    <span class="keyword">int</span> i=integer.intValue(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面反编译后的代码可以看出，int 的自动装箱都是通过<code>Integer.valueOf()</code>方法来实现的，Integer 的自动拆箱都是通过<code>integer.intValue()</code>来实现的。其他类型也有对应的方法。</p>
<blockquote>
<p>自动装箱都是通过包装类的<code>valueOf()</code>方法来实现的，自动拆箱都是通过包装类对象的<code>xxxValue()</code>来实现的。</p>
</blockquote>
<h6 id="容易被忽略的自动拆装箱场景"><a href="#容易被忽略的自动拆装箱场景" class="headerlink" title="容易被忽略的自动拆装箱场景"></a>容易被忽略的自动拆装箱场景</h6><ul>
<li><p>Java 中的集合类只能接收对象类型，当我们把基本数据类型放入集合类中的时候，会进行自动装箱。</p>
</li>
<li><p>包装类与基本数据类型进行比较运算，是先将包装类拆箱成基本数据类型，然后进行比较的。</p>
</li>
<li><p>两个包装类型之间的运算，会自动拆箱成基本类型进行。</p>
</li>
<li><p>三目运算符的语法规范中定义，当第二、三位操作数分别为基本类型和对象时，其中的对象就会拆箱为基本类型进行操作。</p>
<blockquote>
<p><a href="http://www.hollischuang.com/archives/435" target="_blank" rel="noopener">自动拆箱导致空指针异常</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String,Boolean&gt; map =  <span class="keyword">new</span> HashMap&lt;String, Boolean&gt;();</span><br><span class="line">Boolean b = (map!=<span class="keyword">null</span> ? map.get(<span class="string">"test"</span>) : <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<p>上述代码运行后报 NPE：NullPointerException，查看反编译结果如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashMap map = <span class="keyword">new</span> HashMap();</span><br><span class="line">Boolean b = Boolean.valueOf(map == <span class="keyword">null</span> ? <span class="keyword">false</span> : ((Boolean)map.get(<span class="string">"test"</span>)).booleanValue());</span><br></pre></td></tr></table></figure>

<p>hashmap.get(“test”)-&gt;null;</p>
<p>(Boolean)null-&gt;null;</p>
<p>null.booleanValue()-&gt;报错</p>
</blockquote>
</li>
<li><p>函数参数与返回值</p>
</li>
</ul>
<h6 id="自动装箱与缓存"><a href="#自动装箱与缓存" class="headerlink" title="自动装箱与缓存"></a>自动装箱与缓存</h6><p>在 Boxing Conversion 部分的 Java 语言规范(JLS)规定如下：</p>
<p>如果一个变量 p 的在以下范围内时：</p>
<ul>
<li><p>-128至127之间的整数(§3.10.1) </p>
</li>
<li><p>true 和 false的布尔值 (§3.10.3)</p>
</li>
<li><p>‘\u0000’至 ‘\u007f’之间的字符(§3.10.4)</p>
</li>
</ul>
<p>将 p 包装成对象时，会直接使用缓存中的对象。</p>
<h6 id="自动拆装箱带来的问题"><a href="#自动拆装箱带来的问题" class="headerlink" title="自动拆装箱带来的问题"></a>自动拆装箱带来的问题</h6><ul>
<li><p>包装对象的数值比较，不能简单的使用<code>==</code>，虽然 -128 到 127 之间的数字可以，但是这个范围之外的还是需要使用<code>equals</code>比较。</p>
</li>
<li><p>由于自动拆箱，如果包装类对象为 null，那么自动拆箱后就有可能抛出NPE。</p>
</li>
<li><p>循环中有大量拆装箱操作，会浪费很多资源。</p>
</li>
</ul>
<h2 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h2><p>序列化（Serialization）是将对象的状态信息转换为可以存储或传输的形式的过程。</p>
<p>反序列化（Unserialization）则是序列化的反过程。</p>
<p>在 Java 中，对象的序列化与反序列化被广泛应用到 RMI(远程方法调用)及网络传输中。</p>
<h3 id="相关接口及类"><a href="#相关接口及类" class="headerlink" title="相关接口及类"></a>相关接口及类</h3><blockquote>
<p>java.io.Serializable<br>java.io.Externalizable<br>java.io.ObjectOutputStream<br>java.io.ObjectInputStream<br>java.io.ObjectOutput<br>java.io.ObjectInput</p>
</blockquote>
<h4 id="Serializable-接口"><a href="#Serializable-接口" class="headerlink" title="Serializable 接口"></a>Serializable 接口</h4><p>类通过实现 <code>java.io.Serializable</code> 接口来启用序列化功能。未实现此接口的类将无法使其任何状态序列化或反序列化。<strong>可序列化类的所有子类型本身都是可序列化的</strong>。此接口没有方法或字段，仅<strong>用于标识</strong>可序列化的语义。</p>
<p>如果没有实现 Serializable 接口，序列化时将抛出 <code>NotSerializableException</code>。</p>
<p>如果要将在父类中的变量持久化下来，那么父类也应该实现<code>java.io.Serializable</code>。</p>
<p><strong>序列化</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectInputStream ois = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(fileName));</span><br><span class="line">  Test1 o = (Test1) ois.readObject();</span><br><span class="line">  System.out.println(o);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">assert</span> ois != <span class="keyword">null</span>;</span><br><span class="line">    ois.close();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>反序列化</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectOutputStream oos = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(fileName));</span><br><span class="line">  oos.writeObject(test1);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">assert</span> oos != <span class="keyword">null</span>;</span><br><span class="line">    oos.close();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Externalizable-接口"><a href="#Externalizable-接口" class="headerlink" title="Externalizable 接口"></a>Externalizable 接口</h4><p>通过实现 Externalizable 接口的方式实现序列化时</p>
<ul>
<li>如果类中没有空构造器，反序列化时则会报错 <code>java.io.InvalidClassException: xxx.xxx.xxx; no valid constructor</code></li>
<li>如果没有实现接口的 <code>writeExternal()</code> 或 <code>readExternal()</code> 方法，则会将 fields 序列化/反序列化为默认值(int:0 Object:null)</li>
</ul>
<h4 id="Transient-关键字"><a href="#Transient-关键字" class="headerlink" title="Transient 关键字"></a>Transient 关键字</h4><p>在变量声明前加上该关键字，可以阻止该变量被序列化到文件中，在被反序列化后，transient 变量的值将被设为默认值，如 int 型的是 0，对象型的是 null。</p>
<h4 id="序列化ID"><a href="#序列化ID" class="headerlink" title="序列化ID"></a>序列化ID</h4><p>虚拟机是否允许反序列化，不仅取决于类路径和功能代码是否一致，还要确认两个类的序列化 ID 是否一致（<code>private static final long serialVersionUID</code>)</p>
<p>序列化 ID 有两种生成策略，一个是固定的 1L，一个是随机生成一个不重复的 long 类型数据（实际上是使用 JDK 工具生成）。</p>
<p>如果没有特殊需求，用默认的 1L 就可以，这样可以确保代码一致时反序列化成功。随机生成的序列化 ID 可以用来限制某些用户的使用。</p>
<h3 id="序列化与单例模式"><a href="#序列化与单例模式" class="headerlink" title="序列化与单例模式"></a>序列化与单例模式</h3><blockquote>
<p><a href="https://cloud.tencent.com/developer/article/1341386" target="_blank" rel="noopener">单例与序列化的那些事儿</a></p>
</blockquote>
<h4 id="为什么序列化可以破坏单例模式？"><a href="#为什么序列化可以破坏单例模式？" class="headerlink" title="为什么序列化可以破坏单例模式？"></a>为什么序列化可以破坏单例模式？</h4><p>序列化会通过反射调用无参构造器创建新对象，进而破坏单例模式。</p>
<p><code>ObjectInputStream.readObject()</code> 的调用栈：</p>
<p>ObjectInputStream.readObject() —&gt; ObjectInputStream.readObject0() —&gt; ObjectInputStream.readOrdinaryObject() —&gt; ObjectInputStream.checkResolve()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readOrdinaryObject</span><span class="params">(<span class="keyword">boolean</span> unshared)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  Object obj;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// desc.isInstantiable() 是否实现了 Serializable/Externalizable 接口</span></span><br><span class="line">    <span class="comment">// desc.newInstance() 通过反射调用无参构造方法</span></span><br><span class="line">    obj = desc.isInstantiable() ? desc.newInstance() : <span class="keyword">null</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">    <span class="keyword">throw</span> (IOException) <span class="keyword">new</span> InvalidClassException(</span><br><span class="line">      desc.forClass().getName(),</span><br><span class="line">      <span class="string">"unable to create instance"</span>).initCause(ex);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// desc.hasReadResolveMethod() 是否包含 readResolve() 方法</span></span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">        handles.lookupException(passHandle) == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">        desc.hasReadResolveMethod())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// desc.invokeReadResolve(obj) 通过反射调用 readResolve() 方法。</span></span><br><span class="line">      Object rep = desc.invokeReadResolve(obj);</span><br><span class="line">      <span class="keyword">if</span> (unshared &amp;&amp; rep.getClass().isArray()) &#123;</span><br><span class="line">        rep = cloneArray(rep);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (rep != obj) &#123;</span><br><span class="line">        <span class="comment">// Filter the replacement object</span></span><br><span class="line">        <span class="keyword">if</span> (rep != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (rep.getClass().isArray()) &#123;</span><br><span class="line">            filterCheck(rep.getClass(), Array.getLength(rep));</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            filterCheck(rep.getClass(), -<span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        handles.setObject(passHandle, obj = rep);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="如何防止序列化破坏单例模式"><a href="#如何防止序列化破坏单例模式" class="headerlink" title="如何防止序列化破坏单例模式"></a>如何防止序列化破坏单例模式</h4><p>只要在类中定义 <code>readResolve()</code> 方法返回单例即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.gzhennaxia.test.io.serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用双重校验锁实现单例模式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bli@skystartrade.com</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2020-06-04 15:24</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">          singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> singleton;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 反序列化时会检查是否存在 readResolve() 方法，存在则调用它来实例化</span></span><br><span class="line"><span class="comment">     * 否则使用反射调用无参构造器实例化，因此可以通过创建 readResolve() 方法</span></span><br><span class="line"><span class="comment">     * 来保护单例在反序列化过程中不被破坏。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bli@skystartrade.com</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2020-06-04 16:33</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> singleton;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2><h3 id="JDK-体系结构"><a href="#JDK-体系结构" class="headerlink" title="JDK 体系结构"></a>JDK 体系结构</h3><p><img data-src="https://i.stack.imgur.com/CBNux.png" alt=""></p>
<h3 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h3><h4 id="javac"><a href="#javac" class="headerlink" title="javac"></a>javac</h4><blockquote>
<p><a href="https://blog.csdn.net/u010325193/article/details/80792695" target="_blank" rel="noopener">查看JAVA的class二进制文件的方法_u010325193的博客 …</a></p>
</blockquote>
<p>将 .java 文件编译成字节码文件 .class</p>
<h4 id="javap"><a href="#javap" class="headerlink" title="javap"></a>javap</h4><p>将字节码文件反编译成 Java 文件</p>
<h5 id="c"><a href="#c" class="headerlink" title="-c"></a>-c</h5><p>反汇编为字节码指令</p>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Java_bytecode_instruction_listings" target="_blank" rel="noopener">Java bytecode instruction listings - Wikipedia</a></p>
<p><a href="https://juejin.im/post/5d2c453ce51d45775f516b11" target="_blank" rel="noopener">jvm 指令手册- 掘金</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javap -c Math<span class="class">.<span class="keyword">class</span> &gt; <span class="title">Math</span>.<span class="title">txt</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Compiled from <span class="string">"Math.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Math</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> initData;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> User user;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Math</span><span class="params">()</span></span>;</span><br><span class="line">    Code:</span><br><span class="line">       <span class="number">0</span>: aload_0</span><br><span class="line">       1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">       <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    Code:</span><br><span class="line">       0: new           #2                  // class Math</span><br><span class="line">       <span class="number">3</span>: dup</span><br><span class="line">       4: invokespecial #3                  // Method "&lt;init&gt;":()V</span><br><span class="line">       <span class="number">7</span>: astore_1</span><br><span class="line">       <span class="number">8</span>: aload_1</span><br><span class="line">       9: invokevirtual #4                  // Method compute:()I</span><br><span class="line">      <span class="number">12</span>: pop</span><br><span class="line">      13: getstatic     #5                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">      16: ldc           #6                  // String test</span><br><span class="line">      18: invokevirtual #7                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">      <span class="number">21</span>: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compute</span><span class="params">()</span></span>;</span><br><span class="line">    Code:</span><br><span class="line">       <span class="number">0</span>: iconst_1</span><br><span class="line">       <span class="number">1</span>: istore_1</span><br><span class="line">       <span class="number">2</span>: iconst_2</span><br><span class="line">       <span class="number">3</span>: istore_2</span><br><span class="line">       <span class="number">4</span>: iload_1</span><br><span class="line">       <span class="number">5</span>: iload_2</span><br><span class="line">       <span class="number">6</span>: iadd</span><br><span class="line">       <span class="number">7</span>: bipush        <span class="number">10</span></span><br><span class="line">       <span class="number">9</span>: imul</span><br><span class="line">      <span class="number">10</span>: istore_3</span><br><span class="line">      <span class="number">11</span>: iload_3</span><br><span class="line">      <span class="number">12</span>: ireturn</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    Code:</span><br><span class="line">       <span class="number">0</span>: sipush        <span class="number">666</span></span><br><span class="line">       3: putstatic     #8                  // Field initData:I</span><br><span class="line">       6: new           #9                  // class User</span><br><span class="line">       <span class="number">9</span>: dup</span><br><span class="line">      10: invokespecial #10                 // Method User."&lt;init&gt;":()V</span><br><span class="line">      13: putstatic     #11                 // Field user:LUser;</span><br><span class="line">      <span class="number">16</span>: <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="本地方法"><a href="#本地方法" class="headerlink" title="本地方法"></a>本地方法</h2><p>Java 中的 native 方法调用的是用 C 语言写的方法，存在系统的 xxx.dll 文件中，相当于 Java 中的 jar 包。</p>
<h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><p>完整的 JVM 包括类加载子系统、字节码执行引擎、运行时数据区(内存模型)。</p>
<h3 id="JVM-指令手册"><a href="#JVM-指令手册" class="headerlink" title="JVM 指令手册"></a>JVM 指令手册</h3><blockquote>
<p><a href="https://en.wikipedia.org/wiki/Java_bytecode_instruction_listings" target="_blank" rel="noopener">Java bytecode instruction listings - Wikipedia</a></p>
<p><a href="https://juejin.im/post/5d2c453ce51d45775f516b11" target="_blank" rel="noopener">jvm 指令手册- 掘金</a></p>
</blockquote>
<h3 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h3><p><img data-src="https://segmentfault.com/img/bVbG2RJ/view" alt=""></p>
<h4 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h4><p>记录当前线程执行到的虚拟机字节码指令的位置(行号/地址)。</p>
<p>程序计数器这个 JVM 内存区域是唯一一个在《Java虚拟机规范》中没有规定任何 OutOfMemoryError 情况的区域。</p>
<p><strong>为什么要设计程序计数器？</strong></p>
<p>由于线程调度的原因，当当前线程的 CPU 时间片用完的时候，需要记录下当前运行的位置和状态，以便下一次再获得 CPU 时间片时继续执行。即为了线程切换后能恢复到正确的执行位置！</p>
<h4 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h4><h5 id="栈帧"><a href="#栈帧" class="headerlink" title="栈帧"></a>栈帧</h5><p>用于存储局部变量表、操作数栈、动态链接、方法出口等信息。</p>
<h6 id="局部变量表"><a href="#局部变量表" class="headerlink" title="局部变量表"></a>局部变量表</h6><p>局部变量表存放了编译期可知的 Java 基本数据类型、对象引用和 returnAddress 类型（指向一条字节码指令的地址）。</p>
<p>这些数据类型在局部变量表中的存储空间以局部变量槽（Slot）来表示，其中 long 和 double 类型的数据会占用两个变量槽，其余的数据类型只占用一个。局部变量表所需的内存空间在编译期间完成分配，当进入一个方法时，这个方法需要在栈帧中分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表的大小。这里说的“大小”是指变量槽的数量， 虚拟机真正使用多大的内存空间来实现一 个变量槽，则完全由具体的虚拟机实现自行决定。</p>
<p>在《Java虚拟机规范》中，对这个内存区域规定了两类异常状况：</p>
<ol>
<li>如果线程请求的栈深度大于虚拟机所允许的深度，将抛出 StackOverflowError 异常；</li>
<li>如果 Java 虚拟机栈容量可以动态扩展，当栈扩展时无法申请到足够的内存时会抛出 OutOfMemoryError 异常。</li>
</ol>
<p>HotSpot 虚拟机的栈容量是不可以动态扩展的，以前的 Classic 虚拟机倒是可以。所以在HotSpot虚拟机上只要线程申请栈空间成功了就不会有 OOM，但是如果申请时就失败，<strong>仍然</strong>是会出现 OOM 异常的。</p>
<h4 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h4><p>Hot-Spot 虚拟机直接把本地方法栈和虚拟机栈合二为一了。</p>
<h4 id="常量池-元空间"><a href="#常量池-元空间" class="headerlink" title="常量池(元空间)"></a>常量池(元空间)</h4><p>常量池中主要存放两类常量：字面量(Literal)和符号引用(Symbolic References)</p>
<h5 id="Java-程序中发生异常时是如何知道哪行代码发生的异常"><a href="#Java-程序中发生异常时是如何知道哪行代码发生的异常" class="headerlink" title="Java 程序中发生异常时是如何知道哪行代码发生的异常"></a>Java 程序中发生异常时是如何知道哪行代码发生的异常</h5><p>通过 <code>javap -v</code> 命令反编译 Java 文件可以看到，在常量池中有一个 <code>LineNumberTable</code> 其中记录了 jvm 指令与源代码行号的映射关系，当执行到某条指令发生异常时就可以知道是对应源代码的哪行代码。</p>
<h5 id="Java-中的-this"><a href="#Java-中的-this" class="headerlink" title="Java 中的 this"></a>Java 中的 this</h5><p>从反编译文件中可以看出，在 <code>LocalVariableTable</code> 中第一个变量就是 this，所以 this 是编译时编译器隐士传递的局部变量。</p>
<p>注意：<code>javac</code> 默认不会生成调试信息(LocalVariableTable就是其中之一)，需要加上 <code>-g</code> 参数才可以。参考：<a href="https://blog.csdn.net/weixin_30481087/article/details/97001857" target="_blank" rel="noopener">javap -v没有显示LocalVaribleTable</a></p>
<h4 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h4><p>常见的堆内存区域划分(新生代、老年代、永久代、Eden、Survivor……)仅仅是一部分垃圾收集器的共同特性或者说设计风格而已，而非某个Java虚拟机具体 实现的固有内存布局，更不是《Java虚拟机规范》里对Java堆的进一步细致划分。</p>
<p>HotSpot 里面已经有了不采用分代设计的新垃圾收集器。</p>
<h5 id="分代年龄"><a href="#分代年龄" class="headerlink" title="分代年龄"></a>分代年龄</h5><p>分代年龄存储于对象头中。年轻代中的对象在每次 <code>minor gc</code> 后存活下来的对象的分代年龄会加一，当分代年龄超过阀值(默认为15)时会被存放到老年代中。</p>
<p>有两个参数：</p>
<ul>
<li><code>-XX:MaxTenuringThreshold</code>，晋升年龄最大阈值，默认15，新生代中经过数次 YGC 后，对象仍然存活并且达到了晋升年龄阈值，该对象就会晋升到老年代中。</li>
<li><code>-XX:TargetSurvivorRatio</code>，设置 Suvivor 区的目标使用率，默认 50，表示 Survivor 区对象目标使用率为 50%。</li>
</ul>
<h5 id="对象动态年龄判断"><a href="#对象动态年龄判断" class="headerlink" title="对象动态年龄判断"></a>对象动态年龄判断</h5><p>Survivor 区的对象年龄从小到大进行累加，当累加到 X 年龄时的总和大于50%<strong>（可以使用-XX:TargetSurvivorRatio=? 来设置保留多少空闲空间，默认值是50）</strong>，那么比X大的都会晋升到老年代。</p>
<h4 id="方法区-元空间"><a href="#方法区-元空间" class="headerlink" title="方法区/元空间"></a>方法区/元空间</h4><p>用于存储已被虚拟机加载的类型信息、常量、静态变量、即时编译器编译后的代码缓存等数据。</p>
<p>虽然《Java虚拟机规范》中把方法区描述为<strong>堆的一个逻辑部分</strong>，但是它却有一个别名叫作“非堆”（Non-Heap），目的是与Java堆区 分开来。 </p>
<h5 id="方法区-vs-永久代-vs-元空间"><a href="#方法区-vs-永久代-vs-元空间" class="headerlink" title="方法区 vs 永久代 vs 元空间"></a>方法区 vs 永久代 vs 元空间</h5><p>说到方法区，不得不提一下“永久代”这个概念，尤其是在JDK 8以前，许多Java程序员都习惯在 HotSpot 虚拟机上开发、部署程序，很多人都更愿意把方法区称呼为“永久代”（Permanent Generation），或将两者混为一谈。</p>
<p>本质上这两者并不是等价的，因为仅仅是当时的HotSpot虚拟机设计团队选择把收集器的分代设计扩展至方法区，或者说使用永久代来实现方法区而已，这样使得 HotSpot 的垃圾收集器能够像管理Java堆一样管理这部分内存，省去专门为方法区编写内存管理代码的工作。但是对于其他虚拟机实现，譬如BEA JRockit、IBM J9等来说，是不存在永久代的概念的。</p>
<p>原则上如何实现方法区属于虚拟机实现细节，不受《Java虚拟机规范》管束，并不要求统一。但现在回头 来看，当年使用永久代来实现方法区的决定并不是一个好主意，这种设计导致了Java应用更容易遇到内存溢出的问题（永久代有-XX：MaxPermSize的上限，即使不设置也有默认大小，而J9和JRockit只要没有触碰到进程可用内存的上限，例如32位系统中的4GB限制，就不会出问题），而且有极少数方法 （例如String::intern()）会因永久代的原因而导致不同虚拟机下有不同的表现。当Oracle收购BEA获得了 JRockit的所有权后，准备把JRockit中的优秀功能，譬如Java Mission Control管理工具，移植到HotSpot 虚拟机时，但因为两者对方法区实现的差异而面临诸多困难。考虑到HotSpot未来的发展，在JDK 6的 时候HotSpot开发团队就有放弃永久代，逐步改为采用本地内存（Native Memory）来实现方法区的计划了，到了JDK 7的HotSpot，已经把原本放在永久代的字符串常量池、静态变量等移出，而到了 JDK 8，终于完全废弃了永久代的概念，改用与JRockit、J9一样在本地内存中实现的元空间（Metaspace）来代替，把JDK 7中永久代还剩余的内容（主要是类型信息）全部移到元空间中。</p>
<h5 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h5><p>运行时常量池（Runtime Constant Pool）是方法区的一部分。Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息是<strong>常量池表</strong>（Constant Pool Table），用于存放编译期生成的各种<strong>字面量</strong>与<strong>符号引用</strong>，这部分内容将在<strong>类加载后</strong>存放到方法区的<strong>运行时常量池</strong>中。 </p>
<h3 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h3><h4 id="垃圾检测算法"><a href="#垃圾检测算法" class="headerlink" title="垃圾检测算法"></a>垃圾检测算法</h4><h5 id="可达性分析算法"><a href="#可达性分析算法" class="headerlink" title="可达性分析算法"></a>可达性分析算法</h5><p>以 <code>GC Roots</code> 对象为起点，向下搜索引用的对象，将找到的对象都标记为<strong>非垃圾对象</strong>，其余的对象均为<strong>垃圾对象</strong>。</p>
<p>GC Roots：线程栈的本地变量、静态变量、本地方法的变量等等。</p>
<h4 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h4><h3 id="VisualVM"><a href="#VisualVM" class="headerlink" title="VisualVM"></a>VisualVM</h3><p>VisualVM 是一种工具，它提供了可视化界面，用于查看 Java 虚拟机上运行的 Java 应用程序的详细信息。</p>
<blockquote>
<p><a href="https://juejin.im/post/5a3b92def265da4319567218" target="_blank" rel="noopener">使用jvisualvm监控Java程序（本地和远程） - 掘金</a></p>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-visualvm/" target="_blank" rel="noopener">使用 VisualVM 进行性能分析及调优</a></p>
<p><a href="https://blog.51cto.com/tianxingzhe/1651384" target="_blank" rel="noopener">Java程序内存分析Java VisualVM（Visual GC）-点滴积累 …</a></p>
</blockquote>
<h4 id="本地启动"><a href="#本地启动" class="headerlink" title="本地启动"></a>本地启动</h4><p>直接在终端敲命令<code>jvisualvm</code>就可以运行，然后可以看到运行界面。</p>
<h4 id="STW-stop-the-world"><a href="#STW-stop-the-world" class="headerlink" title="STW(stop the world)"></a>STW(stop the world)</h4><blockquote>
<p><a href="https://juejin.im/post/5dc910586fb9a04a95289f28" target="_blank" rel="noopener">(干货篇) JVM stop the world - 掘金</a></p>
</blockquote>
<p>等待所有用户线程进入安全点后并阻塞，做一些全局性操作(例如 GC)的行为。</p>
<h3 id="垃圾回收算法-1"><a href="#垃圾回收算法-1" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h3><p>大对象直接进入老年代</p>
<h3 id="JVM-调优"><a href="#JVM-调优" class="headerlink" title="JVM 调优"></a>JVM 调优</h3><p>调优的目的/目标：减少 GC 次数，加快 GC 运行速度。</p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><h3 id="JVM-线程和操作系统线程"><a href="#JVM-线程和操作系统线程" class="headerlink" title="JVM 线程和操作系统线程"></a>JVM 线程和操作系统线程</h3><p>Java 的线程和操作系统的线程是一一对应的。使用 Java 线程就是使用一个操作系统本地线程。</p>
<p>在 Java1.1 的时候，Solaris 系统上的 JVM，其线程和操作系统线程并不是一一对应的，称之为  绿色线程 。</p>
<p>所谓绿色线程，即该线程是虚拟机层面上的线程，由虚拟机创建，调度和销毁，操作系统对这种线程一无所知。由于绿色线程实现复杂，并且相当于 OS 的原生线程又有着诸多限制，所以 Java 后续的版本就放弃采用这种方式。</p>
<h3 id="volatile-关键字"><a href="#volatile-关键字" class="headerlink" title="volatile 关键字"></a>volatile 关键字</h3><blockquote>
<p><a href="https://cloud.tencent.com/developer/article/1699117" target="_blank" rel="noopener">voliate工作实际应用场景</a></p>
</blockquote>
<p><strong>voliate三特性</strong></p>
<ul>
<li>可见性；</li>
<li>原子性；</li>
<li>禁止指令重排。</li>
</ul>
<h1 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h1><h2 id="成员变量和接口的返回值类型及命名"><a href="#成员变量和接口的返回值类型及命名" class="headerlink" title="成员变量和接口的返回值类型及命名"></a>成员变量和接口的返回值类型及命名</h2><p>布尔类型的成员变量有如下四种定义方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> success</span><br><span class="line"><span class="keyword">boolean</span> isSuccess</span><br><span class="line">Boolean success</span><br><span class="line">Boolean isSuccess</span><br></pre></td></tr></table></figure>

<h3 id="success-isSuccess"><a href="#success-isSuccess" class="headerlink" title="success/isSuccess"></a>success/isSuccess</h3><p>在阿里巴巴Java开发手册中关于这一点，有过一个『强制性』规定：</p>
<blockquote>
<p>8.【强制】POJO类中的任何布尔类型的变量，都不要加is前缀，否则部分框架解析会引起序列化错误。</p>
<p>说明：在本文MySQL规约中的建表约定第一条，表达是与否的值采用is_xxx的命名方式，所以，需要在<resultMap>设置从is_xxx到xxx的映射关系。</p>
<p>反例：定义为基本数据类型Boolean isDeleted的属性，它的方法也是isDeleted()，框架在反向解析的时候，“误以为”对应的属性名称是deleted，导致属性获取不到，进而抛出异常。</p>
</blockquote>
<h4 id="Java-Bean中关于setter-getter的规范"><a href="#Java-Bean中关于setter-getter的规范" class="headerlink" title="Java Bean中关于setter/getter的规范"></a>Java Bean中关于setter/getter的规范</h4><blockquote>
<p>8.3.2 Boolean properties</p>
<p>In addition, for boolean properties, we allow a getter method to match the pattern:</p>
<p><code>public boolean is&lt;PropertyName&gt;();</code></p>
<p>This “is<PropertyName>” method may be provided instead of a “get<PropertyName>” meth-od, or it may be provided in addition to a “get<PropertyName>” method.</p>
<p>In either case, if the “is<PropertyName>” method is present for a boolean property then we will use the “is<PropertyName>” method to read the property value.</p>
<p>An example boolean property might be:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMarsupial</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMarsupial</span><span class="params">(<span class="keyword">boolean</span> m)</span></span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>关于Java Bean中的getter/setter方法的定义其实是有明确的规定的，根据<a href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/" target="_blank" rel="noopener">JavaBeans(TM) Specification</a>规定，如果是普通的参数propertyName，要以以下方式定义其setter/getter：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;PropertyType&gt; get&lt;PropertyName&gt;();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> set&lt;PropertyName&gt;(&lt;PropertyType&gt; a);</span><br></pre></td></tr></table></figure>

<p>但是，布尔类型的变量propertyName则是单独定义的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> is&lt;PropertyName&gt;();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> set&lt;PropertyName&gt;(<span class="keyword">boolean</span> m);</span><br></pre></td></tr></table></figure>

<h4 id="序列化带来的影响"><a href="#序列化带来的影响" class="headerlink" title="序列化带来的影响"></a>序列化带来的影响</h4><p>比较常用的 fastJson、jackson 和 Gson 之间有何区别：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isSuccess;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSuccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isSuccess;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuccess</span><span class="params">(<span class="keyword">boolean</span> success)</span> </span>&#123;</span><br><span class="line">        isSuccess = success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBoris</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Boris"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Test&#123;"</span> +</span><br><span class="line">                <span class="string">"isSuccess="</span> + isSuccess +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        test.setSuccess(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Serializable Result With fastjson-1.2.58 :"</span> + JSON.toJSONString(test));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Serializable Result With Gson-2.8.5 :"</span> + <span class="keyword">new</span> Gson().toJson(test));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Serializable Result With jackson-2.10.0 :"</span> + <span class="keyword">new</span> ObjectMapper().writeValueAsString(test));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Serializable Result With fastjson-1.2.58 :&#123;&quot;boris&quot;:&quot;Boris&quot;,&quot;success&quot;:true&#125;</span><br><span class="line">Serializable Result With Gson-2.8.5 :&#123;&quot;isSuccess&quot;:true&#125;</span><br><span class="line">Serializable Result With jackson-2.10.0 :&#123;&quot;success&quot;:true,&quot;boris&quot;:&quot;Boris&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>在 fastjson 和 jackson 的结果中，原来类中的 isSuccess 字段被序列化成 success，并且其中还包含 boris 值。而 Gson 中只有 isSuccess 字段。</p>
<p>由此可以得出<strong>结论</strong>：</p>
<p>fastjson 和 jackson 在把对象序列化成 json 字符串的时候，是通过反射遍历出该类中的所有 getter 方法，得到 getBoris 和 isSuccess，然后根据 JavaBeans 规范，会认为这是属性 boris 和 success 的值。直接序列化成 <code>{&quot;hollis&quot;:&quot;hollischuang&quot;,&quot;success&quot;:true}</code></p>
<p>Gson 是通过反射遍历该类中的所有属性，然后进行序列化操作 <code>{&quot;isSuccess&quot;:true}</code></p>
<p>可以看到，由于不同的序列化工具，在进行序列化的时候使用到的策略是不一样的，所以，对于同一个类的同一个对象的序列化结果可能是不同的。</p>
<p>如果使用 fastjson 进行序列化，再使用 Gson 反序列化就会出现与实际相反的结果。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 去掉 Test 的 getBoris() 方法运行下面的代码</span></span><br><span class="line">System.out.println(gson.fromJson(JSON.toJSONString(test), Test<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result:</span></span><br><span class="line"><span class="comment">// Test&#123;isSuccess=false&#125;</span></span><br></pre></td></tr></table></figure>

<p>生产环境出现这种现象，则是一个致命的问题。</p>
<p>所以，作为开发者，应该避免这种问题的发生，把 isSuccess 改为 success，这样，成员变量是 success，getter 方法是 isSuccess，完全符合 JavaBeans 规范。无论哪种序列化框架，执行结果都一样。</p>
<blockquote>
<p>R 大关于阿里巴巴 Java 开发手册这条规定的评价（<a href="https://www.zhihu.com/question/55642203）：" target="_blank" rel="noopener">https://www.zhihu.com/question/55642203）：</a></p>
<p><img data-src="http://www.hollischuang.com/wp-content/uploads/2018/12/15449492627754.jpg" alt=""></p>
</blockquote>
<h3 id="Boolean-boolean"><a href="#Boolean-boolean" class="headerlink" title="Boolean/boolean"></a>Boolean/boolean</h3><blockquote>
<p>12.关于基本数据类型与包装数据类型的使用标准如下：</p>
<p>1）【强制】所有的POJO类属性必须使用包装数据类型。</p>
<p>2）【强制】RPC方法的返回值和参数必须使用包装数据类型。</p>
<p>3）【推荐】所有的局部变量使用基本数据类型。</p>
<p>说明：POJO类属性没有初值是提醒使用者在需要使用时，必须自己显式地进行赋值，任何NPE问题，或者入库检查，都由使用者来保证。</p>
<p>正例：数据库的查询结果可能是null，因为自动拆箱，用基本数据类型接收有NPE风险。</p>
<p>反例：某业务的交易报表上显示成交总额涨跌情况，即正负x%，x为基本数据类型，调用的RPC服务，调用不成功时，返回的是默认值，页面显示为0%，这是不合理的，应该显示成中划线-。所以包装数据类型的null值，能够表示额外的信息，如：远程调用失败，异常退出。</p>
</blockquote>
<p>使用包装类型定义变量的方式，通过异常来阻断程序，进而可以被识别到这种线上问题。如果使用基本数据类型的话，系统可能不会报错，进而认为无异常。</p>
<h1 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h1><p>Java Memory Model java内存模型</p>
<h2 id="多核并发缓存架构"><a href="#多核并发缓存架构" class="headerlink" title="多核并发缓存架构"></a>多核并发缓存架构</h2><p><img data-src="https://cqh-i.github.io/2019/08/13/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/pic1.png" alt=""></p>
<p>Java 线程内存模型与 CPU 缓存模型类似，是基于 CPU 缓存模型来建立的，Java 线程内存模型是标准化的，屏蔽掉了底层不同计算机的区别。</p>
<p><img data-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9iOHIxS3hnMmNMSWJTZXFYVkpzYmU2UTZsWmVpYUgzaWE4cU1LVG53cUVvZWljdTJRQTU5bVRYVXROU0pLMGliMENOcW9MUmVSTnJhWndjeEw1cURMTnNQT1EvNjQw?x-oss-process=image/format,png" alt=""></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileVisibilityTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> initFlag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"waiting data..."</span>);</span><br><span class="line">                <span class="keyword">while</span> (!initFlag) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"=====================success"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                prepareData();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepareData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"preparing data..."</span>);</span><br><span class="line">        initFlag = <span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">"prepare data end..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码运行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">waiting data...</span><br><span class="line">preparing data...</span><br><span class="line">prepare data end...</span><br><span class="line"></span><br><span class="line">____________________</span><br><span class="line">死循环，程序无法正常结束</span><br></pre></td></tr></table></figure>

<p>使用 <code>volatile</code> 修饰变量 <code>initFlag</code> 后运行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">waiting data...</span><br><span class="line">preparing data...</span><br><span class="line">prepare data end...</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;success</span><br><span class="line"></span><br><span class="line">____________________</span><br><span class="line">正常结束</span><br></pre></td></tr></table></figure>

<h2 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h2><ol>
<li>read（读取）：从主内存读取数据</li>
<li>load（载入）：将主内存读取到的数据写入工作内存</li>
<li>use（使用）：从工作内存读取数据来计算</li>
<li>assign（赋值）：将计算好的值重新赋值到工作内存中</li>
<li>store（存储）：将工作内存数据写入主内存</li>
<li>write（写入）：将store过去的变量赋值给主内存中的变量</li>
<li>lock（锁定）：将主内存变量加锁，标识为线程独占状态</li>
<li>unlock（解锁）：将内存变量解锁，解锁后其他线程可以锁定该变量</li>
</ol>
<h2 id="总线加锁"><a href="#总线加锁" class="headerlink" title="总线加锁"></a>总线加锁</h2><p>CPU 从主内存读取数据到高速缓存，会在总线对这个数据加锁，其他 CPU 将无法读取或写入这个数据，直到这个 CPU 使用完数据并释放锁只有，其他 CPU 才能读取。</p>
<h2 id="MESI-缓存一致性协议"><a href="#MESI-缓存一致性协议" class="headerlink" title="MESI 缓存一致性协议"></a>MESI 缓存一致性协议</h2><p>多个 CPU 从主内存读取同一个数据到各自的高速缓存，当其中某个 CPU 修改了缓存里的数据，该数据会马上同步回主内存，其他 CPU 通过<strong>总线嗅探机制</strong>可以感知到数据的变化，从而将自己缓存里的数据失效。</p>
<h2 id="Volatile-缓存可见性实现原理"><a href="#Volatile-缓存可见性实现原理" class="headerlink" title="Volatile 缓存可见性实现原理"></a>Volatile 缓存可见性实现原理</h2><p>底层实现主要是通过汇编 lock 前缀指令，它会锁定这块内存区域的缓存(缓存行锁定)，并回写到主内存。</p>
<p>IA-32 架构软件开发者手册对 lock 指令的解释：</p>
<ol>
<li>会将当前处理器缓存行的数据立即写回到系统内存。</li>
<li>这个写回内存的操作会引起其他 CPU 里缓存了该内存地址的数据无效(MESI协议)</li>
</ol>
<h3 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h3><h4 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h4><h4 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileVisibilityTest2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Thread[] threads = <span class="keyword">new</span> Thread[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            threads[i] = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                        increase();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">            thread.join();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：多次运行，结果都是小于等于 10000 的一个值。</p>
<p>解释：</p>
<p>当多个线程同时执行 assign，因为加了 volatile 此时这些线程会立即向主内存同步数据，但只会有一个线程成功执行 lock 操作，然后继续执行 store 操作，在进行 store 操作时，由于总线嗅探机制的存在，其他线程就会感知到，进而将其数据的状态置为失效状态，也就丢失了其之前的数据操作。故案例二中的 num 最终的结果是 &lt;= 20000。</p>
<p><img data-src="../post_image/volatile-visibility.jpg" alt=""></p>
<h2 id="Java-程序汇编代码查看"><a href="#Java-程序汇编代码查看" class="headerlink" title="Java 程序汇编代码查看"></a>Java 程序汇编代码查看</h2><blockquote>
<p><a href="https://cloud.tencent.com/developer/article/1082675" target="_blank" rel="noopener">学会一个JVM插件：使用HSDIS反汇编JIT生成的代码- 云+社区 …</a></p>
</blockquote>
<ol>
<li>下载 <code>hsdis-amd64.dylib</code> 插件，放到 jdk 的 jre/bin 目录下</li>
<li>IDEA 中配置 VM Options，并修改 jre 为上面包含了 <code>hsdis-amd64.dylib</code> 的。</li>
<li>然后运行程序即可在控制台中看到相应汇编代码。</li>
</ol>
<p>Edit Configuration &gt; VM Options:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-server -Xcomp -XX:+UnlockDiagnosticVMOptions -XX:+PrintAssembly -XX:CompileCommand&#x3D;compileonly,*VolatileVisibilityTest.prepareData</span><br></pre></td></tr></table></figure>

<h2 id="字节码文件"><a href="#字节码文件" class="headerlink" title="字节码文件"></a>字节码文件</h2><p>字节码文件中有两个字节表示实现的接口的个数，因此 <strong>Java 类可实现的接口最大个数</strong>为 65535。</p>
<h2 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><h4 id="系统级别"><a href="#系统级别" class="headerlink" title="系统级别"></a>系统级别</h4><ul>
<li>启动类加载器</li>
<li>扩展类加载器</li>
</ul>
<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><h2 id="substring"><a href="#substring" class="headerlink" title="substring"></a>substring</h2><blockquote>
<p><a href="http://hollischuang.gitee.io/tobetopjavaer/#/basics/java-basic/substring?id=jdk-6和jdk-7中substring的原理及区别" target="_blank" rel="noopener">JDK 6和JDK 7中 substring 的原理及区别</a></p>
</blockquote>
<h3 id="JDK-6-中的-substring"><a href="#JDK-6-中的-substring" class="headerlink" title="JDK 6 中的 substring"></a>JDK 6 中的 substring</h3><p>String 是通过字符数组实现的。在 jdk 6 中，String 类包含三个成员变量：<code>char value[]</code>， <code>int offset</code>，<code>int count</code>。他们分别用来存储真正的字符数组，数组的第一个位置索引以及字符串中包含的字符个数。</p>
<p>当调用 substring 方法的时候，会创建一个新的 string 对象，但是这个 string 的 value 值仍然指向堆中的<strong>同一个字符数组</strong>。这两个对象中只有 count 和 offset 的值是不同的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//JDK 6</span></span><br><span class="line">String(<span class="keyword">int</span> offset, <span class="keyword">int</span> count, <span class="keyword">char</span> value[]) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value;</span><br><span class="line">    <span class="keyword">this</span>.offset = offset;</span><br><span class="line">    <span class="keyword">this</span>.count = count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//check boundary</span></span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">new</span> String(offset + beginIndex, endIndex - beginIndex, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="JDK-6-中的-substring-导致的问题"><a href="#JDK-6-中的-substring-导致的问题" class="headerlink" title="JDK 6 中的 substring 导致的问题"></a>JDK 6 中的 substring 导致的问题</h4><p>如果你有一个很长很长的字符串，但是当你使用 substring 进行切割的时候你只需要很短的一段。这可能导致性能问题，因为你需要的只是一小段字符序列，但是你却引用了整个字符串（因为这个非常长的字符数组一直在被引用，所以无法被回收，就可能导致内存泄露）。一般用以下方式来解决该问题，原理其实就是生成一个新的字符串并引用他。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">x = x.substring(x, y) + <span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>关于 JDK 6 中 subString 的使用不当会导致内存泄漏已经被官方记录在 Java Bug Database 中：</p>
<p><img data-src="http://www.hollischuang.com/wp-content/uploads/2016/03/leak.png" alt="leak"></p>
<blockquote>
<p>内存泄露：在计算机科学中，内存泄漏指由于疏忽或错误造成程序未能释放已经不再使用的内存。内存泄漏并非指内存在物理上的消失，而是应用程序分配某段内存后，由于设计错误，导致在释放该段内存之前就失去了对该段内存的控制，从而造成了内存的浪费。</p>
</blockquote>
<h3 id="JDK-7-中的substring"><a href="#JDK-7-中的substring" class="headerlink" title="JDK 7 中的substring"></a>JDK 7 中的substring</h3><p>在 jdk 7 中，substring 方法会在堆内存中创建一个新的数组。</p>
<p><img data-src="http://www.programcreek.com/wp-content/uploads/2013/09/string-substring-jdk71-650x389.jpeg" alt="string-substring-jdk7"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//JDK 7</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[], <span class="keyword">int</span> offset, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//check boundary</span></span><br><span class="line">    <span class="keyword">this</span>.value = Arrays.copyOfRange(value, offset, offset + count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//check boundary</span></span><br><span class="line">    <span class="keyword">int</span> subLen = endIndex - beginIndex;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(value, beginIndex, subLen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JDK 7 中的 subString 方法，使用<code>Arrays.copyOfRange()</code>将旧字符串的字符数组中的字符选择性的 copy 到新字符串的字符数组中，避免对老字符串字符数组的引用。从而解决了内存泄露问题。</p>
<h2 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h2><h3 id="replaceFirst、replaceAll、replace-的区别"><a href="#replaceFirst、replaceAll、replace-的区别" class="headerlink" title="replaceFirst、replaceAll、replace 的区别"></a>replaceFirst、replaceAll、replace 的区别</h3><ul>
<li><p>replaceAll 以及 replaceFirst 是和正则表达式有关的，而 replace 和正则表达式无关。</p>
</li>
<li><p>replaceAll 替换所有匹配的字符，而 replaceFirst 仅替换第一次出现的字符</p>
</li>
</ul>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Summary of PAT</title>
    <url>/2019/02/15/Summary-of-PAT/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2019/01/11/5c3813443dce6.jpg" width="100%"/>

<a id="more"></a>

<h2 id="PAT总结"><a href="#PAT总结" class="headerlink" title="PAT总结"></a>PAT总结</h2><h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ul>
<li>输入使用<code>scanf</code>，输出使用<code>printf</code></li>
<li>题目要求 10^9 以内或者说 32 位整数，使用 int</li>
<li>题目要求 10^10 以内或者说 64 位整数，使用 double</li>
<li>浮点型数据使用 double 存储，不要用 float</li>
<li>小写字母的 ASCLL 码比大写字母的 ASCLL 码值 32</li>
<li>常量使用 const 方式定义，不要用<strong>宏定义</strong></li>
<li>无穷大的数 INF 设置为 <code>(1 &lt;&lt; 31) - 1</code></li>
<li>数组大小大于 10^6，则将其定义在主函数外面</li>
<li>只用 memset 函数给数组赋 0 或 -1，使用 fill 函数赋其他值</li>
</ul>
<h3 id="PAT-OJ-坑"><a href="#PAT-OJ-坑" class="headerlink" title="PAT OJ 坑"></a>PAT OJ 坑</h3><ul>
<li><p>PTA OJ 使用 <code>get()</code> 函数，C++ 会编译不通过，C 编译可以通过，但注意将头文件修改成 C 语言格式。</p>
<p>解决方法：</p>
<ol>
<li><p>使用 <code>scanf(&quot;%s&quot;, a)</code> 替代</p>
<p>sacanf() 无法接受带有空格的字符串。</p>
</li>
<li><p>使用 <code>fgets(char* a,int maxlens,stdin)</code> 替代</p>
<p>fgets 函数在<strong>未读取到我们要求的大小时</strong>（例如 maxlens=10，但只输入了3个字符），遇到换行符，那么读取到的数据就是： 已经读到的数据（遇到换行符前的数据）+ 换行符 + NULL，这会导致 strlen() 函数求得的长度比实际值多 1。</p>
</li>
</ol>
</li>
</ul>
<h3 id="C-C-语法"><a href="#C-C-语法" class="headerlink" title="C / C++ 语法"></a>C / C++ 语法</h3><h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><p><strong>四种基本数据类型</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大致范围</th>
</tr>
</thead>
<tbody><tr>
<td>int（long int）</td>
<td>-2 x 10^9 ~ 2 x 10^9</td>
</tr>
<tr>
<td>long long（long long int)</td>
<td>-9 x 10^18 ~ 9 x 10^18</td>
</tr>
<tr>
<td>float</td>
<td>实际精度 6 ~ 7 位</td>
</tr>
<tr>
<td>double</td>
<td>实际精度 15 ~ 16 位</td>
</tr>
<tr>
<td>char</td>
<td>-128 ~ 127</td>
</tr>
<tr>
<td>bool</td>
<td>0(false) or 1(true)</td>
</tr>
</tbody></table>
<p>long long 型赋大于 2^31 - 1 的初值时，需要在初值后面加上 LL</p>
<h4 id="格式符"><a href="#格式符" class="headerlink" title="格式符"></a>格式符</h4><p><strong>scanf 格式符</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>格式符</th>
</tr>
</thead>
<tbody><tr>
<td>int</td>
<td>%d</td>
</tr>
<tr>
<td>long long</td>
<td>%lld</td>
</tr>
<tr>
<td>folat</td>
<td>%f</td>
</tr>
<tr>
<td>double</td>
<td>%lf</td>
</tr>
<tr>
<td>char</td>
<td>%c</td>
</tr>
<tr>
<td>字符串（char 数组）</td>
<td>%s</td>
</tr>
</tbody></table>
<p>除了 <code>%s</code> 外，scanf 对其他格式符的输入是以空白符（空格、换行）为结束判断标志。</p>
<p><strong>printf 格式符</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>格式符</th>
</tr>
</thead>
<tbody><tr>
<td>int</td>
<td>%d</td>
</tr>
<tr>
<td>long long</td>
<td>%lld</td>
</tr>
<tr>
<td>folat</td>
<td>%f</td>
</tr>
<tr>
<td>double</td>
<td>%f（不是 %lf）</td>
</tr>
<tr>
<td>char</td>
<td>%c</td>
</tr>
<tr>
<td>字符串（char 数组）</td>
<td>%s</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>格式符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>%md</td>
<td>使不足 m 位的 int 型变量以 m 位进行右对齐输出，高位用<strong>空格</strong>补齐</td>
</tr>
<tr>
<td>%0md</td>
<td>类似<code>%md</code>，不过高位用 0 补齐</td>
</tr>
<tr>
<td>%.mf</td>
<td>浮点数保留 m 位小数，采用<strong>四舍六入五成双</strong>规则</td>
</tr>
</tbody></table>
<p><strong><em>想要输出 <code>%</code>,<code>\</code>需要在前面再加上一个<code>%</code>,<code>\</code></em></strong></p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p><strong>常用 math 函数</strong></p>
<p>使用时需要添加 <code>&lt;cmath</code> 头文件。</p>
<ol>
<li><p>绝对值：<code>fabs(double x)</code></p>
</li>
<li><p>取整：<code>floor(double x)</code>，<code>ceil(double x)</code></p>
</li>
<li><p>指数：<code>sqrt(double x)</code></p>
</li>
<li><p>对数：<code>log(double x)</code></p>
</li>
</ol>
<p>换底公式：<code>log(a, b) = log(e, b) / log(e, a)</code></p>
<ol start="5">
<li><p>三角：<code>sin(double x), cos(double x), tan(double x)</code></p>
</li>
<li><p>反三角：<code>asin(double x), acos(double x), atan(double x)</code></p>
</li>
<li><p>四舍五入：<code>round(double x)</code></p>
</li>
</ol>
<p><strong>memset</strong></p>
<p>使用时需要添加 <code>&lt;cstring&gt;</code> 头文件</p>
<p>对数组每个元素赋相同的值。</p>
<p><strong>常见 string 函数</strong></p>
<p>需要添加 <code>&lt;cstring&gt;</code> 头文件</p>
<ol>
<li><p>取长：<code>strlen()</code></p>
<p>strlen() 函数返回的类型是一个无符号整数类型，这就带来了一些需要<strong><em>注意的问题</em></strong>。</p>
<p>比如<br>1  <code>if( strlen(str1) &gt;= strlen(str2) )......</code><br>2  <code>if( strlen(str1) - strlen(str2) &gt;= 0)......</code></p>
<p>第一个 if 能够正常工作，但是第二个就不能了，因为 strlen() 的返回值是无符号整型值，所以 &gt;=  左边的整个式子的结果就是一个无符号整型值。也就是说第二个 if 的结果永远都为真（无符号数不可能大于0）。</p>
</li>
<li><p>比较：<code>strcmp()</code></p>
</li>
<li><p>复制：<code>strcpy()</code></p>
</li>
<li><p>拼接：<code>strcat()</code></p>
</li>
</ol>
<p>数组可以作为函数的参数，但<strong>不能作为返回值类型</strong></p>
<h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>数组大小必须是整数常量，不可以是变量</p>
<p>整型数组部分初始化后其余默认位 0，但如果都没有初始化，则每个元素都是一个随机数。</p>
<p>字符数组可以直接赋值字符串类初始化，但<strong>仅限于初始化</strong>，其他位置不允许。</p>
<h4 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h4><ul>
<li>指针就是变量的地址</li>
<li>指针是一个 unsigned 类型的整数</li>
<li><code>*</code> 一般放在变量前，但<strong>星号是类型的一部分</strong></li>
</ul>
<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><ul>
<li>引用不产生副本，而是给原变量<strong>起别名</strong></li>
<li>引用不是取地址。<code>&amp;</code> 只有在函数的参数列表中出现才叫<strong>引用</strong>，其余地方叫<strong>取址符</strong></li>
</ul>
<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><ul>
<li>访问结构体内的元素有两种方法：<code>.</code> 和 <code>-&gt;</code></li>
</ul>
<h4 id="浮点数的比较"><a href="#浮点数的比较" class="headerlink" title="浮点数的比较"></a>浮点数的比较</h4><p>精度 eps 一般取 10^-8</p>
<p><code>const double eps = 1e-8</code></p>
<ol>
<li>等于</li>
</ol>
<p><code>#define Equ(a, b) ((fabs((a) - (b))) &lt; (eps))</code></p>
<ol start="2">
<li>大于</li>
</ol>
<p><code>#define More(a, b) (((a) - (b)) &gt; (eps))</code></p>
<ol start="3">
<li>小于</li>
</ol>
<p><code>#define Less(a, b) (((a) - (b) &lt; (eps)))</code></p>
<ol start="4">
<li>大于等于</li>
</ol>
<p><code>#define MoreEqu(a, b) (((a) - (b) &gt; (-eps)))</code></p>
<ol start="5">
<li>小于等于</li>
</ol>
<p><code>#define LessEqu(a, b)(((a) - (b) &lt; (eps)))</code></p>
<h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><p><strong>时间复杂度</strong></p>
<p>O(1) &lt; O(logn) &lt; O(n) &lt; O(n^2)</p>
<p><strong>空间复杂度</strong></p>
<p>一般都够用，只要不开好几盒 10^7 以上的数组即可。</p>
<h3 id="评测结果"><a href="#评测结果" class="headerlink" title="评测结果"></a>评测结果</h3><h4 id="AC（Accepted-答案正确）"><a href="#AC（Accepted-答案正确）" class="headerlink" title="AC（Accepted 答案正确）"></a>AC（Accepted 答案正确）</h4><h4 id="CE（Compile-Eroor-编译错误）"><a href="#CE（Compile-Eroor-编译错误）" class="headerlink" title="CE（Compile Eroor 编译错误）"></a>CE（Compile Eroor 编译错误）</h4><h4 id="WA（Wrong-Answer-答案错误）"><a href="#WA（Wrong-Answer-答案错误）" class="headerlink" title="WA（Wrong Answer 答案错误）"></a>WA（Wrong Answer 答案错误）</h4><h4 id="TLE（Time-Limit-Exceeded-运行超时）"><a href="#TLE（Time-Limit-Exceeded-运行超时）" class="headerlink" title="TLE（Time Limit Exceeded 运行超时）"></a>TLE（Time Limit Exceeded 运行超时）</h4><ul>
<li>时间复杂度太高</li>
<li>死循环</li>
</ul>
<h4 id="RE（Runtime-Error-运行错误）"><a href="#RE（Runtime-Error-运行错误）" class="headerlink" title="RE（Runtime Error 运行错误）"></a>RE（Runtime Error 运行错误）</h4><ul>
<li>段错误</li>
<li>非法访问内存</li>
<li>数组越界</li>
<li>指针乱指</li>
<li>浮点错误</li>
<li>除数为 0</li>
<li>模数为 0</li>
<li>递归爆栈</li>
<li>递归层数太深</li>
</ul>
<h4 id="MLE（Memory-Limit-Exceeded-内存超限）"><a href="#MLE（Memory-Limit-Exceeded-内存超限）" class="headerlink" title="MLE（Memory Limit Exceeded 内存超限）"></a>MLE（Memory Limit Exceeded 内存超限）</h4><ul>
<li>数组太大</li>
</ul>
<h4 id="PE（Presentation-Error-格式错误）"><a href="#PE（Presentation-Error-格式错误）" class="headerlink" title="PE（Presentation Error 格式错误）"></a>PE（Presentation Error 格式错误）</h4><ul>
<li>空格</li>
<li>换行</li>
</ul>
<h4 id="OLE（Output-Limit-Exceeded-输出超限）"><a href="#OLE（Output-Limit-Exceeded-输出超限）" class="headerlink" title="OLE（Output Limit Exceeded 输出超限）"></a>OLE（Output Limit Exceeded 输出超限）</h4><ul>
<li>调试信息</li>
<li>死循环输出</li>
</ul>
]]></content>
      <categories>
        <category>PAT</category>
      </categories>
      <tags>
        <tag>PAT</tag>
      </tags>
  </entry>
  <entry>
    <title>Surfing Internet Scientifically</title>
    <url>/2020/03/03/Surfing-Internet-Scientifically/</url>
    <content><![CDATA[<img data-src="https://hyw-space-1253436760.cos.ap-shanghai.myqcloud.com/%E5%85%B6%E4%BB%96/xxx.jpg" width="100%"/>

<a id="more"></a>

<p>SSR-Android 无法使用扫描功能</p>
<blockquote>
<p><a href="https://github.com/shadowsocksrr/shadowsocksr-android/issues/182" target="_blank" rel="noopener">扫描二维码bug？#182</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>The Bast Practice of JWT</title>
    <url>/2019/12/02/The-Bast-Practice-of-JWT/</url>
    <content><![CDATA[<img data-src="https://www.wangbase.com/blogimg/asset/201807/bg2018072301.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://jwt.io/" target="_blank" rel="noopener">官网</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" target="_blank" rel="noopener">JSON Web Token 入门教程 | 阮一峰</a></p>
<p><a href="https://www.baeldung.com/java-json-web-tokens-jjwt" target="_blank" rel="noopener">Supercharge Java Authentication with JSON Web Tokens (JWTs)</a></p>
<p><a href="https://juejin.im/post/5ca162b36fb9a05e181de126#heading-4" target="_blank" rel="noopener">Spring Boot Security 整合 JWT 实现 无状态的分布式API接口</a></p>
</blockquote>
<h2 id="Java-中-JWT-的实现"><a href="#Java-中-JWT-的实现" class="headerlink" title="Java 中 JWT 的实现"></a>Java 中 JWT 的实现</h2><ul>
<li><a href="https://github.com/auth0/java-jwt" target="_blank" rel="noopener">java-jwt</a></li>
<li><a href="https://github.com/jwtk/jjwt" target="_blank" rel="noopener">jjwt</a></li>
</ul>
<h2 id="java-jwt"><a href="#java-jwt" class="headerlink" title="java-jwt"></a>java-jwt</h2><blockquote>
<p><a href="https://github.com/auth0/java-jwt" target="_blank" rel="noopener">java-jwt | GitHub</a></p>
<p><a href="http://www.hyhblog.cn/2017/10/21/json-web-token-intro-and-best-practices/" target="_blank" rel="noopener">Json Web Token的介绍和最佳实践</a></p>
<p><a href="https://juejin.im/post/5c8f50e35188252d9209588d#heading-10" target="_blank" rel="noopener">如何在SpringBoot中集成JWT(JSON Web Token)鉴权</a></p>
</blockquote>
<ol>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成 token</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY = <span class="string">"secret"</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Algorithm ALGORITHM = Algorithm.HMAC256(KEY);</span><br><span class="line">String token = JWT.create()</span><br><span class="line">  .withIssuer(<span class="string">"gzhennaxia"</span>) <span class="comment">// 签发人</span></span><br><span class="line">  .withSubject(userId) <span class="comment">// 主题，需要全局唯一</span></span><br><span class="line">  .sign(ALGORITHM);</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证 token</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JWTVerifier verifier = JWT.require(ALGORITHM).build();</span><br><span class="line">DecodedJWT decodedJWT = verifier.verify(token);</span><br></pre></td></tr></table></figure>

<p>DecodedJWT：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"algorithm"</span>:<span class="string">"HS256"</span>,</span><br><span class="line">    <span class="attr">"claims"</span>:&#123;</span><br><span class="line">        <span class="attr">"iss"</span>:&#123;</span><br><span class="line">            <span class="attr">"null"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"sub"</span>:&#123;</span><br><span class="line">            <span class="attr">"null"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"header"</span>:<span class="string">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9"</span>,</span><br><span class="line">    <span class="attr">"issuer"</span>:<span class="string">"gzhennaxia"</span>,</span><br><span class="line">    <span class="attr">"payload"</span>:<span class="string">"eyJzdWIiOiIxIiwiaXNzIjoiZ3poZW5uYXhpYSJ9"</span>,</span><br><span class="line">    <span class="attr">"signature"</span>:<span class="string">"ItL7KsvAp4Zezk5N5uu1ayAh2HlHU2EgIW3NiSZw1f8"</span>,</span><br><span class="line">    <span class="attr">"subject"</span>:<span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"token"</span>:<span class="string">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiaXNzIjoiZ3poZW5uYXhpYSJ9.ItL7KsvAp4Zezk5N5uu1ayAh2HlHU2EgIW3NiSZw1f8"</span>,</span><br><span class="line">    <span class="attr">"type"</span>:<span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="jjwt"><a href="#jjwt" class="headerlink" title="jjwt"></a>jjwt</h2><blockquote>
<p><a href="https://github.com/jwtk/jjwt" target="_blank" rel="noopener">jjwt | GitHub</a></p>
</blockquote>
<ol>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Uncomment this next dependency if you want to use RSASSA-PSS (PS256, PS384, PS512) algorithms:</span></span><br><span class="line"><span class="comment">&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">    &lt;artifactId&gt;bcprov-jdk15on&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">    &lt;version&gt;1.60&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;scope&gt;runtime&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">&lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成 token</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Key KEY = Keys.secretKeyFor(SignatureAlgorithm.HS256);</span><br><span class="line">Jwts.builder()</span><br><span class="line">  .setIssuer(<span class="string">"gzhennaxia"</span>)</span><br><span class="line">  .setSubject(userId.toString())</span><br><span class="line">  .signWith(KEY)</span><br><span class="line">  .compact();</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">token: eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnemhlbm5heGlhIiwic3ViIjoiMSJ9._Q0XHRhoS0a-ZA4pMzEmY2hShds86IrE5i4-XSj6sGI</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证 token</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Jwt jwt = Jwts.parser().setSigningKey(KEY).parse(token);</span><br></pre></td></tr></table></figure>

<p>Jwt：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"header"</span>:&#123;</span><br><span class="line">        <span class="attr">"alg"</span>:<span class="string">"HS256"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"body"</span>:&#123;</span><br><span class="line">        <span class="attr">"iss"</span>:<span class="string">"gzhennaxia"</span>,</span><br><span class="line">        <span class="attr">"sub"</span>:<span class="string">"1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"signature"</span>:<span class="string">"_Q0XHRhoS0a-ZA4pMzEmY2hShds86IrE5i4-XSj6sGI"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>JWT</category>
      </categories>
      <tags>
        <tag>JWT</tag>
      </tags>
  </entry>
  <entry>
    <title>Ticketing Arrangement</title>
    <url>/2019/12/24/Ticketing-Arrangement/</url>
    <content><![CDATA[<img data-src="http://cdn.feeyo.com/news/091126/09112611172657.jpg" width="100%"/>

<a id="more"></a>

<h2 id="深圳-西安"><a href="#深圳-西安" class="headerlink" title="深圳 - 西安"></a>深圳 - 西安</h2><table>
<thead>
<tr>
<th>车次</th>
<th>起始站</th>
<th>终点站</th>
<th>发车时间</th>
<th>到达时间</th>
<th>坐席</th>
<th>票价</th>
<th>状态</th>
<th>账号</th>
</tr>
</thead>
<tbody><tr>
<td>Z230</td>
<td>深圳</td>
<td>西安</td>
<td>2020-01-21 09:30</td>
<td>2020-1-21 09:22</td>
<td>硬卧</td>
<td>428</td>
<td>候补</td>
<td>杜方超</td>
</tr>
</tbody></table>
<h3 id="武昌-西安"><a href="#武昌-西安" class="headerlink" title="武昌 - 西安"></a>武昌 - 西安</h3><table>
<thead>
<tr>
<th>车次</th>
<th>起始站</th>
<th>终点站</th>
<th>发车时间</th>
<th>到达时间</th>
<th>坐席</th>
<th>票价</th>
<th>状态</th>
<th>账号</th>
</tr>
</thead>
<tbody><tr>
<td>Z230</td>
<td>武昌</td>
<td>西安</td>
<td>2020-01-19 09:30</td>
<td>2020-1-19 09:22</td>
<td>硬卧</td>
<td>247.5</td>
<td>候补</td>
<td>李静</td>
</tr>
</tbody></table>
<h3 id="广州-西安"><a href="#广州-西安" class="headerlink" title="广州 - 西安"></a>广州 - 西安</h3><table>
<thead>
<tr>
<th>车次</th>
<th>起始站</th>
<th>终点站</th>
<th>发车时间</th>
<th>到达时间</th>
<th>坐席</th>
<th>票价</th>
<th>状态</th>
<th>账号</th>
</tr>
</thead>
<tbody><tr>
<td>Z230</td>
<td>广州</td>
<td>西安</td>
<td>2020-01-19 11:17</td>
<td>2020-1-19 09:22</td>
<td>硬卧</td>
<td>428.0</td>
<td>候补</td>
<td>李佳雯</td>
</tr>
<tr>
<td>Z138</td>
<td>广州</td>
<td>西安</td>
<td>2020-01-19 08:32</td>
<td>2020-1-19 07:24</td>
<td>硬卧</td>
<td>428.0</td>
<td>候补</td>
<td>李佳雯</td>
</tr>
</tbody></table>
<h2 id="深圳-北京"><a href="#深圳-北京" class="headerlink" title="深圳 - 北京"></a>深圳 - 北京</h2><h3 id="深圳-长沙-train"><a href="#深圳-长沙-train" class="headerlink" title="深圳 - 长沙:train:"></a>深圳 - 长沙:train:</h3><table>
<thead>
<tr>
<th>车次</th>
<th>起始站</th>
<th>终点站</th>
<th>发车时间</th>
<th>到达时间</th>
<th>票价</th>
<th>起售时间</th>
<th>状态</th>
<th>账号</th>
</tr>
</thead>
<tbody><tr>
<td>K502</td>
<td>深圳</td>
<td>长沙</td>
<td>2020-01-24 05:26</td>
<td>2020-01-24 16:08</td>
<td>硬座： 112</td>
<td>9:30</td>
<td>停运</td>
<td></td>
</tr>
<tr>
<td>K1348</td>
<td>深圳</td>
<td>长沙</td>
<td>2020-01-24 08:10</td>
<td>2020-01-24 18:13</td>
<td>硬座：112</td>
<td></td>
<td><sapn style="color: green; font-weight: bolder;">已出票</span></td>
<td>谭文晗</td>
</tr>
</tbody></table>
<h3 id="长沙-北京-airplane"><a href="#长沙-北京-airplane" class="headerlink" title="长沙 - 北京:airplane:"></a>长沙 - 北京:airplane:</h3><table>
<thead>
<tr>
<th>航班</th>
<th>起飞时间</th>
<th>到达时间</th>
<th>票价</th>
<th>状态</th>
</tr>
</thead>
<tbody><tr>
<td><strong>海南航空</strong>HU7136</td>
<td><strong>2020-01-24 21:45</strong></td>
<td><strong>2020-01-24 23:55</strong></td>
<td>238 + 50</td>
<td><sapn style="color: green; font-weight: bolder;">已出票</span></td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Life</category>
      </categories>
      <tags>
        <tag>Life</tag>
      </tags>
  </entry>
  <entry>
    <title>Travel Strategy of Disney</title>
    <url>/2019/01/31/Travel-Strategy-of-Disney/</url>
    <content><![CDATA[<img data-src="https://images.shobserver.com/news/690_390/2017/1/6/bb24dcee-035d-4631-a293-544347aadd3d.jpeg" width="100%"/>

<a id="more"></a>

<h2 id="迪士尼攻略"><a href="#迪士尼攻略" class="headerlink" title="迪士尼攻略"></a>迪士尼攻略</h2><blockquote>
<p><a href="https://www.ly.com/travels/1037450.html" target="_blank" rel="noopener">2018年上海迪士尼攻略大全</a></p>
</blockquote>
<h3 id="交通"><a href="#交通" class="headerlink" title="交通"></a>交通</h3><p><a href="https://www.amap.com/dir?from%5Bid%5D=B0FFHGJ1YN-from&from%5Bname%5D=%E6%B1%89%E5%BA%AD%E9%85%92%E5%BA%97%E4%B8%8A%E6%B5%B7%E4%B8%AD%E7%8E%AF%E6%B2%AA%E5%8D%97%E8%B7%AF%E5%BA%97&from%5Blnglat%5D=121.562351%2C31.163604&from%5Bmodxy%5D=121.562517%2C31.16354&from%5Bpoitype%5D=100105&from%5Badcode%5D=310115&to%5Bname%5D=%E4%B8%8A%E6%B5%B7%E8%BF%AA%E5%A3%AB%E5%B0%BC%E5%BA%A6%E5%81%87%E5%8C%BA&to%5Blnglat%5D=121.661735%2C31.141333&to%5Bid%5D=B00157AW8O-to&to%5Bpoitype%5D=080501&to%5Badcode%5D=310000&to%5Bmodxy%5D=121.657565%2C31.139744&type=bus&policy=0&dateTime=now" target="_blank" rel="noopener">汉庭酒店(上海中环沪南路店) - 上海迪士尼景区</a></p>
<p><strong>地铁11号线</strong>（迪士尼方向）</p>
<h4 id="御桥-上车（7号口进）"><a href="#御桥-上车（7号口进）" class="headerlink" title="御桥   上车（7号口进）"></a><a href="javascript:void(0)">御桥 </a>  上车（7号口进）</h4><h4 id="迪士尼-下车（1号口出）"><a href="#迪士尼-下车（1号口出）" class="headerlink" title="迪士尼   下车（1号口出）"></a><a href="javascript:void(0)">迪士尼 </a>  下车（1号口出）</h4><p>上车站 首：06:55  末：23:25  约12分钟/趟 共4站</p>
<h3 id="门票"><a href="#门票" class="headerlink" title="门票"></a>门票</h3><blockquote>
<p><a href="https://www.shanghaidisneyresort.com/" target="_blank" rel="noopener">上海迪士尼度假区官方网站</a></p>
</blockquote>
<p>官网预订：可以通过上海迪士尼官网预订一日票或两日联票</p>
<p><img data-src="https://wx2.sinaimg.cn/large/005M2pcYgy1fzu5wewz5mj30ey07ujrs.jpg" alt="image"></p>
<p><img data-src="https://wx2.sinaimg.cn/large/005M2pcYgy1fzu5xh797zj30g1069t90.jpg" alt="image"></p>
<p><img data-src="https://wx3.sinaimg.cn/large/005M2pcYgy1fzu5yad7epj30f705zq38.jpg" alt="image"></p>
<h3 id="APP"><a href="#APP" class="headerlink" title="APP"></a>APP</h3><p>提前下载“迪士尼度假区”app，在园内一天的活动基本都要使用到这个app。入园时需携带购票者身份证，无需取票，直接刷身份证入园，需所有使用同一个身份证号购票的人一起入园。</p>
<p>取得纸质票后立即打开app选择“我的门票”扫描纸质票后面的二维码，可以关联多张门票建立游玩组，就可以一个人同时领取多人的快速通行证了。</p>
<p>1、领取快速通行证（免费）：相当于提前预约指定项目的一个时段游玩，在规定时间前往，无需排队，但数量有限，建议优先领取最想玩最难排队的项目（如飞跃地平线）。每两小时可以领取一次，比如9：30入园领取了一次，下一次在11:30可以领取，可不断领取直到所有项目的快速通行证领完。但如果手中的某个项目的快速通行证还未使用，再次领取时不得领取同一项目，只能领取不同项目。</p>
<p>FP就是是FAST PASS卡。在规定时间去玩这个项目可以不用排队</p>
<p>在上海迪士尼度假区官方App上领取迪士尼快速通行证：</p>
<pre><code>第一步：在您前往上海迪士尼度假区前，提前下载上海迪士尼度假区官方App，并使用您的手机号码或邮箱创建账户。

第二步：进入上海迪士尼乐园后，打开并登录上海迪士尼度假区官方App，点击“获取快速通行证”，扫描您乐园门票上的二维码 。

第三步：还可将同行伙伴的门票一同关联至您的账户，并创建游玩组，便捷为您游玩组内的所有成员领取同一景点、同一返回时间的快速通行证，与亲友同享奇妙乐趣。（需注意，游玩组内的每一位成员都须已进入乐园。）

第四步：选择想要游玩景点的快速通行证，无需支付额外费用。

第五步：确认您所选择的迪士尼快速通行证。

第六步：您可在指定返回时间回到景点的“迪士尼快速通行证入口”，扫描手机或乐园门票上的二维码，验证成功后，即可快速进入景点。</code></pre><p>2、查看各项目排队时间：app实时显示各项目排队时间，可以在想玩的项目中选择排队时间较短的项目优先游玩。</p>
<p>3、查看地图／定位位置：目前园区的游玩项目主要集中在“梦幻世界”“明日世界”“宝藏湾／探险岛”，今年夏天会建成开放一个新区域“玩具总动员”，园区比较大，app地图可以定位目前所在位置。且地图按“游玩设施”“餐饮”“洗手间”等分类，可以选择类别迅速寻找到自己所需。</p>
<h3 id="饮食"><a href="#饮食" class="headerlink" title="饮食"></a>饮食</h3><p>食品：由于迪士尼乐园规则调整，目前不准携带任何食物进园！无论是否开封</p>
<p>饮料：非酒精类可携带不超过600ml，可提前准备盒装牛奶、果汁带进去。园内有瓶装水、可乐等售卖，想喝热水的可以自带保温杯，园内的乐园餐厅都有热水提供。</p>
<p>爆米花价格在30元/桶起，矿泉水10元/瓶起</p>
<p>园区有多个寄存柜，可将物品临时寄存</p>
<h3 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h3><p>1、五星：飞跃地平线、创极速光轮</p>
<p>2、四星：加勒比海盗、七个小矮人矿山车、小飞侠天空奇遇、雷鸣山漂流（需雨衣，可提前网上购买，现场购买10元）</p>
<p>3、三星：古迹探索营的绳索挑战道、喷气背包飞行器、探险家独木舟</p>
<p>4、两星：巴斯光年星际营救、旋转木马、晶彩奇航  </p>
<p><strong>成人游玩路线推荐：入口——米奇大街——探险岛——宝藏湾——梦幻世界——明日世界——奇想花园</strong></p>
<p><strong>儿童游玩路线推荐：入口——米奇大街——奇想花园——梦幻世界——宝藏湾——探险套——明日世界</strong></p>
<p><strong>烟火</strong></p>
<p><strong>一定不要错过！诀窍：</strong></p>
<p><strong>大概5点就要在城堡下找座位，越近越好，然后耐心等着！一定占好座位！</strong></p>
<p><strong>否则，你肯定看不爽的，会后悔莫及！</strong></p>
<p><strong>占位:</strong></p>
<p><img data-src="https://pic3.zhimg.com/50/v2-cd669ec856e3dc8378fcc62b2f91926d_b.jpg" alt="img"></p>
<p><strong>大概在我标红圈的位置，视觉极佳，很震撼，别为了坐旋转木马耽误了。</strong></p>
<p><strong>完全没法比。</strong></p>
<p>作者：梦尧</p>
<p>链接：<a href="https://www.zhihu.com/question/42804614/answer/165982506" target="_blank" rel="noopener">https://www.zhihu.com/question/42804614/answer/165982506</a></p>
<p>来源：知乎</p>
<p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<h3 id="关于身高限制"><a href="#关于身高限制" class="headerlink" title="关于身高限制"></a>关于身高限制</h3><p>多大的娃可以逛迪士尼？我曾经在母婴室里碰到1个多月就被父母拖出来逛上海迪士尼的婴儿，那心也真是大了去了。但是，我们妹妹2岁了，哥哥6岁了，还是遇到了很多项目不能玩，那是因为很多项目都是有身高限制的，比如以下这些：</p>
<p>创极速光轮122cm</p>
<p>喷气背包飞行器112cm</p>
<p>雷鸣山漂流107cm</p>
<p>绳索挑战道（在古迹探索营）106cm</p>
<p>翱翔飞越地平线102cm</p>
<p>七个小矮人矿山车97cm</p>
<p>探险家独木舟要求游客乘坐独木舟时必须能够双脚着地</p>
<p>幻想曲旋转木马120cm或以上可以单独乘坐</p>
<p>你千万不要抱着侥幸心理让孩子先排队，以为排了几个小时队工作人员会同情你，开恩让你玩有身高限制的项目了。迪士尼的工作人员可是很认真负责的，我看到过好几次，排到最后关头，因为身高不够，被拦在外面呜呜哭的孩子。</p>
<p>至于上海迪士尼的大门票，1米以下儿童免票，所以1米以下的娃，趁着长高前赶紧去吧。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>不允许带自拍杆</li>
<li>一共有两道门。第一是检查包裹。 <a href="https://www.mafengwo.cn/travel-scenic-spot/mafengwo/11242.html" target="_blank" rel="noopener">开封</a> 的食物和600ml的饮料都不能带。快八点会打开第一道门。<br>进去后在第二道门前排队，大概八点半会开第二道门，进园区时刷身份证当场取票。</li>
</ul>
<h3 id="强烈建议"><a href="#强烈建议" class="headerlink" title="强烈建议"></a>强烈建议</h3><ul>
<li>老老实实排队争取第一批进园，<strong>你来晚了，什么攻略都没用</strong></li>
<li>9点半园区正式开门，这个时候要注意！！！（敲黑板！！）进入园区的第一件事不是抢FP，而是向右跑！！一定要拿出最快的速度，往飞跃地平线项目跑！这是景区快速游玩套路的重中之重！只要赶上了第一波飞跃地平线，那最后至少帮你节省两个半小时还帮你省下了一张FP！！！</li>
<li>景区快速游玩儿套路——逆时针玩法。先玩儿后面的，再玩儿前面的。这种玩儿法的精髓就是错开人流，出其不意。正常情况下玩儿完飞跃地平线要等待两个小时以上，但是如果一进园就先玩儿飞跃地平线的话能够大大的节省时间，事实证明，这种方法屡试不爽。</li>
<li>如果是地铁返程的话烟花秀一定不要看完，看到十分钟左右就可以了，然后跑着去地铁站。这个时候还是有座位的，如果等到看完了再去，成千上万的人拥挤不说，还要排无尽的队。</li>
<li>谨防黄牛党！！！</li>
</ul>
]]></content>
      <categories>
        <category>Strategy</category>
      </categories>
      <tags>
        <tag>Tour</tag>
      </tags>
  </entry>
  <entry>
    <title>Use JPA in Spring Boot</title>
    <url>/2019/01/07/Use-JPA-in-Spring-Boot/</url>
    <content><![CDATA[<img data-src="https://javadeveloperzone.com/wp-content/uploads/2018/02/Spring-boot-jpa-mysql-example-1024x488.jpg" width="100%"/>

<a id="more"></a>

<h2 id="什么是JPA"><a href="#什么是JPA" class="headerlink" title="什么是JPA"></a>什么是JPA</h2><p>​    JPA 的全称叫做 Java Persistence API，是一个基于 O/R 映射的标准<strong>规范</strong>。目前 JPA 的主要实现有Hibernate、EclipseLink、OpenJPA等，事实上，由于 Hibernate 在数据访问解决技术领域的绝对霸主地位，JPA的标准基本是由 Hibernate 来主导的。Spring 框架为我们提供了 Spring Data JPA，可以减少我们使用 JPA 时的代码量。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol>
<li><p><code>spring.jpa.show-sql=true</code>：日志中打印 SQL 语句。</p>
</li>
<li><p><code>spring.jpa.hibernate.ddl-auto=create</code>：配置实体类维护数据库表结构的具体行为。</p>
<ul>
<li>update：当实体类的属性发生变化时，表结构跟着更新。</li>
<li>create：启动的时候删除现有的表，并根据实体类重新生成表。</li>
<li>create-drop：启动时根据实体类生成表，但是当 sessionFactory 关闭的时候表会被删除。</li>
<li>validate：启动时验证实体类和数据表是否一致，不会创建新表，但是会插入新值。</li>
<li>none：什么都不做。</li>
</ul>
</li>
<li><p><code>spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect</code></p>
<p>在 SrpingBoot 2.0 版本中，Hibernate 创建数据表的时候，默认的数据库存储引擎选择的是 MyISAM 。这个参数是在建表的时候，将默认的存储引擎切换为 InnoDB 用的。</p>
</li>
<li><p><code>jpa.generate-ddl=true</code>：开启 DDL 功能。<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-database-initialization.html#howto-initialize-a-database-using-jpa" target="_blank" rel="noopener">Initialize a Database Using JPA</a></p>
</li>
</ol>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.1.0.RELEASE/api/" target="_blank" rel="noopener">Spring Data JPA 2.1.0.RELEASE API</a></p>
</blockquote>
<h3 id="原生SQL语句"><a href="#原生SQL语句" class="headerlink" title="原生SQL语句"></a>原生SQL语句</h3><ol>
<li>使用<code>@Query</code>注解</li>
<li>设置 nativeQuery 属性值为 true</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query</span>(value=<span class="string">"SELECT count(*) FROM user"</span>, nativeQuery=<span class="keyword">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getTotalRow</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="JPQL"><a href="#JPQL" class="headerlink" title="JPQL"></a>JPQL</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query</span>(<span class="string">"SELECT u FROM User u WHERE u.status = 1"</span>)</span><br><span class="line"><span class="function">Collection&lt;User&gt; <span class="title">findAllActiveUsers</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>JPQL 不支持使用 INSERT</strong></p>
<h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><blockquote>
<p><a href="https://www.jianshu.com/p/659e9715d01d" target="_blank" rel="noopener">【一目了然】Spring Data JPA使用Specification动态构建多表查询、复杂查询及排序示例</a></p>
</blockquote>
<ol>
<li><p>dao 层接口继承 <a href="https://docs.spring.io/spring-data/jpa/docs/2.1.0.RELEASE/api/org/springframework/data/jpa/repository/JpaSpecificationExecutor.html" target="_blank" rel="noopener">JpaSpecificationExecutor</a> 接口。</p>
</li>
<li><p>调用 <a href="https://docs.spring.io/spring-data/jpa/docs/2.1.0.RELEASE/api/org/springframework/data/jpa/repository/JpaSpecificationExecutor.html#findAll-org.springframework.data.jpa.domain.Specification-" target="_blank" rel="noopener">List<T> findAll(Specification<T> spec);</a></p>
</li>
<li><p>实现 <a href="https://docs.spring.io/spring-data/jpa/docs/2.1.0.RELEASE/api/org/springframework/data/jpa/domain/Specification.html" target="_blank" rel="noopener">Specification</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> root 根对象，即条件将被封装到该对象中。where 列名 = label.getXXX</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> query 查询关键字的封装。例如group by、order by等。几乎不用！</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> cb 用来封装条件对象。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 返回null代表没有任何条件</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>eg：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudent</span><span class="params">(String studentNumber,String name ,String nickName,</span></span></span><br><span class="line"><span class="function"><span class="params">            Date birthday,String courseName,<span class="keyword">float</span> chineseScore,<span class="keyword">float</span> mathScore,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">float</span> englishScore,<span class="keyword">float</span> performancePoints)</span> </span>&#123;</span><br><span class="line">    Specification&lt;Student&gt; specification = <span class="keyword">new</span> Specification&lt;Student&gt;()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Student&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//用于暂时存放查询条件的集合</span></span><br><span class="line">            List&lt;Predicate&gt; predicatesList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="comment">//--------------------------------------------</span></span><br><span class="line">            <span class="comment">//查询条件示例</span></span><br><span class="line">            <span class="comment">//equal示例</span></span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(name))&#123;</span><br><span class="line">                Predicate namePredicate = cb.equal(root.get(<span class="string">"name"</span>), name);</span><br><span class="line">                predicatesList.add(namePredicate);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//like示例</span></span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(nickName))&#123;</span><br><span class="line">                Predicate nickNamePredicate = cb.like(root.get(<span class="string">"nickName"</span>), <span class="string">'%'</span>+nickName+<span class="string">'%'</span>);</span><br><span class="line">                predicatesList.add(nickNamePredicate);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//between示例</span></span><br><span class="line">            <span class="keyword">if</span> (birthday != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Predicate birthdayPredicate = cb.between(root.get(<span class="string">"birthday"</span>), birthday, <span class="keyword">new</span> Date());</span><br><span class="line">                predicatesList.add(birthdayPredicate);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//关联表查询示例</span></span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(courseName)) &#123;</span><br><span class="line">                Join&lt;Student,Teacher&gt; joinTeacher = root.join(<span class="string">"teachers"</span>,JoinType.LEFT);</span><br><span class="line">                Predicate coursePredicate = cb.equal(joinTeacher.get(<span class="string">"courseName"</span>), courseName);</span><br><span class="line">                predicatesList.add(coursePredicate);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//复杂条件组合示例</span></span><br><span class="line">            <span class="keyword">if</span> (chineseScore!=<span class="number">0</span> &amp;&amp; mathScore!=<span class="number">0</span> &amp;&amp; englishScore!=<span class="number">0</span> &amp;&amp; performancePoints!=<span class="number">0</span>) &#123;</span><br><span class="line">                Join&lt;Student,Examination&gt; joinExam = root.join(<span class="string">"exams"</span>,JoinType.LEFT);</span><br><span class="line">                Predicate predicateExamChinese = cb.ge(joinExam.get(<span class="string">"chineseScore"</span>),chineseScore);</span><br><span class="line">                Predicate predicateExamMath = cb.ge(joinExam.get(<span class="string">"mathScore"</span>),mathScore);</span><br><span class="line">                Predicate predicateExamEnglish = cb.ge(joinExam.get(<span class="string">"englishScore"</span>),englishScore);</span><br><span class="line">                Predicate predicateExamPerformance = cb.ge(joinExam.get(<span class="string">"performancePoints"</span>),performancePoints);</span><br><span class="line">                <span class="comment">//组合</span></span><br><span class="line">                Predicate predicateExam = cb.or(predicateExamChinese,predicateExamEnglish,predicateExamMath);</span><br><span class="line">                Predicate predicateExamAll = cb.and(predicateExamPerformance,predicateExam);</span><br><span class="line">                predicatesList.add(predicateExamAll);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//--------------------------------------------</span></span><br><span class="line">            <span class="comment">//排序示例(先根据学号排序，后根据姓名排序)</span></span><br><span class="line">            query.orderBy(cb.asc(root.get(<span class="string">"studentNumber"</span>)),cb.asc(root.get(<span class="string">"name"</span>)));</span><br><span class="line">            <span class="comment">//--------------------------------------------</span></span><br><span class="line">            <span class="comment">//最终将查询条件拼好然后return</span></span><br><span class="line">            Predicate[] predicates = <span class="keyword">new</span> Predicate[predicatesList.size()];</span><br><span class="line">            <span class="keyword">return</span> cb.and(predicatesList.toArray(predicates));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> repository.findAll(specification);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<p>使用 <a href="https://link.jianshu.com/?t=https%3A%2F%2Fgithub.com%2Fwenhao%2Fjpa-spec" target="_blank" rel="noopener">jpa-spec</a> 能够减少一些代码量</p>
</blockquote>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><ol>
<li><p>dao 层接口继承 <code>JpaSpecificationExecutor</code>接口。</p>
</li>
<li><p>调用 <a href="https://docs.spring.io/spring-data/jpa/docs/2.1.0.RELEASE/api/org/springframework/data/jpa/repository/JpaSpecificationExecutor.html#findAll-org.springframework.data.jpa.domain.Specification-org.springframework.data.domain.Pageable-" target="_blank" rel="noopener">Page<T> findAll(@Nullable Specification<T> spec, Pageable pageable)</a></p>
</li>
<li><p>实现 <a href="https://docs.spring.io/spring-data/jpa/docs/2.1.0.RELEASE/api/org/springframework/data/jpa/domain/Specification.html" target="_blank" rel="noopener">Specification</a>，及 <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Pageable.html?is-external=true" target="_blank" rel="noopener">Pageable</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> root 根对象，即条件将被封装到该对象中。where 列名 = label.getXXX</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> query 查询关键字的封装。例如group by、order by等。几乎不用！</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> cb 用来封装条件对象。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> pageable 用来封装分页的对象。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 返回null代表没有任何条件</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;T&gt; <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb, Pageable pageable)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>eg：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;User&gt; <span class="title">selectAll</span><span class="params">(<span class="keyword">int</span> pageNum, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">    Pageable pageable = <span class="keyword">new</span> PageRequest(pageNum, pageSize);</span><br><span class="line">    Page&lt;User&gt; users = userRepository.findAll(<span class="keyword">new</span> Specification&lt;Student&gt;()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Student&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            List&lt;Predicate&gt; predicatesList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(name))&#123;</span><br><span class="line">                Predicate namePredicate = cb.equal(root.get(<span class="string">"name"</span>), name);</span><br><span class="line">                predicatesList.add(namePredicate);</span><br><span class="line">            &#125;</span><br><span class="line">            Predicate[] predicates = <span class="keyword">new</span> Predicate[predicatesList.size()];</span><br><span class="line">            <span class="keyword">return</span> cb.and(predicatesList.toArray(predicates));</span><br><span class="line">        &#125;, pageable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><blockquote>
<p><a href="https://blog.csdn.net/moshowgame/article/details/80090453" target="_blank" rel="noopener">JPA事务问题Executing an update/delete query</a></p>
<p><a href="https://blog.csdn.net/hanghangde/article/details/53241150" target="_blank" rel="noopener">用Spring boot jpa update modify delete 数据和事务管理的那些坑</a></p>
</blockquote>
<p>JPA 要求<strong>没有事务支持，不能执行更新和删除操作</strong>。默认情况下， SpringData 的每个方法上有事务， 但都是一个<strong>只读事务</strong>。</p>
<p>所以在 Service 层上必须加上事务注解<code>@Transactional</code>，如果没加则会报如下异常：<code>Executing an update/delete query</code></p>
<p><strong>@Modifyig</strong></p>
<p>在 @Query 注解中编写 JPQL 语句时，必须使用 @Modifying 进行修饰。以通知 SpringData，这是一个 UPDATE 或 DELETE 操作。同时需要在 service 层的方法上添加事务注解。</p>
]]></content>
      <categories>
        <category>JAVA</category>
        <category>Spring Boot</category>
        <category>Datasource</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
        <tag>JPA</tag>
      </tags>
  </entry>
  <entry>
    <title>Use Redis in Spring Boot</title>
    <url>/2019/01/18/Use-Redis-in-Spring-Boot/</url>
    <content><![CDATA[<img data-src="https://grokonez.com/wp-content/uploads/2017/12/spring-data-springjpa-crud-operation-redis-example-spring-boot-redis-example-feature-image.png" width="100%"/>

<a id="more"></a>

<h2 id="RedisTemplate"><a href="#RedisTemplate" class="headerlink" title="RedisTemplate"></a>RedisTemplate</h2><p>80% 都用的是 <code>opsForValue()</code></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>Spring Data</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Spring Data Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Use of Chrome</title>
    <url>/2018/12/15/Use-of-Chrome/</url>
    <content><![CDATA[<p><img data-src="https://images.pexels.com/photos/67112/pexels-photo-67112.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260" alt=""></p>
<a id="more"></a>

<blockquote>
<p>Windows 10 x64</p>
</blockquote>
<p>本文记录我使用Chrome的一些习惯</p>
<h2 id="Chrome快捷键"><a href="#Chrome快捷键" class="headerlink" title="Chrome快捷键"></a>Chrome快捷键</h2><blockquote>
<p><a href="https://support.google.com/chrome/answer/157179?hl=zh-Hans" target="_blank" rel="noopener">Chrome 键盘快捷键</a></p>
</blockquote>
<p>标签页和窗口快捷键</p>
<table>
<thead>
<tr>
<th><strong>操作</strong></th>
<th><strong>快捷键</strong></th>
</tr>
</thead>
<tbody><tr>
<td>打开新窗口</td>
<td><strong>Ctrl + n</strong></td>
</tr>
<tr>
<td>在无痕模式下打开新窗口</td>
<td><strong>Ctrl + Shift + n</strong></td>
</tr>
<tr>
<td>打开新的标签页，并跳转到该标签页</td>
<td><strong>Ctrl + t</strong></td>
</tr>
<tr>
<td>重新打开最后关闭的标签页，并跳转到该标签页</td>
<td><strong>Ctrl + Shift + t</strong></td>
</tr>
<tr>
<td>跳转到下一个打开的标签页</td>
<td><strong>Ctrl + Tab</strong> 或 <strong>Ctrl + PgDn</strong></td>
</tr>
<tr>
<td>跳转到上一个打开的标签页</td>
<td><strong>Ctrl + Shift + Tab</strong> 或 <strong>Ctrl + PgUp</strong></td>
</tr>
<tr>
<td>跳转到特定标签页</td>
<td><strong>Ctrl + 1</strong> 到 <strong>Ctrl + 8</strong></td>
</tr>
<tr>
<td>跳转到最后一个标签页</td>
<td><strong>Ctrl + 9</strong></td>
</tr>
<tr>
<td>在当前标签页中打开主页</td>
<td><strong>Alt + Home</strong></td>
</tr>
<tr>
<td>打开当前标签页浏览记录中记录的上一个页面</td>
<td><strong>Alt + 向左箭头键</strong></td>
</tr>
<tr>
<td>打开当前标签页浏览记录中记录的下一个页面</td>
<td><strong>Alt + 向右箭头键</strong></td>
</tr>
<tr>
<td>关闭当前标签页</td>
<td><strong>Ctrl + w</strong> 或 <strong>Ctrl + F4</strong></td>
</tr>
<tr>
<td>关闭当前窗口</td>
<td><strong>Ctrl + Shift + w</strong></td>
</tr>
<tr>
<td>最小化当前窗口</td>
<td><strong>Alt + 空格键 + n</strong></td>
</tr>
<tr>
<td>最大化当前窗口</td>
<td><strong>Alt + 空格键 + x</strong></td>
</tr>
<tr>
<td>关闭当前窗口</td>
<td><strong>Alt + F4</strong></td>
</tr>
<tr>
<td>退出 Google Chrome</td>
<td><strong>Ctrl + Shift + q</strong></td>
</tr>
</tbody></table>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><h3 id="vimium"><a href="#vimium" class="headerlink" title="vimium"></a>vimium</h3><blockquote>
<p>使用键盘流的方式操纵chrome</p>
</blockquote>
<h4 id="页面浏览"><a href="#页面浏览" class="headerlink" title="页面浏览"></a>页面浏览</h4><table>
<thead>
<tr>
<th>操作</th>
<th>快捷键</th>
</tr>
</thead>
<tbody><tr>
<td>复制当前URL到剪切板</td>
<td>yy</td>
</tr>
</tbody></table>
<h4 id="帮助文档"><a href="#帮助文档" class="headerlink" title="帮助文档"></a>帮助文档</h4><table>
<thead>
<tr>
<th>操作</th>
<th>快捷键</th>
</tr>
</thead>
<tbody><tr>
<td>打开帮助文档</td>
<td>?</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Chrome</category>
      </categories>
      <tags>
        <tag>Chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>Use-of-ElementUI</title>
    <url>/2019/07/31/Use-of-ElementUI/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2019/07/31/5d41178cb31bc93582.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://element.eleme.cn" target="_blank" rel="noopener">ElementUI</a></p>
</blockquote>
<h2 id="Scrollbar-滚动条"><a href="#Scrollbar-滚动条" class="headerlink" title="Scrollbar 滚动条"></a>Scrollbar 滚动条</h2><blockquote>
<p><a href="https://codepen.io/libo9527/pen/jgmYmb" target="_blank" rel="noopener">Demo code</a></p>
</blockquote>
<p><img data-src="https://i.loli.net/2019/07/31/5d4135303465a78467.png" alt="项目中的使用"></p>
<p>注：如果不需要横向滚动条，将 wrap 层的 <code>overflow-x</code> 置为 <code>hidden</code> 即可。</p>
<h2 id="ERROR"><a href="#ERROR" class="headerlink" title="ERROR"></a>ERROR</h2><h3 id="懒加载情况下无法添加一级结点"><a href="#懒加载情况下无法添加一级结点" class="headerlink" title="懒加载情况下无法添加一级结点"></a>懒加载情况下无法添加一级结点</h3><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p>懒加载情况下无法通过 append/insertBefore 等方法添加一级结点</p>
<h4 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">console_runner-1df7d3399bdc1f40995a35209755dcfd8c7547da127f6469fd81e5fba982f6af.js:1 [Vue warn]: Error in v-on handler: &quot;TypeError: Cannot read property &#39;indexOf&#39; of undefined&quot;</span><br><span class="line"></span><br><span class="line">found in</span><br><span class="line"></span><br><span class="line">---&gt; &lt;ElButton&gt; at packages&#x2F;button&#x2F;src&#x2F;button.vue</span><br><span class="line">       &lt;ElCard&gt; at packages&#x2F;card&#x2F;src&#x2F;main.vue</span><br><span class="line">         &lt;Root&gt;</span><br></pre></td></tr></table></figure>

<h4 id="CODE"><a href="#CODE" class="headerlink" title="CODE"></a>CODE</h4><iframe height="300" style="width: 100%;" scrolling="no" title="ElemnetUI Tree 添加顶级结点" src="//codepen.io/libo9527/embed/qBWyyYx/?height=265&theme-id=0&default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/libo9527/pen/qBWyyYx/' target="_blank" rel="noopener">ElemnetUI Tree 添加顶级结点</a> by libo9527
  (<a href='https://codepen.io/libo9527' target="_blank" rel="noopener">@libo9527</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>]]></content>
      <categories>
        <category>Front-end</category>
      </categories>
      <tags>
        <tag>ElementUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Use of IDEA</title>
    <url>/2019/01/05/Use-of-IDEA/</url>
    <content><![CDATA[<img data-src="https://www.paradigmadigital.com/wp-content/uploads/2017/08/intellijVSeclipse.jpg" width="100%"/>

<a id="more"></a>

<h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><h3 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h3><h4 id="批量替换空行"><a href="#批量替换空行" class="headerlink" title="批量替换空行"></a>批量替换空行</h4><p><code>Command+R</code> 打开替换窗口，搜索框中输入 <code>^\s*\n</code>，勾选 <code>Regex</code> 复选框后 Replace All</p>
<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><h3 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h3><blockquote>
<p><a href="https://blog.csdn.net/zhaoyayua/article/details/46548613" target="_blank" rel="noopener">IntelliJ IDEA 调整字体大小- 赱向远方- CSDN博客</a></p>
</blockquote>
<h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><blockquote>
<p><a href="https://blog.csdn.net/qq_30551211/article/details/51277444" target="_blank" rel="noopener">IDEA新建MAVEN项目时速度缓慢</a></p>
</blockquote>
<p>​    IDEA 根据 maven archetype 的本质，其实是执行 <code>mvn archetype:generate</code> 命令，该命令执行时，需要指定一个<code>archetype-catalog.xml</code>文件。</p>
<p>​    该命令的参数<code>-DarchetypeCatalog</code>，可选值为：remote，internal  ，local等，用来指定archetype-catalog.xml文件从哪里获取。默认为remote，即从 <a href="http://repo1.maven.org/maven2/archetype-catalog.xml" target="_blank" rel="noopener">http://repo1.maven.org/maven2/archetype-catalog.xml</a> 路径下载<code>archetype-catalog.xml</code>文件。<a href="http://repo1.maven.org/maven2/archetype-catalog.xml" target="_blank" rel="noopener">http://repo1.maven.org/maven2/archetype-catalog.xml</a> 文件约为3-4M，下载速度很慢，所以导致创建过程缓慢。</p>
<p>​    可以在 <code>settings&gt;Building,Exceptiong,Deployment&gt;Maven&gt;Runner</code> 中配置 <code>VM Options</code> 来指定使用本地文件。如下图所示：</p>
<p><img data-src="https://upload-images.jianshu.io/upload_images/130410-06580ab3367355e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<h2 id="推荐做法"><a href="#推荐做法" class="headerlink" title="推荐做法"></a>推荐做法</h2><ol>
<li>项目、模块等命名时，尽量使用下划线（避免用横杠）来连接多个单词。</li>
</ol>
<h2 id="Mac-OS-下"><a href="#Mac-OS-下" class="headerlink" title="Mac OS 下"></a>Mac OS 下</h2><h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h3><h4 id="快速跳转到文件头"><a href="#快速跳转到文件头" class="headerlink" title="快速跳转到文件头"></a>快速跳转到文件头</h4><p><code>fn + Command + ←</code></p>
<h4 id="快速跳转到文件尾"><a href="#快速跳转到文件尾" class="headerlink" title="快速跳转到文件尾"></a>快速跳转到文件尾</h4><p><code>fn + Command + →</code></p>
<h4 id="快速跳转到当前窗口头"><a href="#快速跳转到当前窗口头" class="headerlink" title="快速跳转到当前窗口头"></a>快速跳转到当前窗口头</h4><p><code>cn +Command + ↑</code></p>
<h4 id="快速跳转到当前窗口尾"><a href="#快速跳转到当前窗口尾" class="headerlink" title="快速跳转到当前窗口尾"></a>快速跳转到当前窗口尾</h4><p><code>fn + Command + ↓</code></p>
<h4 id="快速跳转到某行-列"><a href="#快速跳转到某行-列" class="headerlink" title="快速跳转到某行/列"></a>快速跳转到某行/列</h4><p><code>Command + L</code></p>
<h4 id="添加-MyBatis-的-XML-文件模版"><a href="#添加-MyBatis-的-XML-文件模版" class="headerlink" title="添加 MyBatis 的 XML 文件模版"></a>添加 MyBatis 的 XML 文件模版</h4><ol>
<li><p>Preference –&gt; Editor –&gt; File and Code Templates</p>
<p><img data-src="https://oscimg.oschina.net/oscnet/ea4ccc152ffe4c2ee0800aa8c9feaa61b7a.jpg" alt=""></p>
<p>模版内容：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建时选用 MybatisMapper 模版</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>Use of Markdown</title>
    <url>/2018/06/01/Use-of-Markdown/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2018/12/26/5c23262feb7b6.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p>Markdown 是一个 Web 上使用的文本到HTML的转换工具，可以通过简单、易读易写的文本格式生成结构化的HTML文档。目前 github、Stackoverflow 等网站均支持这种格式。——<a href="http://www.markdown.cn/" target="_blank" rel="noopener">Markdown</a></p>
</blockquote>
<h2 id="生成目录"><a href="#生成目录" class="headerlink" title="生成目录"></a>生成目录</h2><p>TOC：table of contents</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TOC]</span><br></pre></td></tr></table></figure>

<h2 id="修改图片尺寸"><a href="#修改图片尺寸" class="headerlink" title="修改图片尺寸"></a>修改图片尺寸</h2><blockquote>
<p><a href="https://support.typora.io/Resize-Image/" target="_blank" rel="noopener">Typora-Resize Images</a></p>
</blockquote>
<p>使用<code>img</code>标签指定图片样式，eg：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://www.google.com/doodles/kamma-rahbeks-241st-birthday"</span> <span class="attr">width</span>=<span class="string">"100%"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><blockquote>
<p><a href="http://xianbai.me/learn-md/article/extension/table.html" target="_blank" rel="noopener">表格</a></p>
</blockquote>
<h3 id="单元格和表头"><a href="#单元格和表头" class="headerlink" title="单元格和表头"></a>单元格和表头</h3><p>使用 <code>|</code> 来分隔不同的单元格，使用 <code>-</code> 来分隔表头和其他行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copy列名 | 列名</span><br><span class="line">--- | ---</span><br><span class="line">列值 | 列值</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">列名</th>
<th align="left">列名</th>
</tr>
</thead>
<tbody><tr>
<td align="left">列值</td>
<td align="left">列值</td>
</tr>
</tbody></table>
<h3 id="对齐方式"><a href="#对齐方式" class="headerlink" title="对齐方式"></a>对齐方式</h3><p>在表头下方的分隔线标记中加入 <code>:</code>，即可标记下方单元格内容的对齐方式：</p>
<ul>
<li><code>:---</code> 代表左对齐</li>
<li><code>:--:</code> 代表居中对齐</li>
<li><code>---:</code> 代表右对齐</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">copy| left | center | right |</span><br><span class="line">| :--- | :----: | ----: |</span><br><span class="line">| aaaa | bbbbbb | ccccc |</span><br><span class="line">| a    | b      | c     |</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">left</th>
<th align="center">center</th>
<th align="right">right</th>
</tr>
</thead>
<tbody><tr>
<td align="left">aaaa</td>
<td align="center">bbbbbb</td>
<td align="right">ccccc</td>
</tr>
<tr>
<td align="left">a</td>
<td align="center">b</td>
<td align="right">c</td>
</tr>
</tbody></table>
<h2 id="页面内跳转"><a href="#页面内跳转" class="headerlink" title="页面内跳转"></a>页面内跳转</h2><ol>
<li><p>页面内定义一个锚，及要跳转到的位置</p>
<p><code>&lt;span id=&quot;1&quot;&gt;XXX&lt;/span&gt;</code></p>
</li>
<li><p>使用如下格式定义链接即可</p>
<p><code>[跳转到XXX](#1)</code></p>
</li>
</ol>
]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Use of Microsoft Office</title>
    <url>/2019/01/08/Use-of-Microsoft-Office/</url>
    <content><![CDATA[<img data-src="https://www.salfordcommunityleisure.co.uk/sites/default/files/styles/page_width_standard/public/uploads/events/Microsoft%20Office%20%281%29%20edited%20for%20web.jpg?itok=SpDJ00oc" width="100%"/>

<a id="more"></a>

<h2 id="Online"><a href="#Online" class="headerlink" title="Online"></a>Online</h2><blockquote>
<p><a href="https://onedrive.live.com/" target="_blank" rel="noopener">OneDrive</a></p>
<p><a href="https://doc.weiyun.com/" target="_blank" rel="noopener">腾讯微云|文档</a></p>
</blockquote>
<h2 id="Excel"><a href="#Excel" class="headerlink" title="Excel"></a>Excel</h2><blockquote>
<p><a href="https://templates.office.com/zh-CN/%E6%AC%A2%E8%BF%8E%E4%BD%BF%E7%94%A8-Excel-TM10000137" target="_blank" rel="noopener">欢迎使用 Excel</a></p>
<p><a href="http://www.excelapi.net/" target="_blank" rel="noopener">Excel 网络函数库</a></p>
</blockquote>
<p><strong>换行</strong></p>
<p>ALT + 回车</p>
<p><strong>自动填充的间距</strong></p>
<blockquote>
<p><a href="https://zhidao.baidu.com/question/808141593749676452.html" target="_blank" rel="noopener">如何设置excel自动填充的间距</a></p>
</blockquote>
<p>1、先在前两个单元格中输入50、100；(日期时间等也适用)</p>
<p>2、选中这两个单元格，将鼠标指针放在其右下角的黑色标记处，当鼠标指针变为黑色十字形后，拖动鼠标进入自<br>动填充</p>
<p><strong>冻结窗格</strong></p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/%E5%86%BB%E7%BB%93%E7%AA%97%E6%A0%BC%E4%BB%A5%E9%94%81%E5%AE%9A%E8%A1%8C%E5%92%8C%E5%88%97-dab2ffc9-020d-4026-8121-67dd25f2508f" target="_blank" rel="noopener">冻结窗格以锁定行和列</a></p>
</blockquote>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p><strong>IFERROR</strong></p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/iferror-%E5%87%BD%E6%95%B0-c526fd07-caeb-47b8-8bb6-63f3e417f611" target="_blank" rel="noopener">IFERROR 函数</a></p>
</blockquote>
<p><strong>在公式中定义和使用名称</strong></p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/%E5%9C%A8%E5%85%AC%E5%BC%8F%E4%B8%AD%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8%E5%90%8D%E7%A7%B0-4d0f13ac-53b7-422e-afd2-abd7ff379c64" target="_blank" rel="noopener">在公式中定义和使用名称</a></p>
</blockquote>
<p><strong>MATCH</strong></p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/match-%E5%87%BD%E6%95%B0-e8dffd45-c762-47d6-bf89-533f4a37673a" target="_blank" rel="noopener">MATCH 函数</a></p>
</blockquote>
<p><strong>引用</strong></p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/%E5%9C%A8%E7%9B%B8%E5%AF%B9%E5%BC%95%E7%94%A8%E3%80%81%E7%BB%9D%E5%AF%B9%E5%BC%95%E7%94%A8%E5%92%8C%E6%B7%B7%E5%90%88%E5%BC%95%E7%94%A8%E9%97%B4%E5%88%87%E6%8D%A2-dfec08cd-ae65-4f56-839e-5f0d8d0baca9" target="_blank" rel="noopener">在相对引用、绝对引用和混合引用间切换</a></p>
</blockquote>
<p><strong>运算符</strong></p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/%E5%9C%A8-excel-%E5%85%AC%E5%BC%8F%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%AE%A1%E7%AE%97%E8%BF%90%E7%AE%97%E7%AC%A6-78be92ad-563c-4d62-b081-ae6da5c2ca69" target="_blank" rel="noopener">在 Excel 公式中使用计算运算符</a></p>
</blockquote>
<p><strong>LEFT、LEFTB</strong></p>
<blockquote>
<p><a href="https://support.office.com/zh-cn/article/left%E3%80%81leftb-%E5%87%BD%E6%95%B0-9203d2d2-7960-479b-84c6-1ea52b99640c" target="_blank" rel="noopener">LEFT、LEFTB 函数</a></p>
</blockquote>
<h2 id="Office-模板和主题"><a href="#Office-模板和主题" class="headerlink" title="Office 模板和主题"></a><a href="https://templates.office.com/" target="_blank" rel="noopener">Office 模板和主题</a></h2>]]></content>
      <categories>
        <category>Tools</category>
        <category>Office</category>
      </categories>
      <tags>
        <tag>Office</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Triggers in ORACLE</title>
    <url>/2019/09/17/Using-Triggers-in-ORACLE/</url>
    <content><![CDATA[<img data-src="https://i.ytimg.com/vi/R3fvX_xf5P4/maxresdefault.jpg" width="100%"/>

<a id="more"></a>

<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><blockquote>
<p><a href="https://docs.oracle.com/database/121/TDDDG/tdddg_triggers.htm#TDDDG50000" target="_blank" rel="noopener">Using Triggers | ORACLE</a></p>
<p>A <strong>trigger</strong> is a PL/SQL unit that is stored in the database and (if it is in the enabled state) automatically executes (“fires”) in response to a specified event.</p>
<p><a href="https://www.cnblogs.com/huyong/archive/2011/04/27/2030466.html" target="_blank" rel="noopener">ORACLE PL/SQL编程之八：把触发器说透</a></p>
</blockquote>
<p>触发器在数据库里以独立的对象存储，它与存储过程和函数不同的是，存储过程与函数需要用户显示调用才执行，而触发器是由一个事件来启动运行。即触发器是当某个事件发生时自动地隐式运行。并且，触发器不能接收参数。所以运行触发器就叫触发或点火（firing）。</p>
<p>ORACLE 事件指的是对数据库的表或视图进行的 INSERT、UPDATE 及 DELETE 操作。ORACLE将触发器的功能扩展到了触发 ORACLE，如数据库的启动与关闭等。</p>
<p>所以触发器常用来完成由数据库的完整性约束难以完成的复杂业务规则的约束，或用来监视对数据库的各种操作，实现审计的功能。 </p>
<h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><ul>
<li><p>触发事件</p>
<p>引起触发器被触发的事件。 例如：DML语句(INSERT, UPDATE, DELETE语句对表或视图执行数据处理操作)、DDL语句（如CREATE、ALTER、DROP语句在数据库中创建、修改、删除模式对象）、数据库系统事件（如系统启动或退出、异常错误）、用户事件（如登录或退出数据库）。</p>
</li>
<li><p>触发时间</p>
<p>即该 TRIGGER 是在触发事件发生之前（BEFORE）还是之后（AFTER）触发，也就是触发事件和该 TRIGGER 的操作顺序。</p>
</li>
<li><p>触发操作</p>
<p>即该 TRIGGER 被触发之后的目的和意图，正是触发器本身要做的事情。 例如：PL/SQL 块。</p>
</li>
<li><p>触发对象</p>
<p>包括表、视图、模式、数据库。只有在这些对象上发生了符合触发条件的触发事件，才会执行触发操作。</p>
</li>
<li><p>触发条件</p>
<p>由 WHEN 子句指定一个逻辑表达式。只有当该表达式的值为 TRUE 时，遇到触发事件才会自动执行触发器，使其执行触发操作。</p>
</li>
<li><p>触发频率</p>
<p>说明触发器内定义的动作被执行的次数。即语句级(STATEMENT)触发器和行级(ROW)触发器。</p>
</li>
</ul>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>根据<strong>触发频率</strong>分类：</p>
<ul>
<li><p>语句级(STATEMENT)触发器：</p>
<p>指当触发事件发生时，该触发器只执行一次；</p>
</li>
<li><p>行级(ROW)触发器：</p>
<p>指当触发事件发生时，对受到该操作影响的每一行数据，触发器都单独执行一次。</p>
</li>
</ul>
<p>根据<strong>触发事件类型</strong>分类：</p>
<ul>
<li><p>DML 触发器</p>
<p>ORACLE可以在DML语句进行触发，可以在DML操作前或操作后进行触发，并且可以对每个行或语句操作上进行触发。</p>
</li>
<li><p>替代触发器</p>
<p>由于在ORACLE里，不能直接对由两个以上的表建立的视图进行操作。所以给出了替代触发器。它就是ORACLE 8专门为进行视图操作的一种处理方法。 </p>
</li>
<li><p>系统触发器</p>
<p>ORACLE 8i 提供了第三种类型的触发器叫系统触发器。它可以在ORACLE数据库系统的事件中进行触发，如ORACLE系统的启动与关闭等。 </p>
</li>
</ul>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><blockquote>
<p><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_7004.htm" target="_blank" rel="noopener">CREATE TRIGGER | ORACLE</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">OR</span> <span class="keyword">REPLACE</span> ] <span class="keyword">TRIGGER</span> [ schema. ]<span class="keyword">trigger</span></span><br><span class="line">   &#123; <span class="keyword">BEFORE</span> | <span class="keyword">AFTER</span> | INSTEAD <span class="keyword">OF</span> &#125;</span><br><span class="line">   &#123; dml_event_clause</span><br><span class="line">   | &#123; ddl_event [ <span class="keyword">OR</span> ddl_event ]...</span><br><span class="line">     | database_event [ <span class="keyword">OR</span> database_event ]...</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">ON</span> &#123; [ schema. ]<span class="keyword">SCHEMA</span></span><br><span class="line">        | <span class="keyword">DATABASE</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   [ <span class="keyword">WHEN</span> (condition) ]</span><br><span class="line">   &#123; pl/sql_block | call_procedure_statement &#125; ;</span><br></pre></td></tr></table></figure>

<p>eg：</p>
<p>在给 CUSTOMER_RAW_TEST 表插入数据时自动执行 <code>UPDATE GLOBAL_LOCATION_TEST SET COLLECTED_QTY = COLLECTED_QTY + 1 ;</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">TRIGGER</span> Count_Collected_Qty </span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">INSERT</span>  </span><br><span class="line"><span class="keyword">ON</span> CUSTOMER_RAW_TEST</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">each</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">UPDATE</span> GLOBAL_LOCATION_TEST <span class="keyword">SET</span> COLLECTED_QTY = COLLECTED_QTY + <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ul>
<li><p>触发器不接受参数</p>
</li>
<li><p>一个表上最多可有12个触发器，但同一时间、同一事件、同一类型的触发器只能有一个。并各触发器之间不能有矛盾。</p>
</li>
<li><p>在一个表上的触发器越多，对在该表上的DML操作的性能影响就越大。</p>
</li>
<li><p>触发器最大为32KB。若确实需要，可以先建立过程，然后在触发器中用CALL语句进行调用。</p>
</li>
<li><p><strong>在触发器的执行部分只能用DML语句（SELECT、INSERT、UPDATE、DELETE），不能使用DDL语句（CREATE、ALTER、DROP）</strong></p>
</li>
<li><p>触发器中不能包含事务控制语句(COMMIT，ROLLBACK，SAVEPOINT)。因为触发器是触发语句的一部分，触发语句被提交、回退时，触发器也被提交、回退了。</p>
</li>
<li><p>在触发器主体中调用的任何过程、函数，都不能使用事务控制语句。</p>
</li>
<li><p>在触发器主体中不能申明任何 Long 和 blob 变量。新值 new 和旧值 old 也不能向表中的任何long和blob列。</p>
</li>
<li><p>不同类型的触发器(如DML触发器、INSTEAD OF触发器、系统触发器)的语法格式和作用有较大区别。 </p>
</li>
</ul>
<h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_triggers;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> object_name <span class="keyword">FROM</span> user_objects <span class="keyword">WHERE</span> object_type = <span class="string">'TRIGGER'</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> all_triggers <span class="keyword">WHERE</span> table_name = <span class="string">'CUSTOMER_RAW_TEST'</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_source <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'COUNT_COLLECTED_QTY'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> COUNT_COLLECTED_QTY;</span><br></pre></td></tr></table></figure>

<p>注：当删除表或视图时，建立在这些对象上的触发器也随之删除。 </p>
<h3 id="禁用-启用"><a href="#禁用-启用" class="headerlink" title="禁用/启用"></a>禁用/启用</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> TIGGER trigger_name [<span class="keyword">DISABLE</span> | <span class="keyword">ENABLE</span> ];</span><br></pre></td></tr></table></figure>

<p>ALTER TRIGGER 语句只能改变单个触发器的状态，而 ALTER TABLE 语句则能够改变与指定表相关的所有触发器的使用状态。格式为： </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [schema.]table_name &#123;<span class="keyword">ENABLE</span>|<span class="keyword">DISABLE</span>&#125; <span class="keyword">ALL</span> <span class="keyword">TRIGGERS</span>;</span><br></pre></td></tr></table></figure>

<h3 id="查看权限"><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> owner, object_name, object_type, <span class="keyword">status</span> <span class="keyword">FROM</span> dba_objects <span class="keyword">WHERE</span> object_name = <span class="string">'COUNT_COLLECTED_QTY'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="使用-Navicat-管理触发器"><a href="#使用-Navicat-管理触发器" class="headerlink" title="使用 Navicat 管理触发器"></a>使用 Navicat 管理触发器</h3><blockquote>
<p><a href="http://www.formysql.com/wenti/oracle-chufaqi.html" target="_blank" rel="noopener">浅谈 Navicat for Oracle 表触发器</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Trigger</category>
      </categories>
      <tags>
        <tag>Trigger</tag>
      </tags>
  </entry>
  <entry>
    <title>Week-based-year</title>
    <url>/2020/01/02/Week-based-Year/</url>
    <content><![CDATA[<div style="width: 100%; height: 796px; background-image: url(https://i.v2ex.co/785QLPbb.jpeg); background-repeat: no-repeat; background-position: 0 -180px"></div>
<a id="more"></a>

<blockquote>
<p><a href="https://v2ex.com/t/633650" target="_blank" rel="noopener">你今天因为 YYYY-MM-dd 被提 BUG 了吗</a></p>
<p><a href="https://nakedsecurity.sophos.com/2019/12/23/serious-security-the-decade-ending-y2k-bug-that-wasnt/" target="_blank" rel="noopener">Serious Security: The decade-ending “Y2K bug” that wasn’t</a></p>
</blockquote>
<h2 id="BUG-🐛"><a href="#BUG-🐛" class="headerlink" title="BUG 🐛"></a>BUG 🐛</h2><p>正确时间应为 <code>2019/12/29 02:33</code>，却错误的显示为 <code>2020/12/29 02:33</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gzhennaxia.admin.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bo li</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-01-02 17:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarefulWithThatDateEugene</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tryit</span><span class="params">(<span class="keyword">int</span> Y, <span class="keyword">int</span> M, <span class="keyword">int</span> D, String pat)</span> </span>&#123;</span><br><span class="line">        DateTimeFormatter fmt = DateTimeFormatter.ofPattern(pat);</span><br><span class="line">        LocalDate         dat = LocalDate.of(Y,M,D);</span><br><span class="line">        String            str = fmt.format(dat);</span><br><span class="line">        System.out.printf(<span class="string">"Y=%04d M=%02d D=%02d "</span> +</span><br><span class="line">                <span class="string">"formatted with "</span> +</span><br><span class="line">                <span class="string">"\"%s\" -&gt; %s\n"</span>,Y,M,D,pat,str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        tryit(<span class="number">2019</span>,<span class="number">12</span>,<span class="number">28</span>,<span class="string">"YYYY-MM-dd"</span>);</span><br><span class="line">        tryit(<span class="number">2019</span>,<span class="number">12</span>,<span class="number">29</span>,<span class="string">"YYYY-MM-dd"</span>);</span><br><span class="line">        tryit(<span class="number">2019</span>,<span class="number">12</span>,<span class="number">30</span>,<span class="string">"YYYY-MM-dd"</span>);</span><br><span class="line">        tryit(<span class="number">2019</span>,<span class="number">12</span>,<span class="number">31</span>,<span class="string">"YYYY-MM-dd"</span>);</span><br><span class="line">        tryit(<span class="number">2020</span>,<span class="number">01</span>,<span class="number">1</span>,<span class="string">"DD/MM/YYYY"</span>);</span><br><span class="line">        tryit(<span class="number">2020</span>,<span class="number">01</span>,<span class="number">2</span>,<span class="string">"YYYY-MM-DD"</span>);</span><br><span class="line">        tryit(<span class="number">2020</span>,<span class="number">01</span>,<span class="number">3</span>,<span class="string">"YYYY-MM-DD"</span>);</span><br><span class="line">        tryit(<span class="number">2020</span>,<span class="number">01</span>,<span class="number">4</span>,<span class="string">"YYYY-MM-DD"</span>);</span><br><span class="line">        tryit(<span class="number">2020</span>,<span class="number">01</span>,<span class="number">5</span>,<span class="string">"YYYY-MM-DD"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Y&#x3D;2019 M&#x3D;12 D&#x3D;28 formatted with &quot;YYYY-MM-dd&quot; -&gt; 2019-12-28</span><br><span class="line">Y&#x3D;2019 M&#x3D;12 D&#x3D;29 formatted with &quot;YYYY-MM-dd&quot; -&gt; 2020-12-29</span><br><span class="line">Y&#x3D;2019 M&#x3D;12 D&#x3D;30 formatted with &quot;YYYY-MM-dd&quot; -&gt; 2020-12-30</span><br><span class="line">Y&#x3D;2019 M&#x3D;12 D&#x3D;31 formatted with &quot;YYYY-MM-dd&quot; -&gt; 2020-12-31</span><br><span class="line">Y&#x3D;2020 M&#x3D;01 D&#x3D;01 formatted with &quot;DD&#x2F;MM&#x2F;YYYY&quot; -&gt; 01&#x2F;01&#x2F;2020</span><br><span class="line">Y&#x3D;2020 M&#x3D;01 D&#x3D;02 formatted with &quot;YYYY-MM-DD&quot; -&gt; 2020-01-02</span><br><span class="line">Y&#x3D;2020 M&#x3D;01 D&#x3D;03 formatted with &quot;YYYY-MM-DD&quot; -&gt; 2020-01-03</span><br><span class="line">Y&#x3D;2020 M&#x3D;01 D&#x3D;04 formatted with &quot;YYYY-MM-DD&quot; -&gt; 2020-01-04</span><br><span class="line">Y&#x3D;2020 M&#x3D;01 D&#x3D;05 formatted with &quot;YYYY-MM-DD&quot; -&gt; 2020-01-05</span><br></pre></td></tr></table></figure>

<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>Java 日期格式化时使用的<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#patterns" target="_blank" rel="noopener"><strong>模式字符串</strong></a>为 <code>YYYY/MM/dd HH:ss</code>！！！应该改为  <code>yyyy/MM/dd HH:ss</code>！！！</p>
<p>Java 1.8 中 <code>YYYY</code> 表示 <code>week-based-year</code>，意思是年份是基于周进行计算的，一年有 52 个周余 1/2 天，<code>week-based-year</code> 就是决定这多出来的一天或者两天所在的周应该属于哪一年的。</p>
<p>ISO-8601 规定：</p>
<ol>
<li>一周从周一到周日，即周一为每周的第一天</li>
<li>年末被拆分的周分配给天数占多数的年份，即哪个年份的天在这一周里居多，那么这一周就算是哪一年。</li>
</ol>
<p>回归问题，19 年年末 20 年年初的日期与周对应关系为：</p>
<p>|2019/12/29| 2019/12/30 | 2019/12/31 | 2020/01/01 | 2020/01/02 | 2020/01/03 | 2020/01/04 | 2020/01/05 |<br>| ———- | ———- | ———- | ———- | ———- | ———- | ———- |<br>|周天       | 周一       | 周二       | 周三       | 周四       | 周五       | 周六       | 周天       |</p>
<p>由于在这一周里 19 年有 2 天，20 年有 5 天，所以根据 ISO-8601 的规定，这一周是 2020 年的第一周，所以如果使用 <code>YYYY</code> 作为年份的模式字符串，那么转换后得到的年份结果将会是 2020。</p>
<p>但为什么 29 号是周日，不属于 2019 年的最后一周啊，为什么还是被转换成 2020 了呢，难道因为一周是从周日开始算的？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(Locale.getDefault());</span><br><span class="line">System.out.println(WeekFields.of(Locale.getDefault()).getFirstDayOfWeek());</span><br><span class="line"></span><br><span class="line"><span class="comment">// zh_CN</span></span><br><span class="line"><span class="comment">// SUNDAY</span></span><br></pre></td></tr></table></figure>

<p>结果真的是从周日开始算的！！！这是为什么呢？查了一下，Java 8中引入了新的日期 API。新的日期 API 是 JSR-310 规范的实现。但还没有找到具体哪里说了一周是从周日开始算的，但结果就是这样！！！</p>
<h3 id="YYYY-的意义"><a href="#YYYY-的意义" class="headerlink" title="YYYY 的意义"></a>YYYY 的意义</h3><blockquote>
<p><a href="https://nakedsecurity.sophos.com/2019/12/23/serious-security-the-decade-ending-y2k-bug-that-wasnt/" target="_blank" rel="noopener">Serious Security: The decade-ending “Y2K bug” that wasn’t</a></p>
<p>For accounting convenience, therefore, it s conventional to treat some years as having 52 full weeks, and others as having 53 weeks, which keeps things like weekly revenue plans and weekly payroll evened out in the long run.</p>
<p>因此，为了方便核算，通常将某些年份视为有52个完整的星期，而其他年份则视为有53个星期，这样从长远来看，就可以保持诸如每周收入计划和每周工资的平衡。</p>
</blockquote>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>平常日期格式化时使用的标准模式字符串为 <span style="background-color: rgba(27,31,35,.05);border-radius: 3px;font-size: 85%;margin: 0;padding: .2em 0 .2em .4em;">yyyy/MM/dd HH:</span><span style="background-color:rgba(27,31,35,.05);border-radius: 3px;font-size: 85%;margin: 0;padding: .2em .4em .2em 0;">mm:ss</span> (<strong>小大小大小小</strong>)</p>
]]></content>
      <categories>
        <category>JDK</category>
      </categories>
      <tags>
        <tag>JDK</tag>
      </tags>
  </entry>
  <entry>
    <title>Wget for windows</title>
    <url>/2018/12/24/Wget-for-windows/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2018/12/29/5c274920e1243.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/28826000" target="_blank" rel="noopener">Wget for windows——优雅地实现批量下载</a></p>
</blockquote>
<h1 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h1><ol>
<li>点击<a href="http://link.zhihu.com/?target=https%3A//eternallybored.org/misc/wget/">Windows binaries of GNU Wget</a>下载ZIP格式文件</li>
<li>加压到任意目录（如<code>D:/APPS/wget/</code>）</li>
</ol>
<h1 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h1><ol>
<li>使用快捷键<code>win+r</code>，输入<code>sysdm.cpl</code>，然后回车。</li>
<li>选择高级&gt;环境变量&gt;系统变量中选中<code>Path</code>&gt;编辑&gt;新建&gt;浏览&gt;找到对应目录（如<code>D:/APPS/wget/</code>）&gt;确定</li>
<li>控制台输入命令<code>wget -V</code>查看版本</li>
</ol>
]]></content>
      <categories>
        <category>Tools</category>
        <category>Download</category>
      </categories>
      <tags>
        <tag>Wget</tag>
      </tags>
  </entry>
  <entry>
    <title>What System I Wanted</title>
    <url>/2019/12/21/What-System-I-Wanted/</url>
    <content><![CDATA[<img data-src="https://www.churchofjesuschrist.org/youth/bc/youth/article/powerful-ways-to-control-your-thoughts/images/control-my-thoughts-700x363-2115883.jpg" width="100%"/>

<a id="more"></a>

<h2 id="记账系统"><a href="#记账系统" class="headerlink" title="记账系统"></a><a href="https://gitee.com/libo9527/ledger/blob/master/README.md" target="_blank" rel="noopener">记账系统</a></h2><h2 id="火车中转攻略"><a href="#火车中转攻略" class="headerlink" title="火车中转攻略"></a>火车中转攻略</h2><ol>
<li>查看城市 A 到城市 B 的火车中转方案</li>
<li>用户可自定义中转城市</li>
<li>用户可自定义中转次数</li>
<li>多种线路进行打分</li>
<li>打分依据有价格、转乘次数等</li>
</ol>
<h2 id="习惯养成"><a href="#习惯养成" class="headerlink" title="习惯养成"></a>习惯养成</h2><ol>
<li>制定一个习惯的养成计划</li>
<li>缴纳一笔金钱进系统，没有按计划进行实施则不可提取。</li>
<li>想要违规提取只有一个办法，就是注销账号。但注销后将被记入黑名单，不可再次注册。</li>
<li>缴纳的金额会被存入银行，按一定利息存放。</li>
<li>阶段性返还金额，达到某个里程碑就返还一定金额</li>
<li>未能按计划达到标准，则按一定比例推迟金额返还时间。</li>
</ol>
]]></content>
      <categories>
        <category>Thoughts</category>
      </categories>
      <tags>
        <tag>Thoughts</tag>
      </tags>
  </entry>
  <entry>
    <title>What is CORS</title>
    <url>/2019/12/10/What-is-CORS/</url>
    <content><![CDATA[<img data-src="https://geekflare.com/wp-content/uploads/2019/11/cors-1200x385.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><strong>跨域资源共享</strong>（Cross-origin resource sharing，简称CORS），用于让网页的受限资源能够被其他<a href="https://zh.wikipedia.org/wiki/域名" target="_blank" rel="noopener">域名</a>的页面访问的一种机制。通过该机制，页面能够自由地使用不同域名（cross-origin）的图片、样式、脚本、iframes以及视频。 ——<a href="https://zh.wikipedia.org/zh-hans/跨來源資源共享" target="_blank" rel="noopener">维基百科</a></p>
<p><a href="https://developer.mozilla.org/zh/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">HTTP访问控制（CORS） - HTTP | MDN</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">跨域资源共享CORS 详解- 阮一峰的网络日志</a></p>
<p><a href="http://blog.jiayuanzhang.com/post/cors-tutorial/" target="_blank" rel="noopener">跨域资源共享（CORS）详解</a></p>
</blockquote>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><h3 id="简单请求和非简单请求"><a href="#简单请求和非简单请求" class="headerlink" title="简单请求和非简单请求"></a>简单请求和非简单请求</h3><p>只要同时满足以下两大条件，就属于简单请求：</p>
<p>（1）请求方法是以下三种方法之一：</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<p>（2）HTTP的头信息不超出以下几种字段：</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code></li>
</ul>
<h2 id="Spring-项目中配置-CORS"><a href="#Spring-项目中配置-CORS" class="headerlink" title="Spring 项目中配置 CORS"></a>Spring 项目中配置 CORS</h2><blockquote>
<p><a href="https://link.jianshu.com/?t=http://spring.io/guides/gs/rest-service-cors/" target="_blank" rel="noopener">Enabling Cross Origin Requests for a RESTful Web Service | Spring</a></p>
<p><a href="https://spring.io/blog/2015/06/08/cors-support-in-spring-framework" target="_blank" rel="noopener">CORS support in Spring Framework | Spring</a></p>
</blockquote>
<h3 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 使用过滤器注册器注册</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterRegisterConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">filterRegisterBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FilterRegistrationBean&lt;CorsFilter&gt; registrationBean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line">        registrationBean.setFilter(<span class="keyword">new</span> CorsFilter());</span><br><span class="line">        registrationBean.setUrlPatterns(<span class="keyword">new</span> ArrayList&lt;String&gt;() &#123;&#123; add(<span class="string">"*"</span>); &#125;&#125;);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//2. 使用 @WebFilter 注解</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@WebFilter</span>(urlPatterns = <span class="string">"*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"http://localhost:9528"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Max-Age"</span>, <span class="string">"10"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"*"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"*"</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>Access-Control-Allow-Methods</strong></p>
<p>该字段必需，它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的请求类型。</p>
</li>
<li><p><strong>Access-Control-Allow-Headers</strong></p>
<p>如果浏览器请求包括<code>Access-Control-Request-Headers</code>字段，则<code>Access-Control-Allow-Headers</code>字段是必需的。它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在”预检”中请求的字段。</p>
</li>
<li><p><strong>Access-Control-Max-Age</strong></p>
<p>该字段可选，用来指定本次预检请求的有效期，单位为秒。上面结果中，有效期是 10秒，即允许缓存该条回应 10 秒，在此期间，不用发出另一条预检请求。</p>
<p>注意：如果设置缓存后，发现每次还是会发送 OPTIONS 请求，请检查是不是勾选了“禁止缓存”。</p>
<p><img data-src="https://www.technipages.com/wp-content/uploads/2016/05/Chrome-Disable-Cache.png" alt=""></p>
</li>
</ul>
<h3 id="注解-CrossOrigin"><a href="#注解-CrossOrigin" class="headerlink" title="注解 @CrossOrigin"></a>注解 <code>@CrossOrigin</code></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 当前 Controller 中所有的方法接受跨域访问</span></span><br><span class="line">@CrossOrigin(origins = <span class="string">"http://localhost:9528"</span>, maxAge = <span class="number">10</span>)</span><br><span class="line">@RestController</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CorsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @PostMapping(<span class="string">"cors"</span>)</span><br><span class="line">    public <span class="built_in">String</span> cors() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 仅 /cors 可以接受跨域访问</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsController</span> </span>&#123;</span><br><span class="line">		<span class="meta">@CrossOrigin</span>(origins = <span class="string">"http://localhost:9528"</span>, maxAge = <span class="number">10</span>)</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"cors"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cors"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"cors2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">cors2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"cors2"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现-WebMvcConfigurer-接口"><a href="#实现-WebMvcConfigurer-接口" class="headerlink" title="实现 WebMvcConfigurer 接口"></a>实现 WebMvcConfigurer 接口</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfigurerImpl</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">      	<span class="comment">// Error: registry.addMapping("*")</span></span><br><span class="line">        registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">"http://localhost:9528"</span>)</span><br><span class="line">                .allowedMethods(<span class="string">"*"</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">"*"</span>)</span><br><span class="line">                .maxAge(<span class="number">10L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Actuator-项目可使用-application-properties-来配置"><a href="#Spring-Actuator-项目可使用-application-properties-来配置" class="headerlink" title="Spring Actuator 项目可使用 application.properties 来配置"></a>Spring Actuator 项目可使用 application.properties 来配置</h3><blockquote>
<p><a href="https://stackoverflow.com/questions/42874351/spring-boot-enabling-cors-by-application-properties" target="_blank" rel="noopener">Spring Boot enabling CORS by application.properties</a></p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">endpoints.cors.allowed-origins</span>=<span class="string">http://localhost:9528</span></span><br><span class="line"><span class="meta">endpoints.cors.allowed-methods</span>=<span class="string">*</span></span><br><span class="line"><span class="meta">endpoints.cors.allowed-headers</span>=<span class="string">*</span></span><br><span class="line"><span class="meta">endpoints.cors.max-age</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>

<h2 id="Spring-Security-项目中配置-CORS"><a href="#Spring-Security-项目中配置-CORS" class="headerlink" title="Spring Security 项目中配置 CORS"></a>Spring Security 项目中配置 CORS</h2><blockquote>
<p><a href="https://docs.spring.io/spring-security/site/docs/4.2.x/reference/html/cors.html" target="_blank" rel="noopener">CORS | Spring Security</a></p>
<p><a href="https://stackoverflow.com/questions/40418441/spring-security-cors-filter" target="_blank" rel="noopener">Spring security CORS Filter | Stack Overflow</a></p>
<p><a href="http://www.jetchen.cn/spring-security-cors/" target="_blank" rel="noopener">Spring Security 环境下 CORS 跨域失效问题</a></p>
<p><a href="http://www.saily.top/2016/12/29/spring-security-cors/" target="_blank" rel="noopener">Spring Security配置cors跨域访问</a></p>
<p><a href="https://www.jianshu.com/p/87e1ef68794c" target="_blank" rel="noopener">CORS with Spring Boot and Spring Security</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// by default uses a Bean by the name of corsConfigurationSource</span></span><br><span class="line">        http.cors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">CorsConfigurationSource <span class="title">corsConfigurationSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CorsConfiguration configuration = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        configuration.setAllowedOrigins(Arrays.asList(<span class="string">"http://localhost:9528"</span>));</span><br><span class="line">        configuration.setAllowedMethods(Arrays.asList(<span class="string">"*"</span>));</span><br><span class="line">        configuration.setAllowedHeaders(Arrays.asList(<span class="string">"*"</span>));</span><br><span class="line">        configuration.setMaxAge(<span class="number">10L</span>);</span><br><span class="line">        UrlBasedCorsConfigurationSource source = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">"/**"</span>, configuration);</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>What is CSRF</title>
    <url>/2019/12/10/What-is-CSRF/</url>
    <content><![CDATA[<img data-src="https://dpsvdv74uwwos.cloudfront.net/statics/img/ogimage/csrf-cross-site-request-forgery.jpg" width="100%"/>

<a id="more"></a>

<blockquote>
<p><strong>跨站请求伪造</strong>（英语：Cross-site request forgery），也被称为 <strong>one-click attack</strong> 或者 <strong>session riding</strong>，通常缩写为 <strong>CSRF</strong> 或者 <strong>XSRF</strong>， 是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。<a href="https://zh.wikipedia.org/wiki/跨站请求伪造#cite_note-Ristic-1" target="_blank" rel="noopener">[1]</a> 跟<a href="https://zh.wikipedia.org/wiki/跨網站指令碼" target="_blank" rel="noopener">跨网站脚本</a>（XSS）相比，<strong>XSS</strong> 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。 ——<a href="https://zh.wikipedia.org/zh/跨站请求伪造" target="_blank" rel="noopener">维基百科</a></p>
<p><a href="https://blog.techbridge.cc/2017/02/25/csrf-introduction/" target="_blank" rel="noopener">讓我們來談談CSRF - TechBridge 技術共筆部落格</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Attack</category>
      </categories>
      <tags>
        <tag>Attack</tag>
      </tags>
  </entry>
  <entry>
    <title>World Cup Mini Programe</title>
    <url>/2018/06/06/World-Cup-Mini-Programe/</url>
    <content><![CDATA[<p>[TOC]</p>
<h1 id="原型设计"><a href="#原型设计" class="headerlink" title="原型设计"></a>原型设计</h1><blockquote>
<p><a href="http://pro.modao.cc/app/yNV6IjXGdgKjzuzbWWoCESKpAsUV3a1#screen=sACD9810F7B1527599208486" target="_blank" rel="noopener">世界杯</a></p>
</blockquote>
<h1 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h1><blockquote>
<p><a href="http://gz-dmc.cloud.tencent.com/v2/login" target="_blank" rel="noopener">数据库</a></p>
</blockquote>
<h2 id="用户表"><a href="#用户表" class="headerlink" title="用户表"></a>用户表</h2><p>表名：my_user</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>用户自增id</td>
</tr>
<tr>
<td>open_id</td>
<td>varchar(100)</td>
<td>用户在小程序中的唯一识别id</td>
</tr>
<tr>
<td>union_id</td>
<td>varchar(100)</td>
<td>用户在同一主体的多个小程序中的唯一识别id</td>
</tr>
<tr>
<td>nick_name</td>
<td>varchar(50)</td>
<td>用户昵称，由于用户的昵称中可能包含表情，所以要用UTF8MB4编码</td>
</tr>
<tr>
<td>head_img_url</td>
<td>varchar(255)</td>
<td>用户头像地址</td>
</tr>
<tr>
<td>gender</td>
<td>enum</td>
<td>性别(1：男，2：女)</td>
</tr>
<tr>
<td>source</td>
<td>tinyint</td>
<td>用户来源，从分享进来或者直接搜索等</td>
</tr>
<tr>
<td>region</td>
<td>varchar</td>
<td>用户所在地区</td>
</tr>
<tr>
<td>first_login_time</td>
<td>timestamp</td>
<td>用户第一次登录的时间</td>
</tr>
<tr>
<td>last_login_time</td>
<td>timestamp</td>
<td>用户最后一次登录时间</td>
</tr>
<tr>
<td>collection_count</td>
<td>int</td>
<td>今日集球衣的次数</td>
</tr>
<tr>
<td>collection_shirts</td>
<td>varchar(255)</td>
<td>今日可收集的候选集合（球队名之间用”_”连接）</td>
</tr>
</tbody></table>
<h2 id="海报表"><a href="#海报表" class="headerlink" title="海报表"></a>海报表</h2><p>表名：poster</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>海报自增id</td>
</tr>
<tr>
<td>template_id</td>
<td>int</td>
<td>模板id</td>
</tr>
<tr>
<td>team_name</td>
<td>varchar(50)</td>
<td>球队名</td>
</tr>
<tr>
<td>music_url</td>
<td>varchar(255)</td>
<td>海报背景音乐的链接地址</td>
</tr>
<tr>
<td>slogan_id</td>
<td>int</td>
<td>标语id</td>
</tr>
<tr>
<td>poster_url</td>
<td>varchar(255)</td>
<td>生成后的海报图片链接地址</td>
</tr>
</tbody></table>
<h2 id="模板表"><a href="#模板表" class="headerlink" title="模板表"></a>模板表</h2><p>表名：template</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>模板自增id</td>
</tr>
<tr>
<td>template_url</td>
<td>varchar(255)</td>
<td>模板图片的链接地址</td>
</tr>
<tr>
<td>music_url</td>
<td>varchar(255)</td>
<td>海报背景音乐链接地址</td>
</tr>
</tbody></table>
<h2 id="加油词表"><a href="#加油词表" class="headerlink" title="加油词表"></a>加油词表</h2><p>表名：slogan</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>标语自增id</td>
</tr>
<tr>
<td>content</td>
<td>varchar(100)</td>
<td>标语内容</td>
</tr>
</tbody></table>
<h2 id="音乐表"><a href="#音乐表" class="headerlink" title="音乐表"></a><del>音乐表</del></h2><p>表名：music</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>音乐自增id</td>
</tr>
<tr>
<td>music_url</td>
<td>varchar(255)</td>
<td>音乐链接地址</td>
</tr>
</tbody></table>
<h2 id="球队表"><a href="#球队表" class="headerlink" title="球队表"></a><del>球队表</del></h2><p>表名：team</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>球队自增id</td>
</tr>
<tr>
<td>name</td>
<td>varchar(50)</td>
<td>球队名</td>
</tr>
</tbody></table>
<h2 id="赛程表"><a href="#赛程表" class="headerlink" title="赛程表"></a>赛程表</h2><p>表名：match_schedule</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>赛程自增id</td>
</tr>
<tr>
<td>match_type</td>
<td>varchar(10)</td>
<td>比赛类型</td>
</tr>
<tr>
<td>group</td>
<td>varchar(10)</td>
<td>分组情况</td>
</tr>
<tr>
<td>home_team</td>
<td>varchar(10)</td>
<td>主队</td>
</tr>
<tr>
<td>away_team</td>
<td>varchar(10)</td>
<td>客队</td>
</tr>
<tr>
<td>begin_time</td>
<td>timestamp</td>
<td>比赛开始时间</td>
</tr>
<tr>
<td>state</td>
<td>int</td>
<td>比赛状态（0：未开始；1：已开始；2：已结束）</td>
</tr>
</tbody></table>
<h2 id="预约表"><a href="#预约表" class="headerlink" title="预约表"></a>预约表</h2><p>表名：subscribe</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>u_id</td>
<td>int</td>
<td>用户id</td>
</tr>
<tr>
<td>m_id</td>
<td>int</td>
<td>赛程id</td>
</tr>
</tbody></table>
<h2 id="球衣表"><a href="#球衣表" class="headerlink" title="球衣表"></a><del>球衣表</del></h2><p>表名：polo_shirt</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>球衣自增id</td>
</tr>
<tr>
<td>team_name</td>
<td>varchar(50)</td>
<td>所属球队名称</td>
</tr>
<tr>
<td>repertory</td>
<td>int</td>
<td>库存</td>
</tr>
<tr>
<td>probability</td>
<td>double</td>
<td>概率</td>
</tr>
<tr>
<td></td>
<td>String</td>
<td>注释</td>
</tr>
</tbody></table>
<h2 id="球衣收集记录表"><a href="#球衣收集记录表" class="headerlink" title="球衣收集记录表"></a>球衣收集记录表</h2><p>表名：collection_record</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>集到的球衣记录id</td>
</tr>
<tr>
<td>u_id</td>
<td>int</td>
<td>用户id</td>
</tr>
<tr>
<td>argentina</td>
<td>int</td>
<td>集到阿根廷队球衣的数量</td>
</tr>
<tr>
<td>belgium</td>
<td>int</td>
<td>集到比利时队球衣的数量</td>
</tr>
<tr>
<td>brazil</td>
<td>int</td>
<td>集到巴西队球衣的数量</td>
</tr>
<tr>
<td>england</td>
<td>int</td>
<td>集到英国队球衣的数量</td>
</tr>
<tr>
<td>france</td>
<td>int</td>
<td>集到法国队球衣的数量</td>
</tr>
<tr>
<td>germany</td>
<td>int</td>
<td>集到德国队球衣的数量</td>
</tr>
<tr>
<td>mexico</td>
<td>int</td>
<td>集到墨西哥队球衣的数量</td>
</tr>
<tr>
<td>poland</td>
<td>int</td>
<td>集到波兰队球衣的数量</td>
</tr>
<tr>
<td>portugal</td>
<td>int</td>
<td>集到葡萄牙队球衣的数量</td>
</tr>
<tr>
<td>russia</td>
<td>int</td>
<td>集到俄罗斯队球衣的数量</td>
</tr>
<tr>
<td>serbia</td>
<td>int</td>
<td>集到塞尔维亚队球衣的数量</td>
</tr>
<tr>
<td>south_korea</td>
<td>int</td>
<td>集到韩国队球衣的数量</td>
</tr>
<tr>
<td>spain</td>
<td>int</td>
<td>集到西班牙队球衣的数量</td>
</tr>
<tr>
<td>sweden</td>
<td>int</td>
<td>集到瑞典队球衣的数量</td>
</tr>
<tr>
<td>switzerland</td>
<td>int</td>
<td>集到瑞士队球衣的数量</td>
</tr>
</tbody></table>
<h2 id="球衣赠送记录表"><a href="#球衣赠送记录表" class="headerlink" title="球衣赠送记录表"></a>球衣赠送记录表</h2><p>表名：shirt_share</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>球衣分享记录id</td>
</tr>
<tr>
<td>sharer_id</td>
<td>int</td>
<td>分享者id</td>
</tr>
<tr>
<td>receiver_id</td>
<td>int</td>
<td>领取者id（-1代表没有人领取）</td>
</tr>
<tr>
<td>team_name</td>
<td>varchar(50)</td>
<td>分享的球衣所属球队名</td>
</tr>
</tbody></table>
<h2 id="奖品表"><a href="#奖品表" class="headerlink" title="奖品表"></a>奖品表</h2><p>表名：award </p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>奖品自增id</td>
</tr>
<tr>
<td>name</td>
<td>varchar(50)</td>
<td>奖品名称</td>
</tr>
<tr>
<td>real_price</td>
<td>varchar(50)</td>
<td>真实价格</td>
</tr>
<tr>
<td>price</td>
<td>double</td>
<td>标价</td>
</tr>
<tr>
<td>award_img_url</td>
<td>varchar(255)</td>
<td>奖品图片链接地址</td>
</tr>
<tr>
<td>award_url</td>
<td>varchar(255)</td>
<td>奖品详情链接地址</td>
</tr>
<tr>
<td>win_condition</td>
<td>varchar(255)</td>
<td>获取条件（所需球衣id拼接字符串，例如：1_2_3）</td>
</tr>
<tr>
<td>v_repertory</td>
<td>int</td>
<td>虚拟库存</td>
</tr>
<tr>
<td>repertory</td>
<td>int</td>
<td>真实库存</td>
</tr>
</tbody></table>
<h2 id="兑换记录表"><a href="#兑换记录表" class="headerlink" title="兑换记录表"></a>兑换记录表</h2><p>表名：convert_record</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>兑换记录id</td>
</tr>
<tr>
<td>u_id</td>
<td>int</td>
<td>中奖用户id</td>
</tr>
<tr>
<td>user_name</td>
<td>String</td>
<td>中奖用户名</td>
</tr>
<tr>
<td>a_id</td>
<td>int</td>
<td>中将奖品id</td>
</tr>
<tr>
<td>award_name</td>
<td>String</td>
<td>中奖奖品名称</td>
</tr>
<tr>
<td>win_time</td>
<td>timestamp</td>
<td>中奖时间</td>
</tr>
</tbody></table>
<h1 id="用户相关信息"><a href="#用户相关信息" class="headerlink" title="用户相关信息"></a>用户相关信息</h1><h2 id="登陆接口"><a href="#登陆接口" class="headerlink" title="登陆接口"></a>登陆接口</h2><h3 id="接口概述"><a href="#接口概述" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明"><a href="#URL说明" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/user/login</code></p>
<p>请求方式：POST</p>
<h3 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>String</td>
<td>登陆码</td>
</tr>
</tbody></table>
<h3 id="返回内容"><a href="#返回内容" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result&lt;Map&lt;String, Object&gt;&gt;</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
<tr>
<td>++data</td>
<td>Map&lt;String, Object&gt;</td>
<td>请求成功时返回的数据封装</td>
</tr>
<tr>
<td>++++userId</td>
<td>int</td>
<td>用户自增id</td>
</tr>
<tr>
<td>++++loginResult</td>
<td>LoginResult</td>
<td>登陆结果集封装</td>
</tr>
<tr>
<td>++++++openId</td>
<td>String</td>
<td>用户在小程序中的唯一识别id</td>
</tr>
<tr>
<td>++++++sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
</tbody></table>
<h2 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h2><h3 id="接口概述-1"><a href="#接口概述-1" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-1"><a href="#URL说明-1" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/user/userInf</code></p>
<p>请求方式：POST</p>
<h3 id="请求参数-1"><a href="#请求参数-1" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
<tr>
<td>sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
<tr>
<td>uID</td>
<td>int</td>
<td>用户自增id</td>
</tr>
<tr>
<td>nick_name</td>
<td>String</td>
<td>用户昵称，由于用户的昵称中可能包含表情，所以要用UTF8MB4编码</td>
</tr>
<tr>
<td>head_img_url</td>
<td>String</td>
<td>用户头像地址</td>
</tr>
</tbody></table>
<h3 id="返回内容-1"><a href="#返回内容-1" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result&lt;Map&lt;String, Object&gt;&gt;</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
</tbody></table>
<h1 id="为喜欢的球队加油"><a href="#为喜欢的球队加油" class="headerlink" title="为喜欢的球队加油"></a>为喜欢的球队加油</h1><h2 id="生成海报"><a href="#生成海报" class="headerlink" title="生成海报"></a>生成海报</h2><h3 id="接口概述-2"><a href="#接口概述-2" class="headerlink" title="接口概述"></a>接口概述</h3><p>根据用户选择的球队生成海报。</p>
<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/poster/makePoster</code></p>
<p>请求方式：POST</p>
<h3 id="请求参数-2"><a href="#请求参数-2" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
<tr>
<td>sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
<tr>
<td>uID</td>
<td>int</td>
<td>用户id</td>
</tr>
<tr>
<td>teamName</td>
<td>String</td>
<td>球队名</td>
</tr>
<tr>
<td>templateName</td>
<td>String</td>
<td>使用的模板名（”template1“—“template6”）</td>
</tr>
</tbody></table>
<h3 id="返回内容-2"><a href="#返回内容-2" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result&lt;Map&lt;String, String&gt;&gt;</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
<tr>
<td>++data</td>
<td>Map&lt;String, String&gt;</td>
<td>请求成功时返回的数据封装</td>
</tr>
<tr>
<td>++++posterUrl</td>
<td>String</td>
<td>海报链接</td>
</tr>
<tr>
<td>++++templateName</td>
<td>String</td>
<td>使用的模板名（”template1“—“template6”）</td>
</tr>
</tbody></table>
<h1 id="分享集球衣"><a href="#分享集球衣" class="headerlink" title="分享集球衣"></a>分享集球衣</h1><h2 id="分享集球衣-1"><a href="#分享集球衣-1" class="headerlink" title="分享集球衣"></a>分享集球衣</h2><h3 id="接口概述-3"><a href="#接口概述-3" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-2"><a href="#URL说明-2" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/collection/getPoloShirt</code></p>
<p>请求方式：GET</p>
<h3 id="请求参数-3"><a href="#请求参数-3" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>uID</td>
<td>int</td>
<td>用户id</td>
</tr>
<tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
</tbody></table>
<h3 id="返回内容-3"><a href="#返回内容-3" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
<tr>
<td>data</td>
<td>String</td>
<td>请求成功时返回的数据（球衣所属球队名称）</td>
</tr>
</tbody></table>
<h2 id="集球衣记录"><a href="#集球衣记录" class="headerlink" title="集球衣记录"></a>集球衣记录</h2><h3 id="接口概述-4"><a href="#接口概述-4" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-3"><a href="#URL说明-3" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://localhost:8090/world_cup_test/collection/records</code></p>
<p>请求方式：GET</p>
<h3 id="请求参数-4"><a href="#请求参数-4" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>uID</td>
<td>int</td>
<td>用户自增id</td>
</tr>
<tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
<tr>
<td>sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
</tbody></table>
<h3 id="返回内容-4"><a href="#返回内容-4" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result&lt;List<ShirtRecord>&gt;</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
<tr>
<td>++data</td>
<td>List<ShirtRecord></td>
<td>按集到的球衣数量从大到小排好序的记录列表</td>
</tr>
</tbody></table>
<p>ShirtRecord说明</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>teamName</td>
<td>String</td>
<td>球队名</td>
</tr>
<tr>
<td>count</td>
<td>int</td>
<td>集到的数量</td>
</tr>
</tbody></table>
<h2 id="赠送球衣"><a href="#赠送球衣" class="headerlink" title="赠送球衣"></a>赠送球衣</h2><h3 id="接口概述-5"><a href="#接口概述-5" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-4"><a href="#URL说明-4" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/poloShirt/sendShirt</code></p>
<p>请求方式：POST</p>
<h3 id="请求参数-5"><a href="#请求参数-5" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>uID</td>
<td>int</td>
<td>用户自增id</td>
</tr>
<tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
<tr>
<td>sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
<tr>
<td>teamName</td>
<td>String</td>
<td>球衣所属球队的名称</td>
</tr>
</tbody></table>
<h3 id="返回内容-5"><a href="#返回内容-5" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result<Integer></td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
<tr>
<td>++data</td>
<td>Integer</td>
<td>赠送记录Id</td>
</tr>
</tbody></table>
<h2 id="领取球衣"><a href="#领取球衣" class="headerlink" title="领取球衣"></a>领取球衣</h2><h3 id="接口概述-6"><a href="#接口概述-6" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-5"><a href="#URL说明-5" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/poloShirt/receiveShirt</code></p>
<p>请求方式：POST</p>
<h3 id="请求参数-6"><a href="#请求参数-6" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>uID</td>
<td>int</td>
<td>当前用户id</td>
</tr>
<tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
<tr>
<td>sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
<tr>
<td>sharerId</td>
<td>int</td>
<td>球衣分享者的id</td>
</tr>
<tr>
<td>teamName</td>
<td>String</td>
<td>球衣所属球队名</td>
</tr>
<tr>
<td>sendRecordId</td>
<td>int</td>
<td>赠送记录id</td>
</tr>
</tbody></table>
<h3 id="返回内容-6"><a href="#返回内容-6" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
</tbody></table>
<h2 id="索要球衣"><a href="#索要球衣" class="headerlink" title="索要球衣"></a>索要球衣</h2><h3 id="接口概述-7"><a href="#接口概述-7" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-6"><a href="#URL说明-6" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/poloShirt/chargeShirt</code></p>
<p>请求方式：POST</p>
<h3 id="请求参数-7"><a href="#请求参数-7" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>uID</td>
<td>int</td>
<td>当前用户ID</td>
</tr>
<tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
<tr>
<td>sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
<tr>
<td>chargerId</td>
<td>int</td>
<td>索要者的ID</td>
</tr>
<tr>
<td>teamName</td>
<td>String</td>
<td>球衣所属球队名称</td>
</tr>
</tbody></table>
<h3 id="返回内容-7"><a href="#返回内容-7" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result&lt;Map&lt;String, Object&gt;&gt;</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
</tbody></table>
<h2 id="活动奖品"><a href="#活动奖品" class="headerlink" title="活动奖品"></a>活动奖品</h2><h3 id="接口概述-8"><a href="#接口概述-8" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-7"><a href="#URL说明-7" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/collection/awards</code></p>
<p>请求方式：GET</p>
<h3 id="请求参数-8"><a href="#请求参数-8" class="headerlink" title="请求参数"></a>请求参数</h3><p>无</p>
<h3 id="返回内容-8"><a href="#返回内容-8" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result&lt;List<Award>&gt;</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
<tr>
<td>++data</td>
<td>List<Award></td>
<td>请求成功时返回的数据封装</td>
</tr>
<tr>
<td>++++name</td>
<td>String</td>
<td>奖品名称</td>
</tr>
<tr>
<td>++++price</td>
<td>double</td>
<td>标价</td>
</tr>
<tr>
<td>++++awardUrl</td>
<td>String</td>
<td>奖品链接地址</td>
</tr>
<tr>
<td>++++winCondition</td>
<td>String</td>
<td>获取条件</td>
</tr>
</tbody></table>
<h1 id="赛程数据"><a href="#赛程数据" class="headerlink" title="赛程数据"></a>赛程数据</h1><blockquote>
<p><a href="http://data.2018.163.com/" target="_blank" rel="noopener">世界杯数据中心</a></p>
</blockquote>
<h1 id="接口模板"><a href="#接口模板" class="headerlink" title="接口模板"></a>接口模板</h1><h2 id="接口名"><a href="#接口名" class="headerlink" title="接口名"></a>接口名</h2><h3 id="接口概述-9"><a href="#接口概述-9" class="headerlink" title="接口概述"></a>接口概述</h3><h3 id="URL说明-8"><a href="#URL说明-8" class="headerlink" title="URL说明"></a>URL说明</h3><p>URL地址：<code>http://api.99yhrc.com/worldCup_test/</code></p>
<p>请求方式：GET/POST</p>
<h3 id="请求参数-9"><a href="#请求参数-9" class="headerlink" title="请求参数"></a>请求参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>openId</td>
<td>String</td>
<td>微信小程序中用于唯一标识一个用户</td>
</tr>
<tr>
<td>sessionId</td>
<td>String</td>
<td>加盐后的小程序密钥</td>
</tr>
</tbody></table>
<h3 id="返回内容-9"><a href="#返回内容-9" class="headerlink" title="返回内容"></a>返回内容</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>result</td>
<td>Result&lt;Map&lt;String, Object&gt;&gt;</td>
<td>请求结果封装</td>
</tr>
<tr>
<td>++success</td>
<td>boolean</td>
<td>请求是否成功</td>
</tr>
<tr>
<td>++error</td>
<td>String</td>
<td>请求失败时的提示信息</td>
</tr>
<tr>
<td>++data</td>
<td>Map&lt;String, Object&gt;</td>
<td>请求成功时返回的数据封装</td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>Writing Norms</title>
    <url>/2018/12/26/Writing-Norms/</url>
    <content><![CDATA[<img data-src="https://i.loli.net/2018/12/26/5c2340bbf08fb.jpeg" width="100%"/>

<a id="more"></a>

<h2 id="英文标题大小写规则"><a href="#英文标题大小写规则" class="headerlink" title="英文标题大小写规则"></a>英文标题大小写规则</h2><blockquote>
<p><a href="https://www.douban.com/note/180259961/" target="_blank" rel="noopener">论文英文标题等的写法 - 豆瓣</a></p>
</blockquote>
<ol>
<li>一般实词（名词、动词、代词、形容词、副词等）首字母大写，虚词（介词、冠词、连词、感叹词）首字母小写。</li>
<li>标题第一个单词、最后一个单词无论词性首字母应该大写。</li>
<li>超过5个字母的虚词,如between、without、alongside、underneath等应该大写。</li>
<li>如果是重要提示性标题，或者是专有名称标题，可以全部字母都用大写，但这种用法应慎重。</li>
</ol>
<h2 id="中文技术文档"><a href="#中文技术文档" class="headerlink" title="中文技术文档"></a>中文技术文档</h2><blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2016/10/document_style_guide.html" target="_blank" rel="noopener">中文技术文档的写作规范</a></p>
</blockquote>
<p>体会：</p>
<ol>
<li><p>文章内容主体一定要从二级标题开始，不要从一级标题开始。</p>
</li>
<li><p>谨慎使用四级标题，尽量避免出现，保持层级的简单，防止出现过于复杂的章节。如果三级标题下有并列性的内容，建议只使用项目列表（Item list）。</p>
</li>
<li><p>全角中文字符与半角英文字符之间，应有一个半角空格。</p>
</li>
<li><p>半角英文字符和半角阿拉伯数字，与全角标点符号之间不留空格。</p>
</li>
<li><p>用对“的”、“地”、“得”。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">她露出了开心的笑容。</span><br><span class="line">（形容词＋的＋名词）</span><br><span class="line"></span><br><span class="line">她开心地笑了。</span><br><span class="line">（副词＋地＋动词）</span><br><span class="line"></span><br><span class="line">她笑得很开心。</span><br><span class="line">（动词＋得＋副词）</span><br></pre></td></tr></table></figure>
</li>
<li><p>同样一个意思，尽量使用肯定句表达，不使用否定句表达。</p>
</li>
<li><p>避免使用双重否定句。</p>
</li>
<li><p>表示中文时，英文省略号（<code>⋯</code> 不知道这种英文省略号是怎么打出来的）应改为中文省略号（<code>……</code> Windows 系统中文全角下使用 <code>^</code>，即 <code>shift + 6</code>）。</p>
</li>
<li><p>第一次出现英文词汇时，在括号中给出中文标注。此后再次出现时，直接使用英文缩写即可。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Common Sense</category>
        <category>Writing</category>
      </categories>
      <tags>
        <tag>Writing</tag>
      </tags>
  </entry>
  <entry>
    <title>YunNan Tour at National Day 2019</title>
    <url>/2019/09/19/YunNan-Tour-at-National-Day-2019/</url>
    <content><![CDATA[<iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/01/index.html"></iframe>

<a id="more"></a>

<h2 id="2019年国庆云南游"><a href="#2019年国庆云南游" class="headerlink" title="2019年国庆云南游"></a>2019年国庆云南游</h2><h3 id="总体安排"><a href="#总体安排" class="headerlink" title="总体安排"></a>总体安排</h3><h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p>02/10 晚上 - 07/10 早上</p>
<p>由于 2 号晚上才到，7 号早上要走，故游玩时间为中间的 4 天时间。</p>
<h4 id="地点"><a href="#地点" class="headerlink" title="地点"></a>地点</h4><p>昆明（1天）、大理（两天）、丽江（1天）</p>
<p>由于大理相对景点比较多，所以多给一天时间。</p>
<h4 id="路线"><a href="#路线" class="headerlink" title="路线"></a>路线</h4><p>有两种路线：</p>
<ul>
<li>昆明 → 大理 → 丽江 → 昆明</li>
<li>昆明 → 丽江 → 大理 → 昆明</li>
</ul>
<p>由于第一条路线丽江到昆明在 6 号的票太多紧张，加上丽江酒店消费偏高，所以建议使用第二条路线。</p>
<h3 id="路线-1"><a href="#路线-1" class="headerlink" title="路线"></a>路线</h3><h4 id="路线一"><a href="#路线一" class="headerlink" title="路线一"></a>路线一</h4><ul>
<li><p>2 号晚上到了住昆明</p>
</li>
<li><p>3 号白天逛昆明到景点</p>
</li>
<li><p>3 号晚上从昆明坐车到大理</p>
<p><img data-src="https://i.loli.net/2019/09/19/uFXLgV5P6esSHBa.png" alt=""></p>
</li>
<li><p>3 号晚上住大理</p>
</li>
<li><p>4 号白天逛大理景点</p>
</li>
<li><p>4 号晚上住大理</p>
</li>
<li><p>5 号白天逛大理景点</p>
</li>
<li><p>5 号晚上从大理坐车到丽江</p>
<p><img data-src="https://i.loli.net/2019/09/19/Rz8ypmZlXKxUud7.png" alt=""></p>
</li>
<li><p>5 号晚上住丽江</p>
</li>
<li><p>6 号白天逛丽江的景点</p>
</li>
<li><p>6 号晚上从丽江坐车到昆明</p>
<p><img data-src="https://i.loli.net/2019/09/19/kVzFGocCRZagmTL.png" alt=""></p>
<p><img data-src="https://i.loli.net/2019/09/19/lrkIpWoZOstzf91.png" alt=""></p>
<p><img data-src="https://i.loli.net/2019/09/19/vpUMFiEzWBRCAqY.png" alt=""></p>
<p><img data-src="https://i.loli.net/2019/09/19/Xy8xU3Wnj1rzOqP.png" alt=""></p>
<p><img data-src="https://i.loli.net/2019/09/19/sVgykCFrOcJhQoW.png" alt=""></p>
<p><img data-src="http://ww1.sinaimg.cn/large/005M2pcYgy1g747csa62kj30u00yyjt1.jpg" alt="WechatIMG8.jpeg"></p>
</li>
</ul>
<h4 id="路线二"><a href="#路线二" class="headerlink" title="路线二"></a>路线二</h4><ul>
<li><p>2 号晚上到了住昆明</p>
</li>
<li><p>3 号早上从昆明坐车到丽江</p>
<p><img data-src="https://i.loli.net/2019/09/19/qYbAGXDla6Etmu9.png" alt=""></p>
</li>
<li><p>3 号白天逛丽江的景点</p>
</li>
<li><p>3 号晚上从丽江坐车到大理</p>
<p><img data-src="http://ww1.sinaimg.cn/large/005M2pcYgy1g746p2czg4j31ki0qaah2.jpg" alt="WechatIMG6.png"></p>
</li>
<li><p>3 号晚上住大理</p>
</li>
<li><p>4 号白天逛大理的景点</p>
</li>
<li><p>4 号晚上住大理</p>
</li>
<li><p>5 号白天逛大理的景点</p>
</li>
<li><p>5 号晚上从大理坐车到昆明</p>
<p><img data-src="http://ww1.sinaimg.cn/large/005M2pcYgy1g746s5bm7bj31lq0z6gup.jpg" alt="WechatIMG7.png"></p>
</li>
<li><p>5 号晚上住昆明</p>
</li>
<li><p>6 号白天逛昆明的景点</p>
</li>
<li><p>6 号晚上住昆明</p>
</li>
<li><p>7 号早上从昆明坐车返程</p>
</li>
</ul>
<h3 id="天气"><a href="#天气" class="headerlink" title="天气"></a>天气</h3><iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/weather/index.html">
</iframe>

<h3 id="时间轴"><a href="#时间轴" class="headerlink" title="时间轴"></a><a href="https://libo9527.github.io/static/map/amap/20191001/timeline/index.html" target="_blank" rel="noopener">时间轴</a></h3><h3 id="全览图"><a href="#全览图" class="headerlink" title="全览图"></a><a href="http://libo9527.github.io/static/map/amap/20191001/all/index.html" target="_blank" rel="noopener">全览图</a></h3><h3 id="景点"><a href="#景点" class="headerlink" title="景点"></a>景点</h3><h4 id="昆明"><a href="#昆明" class="headerlink" title="昆明"></a>昆明</h4><blockquote>
<p><a href="http://www.mafengwo.cn/mdd/map/10807.html" target="_blank" rel="noopener">昆明全部景点 | 马蜂窝</a></p>
</blockquote>
<iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/02/index.html">
</iframe>

<h4 id="大理"><a href="#大理" class="headerlink" title="大理"></a>大理</h4><blockquote>
<p><a href="http://www.mafengwo.cn/mdd/map/10487.html" target="_blank" rel="noopener">大理全部景点 | 马蜂窝</a></p>
<p><a href="https://m.youxiake.com/gonglue/view?id=3073" target="_blank" rel="noopener">关于那些风花雪月的事</a></p>
<p>关于下关风的传说：传说一：有一个白面书生与一位美丽的姑娘相爱，引起了南诏国王的不满。南诏王就命罗荃法师把书生打入洱海。姑娘为救情人，向观音菩萨要了六瓶风，想让大风把海水吹干，救出书生。谁知风瓶才背到天生桥，姑娘一不小心跌了一跤，以至打碎了五个风瓶。刹时间、狂风怒吼，一年四季风吹不断，冬季尤为猛烈，后来人们就把下关叫作“风城”。传说二：很久以前，观音化作一个老妪，背着一个风瓶，经过天生桥时，守桥土卒按照贯例要检查过往行人的货物。老妪好言劝说不要检查、士卒不听。还没等老妪说明利害关系，就硬将瓶盖打开、顿时风从瓶中冲了出来，一发而不可收。等士卒明白过来，老妪早已不见了。从此，大风日夜不停地由天生桥吹向下关，故名“风城”。</p>
<p>关于上关花的传说：相传上关有棵“十里奇香树”，花大如莲，香味胜过桂花，颜色呈粉白色，结的果实黑而坚硬，用作朝珠，故又称为“朝珠花”。据《大理府志》载：“……花树高六丈，其质似桂，其花白，每朵十二瓣，应十二月，遇润月则多一瓣，俗以仙人遗种，在大理府和山之麓，土人因以其地名之。”此花种于何时，已不可考。只知道在元朝至正年间，花开得很好，年年开、月月开，浓郁的香味散溢百步之外。后已绝种，传说是由于鲜花怒放时，观者云集，一些贪官污吏借观花而敲诈勒索当地百姓，百姓叫苦连天，只好暗中把花弄死。但直到今日，白族人民爱花、养花已成习惯，而且花卉繁多，四季飘香。</p>
<p>关于苍山雪的传说：相传，古时候有一瘟神来到大理坝子想残害百姓。这时，有兄妹俩为使人们免遭瘟疫，到观音那里去学法，归来后，就用法术把瘟神赶到苍山顶上，用大雪把瘟神冻死。兄妹俩亦在苍山雪人峰上变成雪神，永远镇住了瘟神。从此，苍山就有了千年不化之雪。</p>
<p>关于洱海月的传说：天上有一位仙女羡慕人间生活，下凡来到洱海边与一渔民青年成婚。她看到渔民打鱼困难，就把自己带来的一面宝镜放入海底，把鱼照得一清二楚，好让渔民打到更多的鱼。 后来，那面宝镜在海底变成了金月亮，这就是洱海月。每当月出，行近洱海之滨，仰望天空，玉镜高悬，俯视洱海，地溺银涛，水光接天，万顷芒然，一个明晃晃的月亮在海中随浪飘摇，令人惊叹不已。</p>
</blockquote>
<iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/03/index.html">
</iframe>

<h5 id="大理古城"><a href="#大理古城" class="headerlink" title="大理古城"></a>大理古城</h5><p>大理古城有4座主要的城门，除了南门北门外，东门名叫洱海门，西门则叫做苍山门，因为苍山位于古城西侧，开门即见山。</p>
<p><img data-src="https://i.loli.net/2019/09/21/Fil3ypWnz18rbVa.png" alt="image.png"></p>
<h6 id="门票"><a href="#门票" class="headerlink" title="门票"></a>门票</h6><p>免费</p>
<h6 id="开放时间"><a href="#开放时间" class="headerlink" title="开放时间"></a>开放时间</h6><p>全天</p>
<h6 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h6><blockquote>
<p><a href="https://baike.baidu.com/item/%E5%A4%A7%E7%90%86%E5%8F%A4%E5%9F%8E" target="_blank" rel="noopener">百科</a></p>
</blockquote>
<p>大理古城位于云南省西部，又名叶榆城、紫城。古城其历史可追溯至唐天宝年间，南诏王阁逻凤筑的羊苴咩城，为其新都。古城始建于明洪武十五年（1382年），占地面积3平方公里。</p>
<h6 id="内部景点"><a href="#内部景点" class="headerlink" title="内部景点"></a>内部景点</h6><blockquote>
<p><a href="http://www.mafengwo.cn/poi/17043.html" target="_blank" rel="noopener">大理古城 | 马蜂窝</a></p>
</blockquote>
<p><img data-src="https://i.loli.net/2019/09/21/Hhvr1LiFQ4ESuKP.png" alt="image.png"></p>
<p><img data-src="https://i.loli.net/2019/09/21/PMKdcE5Bih3rLgD.png" alt="image.png"></p>
<h5 id="洱海"><a href="#洱海" class="headerlink" title="洱海"></a>洱海</h5><blockquote>
<p><a href="http://www.mafengwo.cn/poi/956.html" target="_blank" rel="noopener">洱海 | 马蜂窝</a></p>
<p>大理“风花雪月”四大名景（下关风、上关花、苍山雪、洱海月）之一，外形如同耳朵，是由西洱河塌陷形成的高原湖泊。<br>共有三岛、四洲、五湖、九曲。</p>
<p>三岛：金梭岛，玉几岛、赤文岛；</p>
<p>四洲：青莎鼻洲、大鹳淜洲、鸳鸯洲、马濂洲；</p>
<p>五湖：太湖、莲花湖、星湖、神湖、渚湖；</p>
<p>九曲：莲花曲、大鹳曲、潘矶曲、凤翼曲、罗莳曲、牛角曲、波曲，高莒曲，鹤翥曲。</p>
<p><a href="https://zhuanlan.zhihu.com/p/25973306" target="_blank" rel="noopener">大理洱海最美拍摄地点最全攻略，附赠洱海摄影地图</a></p>
<p><a href="https://you.ctrip.com/travels/dali31/3610068.html" target="_blank" rel="noopener">大理环洱海拍照自由行最新版攻略</a></p>
</blockquote>
<h6 id="门票-1"><a href="#门票-1" class="headerlink" title="门票"></a>门票</h6><p>免费</p>
<ul>
<li>包车环游洱海，建议顺序游玩的景点：喜洲镇-蝴蝶泉-双廊-南诏风情岛-挖色镇-小普陀，时间允许的话记得在洱海东岸等待大理最美的日落。包车一天的价格在300元左右。</li>
</ul>
<h6 id="开放时间-1"><a href="#开放时间-1" class="headerlink" title="开放时间"></a>开放时间</h6><p>全天</p>
<h6 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h6><blockquote>
<p><a href="https://baike.baidu.com/item/洱海/19448368?fromtitle=大理洱海&fromid=4488915" target="_blank" rel="noopener">洱海 | 百科</a></p>
</blockquote>
<ul>
<li>洱海，古称昆明池、洱河、叶榆泽等。</li>
<li>因其状似人耳，故名洱海。</li>
<li>一般湖水面积约246平方千米，是仅次于滇池的云南第二大湖，中国淡水湖中居第7位。</li>
<li>洱海形成于冰河时代末期，其成因主要是沉降侵蚀，属高原构造断陷湖泊，海拔1972米。</li>
<li>洱海之所以最终以“洱”为名，要么说它“形若人耳”，要么说它“如月抱珥”，因而得名。而“海”的叫法，则源于云南的习俗。在云南十八怪中就有一怪为“湖泊称作海”。这就是说，湖泊在云南多被叫做“海”。</li>
</ul>
<h6 id="内部景点-1"><a href="#内部景点-1" class="headerlink" title="内部景点"></a>内部景点</h6><p><img data-src="https://p1-q.mafengwo.net/s10/M00/68/4D/wKgBZ1nga8-AK3X9AAO9cNuAiuA91.jpeg?imageView2%2F2%2Fw%2F680%2Fq%2F90%7CimageMogr2%2Fstrip%2Fquality%2F90" alt=""></p>
<h5 id="崇圣寺三塔"><a href="#崇圣寺三塔" class="headerlink" title="崇圣寺三塔"></a>崇圣寺三塔</h5><h6 id="门票-2"><a href="#门票-2" class="headerlink" title="门票"></a>门票</h6><ul>
<li>门票： ¥75/人</li>
</ul>
<h6 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h6><blockquote>
<p><a href="https://baike.baidu.com/item/%E5%B4%87%E5%9C%A3%E5%AF%BA%E4%B8%89%E5%A1%94/413481?fromtitle=%E4%B8%89%E5%A1%94&fromid=7724282" target="_blank" rel="noopener">百科</a><br>崇圣寺三塔位于大理古城西北部1.5公里处，西对苍山应乐峰，东对洱海，距山脚约为1500米。南336米处有桃溪向东流过。北76米处有梅溪，东靠滇藏公路。三塔由一大二小三阁组成。大塔又名千寻塔，当地群众称它为“文笔塔”，通高69.13米，底方9.9米，凡16级，为大理地区典型的密檐式空心四方形砖塔。南北小塔均为十级，高42.17米，为八角形密檐式空心砖塔。三座塔鼎足而立，千寻塔居中，二小塔南北拱卫。1961年3月4日，被国务院公布为第一批全国重点文物保护单位。</p>
</blockquote>
<h6 id="内部景点-2"><a href="#内部景点-2" class="headerlink" title="内部景点"></a>内部景点</h6><h6 id="开放时间-2"><a href="#开放时间-2" class="headerlink" title="开放时间"></a>开放时间</h6><p>9:00 - 18:00</p>
<h5 id="苍山"><a href="#苍山" class="headerlink" title="苍山"></a>苍山</h5><blockquote>
<p><a href="http://www.mafengwo.cn/poi/18067.html" target="_blank" rel="noopener">苍山 | 马蜂窝</a></p>
<p><a href="http://www.mafengwo.cn/gonglve/ziyouxing/1802.html" target="_blank" rel="noopener">无苍山，不大理——最全苍山玩法，做一日清闲山里人</a></p>
</blockquote>
<h6 id="门票-3"><a href="#门票-3" class="headerlink" title="门票"></a>门票</h6><ul>
<li>普通票（进山费）：¥40/人</li>
<li>缆车(往返)：¥35/人</li>
<li>感通索道(往返)：¥80/人</li>
<li>苍山大索道：¥300/人(旺季往返) ¥240/人(淡季往返)</li>
</ul>
<h6 id="开放时间-3"><a href="#开放时间-3" class="headerlink" title="开放时间"></a>开放时间</h6><p>苍山：08:30-16:10(旺季) (4月1日-10月31日 周一-周日)</p>
<p>感通索道/苍山大索道：08:30-17:00 (1月1日-12月31日 周一-周日)</p>
<p>影视城开放时间：8:00-17:00 取票时间9:00以后</p>
<h6 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h6><blockquote>
<p><a href="https://baike.baidu.com/item/苍山/15371" target="_blank" rel="noopener">百科</a></p>
<p>苍山是云岭山脉南端的主峰，由十九座山峰由北而南组成，北起洱源邓川，南至下关天生桥。其峰自北而南依次为：云弄、沧浪、五台、莲花、白云、鹤云、三阳、兰峰、雪人、应乐、观音、中和、龙泉、玉局、马龙、圣应、佛顶、马耳、斜阳。</p>
</blockquote>
<ul>
<li>苍山十九峰十八溪</li>
</ul>
<h6 id="内部景点-3"><a href="#内部景点-3" class="headerlink" title="内部景点"></a>内部景点</h6><h5 id="天龙八部影视城"><a href="#天龙八部影视城" class="headerlink" title="天龙八部影视城"></a>天龙八部影视城</h5><blockquote>
<p><a href="http://www.mafengwo.cn/poi/5426333.html" target="_blank" rel="noopener">天龙八部影视城 | 马蜂窝</a></p>
</blockquote>
<h6 id="门票-4"><a href="#门票-4" class="headerlink" title="门票"></a>门票</h6><p>¥52/人</p>
<h6 id="开放时间-4"><a href="#开放时间-4" class="headerlink" title="开放时间"></a>开放时间</h6><p>08：00-17：00</p>
<h6 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h6><blockquote>
<p><a href="https://baike.baidu.com/item/大理天龙八部影视城?fromtitle=天龙八部影视城&fromid=9356333" target="_blank" rel="noopener">百科</a></p>
<p>大理天龙八部影视城，始建于2002年。主要景点由西夏王宫、珍珑棋局、镇南王府等多余处影视拍摄景观组成，占地面积770亩，总建筑面积2.5万平方米，共由146个单体建筑构成，是以金庸长篇小说《天龙八部》为建筑蓝本和宋代、大理文化三结合为背景的仿古建筑群。</p>
</blockquote>
<h6 id="内部景点-4"><a href="#内部景点-4" class="headerlink" title="内部景点"></a>内部景点</h6><ul>
<li><p>西夏王宫<br>俗称皇宫，位于大理天龙八部影视城南端，建筑仿大宋皇宫风格，并融入大理和佛教文化特色，前院为正殿，后院是书房、寝殿等 。</p>
</li>
<li><p>珍珑棋局</p>
<p>位于大理天龙八部影视城中部，是根据金庸《天龙八部》原著中对“珍珑棋局”的描写建造而成；珍珑棋秤为青石，重700吨，表面积近100平方米，上面可以同时站300多人；黑白棋子分别用汉白玉、墨金玉两种材质雕琢加工而成，每个围棋子重25千克。</p>
</li>
<li><p>镇南王府<br>位于大理天龙八部影视城中部，是根据金庸《天龙八部》原著中镇南王段正淳的“镇南王府”的描写建造而成，主要建有府门、前庭、寝宫、住房、后花园、花厅、藏经阁等。</p>
</li>
<li><p>四僧塔</p>
<p>位于大理天龙八部影视城东北部，是一座石砌佛塔，安葬着明洪武年间圆寂于大理的逯光古、斗南、机先、天祥4位日本国僧人 。</p>
</li>
</ul>
<h4 id="丽江"><a href="#丽江" class="headerlink" title="丽江"></a>丽江</h4><blockquote>
<p><a href="http://www.mafengwo.cn/mdd/map/10186.html" target="_blank" rel="noopener">丽江全部景点 | 马蜂窝</a></p>
<p>丽江地处滇西北高原，金沙江中游。以“二山、一城、一湖、一江、一文化、一风情”为主要代表。二山指的是玉龙雪山和老君山；一城为丽江古城，即大研古城；一江为金沙江；一文化指纳西东巴文化；一风情则为摩梭风情。</p>
</blockquote>
<iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/04/index.html">
</iframe>


<h5 id="玉龙雪山"><a href="#玉龙雪山" class="headerlink" title="玉龙雪山"></a>玉龙雪山</h5><blockquote>
<p><a href="http://sw.lijiangtour.com/" target="_blank" rel="noopener">官网</a></p>
<p><a href="http://www.sohu.com/a/307812017_106508" target="_blank" rel="noopener">丽江玉龙雪山一日游攻略，超详细攻略！</a></p>
<p><a href="http://www.lvmama.com/lvyou/guide/mini-209.html" target="_blank" rel="noopener">【微攻略】丽江玉龙雪山是跟团还是自由行？看完就懂了</a></p>
</blockquote>
<h6 id="门票-5"><a href="#门票-5" class="headerlink" title="门票"></a>门票</h6><blockquote>
<p>由于徒步上山具有危险性，出于安全考虑，玉龙雪山景区不允许游客自己爬上去，必须乘坐索道或环保车。</p>
</blockquote>
<ul>
<li>玉龙雪山门票（进山费）（甘海子、冰川公园、蓝月谷、云杉坪、牦牛坪）：¥130/人</li>
<li>东巴谷：¥30/人</li>
<li>东巴万神园：¥15/人</li>
<li>东巴王国：¥35/人</li>
<li>玉水寨：¥50/人</li>
<li>玉柱擎天：¥40/人</li>
<li>玉峰寺：¥25/人</li>
<li>白沙壁画：¥30/人</li>
<li>古城维护费：¥50/人</li>
<li>景区内环保车：¥20元/人</li>
<li>玉龙雪山景区旅游索道（简称“冰川公园大索道”）全程票：¥120～180/人（含往返）</li>
<li>云杉坪旅游索道全程票：¥45/人</li>
<li>牦牛坪旅游索道全程票：¥50/人</li>
<li>乘坐索道自愿购买索道保险：¥2/人</li>
<li>印象丽江大型室外演出：演出票 ¥248/张，VIP票 ¥290/张</li>
<li>丽江千古情大型室内演出：门票 ¥310/张，VIP票 ¥38/张</li>
<li>氧气：丽江古城 ¥20～40/罐 山上服务站 ¥60～100/罐</li>
<li>租羽绒服：¥50/件</li>
</ul>
<h6 id="营业时间"><a href="#营业时间" class="headerlink" title="营业时间"></a>营业时间</h6><ul>
<li>景区营业时间：9:00—18:00</li>
<li>大索道：07:00-18:00(16:00停止售票)</li>
<li>蓝月谷：09:00 - 16:00</li>
</ul>
<h6 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h6><blockquote>
<p><a href="https://baike.baidu.com/item/%E7%8E%89%E9%BE%99%E9%9B%AA%E5%B1%B1/454679" target="_blank" rel="noopener">百科</a></p>
</blockquote>
<ul>
<li>玉龙雪山为云南省丽江市境内雪山群</li>
<li>在丽江北面约15千米处，<strong>全长75千米</strong>，全山的<strong>13座山峰</strong>由南向北纵向排列</li>
<li><strong>北半球最近赤道</strong>终年积雪的山脉</li>
<li>主峰扇子陡<strong>最高处海拔5596米</strong>，终年积雪</li>
<li>发育有<strong>亚欧大陆距离赤道最近</strong>的<strong>温带海洋性冰川</strong></li>
<li>玉龙雪山在纳西语中被称为“欧鲁”，意为白沙的银色山岩、“<strong>天山</strong>”。</li>
<li>其十三座雪峰连绵不绝，宛若一条“巨龙”腾越飞舞，故称为“<strong>玉龙</strong>”。</li>
<li>因其岩性主要为石灰岩与玄武岩，黑白分明，所以又称为“<strong>黑白雪山</strong>”。</li>
<li>是<strong>纳西人的神山</strong>，传说是纳西族保护神“三多”的化身。</li>
<li>1984年，云南玉龙雪山省级自然保护区建立。2001年，玉龙雪山被评为<strong>4A</strong>级旅游景区，2007年5月成为全国首批<strong>5A</strong>级旅游景区。</li>
<li><strong>中国最南的雪山</strong>、也是整个<strong>北半球最南</strong>的雪山</li>
<li>世界上北半球<strong>纬度最低</strong>、<strong>海拔最高</strong>的山峰。</li>
<li>国内<strong>唯一</strong>一个可以攀爬的雪山</li>
</ul>
<h6 id="内部景点-5"><a href="#内部景点-5" class="headerlink" title="内部景点"></a>内部景点</h6><p><img data-src="http://s1.lvjs.com.cn//uploads/pc/place2/2017-04-27/b9ea4acd-9e15-4f71-a361-40871788f6aa_720_.jpg" alt=""></p>
<p><img data-src="https://pic3.zhimg.com/v2-cf5a2295dff7d5286f844120f561311a_b.jpg" alt=""></p>
<p>黑白水河、甘海子、云杉坪、牦牛坪、扇子陡等。其中，云杉坪，又名“情死之地”，海拔3,240米，是纳西族人心中的圣洁之地。</p>
<p><strong>玉龙雪山景区的核心看点</strong></p>
<ol>
<li><p>冰川公园</p>
<p>缆车会将你送到4506米的高处，剩下的路程就是要自己一步步地登上去，直到4680米的最高处。站在观景台瞭望，屹立在天际的雪山冰峰尤为壮观。</p>
<p>上山过程中没有提供餐饮的地方，所以建议自备一些干粮以备不时之需。</p>
</li>
<li><p>蓝月谷&amp;白水河</p>
<p>蓝月谷是著名的爱情圣地，包含了四个湖：玉液湖、镜潭湖、蓝月湖和听涛湖。</p>
<p>从玉龙雪山下来，就可以乘坐环保车前往蓝月谷景区了。环保车会先经过云杉坪，如果想去云杉坪游览可以先计划好游览时间，云杉坪的游览时间约1—2小时，如果时间不够建议直接前往蓝月谷景区。</p>
<p>蓝月谷景区内每个景点之间都有电瓶车可以乘坐，但须另加收50元，一般不需要乘坐电瓶车（类似于观光车），走路一般约40分钟。</p>
</li>
<li><p>甘海子</p>
<p>“甘海子”又名“干海子”，本来是高山上的冰蚀湖泊，后来因为雪线上升，湖水慢慢减少直到干涸，就成了现在的甘海子</p>
<p>甘海子景区地势平缓起伏，是一个天然的大牧场。这里也是仰视玉龙雪山全貌最近的、也是最佳的地方，在这里不仅能够看到玉龙雪山十三个峰依次排开，还能与漫山放牧的野山羊、耗牛合影。</p>
<p>从蓝月谷可坐环保车前往甘海子大草甸。</p>
<p>玉龙雪山的游客中心就设在甘海子</p>
</li>
<li><p>印象丽江大型室外演出</p>
<p>《印象·丽江》是张艺谋导演的一个原生态实景演出作品，演出以雪山为背景，全长1个小时，上篇为“雪山印象”，下篇为“古城印象”。共分为《古道马帮》、《对酒雪山》、《天上人间》、《打跳组歌》、《鼓舞祭天》和《祈福仪式》六大部分。原生态的表演，气势恢弘，与自然同声，带给人心灵上的无比震撼。</p>
<p>《印象丽江》表演场地位于玉龙雪山甘海子蓝月谷剧场，演出票248元，VIP票290元。</p>
<p>演出时间：每天11:10、13:30两场（旺季会加演一场）</p>
</li>
<li><p>丽江千古情大型室内演出</p>
<p>丽江千古情是大型的室内专业表演，它用各种高科技手段和舞台表现诠释了纳西创世纪的生命礼赞、 泸沽湖女儿国的浪漫情怀、木府辉煌的兴盛和睦，马帮传奇的惊现震撼，玉龙第三国的生命绝唱。</p>
<p>《丽江千古情》的演出场地位于丽江宋城旅游区内，门票310元/张，VIP票380/张，包含宋城旅游区景区入园票以及《丽江千古情》演出票。演出时长60分钟。</p>
</li>
</ol>
<h6 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h6><ul>
<li><p>大玉龙景区 VS 玉龙雪山景区</p>
<p>丽江政府把玉龙雪山附近的著名旅游景点整合后称为大玉龙旅游景区。大玉龙景区包含玉龙雪山5A级旅游景区、玉水寨4A级景区、东巴谷生态文化园3A级景区，以及东巴万神园、东巴王国、玉峰寺、白沙壁画这四个景区。</p>
</li>
</ul>
<h6 id="疑惑点"><a href="#疑惑点" class="headerlink" title="疑惑点"></a>疑惑点</h6><ol>
<li><p>景点内环保车</p>
<p>不知道是不是每个点都有去另一个点的车，是不是只有一个方向？也不知道那个票是一次乘车的钱还是全程的。</p>
</li>
<li><p>大索道</p>
<p>官网订票的地方只给出了时间段，但不知道是上山和下山必须在买的这个时间段，还是只有上山是这个时间段，如果是上山是这个时间段，那下山不管多晚都能下来吗？比如坐最后一趟索道上的山，那最晚几点下山？</p>
<p>还有就是如果提前到了能检票上山吗？比如买的是 17:30 ～ 18:00 的，但是 17:00 就排到了检票口，可以进吗？</p>
</li>
</ol>
<h5 id="丽江古城"><a href="#丽江古城" class="headerlink" title="丽江古城"></a>丽江古城</h5><blockquote>
<p><a href="http://www.ljgc517.com/" target="_blank" rel="noopener">官网</a></p>
</blockquote>
<h6 id="门票-6"><a href="#门票-6" class="headerlink" title="门票"></a>门票</h6><ul>
<li>古城维护费（也称“古维费”）：¥50/人</li>
<li>万古楼：¥50/人</li>
</ul>
<h6 id="营业时间-1"><a href="#营业时间-1" class="headerlink" title="营业时间"></a>营业时间</h6><ul>
<li>古城：全天</li>
<li>万古楼：09:00-17:00</li>
</ul>
<h6 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h6><blockquote>
<p><a href="[https://baike.baidu.com/item/%E4%B8%BD%E6%B1%9F%E5%8F%A4%E5%9F%8E/304665](https://baike.baidu.com/item/丽江古城/304665)">百科</a></p>
</blockquote>
<ul>
<li>又名大研古镇</li>
<li>丽江为第二批被批准的中国历史文化名城之一，是中国以<strong>整座古城</strong>申报世界文化遗产获得成功的两座古城之一（平遥古城、丽江古城）</li>
<li>2019年1月1日起，世界文化遗产丽江古城保护管理局根据云南省发展和改革委员会、云南省财政厅《关于降低丽江古城维护费收费标准的通知》，面向游客收取的丽江古城维护费收费标准从每人次80元调整为每人次50元，征收对象、范围、方式及免征范围保持不变。</li>
</ul>
<h6 id="内部景点-6"><a href="#内部景点-6" class="headerlink" title="内部景点"></a>内部景点</h6><blockquote>
<p><a href="http://www.ljgc517.com/gcjd2v2/index.htm" target="_blank" rel="noopener">古城景点 | 官网</a></p>
</blockquote>
<p><img data-src="http://www.17u1u.com/file/image/2015/0111/1420963071.jpg" alt=""></p>
<ul>
<li><p>大水车</p>
</li>
<li><p>四方街</p>
</li>
<li><p>木府</p>
<p>北有故宫，南有木府</p>
<p>不到木府，等于不到丽江</p>
</li>
<li><p>万古楼</p>
<p>狮子山山顶有中国一柱通顶不连接的全木结构建筑第一楼——万古楼。</p>
</li>
<li><p>黑龙潭公园</p>
</li>
</ul>
<h6 id="避坑指南"><a href="#避坑指南" class="headerlink" title="避坑指南"></a>避坑指南</h6><ul>
<li><p>花马街千万不要去</p>
</li>
<li><p>cosplay 拍照时要花钱的，别随便拍</p>
</li>
</ul>
<h5 id="束河古镇"><a href="#束河古镇" class="headerlink" title="束河古镇"></a>束河古镇</h5><blockquote>
<p><a href="http://www.ljshuhe.com/" target="_blank" rel="noopener">官网</a></p>
</blockquote>
<h3 id="酒店"><a href="#酒店" class="headerlink" title="酒店"></a>酒店</h3><h4 id="昆明-1"><a href="#昆明-1" class="headerlink" title="昆明"></a>昆明</h4><iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/hotel/kunming/index.html">
</iframe>

<h4 id="大理-1"><a href="#大理-1" class="headerlink" title="大理"></a>大理</h4><iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/hotel/dali/index.html">
</iframe>

<h4 id="丽江-1"><a href="#丽江-1" class="headerlink" title="丽江"></a>丽江</h4><iframe width="100%" height="400" frameborder="no"  src="https://libo9527.github.io/static/map/amap/20191001/hotel/lijiang/index.html">
</iframe>

<h3 id="美食"><a href="#美食" class="headerlink" title="美食"></a>美食</h3><blockquote>
<p>杜杜推荐：桥香园过桥米线、豆花米线、饵丝、嘉华鲜花饼、云腿月饼、火腿腊肉、牛撒撇、柠檬撒撇</p>
</blockquote>
<h4 id="昆明-2"><a href="#昆明-2" class="headerlink" title="昆明"></a>昆明</h4><h4 id="大理-2"><a href="#大理-2" class="headerlink" title="大理"></a>大理</h4><p>白族三道茶、凉鸡米线、喜洲破酥粑粑、大理生皮、砂锅鱼、烧饵块、粑肉饵丝，永平黄焖鸡、烤乳扇</p>
<h4 id="丽江-2"><a href="#丽江-2" class="headerlink" title="丽江"></a>丽江</h4><p>鸡豆凉粉、丽江粑粑、纳西烤鱼、土鸡米线、过桥米线、腊排骨、黑山羊火锅、各种野生菌（松茸、鸡枞、羊肚菌、牛肝菌等）</p>
<p>丽江古城内的大石桥附近、忠义市场、四方街都是小吃集中地。新城的美食主要聚集在七星街的华都商贸城里，以及新城的象山市场这几个地方。</p>
<p><strong>水果可以在古城里的忠义市场去买。</strong>非常大的一个市场，在古城里面生活的人也在这里买东西。市场主要卖水果、蔬菜、肉之类的。价格很便宜。</p>
<p><strong>有两条酒吧比较集中的街道</strong>，丽江酒吧一般都没有最低消费。</p>
<ul>
<li>四方街酒吧一条街。</li>
<li>饮玉巷。</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><h4 id="必带物品"><a href="#必带物品" class="headerlink" title="必带物品"></a>必带物品</h4><ul>
<li><p>身份证</p>
</li>
<li><p>少量现金</p>
</li>
<li><p>药品</p>
<p>晕车药、感冒药、消炎药、外伤药、葡萄糖…以及个人常用药品。</p>
</li>
<li><p>雨伞</p>
<p>云南天气变化不定，出门前一定要备好雨伞。</p>
</li>
<li><p>防晒</p>
<p>高海拔地区日照强烈，出门前一定要注意防晒工作</p>
</li>
<li><p>高能食品</p>
<p>准备一些士力架、巧克力、牛肉干、糖果、香蕉之类的高热量食物补充能量。</p>
</li>
</ul>
<h3 id="费用明细"><a href="#费用明细" class="headerlink" title="费用明细"></a>费用明细</h3><table>
<thead>
<tr>
<th>项目</th>
<th>日期</th>
<th>类别</th>
<th>单价</th>
<th>数量</th>
<th>总价</th>
<th>人均</th>
<th>涉及人员</th>
<th>票据截图</th>
</tr>
</thead>
<tbody><tr>
<td>深圳 - 广州东</td>
<td>2019-10-01</td>
<td>火车票</td>
<td>¥79.5</td>
<td>1</td>
<td>¥79.5</td>
<td>¥79.5</td>
<td>李</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/sz-gz.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>广州南 - 昆明南</td>
<td>2019-10-02</td>
<td>高铁票</td>
<td>¥434.5</td>
<td>2</td>
<td>¥869</td>
<td>¥434.5</td>
<td>李、浮</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/gzn-kmn.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>昆明 - 丽江</td>
<td>2019-10-03</td>
<td>火车票</td>
<td>¥220</td>
<td>4</td>
<td>¥880</td>
<td>¥220</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/km-lj.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>丽江 - 大理</td>
<td>2019-10-04</td>
<td>火车票</td>
<td>¥34</td>
<td>4</td>
<td>¥136</td>
<td>¥34</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/lj-dl.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>大理 - 昆明</td>
<td>2019-10-05</td>
<td>火车票</td>
<td>¥145</td>
<td>4</td>
<td>¥580</td>
<td>¥145</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/dl-km.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>昆明南 - 广州南</td>
<td>2019-10-07</td>
<td>高铁票</td>
<td>¥434.5</td>
<td>2</td>
<td>¥869</td>
<td>¥434.5</td>
<td>李、浮</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/kmn-gzn.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>汉庭优佳昆明东华酒店</td>
<td>2019-10-02</td>
<td>酒店</td>
<td>¥205</td>
<td>2</td>
<td>¥410</td>
<td>¥102.5</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/km-hotel-01.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a><a href="https://libo9527.github.io/static/map/amap/20191001/images/kn-hotel-02.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>汉庭丽江古城福星路酒店</td>
<td>2019-10-03</td>
<td>酒店</td>
<td>¥283</td>
<td>2</td>
<td>¥566</td>
<td>¥141.5</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/lj-hotel.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>大理古城米畔·轻宿客栈</td>
<td>2019-10-04</td>
<td>民宿</td>
<td>¥319.20</td>
<td>2</td>
<td>¥638.4</td>
<td>¥159.6</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/dl-hotel.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>汉庭昆明北京路酒店</td>
<td>2019-10-05</td>
<td>酒店</td>
<td>¥175</td>
<td>2</td>
<td>¥350</td>
<td>¥87.5</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/km-hotel-03.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td>汉庭昆明呈贡酒店</td>
<td>2019-10-06</td>
<td>酒店</td>
<td>¥126</td>
<td>2</td>
<td>¥252</td>
<td>¥63</td>
<td>李、浮、谭、党</td>
<td><a href="https://libo9527.github.io/static/map/amap/20191001/images/km-hotel-04.png" target="_blank"><i><img width="30px" data-src="https://cdn1.iconfinder.com/data/icons/social-17/48/photos2-512.png" alt="icon"></i></a></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>总计：¥5629.9</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>李：¥1901.6</td>
<td>浮：¥1822.1</td>
<td>谭：¥953.1</td>
<td>党：¥953.1</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Tour</category>
      </categories>
      <tags>
        <tag>Tour</tag>
      </tags>
  </entry>
  <entry>
    <title>Zhuhai Tour in the weekend of January 2020</title>
    <url>/2019/12/31/Zhuhai-Tour-in-the-weekend-of-January-2020/</url>
    <content><![CDATA[<img data-src="cover" width="100%"/>

<a id="more"></a>

<h2 id="路线"><a href="#路线" class="headerlink" title="路线"></a>路线</h2><h3 id="蛇口-珠海-ship"><a href="#蛇口-珠海-ship" class="headerlink" title="蛇口 - 珠海 :ship:"></a>蛇口 - 珠海 :ship:</h3><table>
<thead>
<tr>
<th>起始港口</th>
<th>到达港口</th>
<th>开船时间</th>
<th>到达时间</th>
<th>价格</th>
<th>渠道</th>
</tr>
</thead>
<tbody><tr>
<td>蛇口港</td>
<td>九洲港</td>
<td>2019-12-28 07:30</td>
<td>2019-12-28 08:40</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
<tr>
<td>蛇口港</td>
<td>九洲港</td>
<td>2019-12-28 08:00</td>
<td>2019-12-28 09:10</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
<tr>
<td>蛇口港</td>
<td>九洲港</td>
<td>2019-12-28 08:30</td>
<td>2019-12-28 09:40</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
<tr>
<td>蛇口港</td>
<td>九洲港</td>
<td>2019-12-28 20:00</td>
<td>2019-12-28 21:00</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
<tr>
<td>蛇口港</td>
<td>九洲港</td>
<td>2019-12-28 20:45</td>
<td>2019-12-28 21:55</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
<tr>
<td>蛇口港</td>
<td>九洲港</td>
<td>2019-12-28 21:30</td>
<td>2019-12-28 22:40</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
</tbody></table>
<h3 id="珠海-蛇口-ship"><a href="#珠海-蛇口-ship" class="headerlink" title="珠海 - 蛇口 :ship:"></a>珠海 - 蛇口 :ship:</h3><table>
<thead>
<tr>
<th>起始港口</th>
<th>到达港口</th>
<th>开船时间</th>
<th>到达时间</th>
<th>价格</th>
<th>渠道</th>
</tr>
</thead>
<tbody><tr>
<td>九洲港</td>
<td>蛇口港</td>
<td>2019-12-29 20:00</td>
<td>2019-12-29 21:00</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
<tr>
<td>九洲港</td>
<td>蛇口港</td>
<td>2019-12-29 20:45</td>
<td>2019-12-29 21:45</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
<tr>
<td>九洲港</td>
<td>蛇口港</td>
<td>2019-12-29 21:30</td>
<td>2019-12-29 22:30</td>
<td>¥125 起</td>
<td>携程</td>
</tr>
</tbody></table>
<h3 id="深圳-珠海公路口岸-bus"><a href="#深圳-珠海公路口岸-bus" class="headerlink" title="深圳 - 珠海公路口岸 :bus:"></a>深圳 - 珠海公路口岸 :bus:</h3><blockquote>
<p><a href="http://www.mafengwo.cn/sales/5811177.html" target="_blank" rel="noopener">深圳到珠海公路口岸澳门自由行拼车</a></p>
<p>上车集合点：<br>1、6：30 或 7：00 大剧院B出口；<br>2、7：00 或 7：30 深大北门天桥:深大北门公交站1/2，腾讯大厦同侧。</p>
<p>票价：¥ 99</p>
</blockquote>
<p><img data-src="https://b1-q.mafengwo.net/s13/M00/17/6E/wKgEaVxtL1iAauPpAADQXT-OV-Q43.jpeg" alt=""></p>
<p><img data-src="https://n1-q.mafengwo.net/s13/M00/13/C6/wKgEaVxtLO2ATuG4AADxsEuMe0o57.jpeg" alt=""></p>
]]></content>
      <categories>
        <category>Tour</category>
      </categories>
      <tags>
        <tag>Tour</tag>
      </tags>
  </entry>
  <entry>
    <title>Interview</title>
    <url>/2020/12/09/Interview/</url>
    <content><![CDATA[<hr>
<p>title: Interview<br>description: 面试<br>comments: false<br>hidden: false<br>top: false<br>date: 2020-10-21 20:00:51<br>categories:<br>tags:<br>—计算元素值的哈希值。根据哈希值，在位数组中把对应下标的值置为 1。</p>
<img data-src="https://resources.workable.com/wp-content/uploads/2018/05/prepare-interviews-featured.png" width="100%"/>

<a id="more"></a>

<blockquote>
<p><a href="https://github.com/Snailclimb" target="_blank" rel="noopener">Snailclimb</a>/<a href="https://github.com/Snailclimb/JavaGuide" target="_blank" rel="noopener">JavaGuide</a></p>
<p><a href="https://github.com/CyC2018" target="_blank" rel="noopener">CyC2018</a>/<a href="https://github.com/CyC2018/CS-Notes" target="_blank" rel="noopener">CS-Notes</a></p>
<p><a href="https://xiaozhuanlan.com/javainterview?rel=javaguide" target="_blank">《Java 面试进阶指南》</a> </p>
</blockquote>
<p>[toc]</p>
<h2 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h2><p>你好，我叫李博，木子李，博士的博。94年的，今年是26。籍贯是陕西。</p>
<p>17年毕业于延安大学，专业是信息与计算科学，是个一本。</p>
<p>毕业后就来了深圳工作，到目前为止是有三年多的工作经验。</p>
<p>平常工作中主要使用的是 Spring Boot、MyBatis 等框架，数据库使用过关系型的 MySQL 和 Oracle，文档型的使用过 MongDB，以及内存型的数据库 Redis。</p>
<p>目前最近的项目是前后端分离开发的项目，后端使用的 Spring Cloud 的微服务架构，前段使用的是 Vue.js 结合 Element-UI 组件库开发的。</p>
<p>大体的情况就是这些。</p>
<h2 id="编程思想"><a href="#编程思想" class="headerlink" title="编程思想"></a>编程思想</h2><h3 id="OPP"><a href="#OPP" class="headerlink" title="OPP"></a>OPP</h3><p>面向过程编程（英语：Procedure-oriented Programming，缩写：OPP）</p>
<h3 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h3><p>面向对象编程（英语：Object-oriented programming，缩写：OOP）</p>
<h4 id="OPP-vs-OOP"><a href="#OPP-vs-OOP" class="headerlink" title="OPP vs OOP"></a>OPP vs OOP</h4><p>面向过程的程序设计<span style="color: red">把</span>计算机程序<span style="color: red">视为</span>一系列的<strong>命令集合</strong>，即一组函数的顺序执行。为了简化程序设计，面向过程把函数继续切分为子函数，即把大块函数通过切割成小块函数来降低系统的复杂度。</p>
<p>而面向对象的程序设计<span style="color: red">把</span>计算机程序<span style="color: red">视为</span>一组<strong>对象的集合</strong>，而每个对象都可以接收其他对象发过来的消息，并处理这些消息，<strong>计算机程序的执行就是一系列消息在各个对象之间传递</strong>。</p>
<h4 id="三大特征"><a href="#三大特征" class="headerlink" title="三大特征"></a>三大特征</h4><p>面向对象的三大特征：封装、继承、多态</p>
<h5 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h5><p>把数据以及对数据的操作封装在一个类里。</p>
<h5 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h5><h5 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h5><p>父类引用指向子类对象。</p>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>在软件业，AOP 为 Aspect Oriented Programming 的缩写，意为：面向切面编程</p>
<p>Spring AOP 的实现原理：动态代理</p>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h3><p>布隆过滤器是一种用来检索元素是否在给定大集合中的数据结构，这种数据结构是高效且性能很好的，但缺点是具有一定的错误识别率和删除难度。并且，理论情况下，添加到集合中的元素越多，误报的可能性就越大。</p>
<p>布隆过滤器（Bloom Filter）由二进制向量（或者说位数组）和一系列随机映射函数（哈希函数）两部分组成的数据结构。</p>
<h4 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h4><ol>
<li>使用哈希函数对元素值进行计算，得到哈希值（有几个哈希函数得到几个哈希值）。</li>
<li>根据得到的哈希值，在位数组中把对应下标的值置为 1。</li>
</ol>
<h4 id="判断一个元素是否存在"><a href="#判断一个元素是否存在" class="headerlink" title="判断一个元素是否存在"></a>判断一个元素是否存在</h4><ol>
<li>对给定元素再次进行相同的哈希计算；</li>
<li>得到值之后判断位数组中的每个元素是否都为 1，如果值都为 1，那么说明这个值在布隆过滤器中，如果存在一个值不为 1，说明该元素不在布隆过滤器中。</li>
</ol>
<p>布隆过滤器说某个元素存在，小概率会误判。布隆过滤器说某个元素不在，那么这个元素一定不在。</p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ol>
<li>判断给定数据是否存在：比如判断一个数字是否存在于包含大量数字的数字集中（数字集很大，5亿以上！）、 防止缓存穿透（判断请求的数据是否有效避免直接绕过缓存请求数据库）等等、邮箱的垃圾邮件过滤、黑名单功能等等。</li>
<li>去重：比如爬给定网址的时候对已经爬取过的 URL 去重。</li>
</ol>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><h5 id="Google-Guava-的布隆过滤器"><a href="#Google-Guava-的布隆过滤器" class="headerlink" title="Google Guava 的布隆过滤器"></a>Google Guava 的布隆过滤器</h5><p>创建了一个最多存放 最多 1500个整数的布隆过滤器，并且我们可以容忍误判的概率为百分之一（0.01）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建布隆过滤器对象</span></span><br><span class="line">BloomFilter&lt;Integer&gt; filter = BloomFilter.create(</span><br><span class="line">  Funnels.integerFunnel(),</span><br><span class="line">  <span class="number">1500</span>,</span><br><span class="line">  <span class="number">0.01</span>);</span><br><span class="line"><span class="comment">// 判断指定元素是否存在</span></span><br><span class="line">System.out.println(filter.mightContain(<span class="number">1</span>));</span><br><span class="line">System.out.println(filter.mightContain(<span class="number">2</span>));</span><br><span class="line"><span class="comment">// 将元素添加进布隆过滤器</span></span><br><span class="line">filter.put(<span class="number">1</span>);</span><br><span class="line">filter.put(<span class="number">2</span>);</span><br><span class="line">System.out.println(filter.mightContain(<span class="number">1</span>));</span><br><span class="line">System.out.println(filter.mightContain(<span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h5 id="Redis-中的布隆过滤器"><a href="#Redis-中的布隆过滤器" class="headerlink" title="Redis 中的布隆过滤器"></a>Redis 中的布隆过滤器</h5><p>Guava 提供的布隆过滤器的实现只能单机使用（另外，容量扩展也不容易），而现在互联网一般都是分布式的场景。为了解决这个问题，就需要用到 Redis 中的布隆过滤器了。</p>
<p>Redis v4.0 之后有了 Module（模块/插件） 功能，Redis Modules 让 Redis 可以使用外部模块扩展其功能 。</p>
<p>官网推荐了一个 RedisBloom 作为 Redis 布隆过滤器的 Module。</p>
<h6 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h6><ol>
<li><strong><code>BF.ADD</code></strong>：将元素添加到布隆过滤器中，如果该过滤器尚不存在，则创建该过滤器。格式：<code>BF.ADD {key} {item}</code>。</li>
<li><strong><code>BF.MADD</code></strong>: 将一个或多个元素添加到“布隆过滤器”中，并创建一个尚不存在的过滤器。该命令的操作方式<code>BF.ADD</code>与之相同，只不过它允许多个输入并返回多个值。格式：<code>BF.MADD {key} {item} [item ...]</code> 。</li>
<li>** <code>BF.EXISTS</code>  ** : 确定元素是否在布隆过滤器中存在。格式：<code>BF.EXISTS {key} {item}</code>。</li>
<li><strong><code>BF.MEXISTS</code></strong> ： 确定一个或者多个元素是否在布隆过滤器中存在格式：<code>BF.MEXISTS {key} {item} [item ...]</code>。</li>
</ol>
<h6 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BF.ADD myFilter java</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.ADD myFilter javaguide</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS myFilter java</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS myFilter javaguide</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS myFilter github</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<h3 id="B-树"><a href="#B-树" class="headerlink" title="B 树"></a>B 树</h3><p>B树（balance tree）可以认为是 m 叉的多路平衡查找树</p>
<h3 id="B-树-1"><a href="#B-树-1" class="headerlink" title="B+ 树"></a>B+ 树</h3><h4 id="B树和B-树的区别"><a href="#B树和B-树的区别" class="headerlink" title="B树和B+树的区别"></a>B树和B+树的区别</h4><blockquote>
<p><a href="https://blog.csdn.net/login_sonata/article/details/75268075" target="_blank" rel="noopener">b树和b+树的区别</a></p>
</blockquote>
<ul>
<li>B+树的中间节点不保存数据，只在叶子结点中保存数据；而B树数据分布在整颗树中。</li>
<li>因为B+树的叶子结点按顺序链接，可以很方便的进行<strong>范围查找</strong>。</li>
</ul>
<h3 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h3><h4 id="5-个特性"><a href="#5-个特性" class="headerlink" title="5 个特性"></a>5 个特性</h4><ol>
<li>每个节点要么是红色，要么是黑色；</li>
<li>根节点永远是黑色的；</li>
<li>所有的叶节点都是是黑色的（注意这里说叶子节点其实是上图中的 NIL 节点）；</li>
<li>每个红色节点的两个子节点一定都是黑色；</li>
<li>从任一节点到其子树中每个叶子节点的路径都包含相同数量的黑色节点；</li>
</ol>
<p>HashMap 为什么要使用红黑树？</p>
<p>红黑树是基于二叉查找树的改造，二叉树查找树具有平衡树和有序性的特点，能够支持快速的查找功能，但平衡树的维护成本比较高，红黑树采用的“适度平衡”标准，可以保证每次插入或删除操作后重平衡过程中，全树拓扑结构的更新仅涉及常数个节点。<strong>尽管最坏情况下需对多达logn个节点重染色，但就分摊意义而言仅为O(1)个。</strong></p>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><h3 id="KMP-算法"><a href="#KMP-算法" class="headerlink" title="KMP 算法"></a>KMP 算法</h3><p>谈到字符串问题，不得不提的就是 KMP 算法，它是用来解决字符串查找的问题，可以在一个字符串（S）中查找一个子串（W）出现的位置。KMP 算法把字符匹配的时间复杂度缩小到 O(m+n) ,而空间复杂度也只有O(m)。因为“暴力搜索”的方法会反复回溯主串，导致效率低下，而KMP算法可以利用已经部分匹配这个有效信息，保持主串上的指针不回溯，通过修改子串的指针，让模式串尽量地移动到有效的位置。</p>
<h3 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h3><p>排序算法的成本模型是比较和交换的次数。</p>
<h4 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h4><p>从数组中选择最小元素，将它与数组的第一个元素交换位置。再从数组剩下的元素中选择出最小的元素，将它与数组的第二个元素交换位置。不断进行这样的操作，直到将整个数组排序。</p>
<p>选择排序需要 ~N2/2 次比较和 ~N 次交换，它的运行时间与输入无关，这个特点使得它对一个已经排序的数组也需要这么多的比较和交换操作。</p>
<p><a href="https://camo.githubusercontent.com/7d5779d6bf5f57e00e5e48e49437a74a4d7e3cf7/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62633662653264302d656435652d346465662d383965352d3361646139616661383131612e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/7d5779d6bf5f57e00e5e48e49437a74a4d7e3cf7/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62633662653264302d656435652d346465662d383965352d3361646139616661383131612e676966" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Selection</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Sort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N = nums.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">int</span> min = i;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; N; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (less(nums[j], nums[min])) &#123;</span><br><span class="line">          min = j;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      swap(nums, i, min);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h4><p>从左到右不断交换相邻逆序的元素，在一轮的循环之后，可以让未排序的最大元素上浮到右侧。</p>
<p>在一轮循环中，如果没有发生交换，那么说明数组已经是有序的，此时可以直接退出。</p>
<p><a href="https://camo.githubusercontent.com/c121fd9d4776aa05f1577a863250cacce1f9fb93/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f30663864313738622d353264382d343931622d396466642d3431653035613935323537382e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/c121fd9d4776aa05f1577a863250cacce1f9fb93/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f30663864313738622d353264382d343931622d396466642d3431653035613935323537382e676966" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bubble</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Sort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N = nums.length;</span><br><span class="line">    <span class="keyword">boolean</span> isSorted = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = N - <span class="number">1</span>; i &gt; <span class="number">0</span> &amp;&amp; !isSorted; i--) &#123;</span><br><span class="line">      isSorted = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (less(nums[j + <span class="number">1</span>], nums[j])) &#123;</span><br><span class="line">          isSorted = <span class="keyword">false</span>;</span><br><span class="line">          swap(nums, j, j + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h4><p>每次都将当前元素插入到左侧已经排序的数组中，使得插入之后左侧数组依然有序。</p>
<p>对于数组 {3, 5, 2, 4, 1}，它具有以下逆序：(3, 2), (3, 1), (5, 2), (5, 4), (5, 1), (2, 1), (4, 1)，插入排序每次只能交换相邻元素，令逆序数量减少 1，因此插入排序需要交换的次数为逆序数量。</p>
<p>插入排序的时间复杂度取决于数组的初始顺序，如果数组已经部分有序了，那么逆序较少，需要的交换次数也就较少，时间复杂度较低。</p>
<ul>
<li>平均情况下插入排序需要 ~N2/4 比较以及 ~N2/4 次交换；</li>
<li>最坏的情况下需要 ~N2/2 比较以及 ~N2/2 次交换，最坏的情况是数组是倒序的；</li>
<li>最好的情况下需要 N-1 次比较和 0 次交换，最好的情况就是数组已经有序了。</li>
</ul>
<p><a href="https://camo.githubusercontent.com/3e2e38e4ded17c7d4cd6945710d1d51d26118268/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f33353235336661342d663630612d346533622d616165632d3866633833356161626461632e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/3e2e38e4ded17c7d4cd6945710d1d51d26118268/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f33353235336661342d663630612d346533622d616165632d3866633833356161626461632e676966" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Insertion</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Sort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N = nums.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt; <span class="number">0</span> &amp;&amp; less(nums[j], nums[j - <span class="number">1</span>]); j--) &#123;</span><br><span class="line">        swap(nums, j, j - <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h4><p>对于大规模的数组，插入排序很慢，因为它只能交换相邻的元素，每次只能将逆序数量减少 1。希尔排序的出现就是为了解决插入排序的这种局限性，它通过交换不相邻的元素，每次可以将逆序数量减少大于 1。</p>
<p>希尔排序使用插入排序对间隔 h 的序列进行排序。通过不断减小 h，最后令 h=1，就可以使得整个数组是有序的。</p>
<p><a href="https://camo.githubusercontent.com/1ca2add89effbf569df135b2ae0c1057a5de1049/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f37383138633537342d393761382d343864622d386536322d3862666230333062303262612e706e67" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/1ca2add89effbf569df135b2ae0c1057a5de1049/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f37383138633537342d393761382d343864622d386536322d3862666230333062303262612e706e67" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shell</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Sort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> N = nums.length;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (h &lt; N / <span class="number">3</span>) &#123;</span><br><span class="line">      h = <span class="number">3</span> * h + <span class="number">1</span>; <span class="comment">// 1, 4, 13, 40, ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = h; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt;= h &amp;&amp; less(nums[j], nums[j - h]); j -= h) &#123;</span><br><span class="line">          swap(nums, j, j - h);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      h = h / <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>希尔排序的运行时间达不到平方级别，使用递增序列 1, 4, 13, 40, … 的希尔排序所需要的比较次数不会超过 N 的若干倍乘于递增序列的长度。后面介绍的高级排序算法只会比希尔排序快两倍左右。</p>
<h4 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h4><p>归并排序的思想是将数组分成两部分，分别进行排序，然后归并起来。</p>
<p><a href="https://camo.githubusercontent.com/ad8dbcf111d93c5fe575e1ce147599aefcabdd36/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65633834303936372d643132372d346461332d623662622d3138363939366335363734362e706e67" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/ad8dbcf111d93c5fe575e1ce147599aefcabdd36/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65633834303936372d643132372d346461332d623662622d3138363939366335363734362e706e67" alt="img"></a></p>
<h5 id="1-归并方法"><a href="#1-归并方法" class="headerlink" title="1. 归并方法"></a>1. 归并方法</h5><p>归并方法将数组中两个已经排序的部分归并成一个。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Sort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> T[] aux;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(T[] nums, <span class="keyword">int</span> l, <span class="keyword">int</span> m, <span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = l, j = m + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = l; k &lt;= h; k++) &#123;</span><br><span class="line">      aux[k] = nums[k]; <span class="comment">// 将数据复制到辅助数组</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = l; k &lt;= h; k++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &gt; m) &#123;</span><br><span class="line">        nums[k] = aux[j++];</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j &gt; h) &#123;</span><br><span class="line">        nums[k] = aux[i++];</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (aux[i].compareTo(aux[j]) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        nums[k] = aux[i++]; <span class="comment">// 先进行这一步，保证稳定性</span></span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        nums[k] = aux[j++];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-自顶向下归并排序"><a href="#2-自顶向下归并排序" class="headerlink" title="2. 自顶向下归并排序"></a>2. 自顶向下归并排序</h5><p>将一个大数组分成两个小数组去求解。</p>
<p>因为每次都将问题对半分成两个子问题，这种对半分的算法复杂度一般为 O(NlogN)。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Up2DownMergeSort</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">MergeSort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line">    aux = (T[]) <span class="keyword">new</span> Comparable[nums.length];</span><br><span class="line">    sort(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums, <span class="keyword">int</span> l, <span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (h &lt;= l) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + (h - l) / <span class="number">2</span>;</span><br><span class="line">    sort(nums, l, mid);</span><br><span class="line">    sort(nums, mid + <span class="number">1</span>, h);</span><br><span class="line">    merge(nums, l, mid, h);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-自底向上归并排序"><a href="#3-自底向上归并排序" class="headerlink" title="3. 自底向上归并排序"></a>3. 自底向上归并排序</h5><p>先归并那些微型数组，然后成对归并得到的微型数组。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Down2UpMergeSort</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">MergeSort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> N = nums.length;</span><br><span class="line">    aux = (T[]) <span class="keyword">new</span> Comparable[N];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> sz = <span class="number">1</span>; sz &lt; N; sz += sz) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> lo = <span class="number">0</span>; lo &lt; N - sz; lo += sz + sz) &#123;</span><br><span class="line">        merge(nums, lo, lo + sz - <span class="number">1</span>, Math.min(lo + sz + sz - <span class="number">1</span>, N - <span class="number">1</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h4><h5 id="1-基本算法"><a href="#1-基本算法" class="headerlink" title="1. 基本算法"></a>1. 基本算法</h5><ul>
<li>归并排序将数组分为两个子数组分别排序，并将有序的子数组归并使得整个数组排序；</li>
<li>快速排序通过一个切分元素将数组分为两个子数组，左子数组小于等于切分元素，右子数组大于等于切分元素，将这两个子数组排序也就将整个数组排序了。</li>
</ul>
<p><a href="https://camo.githubusercontent.com/eda7de5fb7b862056b35daa26b290481a66f4475/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36323334656233642d636366322d343938372d613732342d3233356165663639353762312e706e67" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/eda7de5fb7b862056b35daa26b290481a66f4475/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36323334656233642d636366322d343938372d613732342d3233356165663639353762312e706e67" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Sort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line">    shuffle(nums);</span><br><span class="line">    sort(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums, <span class="keyword">int</span> l, <span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (h &lt;= l)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> j = partition(nums, l, h);</span><br><span class="line">    sort(nums, l, j - <span class="number">1</span>);</span><br><span class="line">    sort(nums, j + <span class="number">1</span>, h);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shuffle</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line">    List&lt;Comparable&gt; list = Arrays.asList(nums);</span><br><span class="line">    Collections.shuffle(list);</span><br><span class="line">    list.toArray(nums);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-切分"><a href="#2-切分" class="headerlink" title="2. 切分"></a>2. 切分</h5><p>取 a[l] 作为切分元素，然后从数组的左端向右扫描直到找到第一个大于等于它的元素，再从数组的右端向左扫描找到第一个小于它的元素，交换这两个元素。不断进行这个过程，就可以保证左指针 i 的左侧元素都不大于切分元素，右指针 j 的右侧元素都不小于切分元素。当两个指针相遇时，将切分元素 a[l] 和 a[j] 交换位置。</p>
<p><a href="https://camo.githubusercontent.com/ffc612e3e9f579a35c1bf2a68b368055cd5eabfc/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f63343835393239302d653237642d346631322d626563662d6532613563316633613237352e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/ffc612e3e9f579a35c1bf2a68b368055cd5eabfc/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f63343835393239302d653237642d346631322d626563662d6532613563316633613237352e676966" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(T[] nums, <span class="keyword">int</span> l, <span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = l, j = h + <span class="number">1</span>;</span><br><span class="line">  T v = nums[l];</span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (less(nums[++i], v) &amp;&amp; i != h) ;</span><br><span class="line">    <span class="keyword">while</span> (less(v, nums[--j]) &amp;&amp; j != l) ;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= j)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    swap(nums, i, j);</span><br><span class="line">  &#125;</span><br><span class="line">  swap(nums, l, j);</span><br><span class="line">  <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-性能分析"><a href="#3-性能分析" class="headerlink" title="3. 性能分析"></a>3. 性能分析</h5><p>快速排序是原地排序，不需要辅助数组，但是递归调用需要辅助栈。</p>
<p>快速排序最好的情况下是每次都正好将数组对半分，这样递归调用次数才是最少的。这种情况下比较次数为 CN=2CN/2+N，复杂度为 O(NlogN)。</p>
<p>最坏的情况下，第一次从最小的元素切分，第二次从第二小的元素切分，如此这般。因此最坏的情况下需要比较 N2/2。为了防止数组最开始就是有序的，在进行快速排序时需要随机打乱数组。</p>
<h5 id="4-算法改进"><a href="#4-算法改进" class="headerlink" title="4. 算法改进"></a>4. 算法改进</h5><h6 id="4-1-切换到插入排序"><a href="#4-1-切换到插入排序" class="headerlink" title="4.1 切换到插入排序"></a>4.1 切换到插入排序</h6><p>因为快速排序在小数组中也会递归调用自己，对于小数组，插入排序比快速排序的性能更好，因此在小数组中可以切换到插入排序。</p>
<h6 id="4-2-三数取中"><a href="#4-2-三数取中" class="headerlink" title="4.2 三数取中"></a>4.2 三数取中</h6><p>最好的情况下是每次都能取数组的中位数作为切分元素，但是计算中位数的代价很高。一种折中方法是取 3 个元素，并将大小居中的元素作为切分元素。</p>
<h6 id="4-3-三向切分"><a href="#4-3-三向切分" class="headerlink" title="4.3 三向切分"></a>4.3 三向切分</h6><p>对于有大量重复元素的数组，可以将数组切分为三部分，分别对应小于、等于和大于切分元素。</p>
<p>三向切分快速排序对于有大量重复元素的随机数组可以在线性时间内完成排序。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeWayQuickSort</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">QuickSort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums, <span class="keyword">int</span> l, <span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (h &lt;= l) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> lt = l, i = l + <span class="number">1</span>, gt = h;</span><br><span class="line">    T v = nums[l];</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= gt) &#123;</span><br><span class="line">      <span class="keyword">int</span> cmp = nums[i].compareTo(v);</span><br><span class="line">      <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        swap(nums, lt++, i++);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        swap(nums, i, gt--);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(nums, l, lt - <span class="number">1</span>);</span><br><span class="line">    sort(nums, gt + <span class="number">1</span>, h);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-基于切分的快速选择算法"><a href="#5-基于切分的快速选择算法" class="headerlink" title="5. 基于切分的快速选择算法"></a>5. 基于切分的快速选择算法</h5><p>快速排序的 partition() 方法，会返回一个整数 j 使得 a[l..j-1] 小于等于 a[j]，且 a[j+1..h] 大于等于 a[j]，此时 a[j] 就是数组的第 j 大元素。</p>
<p>可以利用这个特性找出数组的第 k 个元素。</p>
<p>该算法是线性级别的，假设每次能将数组二分，那么比较的总次数为 (N+N/2+N/4+..)，直到找到第 k 个元素，这个和显然小于 2N。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">select</span><span class="params">(T[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">0</span>, h = nums.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (h &gt; l) &#123;</span><br><span class="line">    <span class="keyword">int</span> j = partition(nums, l, h);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (j == k) &#123;</span><br><span class="line">      <span class="keyword">return</span> nums[k];</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j &gt; k) &#123;</span><br><span class="line">      h = j - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      l = j + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nums[k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h4><h5 id="1-堆"><a href="#1-堆" class="headerlink" title="1. 堆"></a>1. 堆</h5><p>堆中某个节点的值总是大于等于或小于等于其子节点的值，并且堆是一颗完全二叉树。</p>
<p>堆可以用数组来表示，这是因为堆是完全二叉树，而完全二叉树很容易就存储在数组中。位置 k 的节点的父节点位置为 k/2，而它的两个子节点的位置分别为 2k 和 2k+1。这里不使用数组索引为 0 的位置，是为了更清晰地描述节点的位置关系。</p>
<p><a href="https://camo.githubusercontent.com/e35f8858d4eef74d1f2ebd9e375f712ed30ba7c1/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f66343838383363382d396438612d343934652d393961342d3331376438646462383535322e706e67" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/e35f8858d4eef74d1f2ebd9e375f712ed30ba7c1/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f66343838383363382d396438612d343934652d393961342d3331376438646462383535322e706e67" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Heap</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> T[] heap;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> N = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Heap</span><span class="params">(<span class="keyword">int</span> maxN)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.heap = (T[]) <span class="keyword">new</span> Comparable[maxN + <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> N == <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> N;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">less</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> heap[i].compareTo(heap[j]) &lt; <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    T t = heap[i];</span><br><span class="line">    heap[i] = heap[j];</span><br><span class="line">    heap[j] = t;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-上浮和下沉"><a href="#2-上浮和下沉" class="headerlink" title="2. 上浮和下沉"></a>2. 上浮和下沉</h5><p>在堆中，当一个节点比父节点大，那么需要交换这个两个节点。交换后还可能比它新的父节点大，因此需要不断地进行比较和交换操作，把这种操作称为上浮。</p>
<p><a href="https://camo.githubusercontent.com/8834662976c5fff405ba8b697a5a694dfd53f3d0/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f39396435653834652d666332612d343961332d383235392d3864653237343631373735362e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/8834662976c5fff405ba8b697a5a694dfd53f3d0/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f39396435653834652d666332612d343961332d383235392d3864653237343631373735362e676966" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (k &gt; <span class="number">1</span> &amp;&amp; less(k / <span class="number">2</span>, k)) &#123;</span><br><span class="line">    swap(k / <span class="number">2</span>, k);</span><br><span class="line">    k = k / <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类似地，当一个节点比子节点来得小，也需要不断地向下进行比较和交换操作，把这种操作称为下沉。一个节点如果有两个子节点，应当与两个子节点中最大那个节点进行交换。</p>
<p><a href="https://camo.githubusercontent.com/ed9e4c1c03e7af351d0e312ddd2e574e458a3be9/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f34626635653366622d613238352d343133382d623362362d3738303935366562316466312e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/ed9e4c1c03e7af351d0e312ddd2e574e458a3be9/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f34626635653366622d613238352d343133382d623362362d3738303935366562316466312e676966" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sink</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= N) &#123;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">2</span> * k;</span><br><span class="line">    <span class="keyword">if</span> (j &lt; N &amp;&amp; less(j, j + <span class="number">1</span>))</span><br><span class="line">      j++;</span><br><span class="line">    <span class="keyword">if</span> (!less(k, j))</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    swap(k, j);</span><br><span class="line">    k = j;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-插入元素"><a href="#3-插入元素" class="headerlink" title="3. 插入元素"></a>3. 插入元素</h5><p>将新元素放到数组末尾，然后上浮到合适的位置。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Comparable v)</span> </span>&#123;</span><br><span class="line">  heap[++N] = v;</span><br><span class="line">  swim(N);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-删除最大元素"><a href="#4-删除最大元素" class="headerlink" title="4. 删除最大元素"></a>4. 删除最大元素</h5><p>从数组顶端删除最大的元素，并将数组的最后一个元素放到顶端，并让这个元素下沉到合适的位置。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">delMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  T max = heap[<span class="number">1</span>];</span><br><span class="line">  swap(<span class="number">1</span>, N--);</span><br><span class="line">  heap[N + <span class="number">1</span>] = <span class="keyword">null</span>;</span><br><span class="line">  sink(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-堆排序"><a href="#5-堆排序" class="headerlink" title="5. 堆排序"></a>5. 堆排序</h5><p>把最大元素和当前堆中数组的最后一个元素交换位置，并且不删除它，那么就可以得到一个从尾到头的递减序列，从正向来看就是一个递增序列，这就是堆排序。</p>
<h6 id="5-1-构建堆"><a href="#5-1-构建堆" class="headerlink" title="5.1 构建堆"></a>5.1 构建堆</h6><p>无序数组建立堆最直接的方法是从左到右遍历数组进行上浮操作。一个更高效的方法是从右至左进行下沉操作，如果一个节点的两个节点都已经是堆有序，那么进行下沉操作可以使得这个节点为根节点的堆有序。叶子节点不需要进行下沉操作，可以忽略叶子节点的元素，因此只需要遍历一半的元素即可。</p>
<p><a href="https://camo.githubusercontent.com/e0c6925e9a108b4a2a959993770d7d28431dba2c/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f63326361386464322d386430302d346133652d626563652d6462373834396163396366642e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/e0c6925e9a108b4a2a959993770d7d28431dba2c/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f63326361386464322d386430302d346133652d626563652d6462373834396163396366642e676966" alt="img"></a></p>
<h6 id="5-2-交换堆顶元素与最后一个元素"><a href="#5-2-交换堆顶元素与最后一个元素" class="headerlink" title="5.2 交换堆顶元素与最后一个元素"></a>5.2 交换堆顶元素与最后一个元素</h6><p>交换之后需要进行下沉操作维持堆的有序状态。</p>
<p><a href="https://camo.githubusercontent.com/832b0a4113917a79bffa3b94ccc57f0840d2b912/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f64313536626364612d616338642d343332342d393565302d3063386466343135363763392e676966" target="_blank" rel="noopener"><img data-src="https://camo.githubusercontent.com/832b0a4113917a79bffa3b94ccc57f0840d2b912/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f64313536626364612d616338642d343332342d393565302d3063386466343135363763392e676966" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Sort</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数组第 0 个位置不能有元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = N / <span class="number">2</span>; k &gt;= <span class="number">1</span>; k--)</span><br><span class="line">      sink(nums, k, N);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (N &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      swap(nums, <span class="number">1</span>, N--);</span><br><span class="line">      sink(nums, <span class="number">1</span>, N);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sink</span><span class="params">(T[] nums, <span class="keyword">int</span> k, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= N) &#123;</span><br><span class="line">      <span class="keyword">int</span> j = <span class="number">2</span> * k;</span><br><span class="line">      <span class="keyword">if</span> (j &lt; N &amp;&amp; less(nums, j, j + <span class="number">1</span>))</span><br><span class="line">        j++;</span><br><span class="line">      <span class="keyword">if</span> (!less(nums, k, j))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      swap(nums, k, j);</span><br><span class="line">      k = j;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">less</span><span class="params">(T[] nums, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nums[i].compareTo(nums[j]) &lt; <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6-分析"><a href="#6-分析" class="headerlink" title="6. 分析"></a>6. 分析</h5><p>一个堆的高度为 logN，因此在堆中插入元素和删除最大元素的复杂度都为 logN。</p>
<p>对于堆排序，由于要对 N 个节点进行下沉操作，因此复杂度为 NlogN。</p>
<p>堆排序是一种原地排序，没有利用额外的空间。</p>
<p>现代操作系统很少使用堆排序，因为它无法利用局部性原理进行缓存，也就是数组元素很少和相邻的元素进行比较和交换。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><h5 id="1-排序算法的比较"><a href="#1-排序算法的比较" class="headerlink" title="1. 排序算法的比较"></a>1. 排序算法的比较</h5><table>
<thead>
<tr>
<th>算法</th>
<th>稳定性</th>
<th>时间复杂度</th>
<th>空间复杂度</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>选择排序</td>
<td>×</td>
<td>N2</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>冒泡排序</td>
<td>√</td>
<td>N2</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>插入排序</td>
<td>√</td>
<td>N ~ N2</td>
<td>1</td>
<td>时间复杂度和初始顺序有关</td>
</tr>
<tr>
<td>希尔排序</td>
<td>×</td>
<td>N 的若干倍乘于递增序列的长度</td>
<td>1</td>
<td>改进版插入排序</td>
</tr>
<tr>
<td>快速排序</td>
<td>×</td>
<td>NlogN</td>
<td>logN</td>
<td></td>
</tr>
<tr>
<td>三向切分快速排序</td>
<td>×</td>
<td>N ~ NlogN</td>
<td>logN</td>
<td>适用于有大量重复主键</td>
</tr>
<tr>
<td>归并排序</td>
<td>√</td>
<td>NlogN</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>堆排序</td>
<td>×</td>
<td>NlogN</td>
<td>1</td>
<td>无法利用局部性原理</td>
</tr>
</tbody></table>
<p>快速排序是最快的通用排序算法，它的内循环的指令很少，而且它还能利用缓存，因为它总是顺序地访问数据。它的运行时间近似为 ~cNlogN，这里的 c 比其它线性对数级别的排序算法都要小。</p>
<p>使用三向切分快速排序，实际应用中可能出现的某些分布的输入能够达到线性级别，而其它排序算法仍然需要线性对数时间。</p>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><h3 id="推荐算法"><a href="#推荐算法" class="headerlink" title="推荐算法"></a>推荐算法</h3><h2 id="Java-语言"><a href="#Java-语言" class="headerlink" title="Java 语言"></a>Java 语言</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="多态-1"><a href="#多态-1" class="headerlink" title="多态"></a>多态</h4><p>多态的三个条件：</p>
<ol>
<li>要有继承关系</li>
<li>子类要重写父类的方法</li>
<li>父类引用指向子类对象</li>
</ol>
<h4 id="为什么说-Java-语言“编译与解释并存”？"><a href="#为什么说-Java-语言“编译与解释并存”？" class="headerlink" title="为什么说 Java 语言“编译与解释并存”？"></a>为什么说 Java 语言“编译与解释并存”？</h4><p>高级编程语言按照程序的执行方式分为编译型和解释型两种。简单来说，编译型语言是指编译器针对特定的操作系统将源代码一次性翻译成可被该平台执行的机器码；解释型语言是指解释器对源程序逐行解释成特定平台的机器码并立即执行。</p>
<p>Java 语言既具有编译型语言的特征，也具有解释型语言的特征，因为 Java 程序要经过先编译，后解释两个步骤，由 Java 编写的程序需要先经过编译步骤，生成字节码（*.class 文件），这种字节码必须由 Java 解释器来解释执行。因此，我们可以认为 Java 语言编译与解释并存。</p>
<h4 id="Java中的几种基本数据类型是什么？对应的包装类型是什么？各自占用多少字节呢？"><a href="#Java中的几种基本数据类型是什么？对应的包装类型是什么？各自占用多少字节呢？" class="headerlink" title="Java中的几种基本数据类型是什么？对应的包装类型是什么？各自占用多少字节呢？"></a>Java中的几种基本数据类型是什么？对应的包装类型是什么？各自占用多少字节呢？</h4><p>Java<strong>中</strong>有8种基本数据类型，分别为：</p>
<ol>
<li>6种数字类型 ：byte、short、int、long、float、double</li>
<li>1种字符类型：char</li>
<li>1种布尔型：boolean。</li>
</ol>
<p>这八种基本类型都有对应的包装类分别为：Byte、Short、Integer、Long、Float、Double、Character、Boolean</p>
<table>
<thead>
<tr>
<th>基本类型</th>
<th>位数</th>
<th>字节</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>int</td>
<td>32</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td>short</td>
<td>16</td>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>long</td>
<td>64</td>
<td>8</td>
<td>0L</td>
</tr>
<tr>
<td>byte</td>
<td>8</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>char</td>
<td>16</td>
<td>2</td>
<td>‘u0000’</td>
</tr>
<tr>
<td>float</td>
<td>32</td>
<td>4</td>
<td>0f</td>
</tr>
<tr>
<td>double</td>
<td>64</td>
<td>8</td>
<td>0d</td>
</tr>
<tr>
<td>boolean</td>
<td>1</td>
<td></td>
<td>false</td>
</tr>
</tbody></table>
<h4 id="为什么-Java-中只有值传递？"><a href="#为什么-Java-中只有值传递？" class="headerlink" title="为什么 Java 中只有值传递？"></a>为什么 Java 中只有值传递？</h4><p>Java 对对象的传递，传递的是对象引用的一份拷贝，虽然会可以通过引用修改对象的状态，但出了方法后原变量的引用并没有改变，即对象引用是按值传递的。</p>
<h3 id="包装类"><a href="#包装类" class="headerlink" title="包装类"></a>包装类</h3><h4 id="哪些地方会自动拆装箱"><a href="#哪些地方会自动拆装箱" class="headerlink" title="哪些地方会自动拆装箱"></a>哪些地方会自动拆装箱</h4><ol>
<li>将基本数据类型放入集合类</li>
<li>包装类型和基本类型的大小比较</li>
<li>包装类型的运算</li>
<li>函数参数与返回值</li>
</ol>
<h4 id="java-是否存在使得语句-i-gt-j-i-lt-j-结果为-false-的-i、j-值？"><a href="#java-是否存在使得语句-i-gt-j-i-lt-j-结果为-false-的-i、j-值？" class="headerlink" title="java 是否存在使得语句 i &gt; j || i &lt;= j 结果为 false 的 i、j 值？"></a>java 是否存在使得语句 <code>i &gt; j || i &lt;= j</code> 结果为 false 的 i、j 值？</h4><p>存在，java 的数值 NaN 代表 not a number，无法用于比较，例如使 <code>i = Double.NaN; j = i;</code> 最后 i == j 的结果依旧为 false。</p>
<h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><p>Java 泛型（generics）是 JDK 5 中引入的一个新特性, 泛型提供了编译时类型安全检测机制，该机制允许程序员在编译时检测到非法的类型。</p>
<p>泛型的本质是参数化类型，也就是说所操作的数据类型被指定为一个参数。</p>
<h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><h4 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h4><p><strong>JDK 1.8 之前：</strong></p>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/java内存区域/JVM运行时数据区域.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.png" alt="img"></a></p>
<p><strong>JDK 1.8 ：</strong></p>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/java内存区域/2019-3Java运行时数据区域JDK1.8.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/2019-3Java%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9FJDK1.8.png" alt="img"></a></p>
<h4 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h4><p>每个 Java 方法在执行的同时会创建一个栈帧用于存储局部变量表、操作数栈、动态链接、方法出口等信息。</p>
<p>从方法调用直至执行完成的过程，对应着一个栈帧在 Java 虚拟机栈中入栈和出栈的过程。</p>
<h4 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h4><p>Java 堆是垃圾收集器管理的主要区域，因此也被称作<strong>GC 堆（Garbage Collected Heap）</strong>.从垃圾回收的角度，由于现在收集器基本都采用分代垃圾收集算法，所以 Java 堆还可以细分为：新生代和老年代：再细致一点有：Eden 空间、From Survivor、To Survivor 空间等。<strong>进一步划分的目的是更好地回收内存，或者更快地分配内存。</strong></p>
<p>在 JDK 7 版本及JDK 7 版本之前，堆内存被通常被分为下面三部分：</p>
<ol>
<li>新生代内存(Young Generation)</li>
<li>老生代(Old Generation)</li>
<li>永生代(Permanent Generation)</li>
</ol>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/java内存区域/JVM堆内存结构-JDK7.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/JVM%E5%A0%86%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84-JDK7.png" alt="JVM堆内存结构-JDK7"></a></p>
<p>JDK 8 版本之后方法区（HotSpot 的永久代）被彻底移除了（JDK1.7 就已经开始了），取而代之是元空间，元空间使用的是直接内存。</p>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/java内存区域/JVM堆内存结构-jdk8.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/JVM%E5%A0%86%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84-jdk8.png" alt="JVM堆内存结构-JDK8"></a></p>
<h5 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h5><p>Hotspot的对象头主要包括两部分数据：Mark Word（标记字段）、Klass Pointer（类型指针）。</p>
<p><strong>Mark Word</strong>：默认存储对象的HashCode，分代年龄和锁标志位信息。Mark Word被设计成一个非固定的数据结构以便在极小的空间内存存储尽量多的数据。它会根据对象的状态复用自己的存储空间，也就是说在运行期间Mark Word里存储的数据会随着锁标志位的变化而变化。</p>
<table>
<thead>
<tr>
<th align="left">状态</th>
<th align="left">存储内容</th>
<th align="left">锁标记</th>
</tr>
</thead>
<tbody><tr>
<td align="left">无锁</td>
<td align="left">对象的hashCode、对象分代年龄、是否是偏向锁（0）</td>
<td align="left">01</td>
</tr>
<tr>
<td align="left">偏向锁</td>
<td align="left">偏向线程ID、偏向时间戳、对象分代年龄、是否是偏向锁（1）</td>
<td align="left">01</td>
</tr>
<tr>
<td align="left">轻量级锁</td>
<td align="left">指向栈中锁记录的指针</td>
<td align="left">00</td>
</tr>
<tr>
<td align="left">重量级锁</td>
<td align="left">指向互斥量（重量级锁）的指针</td>
<td align="left">10</td>
</tr>
</tbody></table>
<p><strong>Klass Point</strong>：对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。</p>
<h4 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h4><p>方法区与 Java 堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。虽然 <strong>Java 虚拟机规范把方法区描述为堆的一个逻辑部分</strong>，但是它却有一个别名叫做 <strong>Non-Heap（非堆）</strong>，目的应该是与 Java 堆区分开来。</p>
<p>方法区也被称为永久代。很多人都会分不清方法区和永久代的关系，为此我也查阅了文献。</p>
<h5 id="方法区和永久代的关系"><a href="#方法区和永久代的关系" class="headerlink" title="方法区和永久代的关系"></a>方法区和永久代的关系</h5><blockquote>
<p>《Java 虚拟机规范》只是规定了有方法区这么个概念和它的作用，并没有规定如何去实现它。那么，在不同的 JVM 上方法区的实现肯定是不同的了。 <strong>方法区和永久代的关系很像 Java 中接口和类的关系，类实现了接口，而永久代就是 HotSpot 虚拟机对虚拟机规范中方法区的一种实现方式。</strong> 也就是说，永久代是 HotSpot 的概念，方法区是 Java 虚拟机规范中的定义，是一种规范，而永久代是一种实现，一个是标准一个是实现，其他的虚拟机实现并没有永久代这一说法。</p>
</blockquote>
<h4 id="对象的访问定位"><a href="#对象的访问定位" class="headerlink" title="对象的访问定位"></a>对象的访问定位</h4><p>建立对象就是为了使用对象，我们的 Java 程序通过栈上的 reference 数据来操作堆上的具体对象。对象的访问方式由虚拟机实现而定，目前主流的访问方式有<strong>①使用句柄</strong>和<strong>②直接指针</strong>两种：</p>
<ol>
<li><strong>句柄：</strong> 如果使用句柄的话，那么 Java 堆中将会划分出一块内存来作为句柄池，reference 中存储的就是对象的句柄地址，而句柄中包含了对象实例数据与类型数据各自的具体地址信息； <a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/java内存区域/对象的访问定位-使用句柄.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D-%E4%BD%BF%E7%94%A8%E5%8F%A5%E6%9F%84.png" alt="对象的访问定位-使用句柄"></a></li>
<li><strong>直接指针：</strong> 如果使用直接指针访问，那么 Java 堆对象的布局中就必须考虑如何放置访问类型数据的相关信息，而 reference 中存储的直接就是对象的地址。</li>
</ol>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/java内存区域/对象的访问定位-直接指针.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D-%E7%9B%B4%E6%8E%A5%E6%8C%87%E9%92%88.png" alt="对象的访问定位-直接指针"></a></p>
<p><strong>这两种对象访问方式各有优势。使用句柄来访问的最大好处是 reference 中存储的是稳定的句柄地址，在对象被移动时只会改变句柄中的实例数据指针，而 reference 本身不需要修改。使用直接指针访问方式最大的好处就是速度快，它节省了一次指针定位的时间开销。</strong></p>
<h4 id="类加载机制"><a href="#类加载机制" class="headerlink" title="类加载机制"></a>类加载机制</h4><h5 id="类的生命周期-类加载过程"><a href="#类的生命周期-类加载过程" class="headerlink" title="类的生命周期/类加载过程"></a>类的生命周期/类加载过程</h5><p>类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括 <span style="color: red">7 个阶段</span>。其中准备、验证、解析 3 个部分统称为连接（Linking）。</p>
<p>加载(loading) –&gt; 验证(Verification) –&gt;准备(Preparation) –&gt; 解析(Resolution) –&gt; 初始化(Initialization) –&gt; 使用(Using) –&gt; 卸载(Unloading)</p>
<p><img data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f14bd8d34554d94a925fab4bbdc7911~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h6 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h6><p>将 <code>.class</code> 文件加载到 JVM 运行时数据区的<strong>方法区</strong>内，然后在堆中创建一个 java.lang.Class 对象，用来封装类在方法区内的数据结构。</p>
<p><code>.class</code> 文件来源：</p>
<ol>
<li>本地磁盘</li>
<li>网络下载</li>
<li>zip、jar 等归档文件中</li>
<li>数据库</li>
<li>动态编译 Java 源文件</li>
</ol>
<h6 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h6><p>验证的目的是为了确保 Class 文件中的字节流包含的信息符合当前虚拟机的要求，而且不会危害虚拟机自身的安全。</p>
<p>包括以下四个阶段的验证：</p>
<ol>
<li><p>文件格式的验证</p>
<p>是否以 <code>0xCAFEBABE</code> 开头、主次版本号是否在当前虚拟机的处理范围之内、常量池中的常量是否有不被支持的类型。</p>
</li>
<li><p>元数据的验证</p>
<p>对字节码描述的信息进行语义分析。例如：这个类是否有父类，除了java.lang.Object 之外。</p>
</li>
<li><p>字节码验证</p>
<p>通过数据流和控制流分析，确定程序语义是合法的、符合逻辑的。</p>
</li>
<li><p>符号引用验证</p>
</li>
</ol>
<h6 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h6><p>为类的<span style="color: red">静态变量</span>分配内存，并根据数据类型将其初始化为默认的<span style="color: red">零值</span>(注意不是程序中设置的值)</p>
<p><span style="color: red">注意</span>：如果是常量(static final)，且在声明时就指定了初始值，则会直接赋值为指定值。</p>
<h6 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h6><p>将常量池中的符号引用转换为直接引用。</p>
<h6 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h6><p>初始化<strong>类变量</strong></p>
<p><strong>类初始化时机</strong>：</p>
<ol>
<li>创建类的实例，也就是 new 一个对象</li>
<li>访问某个类或接口的静态变量</li>
<li>调用类的静态方法</li>
<li>反射 <code>Class.forName(&quot;&quot;)</code></li>
<li>初始化一个类的子类（会首先初始化子类的父类）</li>
<li>JVM 启动时标明的启动类</li>
</ol>
<h5 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h5><h6 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h6><ol>
<li><p>启动类加载器</p>
<p>负责加载 <code>JAVA_HOME\lib</code> 目录中能被虚拟机识别的类，可以通过 <code>Launcher.getBootstrapClassPath().getURLs()</code> 查看。</p>
<p>由 C++ 实现，无法被 Java 程序直接引用。</p>
</li>
<li><p>扩展类加载器</p>
<p>负责加载 <code>JAVA_HOME\lib\ext</code> 目录下的类</p>
</li>
<li><p>应用类加载器</p>
<p>责加载用户类路径（ClassPath）所指定的类</p>
</li>
</ol>
<h6 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a>继承关系</h6><p>通过组合的方式实现的继承关系。</p>
<ul>
<li><p>启动类加载器没有父类</p>
</li>
<li><p>扩展类加载器的父类为 null</p>
</li>
<li><p>应用类加载器继承自扩展类加载器</p>
</li>
<li><p>自定义类加载器继承自引用类加载器</p>
</li>
</ul>
<h5 id="双亲委派模型"><a href="#双亲委派模型" class="headerlink" title="双亲委派模型"></a>双亲委派模型</h5><p>当类加载器收到了类加载的请求，它首先把请求委托给父加载器去完成，当父加载器无法加载时，子加载器才会尝试自己去加载该类。</p>
<h6 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h6><ol>
<li>防止重复加载</li>
<li>保证 Java 基础类的安全性</li>
</ol>
<h6 id="双亲委派模型的破坏者-线程上下文类加载器"><a href="#双亲委派模型的破坏者-线程上下文类加载器" class="headerlink" title="双亲委派模型的破坏者-线程上下文类加载器"></a>双亲委派模型的破坏者-线程上下文类加载器</h6><p>在Java应用中存在着很多服务提供者接口（Service Provider Interface，SPI），这些接口允许第三方为它们提供实现，如常见的 SPI 有 JDBC、JNDI 等，这些 SPI 的接口属于 Java 核心库，一般存在 rt.jar 包中，由 Bootstrap 类加载器加载，而 SPI 的第三方实现代码则是作为Java应用所依赖的 jar 包被存放在 classpath 路径下，由于启动类加载器无法直接加载 SPI 的实现类，同时由于双亲委派模式的存在，Bootstrap 类加载器也无法反向委托AppClassLoader 加载器SPI的实现类。在这种情况下，我们就需要线程上下文类加载器。</p>
<p>线程上下文类加载器（contextClassLoader）可以通过<code>java.lang.Thread</code> 类中的<code>getContextClassLoader()</code> 和 <code>setContextClassLoader(ClassLoader cl)</code> 方法来获取和设置线程的上下文类加载器。如果没有手动设置上下文类加载器，线程将继承其父线程的上下文类加载器，初始线程的上下文类加载器是应用类加载器，在线程中运行的代码可以通过此类加载器来加载类和资源。</p>
<p><img data-src="https://img-blog.csdn.net/20170625143404387?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamF2YXplamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>“破坏”是指破坏了父类加载器无法加载子类加载器范围的类这样的规则。</p>
<p>就是通过在父类加载器中使用 <code>Thread.getContextClassLoader()</code> 获取到子类加载器，然后再调用子类加载器的 <code>findClass()</code> 方法去加载。</p>
<h4 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a>内存分配</h4><p><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01d330d8-2710-4fad-a91c-7bbbfaaefc0e.png" alt=""></p>
<p>大部分情况，对象都会首先在 Eden 区域分配，在一次新生代垃圾回收后，如果对象还存活，则会进入 s0 或者 s1，并且对象的年龄还会加 1(Eden 区-&gt;Survivor 区后对象的初始年龄变为 1)，当它的年龄增加到一定程度（默认为 15 岁），就会被晋升到老年代中。对象晋升到老年代的年龄阈值，可以通过参数 <code>-XX:MaxTenuringThreshold</code> 来设置。</p>
<p>Hotspot遍历所有对象时，按照年龄从小到大对其所占用的大小进行累积，当累积的某个年龄大小超过了survivor区的一半时，取这个年龄和MaxTenuringThreshold中更小的一个值，作为新的晋升年龄阈值。</p>
<h5 id="大对象直接进入老年代"><a href="#大对象直接进入老年代" class="headerlink" title="大对象直接进入老年代"></a>大对象直接进入老年代</h5><p>为了避免为大对象分配内存时由于分配担保机制带来的复制而降低效率。</p>
<p>分配担保机制就是进行了 Minor GC 还是无法满足，则将对象存到老年代。</p>
<p><img data-src="https://camo.githubusercontent.com/4d68bf3180587d6c478ff9af5b768bbac73a483aea41fdcd01d37ee6f3a92678/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323032302d382f62343832323863322d616330302d343636382d613738662d3666323231663835363362352e706e67" alt=""></p>
<h4 id="垃圾回收过程"><a href="#垃圾回收过程" class="headerlink" title="垃圾回收过程"></a>垃圾回收过程</h4><ul>
<li><strong>那些内存需要回收？</strong>(对象是否可以被回收的两种经典算法: 引用计数法 和 可达性分析算法)</li>
<li><strong>什么时候回收？</strong>(堆的新生代、老年代、永久代的垃圾回收时机，MinorGC 和 FullGC)</li>
<li><strong>如何回收？</strong>(三种经典垃圾回收算法(标记清除算法、复制算法、标记整理算法)及分代收集算法 和 七种垃圾收集器)</li>
</ul>
<h4 id="监测垃圾对象"><a href="#监测垃圾对象" class="headerlink" title="监测垃圾对象"></a>监测垃圾对象</h4><p><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/11034259.png" alt=""></p>
<h5 id="引用计数法"><a href="#引用计数法" class="headerlink" title="引用计数法"></a>引用计数法</h5><p><strong>这个方法实现简单，效率高，但是目前主流的虚拟机中并没有选择这个算法来管理内存，其最主要的原因是它很难解决对象之间相互循环引用的问题。</strong> </p>
<h5 id="可达性分析算法"><a href="#可达性分析算法" class="headerlink" title="可达性分析算法"></a>可达性分析算法</h5><p>可作为GC Roots的对象包括下面几种:</p>
<ul>
<li>虚拟机栈(栈帧中的本地变量表)中引用的对象</li>
<li>本地方法栈(Native方法)中引用的对象</li>
<li>方法区中类静态属性引用的对象</li>
<li>方法区中常量引用的对象</li>
</ul>
<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><p>JDK1.2 以后，Java 对引用的概念进行了扩充，将引用分为强引用、软引用、弱引用、虚引用四种（引用强度逐渐减弱）</p>
<p><strong>1．强引用（StrongReference）</strong></p>
<p>以前我们使用的大部分引用实际上都是强引用，这是使用最普遍的引用。如果一个对象具有强引用，那就类似于<strong>必不可少的生活用品</strong>，垃圾回收器绝不会回收它。当内存空间不足，Java 虚拟机宁愿抛出 OutOfMemoryError 错误，使程序异常终止，也不会靠随意回收具有强引用的对象来解决内存不足问题。</p>
<p><strong>2．软引用（SoftReference）</strong></p>
<p>如果一个对象只具有软引用，那就类似于<strong>可有可无的生活用品</strong>。如果内存空间足够，垃圾回收器就不会回收它，如果内存空间不足了，就会回收这些对象的内存。只要垃圾回收器没有回收它，该对象就可以被程序使用。软引用可用来实现内存敏感的高速缓存。</p>
<p>软引用可以和一个引用队列（ReferenceQueue）联合使用，如果软引用所引用的对象被垃圾回收，JAVA 虚拟机就会把这个软引用加入到与之关联的引用队列中。</p>
<p><strong>3．弱引用（WeakReference）</strong></p>
<p>如果一个对象只具有弱引用，那就类似于<strong>可有可无的生活用品</strong>。弱引用与软引用的区别在于：只具有弱引用的对象拥有更短暂的生命周期。在垃圾回收器线程扫描它所管辖的内存区域的过程中，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存。不过，由于垃圾回收器是一个优先级很低的线程， 因此不一定会很快发现那些只具有弱引用的对象。</p>
<p>弱引用可以和一个引用队列（ReferenceQueue）联合使用，如果弱引用所引用的对象被垃圾回收，Java 虚拟机就会把这个弱引用加入到与之关联的引用队列中。</p>
<p><strong>4．虚引用（PhantomReference）</strong></p>
<p>“虚引用”顾名思义，就是形同虚设，与其他几种引用都不同，虚引用并不会决定对象的生命周期。如果一个对象仅持有虚引用，那么它就和没有任何引用一样，在任何时候都可能被垃圾回收。</p>
<p><strong>虚引用主要用来跟踪对象被垃圾回收的活动</strong>。</p>
<p><strong>虚引用与软引用和弱引用的一个区别在于：</strong> 虚引用必须和引用队列（ReferenceQueue）联合使用。当垃圾回收器准备回收一个对象时，如果发现它还有虚引用，就会在回收对象的内存之前，把这个虚引用加入到与之关联的引用队列中。程序可以通过判断引用队列中是否已经加入了虚引用，来了解被引用的对象是否将要被垃圾回收。程序如果发现某个虚引用已经被加入到引用队列，那么就可以在所引用的对象的内存被回收之前采取必要的行动。</p>
<p>特别注意，在程序设计中一般很少使用弱引用与虚引用，使用软引用的情况较多，这是因为<strong>软引用可以加速 JVM 对垃圾内存的回收速度，可以维护系统的运行安全，防止内存溢出（OutOfMemory）等问题的产生</strong>。</p>
<h4 id="如何判断一个类是无用的类"><a href="#如何判断一个类是无用的类" class="headerlink" title="如何判断一个类是无用的类"></a>如何判断一个类是无用的类</h4><p>方法区主要回收的是无用的类，那么如何判断一个类是无用的类的呢？</p>
<p>判定一个常量是否是“废弃常量”比较简单，而要判定一个类是否是“无用的类”的条件则相对苛刻许多。类需要同时满足下面 3 个条件才能算是 <strong>“无用的类”</strong> ：</p>
<ul>
<li>该类所有的实例都已经被回收，也就是 Java 堆中不存在该类的任何实例。</li>
<li>加载该类的 <code>ClassLoader</code> 已经被回收。</li>
<li>该类对应的 <code>java.lang.Class</code> 对象没有在任何地方被引用，无法在任何地方通过反射访问该类的方法。</li>
</ul>
<p>虚拟机可以对满足上述 3 个条件的无用类进行回收，这里说的仅仅是“可以”，而并不是和对象一样不使用了就会必然被回收。</p>
<h4 id="垃圾收集算法"><a href="#垃圾收集算法" class="headerlink" title="垃圾收集算法"></a>垃圾收集算法</h4><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/垃圾收集算法.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95.png" alt="垃圾收集算法分类"></a></p>
<h5 id="标记-清除算法"><a href="#标记-清除算法" class="headerlink" title="标记-清除算法"></a>标记-清除算法</h5><p>该算法分为“标记”和“清除”阶段：首先标记出所有不需要回收的对象，在标记完成后统一回收掉所有没有被标记的对象。它是最基础的收集算法，后续的算法都是对其不足进行改进得到。这种垃圾收集算法会带来两个明显的问题：</p>
<ol>
<li><strong>效率问题</strong></li>
<li><strong>空间问题（标记清除后会产生大量不连续的碎片）</strong></li>
</ol>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/标记-清除算法.jpeg" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95.jpeg" alt="img"></a></p>
<h5 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h5><p>为了解决效率问题，“复制”收集算法出现了。它可以将内存分为大小相同的两块，每次使用其中的一块。当这一块的内存使用完后，就将还存活的对象复制到另一块去，然后再把使用的空间一次清理掉。这样就使每次的内存回收都是对内存区间的一半进行回收。</p>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/90984624.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/90984624.png" alt="复制算法"></a></p>
<h5 id="标记-整理算法"><a href="#标记-整理算法" class="headerlink" title="标记-整理算法"></a>标记-整理算法</h5><p>根据老年代的特点提出的一种标记算法，标记过程仍然与“标记-清除”算法一样，但后续步骤不是直接对可回收对象回收，而是让所有存活的对象向一端移动，然后直接清理掉端边界以外的内存。</p>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/94057049.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/94057049.png" alt="标记-整理算法 "></a></p>
<h5 id="分代收集算法"><a href="#分代收集算法" class="headerlink" title="分代收集算法"></a>分代收集算法</h5><p>当前虚拟机的垃圾收集都采用分代收集算法，这种算法没有什么新的思想，只是根据对象存活周期的不同将内存分为几块。一般将 java 堆分为新生代和老年代，这样我们就可以根据各个年代的特点选择合适的垃圾收集算法。</p>
<p><strong>比如在新生代中，每次收集都会有大量对象死去，所以可以选择复制算法，只需要付出少量对象的复制成本就可以完成每次垃圾收集。而老年代的对象存活几率是比较高的，而且没有额外的空间对它进行分配担保，所以我们必须选择“标记-清除”或“标记-整理”算法进行垃圾收集。</strong></p>
<h4 id="JVM-两种模式的区别"><a href="#JVM-两种模式的区别" class="headerlink" title="JVM 两种模式的区别"></a>JVM 两种模式的区别</h4><p>JVM工作在Server模式可以大大提高性能，但应用的启动会比client模式慢大概10%。</p>
<p>最主要的差别在于：-Server模式启动时，速度较慢，但是一旦运行起来后，性能将会有很大的提升。原因是：</p>
<p>当虚拟机运行在-client模式的时候，使用的是一个代号为C1的轻量级编译器，而-server模式启动的虚拟机采用相对重量级，代号为C2的编译器。C2比C1编译器编译的相对彻底，服务起来之后，性能更高。</p>
<h4 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h4><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/垃圾收集器.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="垃圾收集器分类"></a></p>
<p><strong>如果说收集算法是内存回收的方法论，那么垃圾收集器就是内存回收的具体实现。</strong></p>
<h5 id="Serial-收集器"><a href="#Serial-收集器" class="headerlink" title="Serial 收集器"></a>Serial 收集器</h5><p>Serial（串行）收集器是最基本、历史最悠久的垃圾收集器了。大家看名字就知道这个收集器是一个单线程收集器了。它的 <strong>“单线程”</strong> 的意义不仅仅意味着它只会使用一条垃圾收集线程去完成垃圾收集工作，更重要的是它在进行垃圾收集工作的时候必须暂停其他所有的工作线程（ <strong>“Stop The World”</strong> ），直到它收集结束。</p>
<p><strong>新生代采用复制算法，老年代采用标记-整理算法。</strong> <a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/46873026.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/46873026.png" alt=" Serial 收集器 "></a></p>
<p>虚拟机的设计者们当然知道 Stop The World 带来的不良用户体验，所以在后续的垃圾收集器设计中停顿时间在不断缩短。</p>
<p>但是 Serial 收集器有没有优于其他垃圾收集器的地方呢？当然有，它<strong>简单而高效（与其他收集器的单线程相比）</strong>。Serial 收集器由于没有线程交互的开销，自然可以获得很高的单线程收集效率。Serial 收集器对于运行在 Client 模式下的虚拟机来说是个不错的选择。</p>
<h5 id="ParNew-收集器"><a href="#ParNew-收集器" class="headerlink" title="ParNew 收集器"></a>ParNew 收集器</h5><p><strong>ParNew 收集器其实就是 Serial 收集器的多线程版本，除了使用多线程进行垃圾收集外，其余行为（控制参数、收集算法、回收策略等等）和 Serial 收集器完全一样。</strong></p>
<p><strong>新生代采用复制算法，老年代采用标记-整理算法。</strong> <a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/22018368.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/22018368.png" alt="ParNew 收集器 "></a></p>
<p>它是许多运行在 Server 模式下的虚拟机的首要选择，除了 Serial 收集器外，只有它能与 CMS 收集器（真正意义上的并发收集器）配合工作。</p>
<p><strong>并行和并发概念补充：</strong></p>
<ul>
<li><strong>并行（Parallel）</strong> ：指多条垃圾收集线程并行工作，但此时用户线程仍然处于等待状态。</li>
<li><strong>并发（Concurrent）</strong>：指用户线程与垃圾收集线程同时执行（但不一定是并行，可能会交替执行），用户程序在继续运行，而垃圾收集器运行在另一个 CPU 上。</li>
</ul>
<h5 id="Parallel-Scavenge-收集器"><a href="#Parallel-Scavenge-收集器" class="headerlink" title="Parallel Scavenge 收集器"></a>Parallel Scavenge 收集器</h5><p>Parallel Scavenge 收集器也是使用复制算法的多线程收集器，它看上去几乎和ParNew一样。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-XX:+UseParallelGC </span><br><span class="line"></span><br><span class="line">    使用 Parallel 收集器+ 老年代串行</span><br><span class="line"></span><br><span class="line">-XX:+UseParallelOldGC</span><br><span class="line"></span><br><span class="line">    使用 Parallel 收集器+ 老年代并行</span><br></pre></td></tr></table></figure>

<p><strong>Parallel Scavenge 收集器关注点是吞吐量（高效率的利用 CPU）。CMS 等垃圾收集器的关注点更多的是用户线程的停顿时间（提高用户体验）。所谓吞吐量就是 CPU 中用于运行用户代码的时间与 CPU 总消耗时间的比值。</strong> Parallel Scavenge 收集器提供了很多参数供用户找到最合适的停顿时间或最大吞吐量，如果对于收集器运作不太了解，手工优化存在困难的时候，使用Parallel Scavenge收集器配合自适应调节策略，把内存管理优化交给虚拟机去完成也是一个不错的选择。</p>
<p><strong>新生代采用复制算法，老年代采用标记-整理算法。</strong> <a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/parllel-scavenge收集器.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/parllel-scavenge%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="Parallel Scavenge 收集器 "></a></p>
<p><strong>是JDK1.8默认收集器</strong><br>使用 java -XX:+PrintCommandLineFlags -version命令查看</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-XX:InitialHeapSize&#x3D;262921408 -XX:MaxHeapSize&#x3D;4206742528 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC </span><br><span class="line">java version &quot;1.8.0_211&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span><br></pre></td></tr></table></figure>

<p>JDK1.8 默认使用的是Parallel Scavenge + Parallel Old，如果指定了-XX:+UseParallelGC参数，则默认指定了-XX:+UseParallelOldGC，可以使用-XX:-UseParallelOldGC来禁用该功能</p>
<h5 id="Serial-Old-收集器"><a href="#Serial-Old-收集器" class="headerlink" title="Serial Old 收集器"></a>Serial Old 收集器</h5><p><strong>Serial 收集器的老年代版本</strong>，它同样是一个单线程收集器。它主要有两大用途：一种用途是在 JDK1.5 以及以前的版本中与 Parallel Scavenge 收集器搭配使用，另一种用途是作为 CMS 收集器的后备方案。</p>
<h5 id="Parallel-Old-收集器"><a href="#Parallel-Old-收集器" class="headerlink" title="Parallel Old 收集器"></a>Parallel Old 收集器</h5><p><strong>Parallel Scavenge 收集器的老年代版本</strong>。使用多线程和“标记-整理”算法。在注重吞吐量以及 CPU 资源的场合，都可以优先考虑 Parallel Scavenge 收集器和 Parallel Old 收集器。</p>
<h5 id="CMS-收集器"><a href="#CMS-收集器" class="headerlink" title="CMS 收集器"></a>CMS 收集器</h5><p><strong>CMS（Concurrent Mark Sweep）收集器是一种以获取最短回收停顿时间为目标的收集器。它非常符合在注重用户体验的应用上使用。</strong></p>
<p><strong>CMS（Concurrent Mark Sweep）收集器是 HotSpot 虚拟机第一款真正意义上的并发收集器，它第一次实现了让垃圾收集线程与用户线程（基本上）同时工作。</strong></p>
<p>从名字中的<strong>Mark Sweep</strong>这两个词可以看出，CMS 收集器是一种 <strong>“标记-清除”算法</strong>实现的，它的运作过程相比于前面几种垃圾收集器来说更加复杂一些。整个过程分为四个步骤：</p>
<ul>
<li><strong>初始标记：</strong> 暂停所有的其他线程，并记录下直接与 root 相连的对象，速度很快 ；</li>
<li><strong>并发标记：</strong> 同时开启 GC 和用户线程，用一个闭包结构去记录可达对象。但在这个阶段结束，这个闭包结构并不能保证包含当前所有的可达对象。因为用户线程可能会不断的更新引用域，所以 GC 线程无法保证可达性分析的实时性。所以这个算法里会跟踪记录这些发生引用更新的地方。</li>
<li><strong>重新标记：</strong> 重新标记阶段就是为了修正并发标记期间因为用户程序继续运行而导致标记产生变动的那一部分对象的标记记录，这个阶段的停顿时间一般会比初始标记阶段的时间稍长，远远比并发标记阶段时间短</li>
<li><strong>并发清除：</strong> 开启用户线程，同时 GC 线程开始对未标记的区域做清扫。</li>
</ul>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/pictures/jvm垃圾回收/CMS收集器.png" target="_blank" rel="noopener"><img data-src="https://github.com/Snailclimb/JavaGuide/raw/master/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/CMS%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="CMS 垃圾收集器 "></a></p>
<p>从它的名字就可以看出它是一款优秀的垃圾收集器，主要优点：<strong>并发收集、低停顿</strong>。但是它有下面三个明显的缺点：</p>
<ul>
<li><strong>对 CPU 资源敏感；</strong></li>
<li><strong>无法处理浮动垃圾；</strong></li>
<li><strong>它使用的回收算法-“标记-清除”算法会导致收集结束时会有大量空间碎片产生。</strong></li>
</ul>
<h5 id="G1-收集器"><a href="#G1-收集器" class="headerlink" title="G1 收集器"></a>G1 收集器</h5><p><strong>G1 (Garbage-First) 是一款面向服务器的垃圾收集器,主要针对配备多颗处理器及大容量内存的机器. 以极高概率满足 GC 停顿时间要求的同时,还具备高吞吐量性能特征.</strong></p>
<p>被视为 JDK1.7 中 HotSpot 虚拟机的一个重要进化特征。它具备一下特点：</p>
<ul>
<li><strong>并行与并发</strong>：G1 能充分利用 CPU、多核环境下的硬件优势，使用多个 CPU（CPU 或者 CPU 核心）来缩短 Stop-The-World 停顿时间。部分其他收集器原本需要停顿 Java 线程执行的 GC 动作，G1 收集器仍然可以通过并发的方式让 java 程序继续执行。</li>
<li><strong>分代收集</strong>：虽然 G1 可以不需要其他收集器配合就能独立管理整个 GC 堆，但是还是保留了分代的概念。</li>
<li><strong>空间整合</strong>：与 CMS 的“标记–清理”算法不同，G1 从整体来看是基于“标记整理”算法实现的收集器；从局部上来看是基于“复制”算法实现的。</li>
<li><strong>可预测的停顿</strong>：这是 G1 相对于 CMS 的另一个大优势，降低停顿时间是 G1 和 CMS 共同的关注点，但 G1 除了追求低停顿外，还能建立可预测的停顿时间模型，能让使用者明确指定在一个长度为 M 毫秒的时间片段内。</li>
</ul>
<p>G1 收集器的运作大致分为以下几个步骤：</p>
<ul>
<li><strong>初始标记</strong></li>
<li><strong>并发标记</strong></li>
<li><strong>最终标记</strong></li>
<li><strong>筛选回收</strong></li>
</ul>
<p><strong>G1 收集器在后台维护了一个优先列表，每次根据允许的收集时间，优先选择回收价值最大的 Region(这也就是它的名字 Garbage-First 的由来)</strong>。这种使用 Region 划分内存空间以及有优先级的区域回收方式，保证了 G1 收集器在有限时间内可以尽可能高的收集效率（把内存化整为零）。</p>
<h4 id="JDK-监控和故障处理工具"><a href="#JDK-监控和故障处理工具" class="headerlink" title="JDK 监控和故障处理工具"></a>JDK 监控和故障处理工具</h4><h5 id="JDK-命令行工具"><a href="#JDK-命令行工具" class="headerlink" title="JDK 命令行工具"></a>JDK 命令行工具</h5><p>这些命令在 JDK 安装目录下的 bin 目录下：</p>
<ul>
<li><strong><code>jps</code></strong> (JVM Process Status）: 类似 UNIX 的 <code>ps</code> 命令。用户查看所有 Java 进程的启动类、传入参数和 Java 虚拟机参数等信息；</li>
<li><strong><code>jstat</code></strong>（ JVM Statistics Monitoring Tool）: 用于收集 HotSpot 虚拟机各方面的运行数据;</li>
<li><strong><code>jinfo</code></strong> (Configuration Info for Java) : Configuration Info forJava,显示虚拟机配置信息;</li>
<li><strong><code>jmap</code></strong> (Memory Map for Java) :生成堆转储快照;</li>
<li><strong><code>jhat</code></strong> (JVM Heap Dump Browser ) : 用于分析 heapdump 文件，它会建立一个 HTTP/HTML 服务器，让用户可以在浏览器上查看分析结果;</li>
<li><strong><code>jstack</code></strong> (Stack Trace for Java):生成虚拟机当前时刻的线程快照，线程快照就是当前虚拟机内每一条线程正在执行的方法堆栈的集合。</li>
</ul>
<h5 id="JDK-可视化分析工具"><a href="#JDK-可视化分析工具" class="headerlink" title="JDK 可视化分析工具"></a>JDK 可视化分析工具</h5><h6 id="JConsole-Java-监视与管理控制台"><a href="#JConsole-Java-监视与管理控制台" class="headerlink" title="JConsole:Java 监视与管理控制台"></a>JConsole:Java 监视与管理控制台</h6><p>JConsole 是基于 JMX 的可视化监视、管理工具。可以很方便的监视本地及远程服务器的 java 进程的内存使用情况。你可以在控制台输出<code>console</code>命令启动或者在 JDK 目录下的 bin 目录找到<code>jconsole.exe</code>然后双击启动。</p>
<h6 id="Visual-VM-多合一故障处理工具"><a href="#Visual-VM-多合一故障处理工具" class="headerlink" title="Visual VM:多合一故障处理工具"></a>Visual VM:多合一故障处理工具</h6><p>VisualVM 提供在 Java 虚拟机 (Java Virutal Machine, JVM) 上运行的 Java 应用程序的详细信息。在 VisualVM 的图形用户界面中，您可以方便、快捷地查看多个 Java 应用程序的相关信息。</p>
<h4 id="synchronized-锁"><a href="#synchronized-锁" class="headerlink" title="synchronized 锁"></a>synchronized 锁</h4><p>synchronized通过Monitor来实现线程同步，Monitor是依赖于底层操作系统的Mutex Lock（互斥锁）来实现的线程同步。</p>
<p>锁一共四种状态，级别从低到高依次是：无锁、偏向锁、轻量级锁和重量级锁。锁状态只能升级不能降级。</p>
<p>锁状态存放在JVM对象头中的 Mark Word 中。</p>
<h5 id="无锁"><a href="#无锁" class="headerlink" title="无锁"></a>无锁</h5><p>无锁没有对资源进行锁定，所有的线程都能访问并修改同一个资源，但同时只有一个线程能修改成功。</p>
<p>无锁的特点就是修改操作在循环内进行，CAS原理及应用即是无锁的实现。</p>
<h5 id="偏向锁"><a href="#偏向锁" class="headerlink" title="偏向锁"></a>偏向锁</h5><p>在大多数情况下，锁总是由同一线程多次获得，不存在多线程竞争，所以出现了偏向锁。其目标就是在只有一个线程执行同步代码块时能够提高性能。</p>
<p>当一个线程访问同步代码块并获取锁时，会在Mark Word里存储锁偏向的线程ID。在线程进入和退出同步块时不是通过CAS操作来加锁和解锁，而是检测Mark Word里是否存储着指向当前线程的偏向锁。</p>
<p>引入偏向锁是为了在无多线程竞争的情况下尽量减少不必要的轻量级锁，因为轻量级锁的获取及释放依赖多次CAS原子指令，而偏向锁只需要在置换ThreadID的时候依赖一次CAS原子指令即可。</p>
<h5 id="轻量级锁"><a href="#轻量级锁" class="headerlink" title="轻量级锁"></a>轻量级锁</h5><p>是指当锁是偏向锁的时候，被另外的线程所访问，偏向锁就会升级为轻量级锁，其他线程会通过自旋的形式尝试获取锁，不会阻塞，从而提高性能。</p>
<p>在代码进入同步块的时候，如果同步对象锁状态为无锁状态，虚拟机首先将在当前线程的栈帧中建立一个名为锁记录（Lock Record）的空间，用于存储锁对象目前的Mark Word的拷贝，然后拷贝对象头中的Mark Word复制到锁记录中。</p>
<p>拷贝成功后，虚拟机将使用CAS操作尝试将对象的Mark Word更新为指向Lock Record的指针，并将Lock Record里的owner指针指向对象的Mark Word。</p>
<p>如果此时有另一个新线程请求锁，虚拟机会检查对象的Mark Word是否指向该线程的栈帧，没有则说明多个线程竞争锁。该线程通过自旋进行等待。但是当自旋超过一定的次数，或者一个线程在持有锁，一个在自旋，又有第三个来访时，轻量级锁升级为重量级锁。</p>
<h5 id="重量级锁"><a href="#重量级锁" class="headerlink" title="重量级锁"></a>重量级锁</h5><p>升级为重量级锁时，锁标志的状态值变为“10”，此时Mark Word中存储的是指向重量级锁(monitor)的指针，此时等待锁的线程都会进入阻塞状态。</p>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>偏向锁通过对象头的Mark Word存储线程ID来减少过多的CAS操作，提高在无竞争环境下的Synchronized效率。</p>
<p>轻量级锁则是通过CAS自旋等待来避免线程的阻塞和唤醒操作，提高在竞争不激烈环境下synchronized的效率。</p>
<h5 id="Synchronized和ReentrantLock在唤醒被挂起线程竞争的时候有什么区别？"><a href="#Synchronized和ReentrantLock在唤醒被挂起线程竞争的时候有什么区别？" class="headerlink" title="Synchronized和ReentrantLock在唤醒被挂起线程竞争的时候有什么区别？"></a>Synchronized和ReentrantLock在唤醒被挂起线程竞争的时候有什么区别？</h5><p>Synchronized和ReentrantLock他们的开销差距是在释放锁时唤醒线程的数量,Synchronized是唤醒锁池里所有的线程+刚好来访问的线程,而ReentrantLock则是当前线程后进来的第一个线程+刚好来访问的线程.</p>
<h4 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h4><p>ReentrantLock上锁的时候如果只有一个线程进来,是不会有线程挂起的操作的,也就是说只需要在AQS里使用CAS改变一个state的值为1</p>
<h3 id="集合框架"><a href="#集合框架" class="headerlink" title="集合框架"></a>集合框架</h3><h4 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h4><p><img data-src="https://camo.githubusercontent.com/d1efb1abc3173aa2a607316dda79bea560fe333f/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230383232303934383038342e706e67" alt=""></p>
<table>
<thead>
<tr>
<th>线程不安全</th>
<th>线程安全</th>
</tr>
</thead>
<tbody><tr>
<td>Arraylist</td>
<td>Vector/CopyOnWriteArrayList</td>
</tr>
<tr>
<td>LinkedList</td>
<td>ConcurrentLinkedQueue</td>
</tr>
<tr>
<td>HashMap</td>
<td>ConcurrentHashMap</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><h5 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h5><h6 id="扩容机制"><a href="#扩容机制" class="headerlink" title="扩容机制"></a>扩容机制</h6><blockquote>
<p><a href="https://snailclimb.gitee.io/javaguide/#/docs/java/collection/ArrayList源码+扩容机制分析" target="_blank" rel="noopener">通过源码一步一步分析 ArrayList 扩容机制</a></p>
</blockquote>
<ol>
<li><strong>以无参数构造方法创建 ArrayList 时，实际上初始化赋值的是一个空数组。当真正对数组进行添加元素操作时，才真正分配容量。即向数组中添加第一个元素时，数组容量扩为 10。</strong></li>
<li><strong>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1),所以 ArrayList 每次扩容之后容量都会变为原来的 1.5 倍左右（oldCapacity 为偶数就是 1.5 倍，否则是 1.5 倍左右）！</strong> 奇偶不同，比如 ：10+10/2 = 15, 33+33/2=49。如果是奇数的话会丢掉小数. </li>
</ol>
<h5 id="Arraylist-与-LinkedList-区别"><a href="#Arraylist-与-LinkedList-区别" class="headerlink" title="Arraylist 与 LinkedList 区别?"></a>Arraylist 与 LinkedList 区别?</h5><ol>
<li><strong>底层数据结构：</strong><ul>
<li><code>Arraylist</code> 底层使用的是 <strong><code>Object</code> 数组</strong>；</li>
<li><code>LinkedList</code> 底层使用的是 <strong>双向链表</strong> 数据结构（JDK1.6 之前为循环链表，JDK1.7 取消了循环）</li>
</ul>
</li>
<li><strong>插入和删除是否受元素位置的影响：</strong> ① <strong><code>ArrayList</code> 采用数组存储，所以插入和删除元素的时间复杂度受元素位置的影响。</strong> 比如：执行<code>add(E e)</code>方法的时候， <code>ArrayList</code> 会默认在将指定的元素追加到此列表的末尾，这种情况时间复杂度就是 O(1)。但是如果要在指定位置 i 插入和删除元素的话（<code>add(int index, E element)</code>）时间复杂度就为 O(n-i)。因为在进行上述操作的时候集合中第 i 和第 i 个元素之后的(n-i)个元素都要执行向后位/向前移一位的操作。 ② <strong><code>LinkedList</code> 采用链表存储，所以对于<code>add(E e)</code>方法的插入，删除元素时间复杂度不受元素位置的影响，近似 O(1)，如果是要在指定位置<code>i</code>插入和删除元素的话（<code>(add(int index, E element)</code>） 时间复杂度近似为<code>o(n))</code>因为需要先移动到指定位置再插入。</strong></li>
<li><strong>是否支持快速随机访问：</strong> <code>LinkedList</code> 不支持高效的随机元素访问，而 <code>ArrayList</code> 支持。快速随机访问就是通过元素的序号快速获取元素对象(对应于<code>get(int index)</code>方法)。</li>
<li><strong>内存空间占用：</strong> ArrayList 的空间浪费主要体现在在 list 列表的结尾会预留一定的容量空间，而 LinkedList 的空间花费则体现在它的每一个元素都需要消耗比 ArrayList 更多的空间（因为要存放直接后继和直接前驱以及数据）。</li>
</ol>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><h5 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h5><p>HashSet 底层就是基于 HashMap 实现的。set 中的元素作为 key 存储在 hashmap 中，value 对应set中定义的同一个 Object。</p>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><p><img data-src="https://camo.githubusercontent.com/bcc4885b038529bc66a48f637c14cc7933ce63da/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303230313130313233343333353833372e706e67" alt=""></p>
<h5 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h5><h6 id="put-流程"><a href="#put-流程" class="headerlink" title="put 流程"></a>put 流程</h6><p><img data-src="https://upload-images.jianshu.io/upload_images/13947009-afee4ea47109f9c3.jpg" alt=""></p>
<ol>
<li>计算 key 的 hash 值(hashcode 高位抑或运算)</li>
<li>判断哈希表是否为空，如果为空则进行 <code>resize()</code></li>
<li>根据 hash 值计算数组下标，查看数组对应位置是否有值，没有就直接创建新节点存入</li>
<li>如果存在值则判断 hash 值是否相等、key 是否 equal，如果相等则覆盖旧值。</li>
<li>如果不等，则判断是否是红黑树节点，如果是则进入红黑树 put 操作。</li>
<li>如果不是则表示为链表，循环遍历链表进行插入操作</li>
<li>插入后链表后，链表长度如果大于 8，而哈希表数组长度小于 64，则扩容后 reHash，数组长度大于 64，则将链表转化为红黑树</li>
<li>最后 <code>++modCount</code>，<code>++size</code>，如果size 大与阀值则进行 <code>resize()</code>。</li>
</ol>
<h6 id="哈希表数组长度为什么必须为-2-的幂次方？"><a href="#哈希表数组长度为什么必须为-2-的幂次方？" class="headerlink" title="哈希表数组长度为什么必须为 2 的幂次方？"></a>哈希表数组长度为什么必须为 2 的幂次方？</h6><p>为了通过减法结合按位与操作<strong>代替</strong>取模运算提高性能。</p>
<p><code>a % b == (b-1) &amp; a</code></p>
<p>而只有当 b 是 2 的指数时，等式才成立。</p>
<h6 id="为什么要把-hashcode-与其高位进行抑或运算？"><a href="#为什么要把-hashcode-与其高位进行抑或运算？" class="headerlink" title="为什么要把 hashcode 与其高位进行抑或运算？"></a>为什么要把 hashcode 与其高位进行抑或运算？</h6><p>为了减少哈希碰撞。</p>
<h6 id="HashMap-和-Hashtable-的区别"><a href="#HashMap-和-Hashtable-的区别" class="headerlink" title="HashMap 和 Hashtable 的区别"></a>HashMap 和 Hashtable 的区别</h6><ol>
<li><strong>线程是否安全：</strong> HashMap 是非线程安全的，HashTable 是线程安全的,因为 HashTable 内部的方法基本都经过<code>synchronized</code> 修饰。</li>
<li><strong>效率：</strong> 因为线程安全的问题，HashMap 要比 HashTable 效率高一点。另外，HashTable 基本被淘汰，不要在代码中使用它；</li>
<li><strong>对 Null key 和 Null value 的支持：</strong> HashMap 可以存储 null 的 key 和 value，但 null 作为键只能有一个，null 作为值可以有多个；HashTable 不允许有 null 键和 null 值，否则会抛出 NullPointerException。</li>
<li><strong>初始容量大小和每次扩充容量大小的不同 ：</strong> ① 创建时如果不指定容量初始值，Hashtable 默认的初始大小为 11，之后每次扩充，容量变为原来的 2n+1。HashMap 默认的初始化大小为 16。之后每次扩充，容量变为原来的 2 倍。② 创建时如果给定了容量初始值，那么 Hashtable 会直接使用你给定的大小，而 HashMap 会将其扩充为 2 的幂次方大小。</li>
<li><strong>底层数据结构：</strong> JDK1.8 以后的 HashMap 在解决哈希冲突时有了较大的变化，当链表长度大于阈值（默认为 8）（将链表转换成红黑树前会判断，如果当前数组的长度小于 64，那么会选择先进行数组扩容，而不是转换为红黑树）时，将链表转化为红黑树，以减少搜索时间。Hashtable 没有这样的机制。</li>
</ol>
<h6 id="HashMap-和-TreeMap-区别"><a href="#HashMap-和-TreeMap-区别" class="headerlink" title="HashMap 和 TreeMap 区别"></a>HashMap 和 TreeMap 区别</h6><p><code>TreeMap</code> 和<code>HashMap</code> 都继承自<code>AbstractMap</code> ，但是需要注意的是<code>TreeMap</code>它还实现了<code>NavigableMap</code>接口和<code>SortedMap</code> 接口。</p>
<p>实现 <code>NavigableMap</code> 接口让 <code>TreeMap</code> 有了对集合内元素的搜索的能力。</p>
<p>实现<code>SortMap</code>接口让 <code>TreeMap</code> 有了对集合中的元素根据键排序的能力。默认是按 key 的升序排序，不过我们也可以指定排序的比较器。</p>
<h5 id="ConcurentHashMap"><a href="#ConcurentHashMap" class="headerlink" title="ConcurentHashMap"></a>ConcurentHashMap</h5><p>1.8以前的ConcurrentHashMap 的时候, 会初始化一个Segment数组, 容量为16,每个Segment都继承了ReentrantLock类,也就是说每个Segment类本身就是一个锁,之后Segment内部又有一个table数组,而每个table数组里的索引数据又对应着一个HashEntry链表.</p>
<h6 id="ConcurrentHashMap1-8为什么用CAS-Synchronized取代Segment-ReentrantLock"><a href="#ConcurrentHashMap1-8为什么用CAS-Synchronized取代Segment-ReentrantLock" class="headerlink" title="ConcurrentHashMap1.8为什么用CAS+Synchronized取代Segment+ReentrantLock?"></a>ConcurrentHashMap1.8为什么用CAS+Synchronized取代Segment+ReentrantLock?</h6><p>1.8 中的 ConcurrentHashMap，Synchronized是将每一个Node对象作为了一个锁,将锁粒度进一步细化了,也就是说,除非两个线程同时操作一个Node,注意,是一个Node而不是一个Node链表哦,那么才会争抢同一把锁.</p>
<p>如果使用ReentrantLock其实也可以将锁细化成这样的,只要让Node类继承ReentrantLock就行了,这样的话调用f.lock()就能做到和Synchronized(f)同样的效果,但为什么不这样做呢?</p>
<p>请大家试想一下,锁已经被细化到这种程度了,那么出现并发争抢的可能性还高吗?还有就是,哪怕出现争抢了,只要线程可以在30到50次自旋里拿到锁,那么Synchronized就不会升级为重量级锁,而等待的线程也就不用被挂起,我们也就少了挂起和唤醒这个上下文切换的过程开销.</p>
<p>但如果是ReentrantLock呢?它则只有在线程没有抢到锁,然后新建Node节点后再尝试一次而已,不会自旋,而是直接被挂起,这样一来,我们就很容易会多出线程上下文开销的代价.当然,你也可以使用tryLock(),但是这样又出现了一个问题,你怎么知道tryLock的时间呢?在时间范围里还好,假如超过了呢?</p>
<p>所以,在锁被细化到如此程度上,使用Synchronized是最好的选择了.这里再补充一句,Synchronized和ReentrantLock他们的开销差距是在释放锁时唤醒线程的数量,Synchronized是唤醒锁池里所有的线程+刚好来访问的线程,而ReentrantLock则是当前线程后进来的第一个线程+刚好来访问的线程.</p>
<p>如果是线程并发量不大的情况下,那么Synchronized因为自旋锁,偏向锁,轻量级锁的原因,不用将等待线程挂起,偏向锁甚至不用自旋,所以在这种情况下要比ReentrantLock高效</p>
<h3 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h3><h4 id="分类-1"><a href="#分类-1" class="headerlink" title="分类"></a>分类</h4><p>四大基类：</p>
<ol>
<li><code>java.io.InputStream</code></li>
<li><code>java.io.OutputStream</code></li>
<li><code>java.io.Reader</code></li>
<li><code>java.io.Writer</code></li>
</ol>
<ul>
<li>按照流的流向分，可以分为输入流和输出流；</li>
<li>按照操作单元划分，可以划分为字节流和字符流；</li>
<li>按照流的角色划分为节点流和处理流。</li>
</ul>
<h4 id="Files-和-Paths"><a href="#Files-和-Paths" class="headerlink" title="Files 和 Paths"></a>Files 和 Paths</h4><p>从 Java 7 开始，提供了 Files 和 Paths 这两个工具类，能极大地方便我们读写文件。</p>
<p>虽然 Files 和 Paths 是 java.nio 包里面的类，但他俩封装了很多读写文件的简单方法。</p>
<h4 id="BIO"><a href="#BIO" class="headerlink" title="BIO"></a>BIO</h4><p><strong>BIO (Blocking I/O):</strong> 同步阻塞 I/O 模式，数据的读取写入必须阻塞在一个线程内等待其完成。</p>
<h4 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h4><p><strong>NIO (Non-blocking/New I/O):</strong> NIO 是一种同步非阻塞的 I/O 模型，在 Java 1.4 中引入了 NIO 框架，对应 java.nio 包，提供了 Channel , Selector，Buffer 等抽象。NIO 中的 N 可以理解为 Non-blocking，不单纯是 New。它支持面向缓冲的，基于通道的 I/O 操作方法。 NIO 提供了与传统 BIO 模型中的 <code>Socket</code> 和 <code>ServerSocket</code> 相对应的 <code>SocketChannel</code> 和 <code>ServerSocketChannel</code> 两种不同的套接字通道实现,两种通道都支持阻塞和非阻塞两种模式。</p>
<h5 id="NIO核心组件"><a href="#NIO核心组件" class="headerlink" title="NIO核心组件"></a>NIO核心组件</h5><p>NIO 包含下面几个核心的组件：</p>
<ul>
<li>Channel(通道)</li>
<li>Buffer(缓冲区)</li>
<li>Selector(选择器)</li>
</ul>
<h4 id="AIO"><a href="#AIO" class="headerlink" title="AIO"></a>AIO</h4><p><strong>AIO (Asynchronous I/O):</strong> AIO 也就是 NIO 2。在 Java 7 中引入了 NIO 的改进版 NIO 2,它是异步非阻塞的 IO 模型。异步 IO 是基于事件和回调机制实现的，也就是应用操作之后会直接返回，不会堵塞在那里，当后台处理完成，操作系统会通知相应的线程进行后续的操作。</p>
<h4 id="BIO-NIO-AIO-总结"><a href="#BIO-NIO-AIO-总结" class="headerlink" title="BIO,NIO,AIO 总结"></a>BIO,NIO,AIO 总结</h4><p>Java 中的 BIO、NIO和 AIO 理解为是 Java 语言对操作系统的各种 IO 模型的封装。</p>
<h5 id="如何区分-“同步-异步-”和-“阻塞-非阻塞”-呢？"><a href="#如何区分-“同步-异步-”和-“阻塞-非阻塞”-呢？" class="headerlink" title="如何区分 “同步/异步 ”和 “阻塞/非阻塞” 呢？"></a>如何区分 “同步/异步 ”和 “阻塞/非阻塞” 呢？</h5><p>同步/异步是从行为角度描述事物的，而阻塞和非阻塞描述的当前事物的状态（等待调用结果时的状态）。</p>
<h5 id="NIO的特性-NIO与IO区别"><a href="#NIO的特性-NIO与IO区别" class="headerlink" title="NIO的特性/NIO与IO区别"></a>NIO的特性/NIO与IO区别</h5><ol>
<li><p><strong>IO流是阻塞的，NIO流是非阻塞的。</strong></p>
</li>
<li><p><strong>IO 面向流(Stream oriented)，而 NIO 面向缓冲区(Buffer oriented)。</strong></p>
<p>任何时候访问NIO中的数据，都是通过缓冲区进行操作。最常用的缓冲区是 ByteBuffer。</p>
</li>
<li><p>NIO 通过Channel（通道） 进行读写。</p>
<p>通道是双向的，可读也可写，而流的读写是单向的。</p>
</li>
<li><p>NIO有选择器，而IO没有。</p>
<p>选择器用于使用单个线程处理多个通道。因此，它需要较少的线程来处理这些通道。</p>
</li>
</ol>
<h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><h4 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h4><h5 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h5><p><code>java.lang.Thread.State</code>枚举类中定义了六种线程的状态，可以调用线程Thread中的<code>getState()</code>方法<strong>获取当前线程的状态</strong>。</p>
<table>
<thead>
<tr>
<th align="left">线程状态</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NEW</td>
<td align="left">尚未启动的线程状态，即线程创建，<strong>还未调用start方法</strong></td>
</tr>
<tr>
<td align="left">RUNNABLE</td>
<td align="left"><strong>就绪状态</strong>（调用start，等待调度）+<strong>正在运行</strong></td>
</tr>
<tr>
<td align="left">BLOCKED</td>
<td align="left"><strong>等待监视器锁</strong>时，陷入阻塞状态</td>
</tr>
<tr>
<td align="left">WAITING</td>
<td align="left">等待状态的线程正在<strong>等待</strong>另一线程执行特定的操作（如notify）</td>
</tr>
<tr>
<td align="left">TIMED_WAITING</td>
<td align="left">具有<strong>指定等待时间</strong>的等待状态</td>
</tr>
<tr>
<td align="left">TERMINATED</td>
<td align="left">线程完成执行，<strong>终止状态</strong></td>
</tr>
</tbody></table>
<p>下图源自《Java并发编程艺术》图4-1<br><a href="https://img2018.cnblogs.com/blog/1771072/202002/1771072-20200209204908012-1070559737.png" target="_blank" rel="noopener"><img data-src="https://img2018.cnblogs.com/blog/1771072/202002/1771072-20200209204908012-1070559737.png" alt="img"></a></p>
<h4 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h4><p><strong><code>volatile</code> 关键字除了防止 JVM 的指令重排 ，还有一个重要的作用就是保证变量的可见性。</strong></p>
<h4 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h4><p>在 Java 早期版本中，<code>synchronized</code> 属于 <strong>重量级锁</strong>，效率低下。</p>
<p>因为监视器锁（monitor）是依赖于底层的操作系统的 <code>Mutex Lock</code> 来实现的，Java 的线程是映射到操作系统的原生线程之上的。如果要挂起或者唤醒一个线程，都需要操作系统帮忙完成，而操作系统实现线程之间的切换时需要从用户态转换到内核态，这个状态之间的转换需要相对比较长的时间，时间成本相对较高。</p>
<p>庆幸的是在 Java 6 之后 Java 官方对从 JVM 层面对 synchronized 较大优化。JDK1.6 对锁的实现引入了大量的优化，如自旋锁、适应性自旋锁、锁消除、锁粗化、偏向锁、轻量级锁等技术来减少锁操作的开销。</p>
<p>锁主要存在四种状态，依次是：无锁状态、偏向锁状态、轻量级锁状态、重量级锁状态，他们会随着竞争的激烈而逐渐升级。注意锁可以升级不可降级，这种策略是为了提高获得锁和释放锁的效率。</p>
<h5 id="synchronized-和-ReentrantLock-的区别"><a href="#synchronized-和-ReentrantLock-的区别" class="headerlink" title="synchronized 和 ReentrantLock 的区别"></a>synchronized 和 ReentrantLock 的区别</h5><ol>
<li><p>两者都是可重入锁</p>
</li>
<li><p>synchronized 依赖于 JVM 而 ReentrantLock 依赖于 API</p>
</li>
<li><p>ReentrantLock 比 synchronized 增加了一些高级功能</p>
<p>主要有三点：</p>
<ul>
<li><strong>等待可中断</strong> : <code>ReentrantLock</code>提供了一种能够中断等待锁的线程的机制，通过 <code>lock.lockInterruptibly()</code> 来实现这个机制。也就是说正在等待的线程可以选择放弃等待，改为处理其他事情。</li>
<li><strong>可实现公平锁</strong> : <code>ReentrantLock</code>可以指定是公平锁还是非公平锁。而<code>synchronized</code>只能是非公平锁。所谓的公平锁就是先等待的线程先获得锁。<code>ReentrantLock</code>默认情况是非公平的，可以通过 <code>ReentrantLock</code>类的<code>ReentrantLock(boolean fair)</code>构造方法来制定是否是公平的。</li>
<li><strong>可实现选择性通知（锁可以绑定多个条件）</strong>: <code>synchronized</code>关键字与<code>wait()</code>和<code>notify()</code>/<code>notifyAll()</code>方法相结合可以实现等待/通知机制。<code>ReentrantLock</code>类当然也可以实现，但是需要借助于<code>Condition</code>接口与<code>newCondition()</code>方法。</li>
</ul>
</li>
</ol>
<h5 id="synchronized-关键字和-volatile-关键字的区别"><a href="#synchronized-关键字和-volatile-关键字的区别" class="headerlink" title="synchronized 关键字和 volatile 关键字的区别"></a>synchronized 关键字和 volatile 关键字的区别</h5><p><code>synchronized</code> 关键字和 <code>volatile</code> 关键字是两个互补的存在，而不是对立的存在！</p>
<ul>
<li><strong>volatile 关键字</strong>是线程同步的<strong>轻量级实现</strong>，所以<strong>volatile 性能肯定比 synchronized 关键字要好</strong>。但是<strong>volatile 关键字只能用于变量而 synchronized 关键字可以修饰方法以及代码块</strong>。</li>
<li><strong>volatile 关键字能保证数据的可见性，但不能保证数据的原子性。synchronized 关键字两者都能保证。</strong></li>
<li><strong>volatile 关键字主要用于解决变量在多个线程之间的可见性，而 synchronized 关键字解决的是多个线程之间访问资源的同步性。</strong></li>
</ul>
<h4 id="为什么我们调用-start-方法时会执行-run-方法，为什么我们不能直接调用-run-方法？"><a href="#为什么我们调用-start-方法时会执行-run-方法，为什么我们不能直接调用-run-方法？" class="headerlink" title="为什么我们调用 start() 方法时会执行 run() 方法，为什么我们不能直接调用 run() 方法？"></a>为什么我们调用 start() 方法时会执行 run() 方法，为什么我们不能直接调用 run() 方法？</h4><p>因为直接调用 run() 方法不会创建新线程去执行，而是当作普通方法在当前线程里执行。</p>
<h4 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h4><h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><p>《阿里巴巴 Java 开发手册》中强制线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险</p>
<h5 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>ThreadPoolExecutor</code> 3 个最重要的参数：</strong></p>
<ul>
<li><strong><code>corePoolSize</code> :</strong> 核心线程数线程数定义了最小可以同时运行的线程数量。</li>
<li><strong><code>maximumPoolSize</code> :</strong> 当队列中存放的任务达到队列容量的时候，当前可以同时运行的线程数量变为最大线程数。</li>
<li><strong><code>workQueue</code>:</strong> 当新任务来的时候会先判断当前运行的线程数量是否达到核心线程数，如果达到的话，新任务就会被存放在队列中。</li>
</ul>
<p><code>ThreadPoolExecutor</code>其他常见参数:</p>
<ol>
<li><strong><code>keepAliveTime</code></strong>:当线程池中的线程数量大于 <code>corePoolSize</code> 的时候，如果这时没有新的任务提交，核心线程外的线程不会立即销毁，而是会等待，直到等待的时间超过了 <code>keepAliveTime</code>才会被回收销毁；</li>
<li><strong><code>unit</code></strong> : <code>keepAliveTime</code> 参数的时间单位。</li>
<li><strong><code>threadFactory</code></strong> :executor 创建新线程的时候会用到。</li>
<li><strong><code>handler</code></strong> :饱和策略。</li>
</ol>
<h6 id="ThreadPoolExecutor-饱和策略"><a href="#ThreadPoolExecutor-饱和策略" class="headerlink" title="ThreadPoolExecutor 饱和策略"></a><code>ThreadPoolExecutor</code> 饱和策略</h6><p><strong><code>ThreadPoolExecutor</code> 饱和策略定义:</strong></p>
<p>如果当前同时运行的线程数量达到最大线程数量并且队列也已经被放满了任时，<code>ThreadPoolTaskExecutor</code> 定义一些策略:</p>
<ul>
<li><strong><code>ThreadPoolExecutor.AbortPolicy</code></strong>：抛出 <code>RejectedExecutionException</code>来拒绝新任务的处理。</li>
<li><strong><code>ThreadPoolExecutor.CallerRunsPolicy</code></strong>：调用执行自己的线程运行任务，也就是直接在调用<code>execute</code>方法的线程中运行(<code>run</code>)被拒绝的任务，如果执行程序已关闭，则会丢弃该任务。因此这种策略会降低对于新任务提交速度，影响程序的整体性能。如果您的应用程序可以承受此延迟并且你要求任何一个任务请求都要被执行的话，你可以选择这个策略。</li>
<li><strong><code>ThreadPoolExecutor.DiscardPolicy</code>：</strong> 不处理新任务，直接丢弃掉。</li>
<li><strong><code>ThreadPoolExecutor.DiscardOldestPolicy</code>：</strong> 此策略将丢弃最早的未处理的任务请求。</li>
</ul>
<h5 id="execute-方法和-submit-方法的区别？"><a href="#execute-方法和-submit-方法的区别？" class="headerlink" title="execute()方法和 submit()方法的区别？"></a>execute()方法和 submit()方法的区别？</h5><ol>
<li><strong><code>execute()</code>方法用于提交不需要返回值的任务，所以无法判断任务是否被线程池执行成功与否；</strong></li>
<li><strong><code>submit()</code>方法用于提交需要返回值的任务。线程池会返回一个 <code>Future</code> 类型的对象，通过这个 <code>Future</code> 对象可以判断任务是否执行成功</strong>，并且可以通过 <code>Future</code> 的 <code>get()</code>方法来获取返回值，<code>get()</code>方法会阻塞当前线程直到任务完成，而使用 <code>get（long timeout，TimeUnit unit）</code>方法则会阻塞当前线程一段时间后立即返回，这时候有可能任务没有执行完。</li>
</ol>
<h4 id="原子类"><a href="#原子类" class="headerlink" title="原子类"></a>原子类</h4><h5 id="AtomicInteger-类的原理"><a href="#AtomicInteger-类的原理" class="headerlink" title="AtomicInteger 类的原理"></a>AtomicInteger 类的原理</h5><p>AtomicInteger 类的部分源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// setup to use Unsafe.compareAndSwapInt for updates（更新操作时提供“比较并替换”的作用）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    valueOffset = unsafe.objectFieldOffset</span><br><span class="line">      (AtomicInteger.class.getDeclaredField("value"));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> Error(ex); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> value;</span><br></pre></td></tr></table></figure>

<p>AtomicInteger 类主要利用 CAS (compare and swap) + volatile 和 native 方法来保证原子操作，从而避免 synchronized 的高开销，执行效率大为提升。</p>
<h4 id="CAS的缺点"><a href="#CAS的缺点" class="headerlink" title="CAS的缺点"></a>CAS的缺点</h4><ol>
<li><p>ABA问题</p>
<p>假设有两个线程——线程1和线程2，两个线程按照顺序进行以下操作：</p>
<p>(1)线程1读取内存中数据为A；</p>
<p>(2)线程2将该数据修改为B；</p>
<p>(3)线程2将该数据修改为A；</p>
<p>(4)线程1对数据进行CAS操作</p>
<p>在第(4)步中，由于内存中数据仍然为A，因此CAS操作成功，但实际上该数据已经被线程2修改过了。这就是ABA问题。</p>
<p>在AtomicInteger的例子中，ABA似乎没有什么危害。但是在某些场景下，ABA却会带来隐患，例如栈顶问题：一个栈的栈顶经过两次(或多次)变化又恢复了原值，但是栈可能已发生了变化。</p>
<p>对于ABA问题，比较有效的方案是引入版本号，内存中的值每发生一次变化，版本号都+1；在进行CAS操作时，不仅比较内存中的值，也会比较版本号，只有当二者都没有变化时，CAS才能执行成功。Java中的AtomicStampedReference类便是使用版本号来解决ABA问题的。</p>
</li>
<li><p>高竞争下的开销问题</p>
<p>在并发冲突概率大的高竞争环境下，如果CAS一直失败，会一直重试，CPU开销较大。针对这个问题的一个思路是引入退出机制，如重试次数超过一定阈值后失败退出。当然，更重要的是避免在高竞争环境下使用乐观锁。</p>
</li>
<li><p>功能限制</p>
<p>CAS的功能是比较受限的，例如CAS只能保证单个变量（或者说单个内存值）操作的原子性，这意味着：(1)原子性不一定能保证线程安全，例如在Java中需要与volatile配合来保证线程安全；(2)当涉及到多个变量(内存值)时，CAS也无能为力。</p>
<p>除此之外，CAS的实现需要硬件层面处理器的支持，在Java中普通用户无法直接使用，只能借助atomic包下的原子类使用，灵活性受到限制。</p>
</li>
</ol>
<h4 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h4><p>AQS 的全称为（AbstractQueuedSynchronizer）</p>
<p>AQS 是一个用来构建锁和同步器的框架，使用 AQS 能简单且高效地构造出应用广泛的大量的同步器，比如我们提到的 ReentrantLock，Semaphore，其他的诸如 ReentrantReadWriteLock，SynchronousQueue，FutureTask 等等皆是基于 AQS 的。当然，我们自己也能利用 AQS 非常轻松容易地构造出符合我们自己需求的同步器。</p>
<h5 id="AQS-组件总结"><a href="#AQS-组件总结" class="headerlink" title="AQS 组件总结"></a>AQS 组件总结</h5><ul>
<li><strong>Semaphore(信号量)-允许多个线程同时访问：</strong> synchronized 和 ReentrantLock 都是一次只允许一个线程访问某个资源，Semaphore(信号量)可以指定多个线程同时访问某个资源。</li>
<li><strong>CountDownLatch （倒计时器）：</strong> CountDownLatch 是一个同步工具类，用来协调多个线程之间的同步。这个工具通常用来控制线程等待，它可以让某一个线程等待直到倒计时结束，再开始执行。</li>
<li><strong>CyclicBarrier(循环栅栏)：</strong> CyclicBarrier 和 CountDownLatch 非常类似，它也可以实现线程间的技术等待，但是它的功能比 CountDownLatch 更加复杂和强大。主要应用场景和 CountDownLatch 类似。CyclicBarrier 的字面意思是可循环使用（Cyclic）的屏障（Barrier）。它要做的事情是，让一组线程到达一个屏障（也可以叫同步点）时被阻塞，直到最后一个线程到达屏障时，屏障才会开门，所有被屏障拦截的线程才会继续干活。CyclicBarrier 默认的构造方法是 CyclicBarrier(int parties)，其参数表示屏障拦截的线程数量，每个线程调用 await()方法告诉 CyclicBarrier 我已经到达了屏障，然后当前线程被阻塞。</li>
</ul>
<h5 id="用过-CountDownLatch-么？什么场景下用的？"><a href="#用过-CountDownLatch-么？什么场景下用的？" class="headerlink" title="用过 CountDownLatch 么？什么场景下用的？"></a>用过 CountDownLatch 么？什么场景下用的？</h5><p><code>CountDownLatch</code> 的作用就是 允许 count 个线程阻塞在一个地方，直至所有线程的任务都执行完毕。之前在项目中，有一个使用多线程读取多个文件处理的场景，我用到了 <code>CountDownLatch</code> 。具体场景是下面这样的：</p>
<p>我们要读取处理 6 个文件，这 6 个任务都是没有执行顺序依赖的任务，但是我们需要返回给用户的时候将这几个文件的处理的结果进行统计整理。</p>
<p>为此我们定义了一个线程池和 count 为 6 的<code>CountDownLatch</code>对象 。使用线程池处理读取任务，每一个线程处理完之后就将 count-1，调用<code>CountDownLatch</code>对象的 <code>await()</code>方法，直到所有文件读取完之后，才会接着执行后面的逻辑。</p>
<h4 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h4><h5 id="乐观锁-VS-悲观锁"><a href="#乐观锁-VS-悲观锁" class="headerlink" title="乐观锁 VS 悲观锁"></a>乐观锁 VS 悲观锁</h5><ul>
<li>乐观锁：乐观锁在操作数据时非常乐观，认为别人不会同时修改数据。因此乐观锁不会上锁，只是在执行更新的时候判断一下在此期间别人是否修改了数据：如果别人修改了数据则放弃操作，否则执行操作。</li>
<li>悲观锁：悲观锁在操作数据时比较悲观，认为别人会同时修改数据。因此操作数据时直接把数据锁住，直到操作完成后才会释放锁；上锁期间其他人不能修改数据。</li>
</ul>
<p>乐观锁的实现方式主要有两种：CAS机制和版本号机制。</p>
<h5 id="公平锁-VS-非公平锁"><a href="#公平锁-VS-非公平锁" class="headerlink" title="公平锁 VS 非公平锁"></a>公平锁 VS 非公平锁</h5><h6 id="公平锁"><a href="#公平锁" class="headerlink" title="公平锁"></a>公平锁</h6><p>公平锁是指多个线程按照申请锁的顺序来获取锁，锁被占用时直接进入队列中排队。</p>
<p>公平锁的优点是等待锁的线程不会饿死。缺点是整体吞吐率相对非公平锁要低，CPU唤醒阻塞线程的开销比非公平锁大。</p>
<h6 id="非公平锁"><a href="#非公平锁" class="headerlink" title="非公平锁"></a>非公平锁</h6><p>非公平锁是多个线程加锁时直接尝试获取锁，获取不到才会到等待队列的队尾等待。但如果此时锁刚好可用，那么这个线程可以无需阻塞直接获取到锁，所以非公平锁有可能出现后申请锁的线程先获取锁的场景。</p>
<p>非公平锁的优点是可以减少唤起线程的开销，整体的吞吐率高。</p>
<p>缺点是处于等待队列中的线程可能会饿死，或者等很久才会获得锁。</p>
<h5 id="可重入锁-VS-非可重入锁"><a href="#可重入锁-VS-非可重入锁" class="headerlink" title="可重入锁 VS 非可重入锁"></a>可重入锁 VS 非可重入锁</h5><p>可重入锁又名递归锁，是指在同一个线程在外层方法获取锁的时候，再进入该线程的内层方法再获取锁时会自动获得锁，不会因为之前已经获取过还没释放而阻塞。Java中ReentrantLock和synchronized都是可重入锁，可重入锁的一个优点是可一定程度避免死锁。</p>
<h5 id="独享锁-VS-共享锁"><a href="#独享锁-VS-共享锁" class="headerlink" title="独享锁 VS 共享锁"></a>独享锁 VS 共享锁</h5><p>独享锁也叫排他锁，是指该锁一次只能被一个线程所持有。如果线程T对数据A加上排它锁后，则其他线程不能再对A加任何类型的锁。获得排它锁的线程即能读数据又能修改数据。JDK中的synchronized和JUC中Lock的实现类就是互斥锁。</p>
<p>共享锁是指该锁可被多个线程所持有。如果线程T对数据A加上共享锁后，则其他线程只能对A再加共享锁，不能加排它锁。获得共享锁的线程只能读数据，不能修改数据。</p>
<p>ReentrantReadWriteLock有两把锁：ReadLock和WriteLock，读锁是共享锁，写锁是独享锁。</p>
<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><p><img data-src="https://images2017.cnblogs.com/blog/401339/201709/401339-20170928225241215-295252070.png" alt=""></p>
<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a><a href="https://libo9527.github.io/2020/10/22/Design-Pattern-Singleton/" target="_blank" rel="noopener">单例模式</a></h3><h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><h5 id="饿汉模式"><a href="#饿汉模式" class="headerlink" title="饿汉模式"></a>饿汉模式</h5><blockquote>
<p>Static initializers are run by the JVM at class initialization time, after class loading but before the class is used by any thread. Because the JVM acquires a lock during initialization [JLS 12.4.2] and this lock is acquired by each thread at least once to ensure that the class has been loaded, memory writes made during static initialization are automatically visible to all threads. Thus statically initialized objects require no explicit synchronization either during construction or when being referenced</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton1 instance = <span class="keyword">new</span> Singleton1();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类加载机制保障了饿汉模式的线程安全。JVM 在类加载时会获取一把锁，这把锁在线程访问对象时也会先去争取，确保类已经被加载了。</p>
<h5 id="懒汉模式"><a href="#懒汉模式" class="headerlink" title="懒汉模式"></a>懒汉模式</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton2 instance;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton2 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> Singleton2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="线程安全的懒汉模式"><a href="#线程安全的懒汉模式" class="headerlink" title="线程安全的懒汉模式"></a>线程安全的懒汉模式</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton3 instance;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton3 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> Singleton3();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="双重校验锁模式（DCL，即-double-checked-locking）"><a href="#双重校验锁模式（DCL，即-double-checked-locking）" class="headerlink" title="双重校验锁模式（DCL，即 double-checked locking）"></a>双重校验锁模式（DCL，即 double-checked locking）</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton4 instance;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton4 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (Singleton4<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">          instance = <span class="keyword">new</span> Singleton4();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="为什么要两次判空？"><a href="#为什么要两次判空？" class="headerlink" title="为什么要两次判空？"></a>为什么要两次判空？</h6><p>第一次判空是为了减少无谓的抢夺锁，提升销量。</p>
<p>第二次判空是为了保障不会破坏单例，假设没有第二次判空，线程 1，线程 2 同时通过第一次判空，之后线程 1 获得了锁，并实例化了 instance，之后线程 2 获得锁，又会实例化一遍，破坏了单例模式。</p>
<h6 id="为什么要加-volatile-关键字？"><a href="#为什么要加-volatile-关键字？" class="headerlink" title="为什么要加 volatile 关键字？"></a>为什么要加 volatile 关键字？</h6><blockquote>
<p><a href="https://blog.csdn.net/justloveyou_/article/details/64127789" target="_blank" rel="noopener">彻头彻尾理解单例模式与多线程</a></p>
</blockquote>
<p><code>instance = new Singleton4();</code> 可以被拆解为三条机器指令（伪代码）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">memory &#x3D; allocate();        &#x2F;&#x2F;1:分配对象的内存空间</span><br><span class="line">ctorInstance(memory);       &#x2F;&#x2F;2:初始化对象</span><br><span class="line">instance &#x3D; memory;        &#x2F;&#x2F;3:使 instance 引用指向刚分配的内存地址</span><br></pre></td></tr></table></figure>

<p>由于存在指令重排序，上述三条指令的顺序可能会变成 1、3、2</p>
<p>如果没有使用 volatile，那假设线程 1 已经执行到创建对象的语句了，且刚好执行到重排序后到机器指令 3，此时 instance 已经不是 null 了，其他线程就会获取到一个没有完整初始化的 instance 对象，进而造成未知错误。</p>
<h5 id="静态内部类单例模式"><a href="#静态内部类单例模式" class="headerlink" title="静态内部类单例模式"></a>静态内部类单例模式</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton5 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> InnerClass.instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton5 instance = <span class="keyword">new</span> Singleton5();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态内部类模式综合了懒汉和饿汉模式，既满足线程安全，又满足延迟加载。</p>
<h5 id="枚举单例模式"><a href="#枚举单例模式" class="headerlink" title="枚举单例模式"></a>枚举单例模式</h5><blockquote>
<p>《Effective Java》作者认为该模式是单例模式的最佳实践。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton6 &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="反射攻击"><a href="#反射攻击" class="headerlink" title="反射攻击"></a>反射攻击</h4><p>私有化构造器并不能阻止反射攻击。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">  Singleton1 instance = Singleton1.getInstance();</span><br><span class="line"></span><br><span class="line">  Constructor&lt;Singleton1&gt; declaredConstructor = Singleton1<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>()</span>;</span><br><span class="line">  declaredConstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">  Singleton1 instance1 = declaredConstructor.newInstance();</span><br><span class="line">  System.out.println(instance == instance1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">false</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>反射攻击枚举单例模式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">  Singleton6 instance = Singleton6.INSTANCE;</span><br><span class="line"></span><br><span class="line">  Constructor&lt;Singleton6&gt; declaredConstructor = Singleton6<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>()</span>;</span><br><span class="line">  declaredConstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">  Singleton6 instance2 = declaredConstructor.newInstance();</span><br><span class="line">  System.out.println(instance == instance2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NoSuchMethodException: com.gzhennaxia.demo.singleton.Singleton6.&lt;init&gt;()</span><br><span class="line">	at java.lang.Class.getConstructor0(Class.java:3082)</span><br><span class="line">	at java.lang.Class.getDeclaredConstructor(Class.java:2178)</span><br></pre></td></tr></table></figure>

<p>报错说找不到空构造方法，但即使手动添加了空构造方法同样会报这个错，因为 Java 编译器会为每个构造器自动添加两个参数，这点从反编译文件中可以看出（只有一个 <code>com/gzhennaxia/demo/singleton/Singleton6.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</code> 双参构造器）。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton6 &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Classfile /Users/libo/Documents/GitHub/projects/demo/src/main/java/com/gzhennaxia/demo/singleton/Singleton6<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">  <span class="title">Last</span> <span class="title">modified</span> 2020年10月22日</span>; size <span class="number">921</span> bytes</span><br><span class="line">  MD5 checksum bf867cdc275213b5182d9e511c593cad</span><br><span class="line">  Compiled from <span class="string">"Singleton6.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">gzhennaxia</span>.<span class="title">demo</span>.<span class="title">singleton</span>.<span class="title">Singleton6</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">com</span>.<span class="title">gzhennaxia</span>.<span class="title">demo</span>.<span class="title">singleton</span>.<span class="title">Singleton6</span>&gt;</span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">56</span></span><br><span class="line">  flags: (<span class="number">0x4031</span>) ACC_PUBLIC, ACC_FINAL, ACC_SUPER, ACC_ENUM</span><br><span class="line">  this_class: #4                          // com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">  super_class: #10                        // java/lang/Enum</span><br><span class="line">  interfaces: <span class="number">0</span>, fields: <span class="number">2</span>, methods: <span class="number">4</span>, attributes: <span class="number">2</span></span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Fieldref           #4.#29         // com/gzhennaxia/demo/singleton/Singleton6.$VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">   #2 = Methodref          #30.#31        // "[Lcom/gzhennaxia/demo/singleton/Singleton6;".clone:()Ljava/lang/Object;</span><br><span class="line">   #3 = Class              #14            // "[Lcom/gzhennaxia/demo/singleton/Singleton6;"</span><br><span class="line">   #4 = Class              #32            // com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">   #5 = Methodref          #10.#33        // java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">   #6 = Methodref          #10.#34        // java/lang/Enum."&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">   #7 = String             #11            // INSTANCE</span><br><span class="line">   #8 = Methodref          #4.#34         // com/gzhennaxia/demo/singleton/Singleton6."&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">   #9 = Fieldref           #4.#35         // com/gzhennaxia/demo/singleton/Singleton6.INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #10 = Class              #36            // java/lang/Enum</span><br><span class="line">  #11 = Utf8               INSTANCE</span><br><span class="line">  #12 = Utf8               Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #13 = Utf8               $VALUES</span><br><span class="line">  #14 = Utf8               [Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #15 = Utf8               values</span><br><span class="line">  #16 = Utf8               ()[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #17 = Utf8               Code</span><br><span class="line">  #18 = Utf8               LineNumberTable</span><br><span class="line">  #19 = Utf8               valueOf</span><br><span class="line">  #20 = Utf8               (Ljava/lang/String;)Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #21 = Utf8               &lt;init&gt;</span><br><span class="line">  #22 = Utf8               (Ljava/lang/String;I)V</span><br><span class="line">  #23 = Utf8               Signature</span><br><span class="line">  #24 = Utf8               ()V</span><br><span class="line">  #25 = Utf8               &lt;clinit&gt;</span><br><span class="line">  #26 = Utf8               Ljava/lang/Enum&lt;Lcom/gzhennaxia/demo/singleton/Singleton6;&gt;;</span><br><span class="line">  #27 = Utf8               SourceFile</span><br><span class="line">  #28 = Utf8               Singleton6.java</span><br><span class="line">  #29 = NameAndType        #13:#14        // $VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #30 = Class              #14            // "[Lcom/gzhennaxia/demo/singleton/Singleton6;"</span><br><span class="line">  #31 = NameAndType        #37:#38        // clone:()Ljava/lang/Object;</span><br><span class="line">  #32 = Utf8               com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">  #33 = NameAndType        #19:#39        // valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">  #34 = NameAndType        #21:#22        // "&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">  #35 = NameAndType        #11:#12        // INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">  #36 = Utf8               java/lang/Enum</span><br><span class="line">  #37 = Utf8               clone</span><br><span class="line">  #38 = Utf8               ()Ljava/lang/Object;</span><br><span class="line">  #39 = Utf8               (Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.gzhennaxia.demo.singleton.Singleton6 INSTANCE;</span><br><span class="line">    descriptor: Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">    flags: (<span class="number">0x4019</span>) ACC_PUBLIC, ACC_STATIC, ACC_FINAL, ACC_ENUM</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.gzhennaxia.demo.singleton.Singleton6[] values();</span><br><span class="line">    descriptor: ()[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">    flags: (<span class="number">0x0009</span>) ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         0: getstatic     #1                  // Field $VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">         3: invokevirtual #2                  // Method "[Lcom/gzhennaxia/demo/singleton/Singleton6;".clone:()Ljava/lang/Object;</span><br><span class="line">         6: checkcast     #3                  // class "[Lcom/gzhennaxia/demo/singleton/Singleton6;"</span><br><span class="line">         <span class="number">9</span>: areturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.gzhennaxia.demo.singleton.<span class="function">Singleton6 <span class="title">valueOf</span><span class="params">(java.lang.String)</span></span>;</span><br><span class="line">    descriptor: (Ljava/lang/String;)Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">    flags: (<span class="number">0x0009</span>) ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         0: ldc           #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">         <span class="number">2</span>: aload_0</span><br><span class="line">         3: invokestatic  #5                  // Method java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">         6: checkcast     #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">         <span class="number">9</span>: areturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: (<span class="number">0x0008</span>) ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">4</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         0: new           #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">         <span class="number">3</span>: dup</span><br><span class="line">         4: ldc           #7                  // String INSTANCE</span><br><span class="line">         <span class="number">6</span>: iconst_0</span><br><span class="line">         7: invokespecial #8                  // Method "&lt;init&gt;":(Ljava/lang/String;I)V</span><br><span class="line">        10: putstatic     #9                  // Field INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">        <span class="number">13</span>: iconst_1</span><br><span class="line">        14: anewarray     #4                  // class com/gzhennaxia/demo/singleton/Singleton6</span><br><span class="line">        <span class="number">17</span>: dup</span><br><span class="line">        <span class="number">18</span>: iconst_0</span><br><span class="line">        19: getstatic     #9                  // Field INSTANCE:Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">        <span class="number">22</span>: aastore</span><br><span class="line">        23: putstatic     #1                  // Field $VALUES:[Lcom/gzhennaxia/demo/singleton/Singleton6;</span><br><span class="line">        <span class="number">26</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">8</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">7</span>: <span class="number">13</span></span><br><span class="line">&#125;</span><br><span class="line">Signature: #26                          // Ljava/lang/Enum&lt;Lcom/gzhennaxia/demo/singleton/Singleton6;&gt;;</span><br><span class="line">SourceFile: <span class="string">"Singleton6.java"</span></span><br></pre></td></tr></table></figure>

<p>从反编译结果可以看出枚举的实例化调用的是继承自 <code>java.lang.Enum</code> 的 <code>protected Enum(String var1, int var2)</code> 构造器，那是否可以反射调用该构造器来实例化 Singleton6 呢？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">  Singleton6 instance = Singleton6.INSTANCE;</span><br><span class="line"></span><br><span class="line">  Constructor&lt;Singleton6&gt; declaredConstructor = Singleton6<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>(<span class="title">String</span>.<span class="title">class</span>, <span class="title">int</span>.<span class="title">class</span>)</span>;</span><br><span class="line">  declaredConstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">  Singleton6 instance2 = declaredConstructor.newInstance(<span class="string">""</span>, <span class="number">0</span>);</span><br><span class="line">  System.out.println(instance == instance2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Cannot reflectively create enum objects</span><br><span class="line">	at java.lang.reflect.Constructor.newInstance(Constructor.java:417)</span><br></pre></td></tr></table></figure>

<p>结果报错，查看 java.lang.reflect.Constructor.newInstance (Constructor.java:417)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(Object ... initargs)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> InstantiationException, IllegalAccessException,</span></span><br><span class="line"><span class="function">IllegalArgumentException, InvocationTargetException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!override) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;</span><br><span class="line">      Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">      checkAccess(caller, clazz, <span class="keyword">null</span>, modifiers);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((clazz.getModifiers() &amp; Modifier.ENUM) != <span class="number">0</span>)</span><br><span class="line">    <span class="comment">////////////  417  //////////// </span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Cannot reflectively create enum objects"</span>);</span><br><span class="line">  ConstructorAccessor ca = constructorAccessor;   <span class="comment">// read volatile</span></span><br><span class="line">  <span class="keyword">if</span> (ca == <span class="keyword">null</span>) &#123;</span><br><span class="line">    ca = acquireConstructorAccessor();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">  T inst = (T) ca.newInstance(initargs);</span><br><span class="line">  <span class="keyword">return</span> inst;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到反射创建实例的时候会判断类的修饰符中是否有 enum，如果有就抛出 <code>IllegalArgumentException</code> 异常。</p>
<p>因此，<strong>枚举类型可以防止反射攻击</strong>。</p>
<h5 id="非枚举的防守方法"><a href="#非枚举的防守方法" class="headerlink" title="非枚举的防守方法"></a>非枚举的防守方法</h5><p>在构造器中判断实例是否已经存在，存在就抛出异常，保证构造器只被调用一次！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Singleton1 instance = <span class="keyword">new</span> Singleton1();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance != <span class="keyword">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"实例已存在，单例构造器只能被调用一次！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="序列化攻击"><a href="#序列化攻击" class="headerlink" title="序列化攻击"></a>序列化攻击</h4><p>一般类需要实现 <code>Serializable</code> 接口才能被序列化，但枚举类不用，因为枚举类本质是继承了 <code>java.lang.Enum</code> 的，而 Enum 已经声明实现了 <code>Serializable</code>。</p>
<p>一般的单例模式无法防止序列化攻击，经过序列化和反序列化后会创建出新的实例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonTest2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    Singleton1 instance = Singleton1.getInstance();</span><br><span class="line"></span><br><span class="line">    ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(outputStream);</span><br><span class="line">    objectOutputStream.writeObject(instance);</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = outputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">    ByteArrayInputStream byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">    ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(byteArrayInputStream);</span><br><span class="line">    Singleton1 instance1 = (Singleton1) objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">    System.out.println(instance == instance1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">false</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>但是对于枚举类来说，反序列化后还是原来的实例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">  Singleton6 instance = Singleton6.INSTANCE;</span><br><span class="line"></span><br><span class="line">  ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">  ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(outputStream);</span><br><span class="line">  objectOutputStream.writeObject(instance);</span><br><span class="line">  <span class="keyword">byte</span>[] bytes = outputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">  ByteArrayInputStream byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">  ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(byteArrayInputStream);</span><br><span class="line">  Singleton6 instance1 = (Singleton6) objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">  System.out.println(instance == instance1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">true</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>可以看到反序列化枚举后得到的实例和序列化之前的实例是同一个实例。查看 <code>ByteArrayOutputStream.writeObject()</code> 方法源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (enableOverride) &#123;</span><br><span class="line">    writeObjectOverride(obj);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    writeObject0(obj, <span class="keyword">false</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (depth == <span class="number">0</span>) &#123;</span><br><span class="line">      writeFatalException(ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> ex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>writeObject0()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject0</span><span class="params">(Object obj, <span class="keyword">boolean</span> unshared)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// remaining cases</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">    writeString((String) obj, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cl.isArray()) &#123;</span><br><span class="line">    writeArray(obj, desc, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Enum) &#123;</span><br><span class="line">    writeEnum((Enum&lt;?&gt;) obj, desc, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Serializable) &#123;</span><br><span class="line">    writeOrdinaryObject(obj, desc, unshared);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(</span><br><span class="line">        cl.getName() + <span class="string">"\n"</span> + debugInfoStack.toString());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(cl.getName());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  depth--;</span><br><span class="line">  bout.setBlockDataMode(oldMode);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果是枚举类型，会调用 <code>writeEnum()</code> 方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeEnum</span><span class="params">(Enum&lt;?&gt; en,</span></span></span><br><span class="line"><span class="function"><span class="params">                       ObjectStreamClass desc,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">boolean</span> unshared)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Enum 类型标记：129</span></span><br><span class="line"><span class="comment">     * new Enum constant.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="comment">// final static byte TC_ENUM =         (byte)0x7E;</span></span><br><span class="line">  bout.writeByte(TC_ENUM);</span><br><span class="line">  ObjectStreamClass sdesc = desc.getSuperDesc();</span><br><span class="line">  writeClassDesc((sdesc.forClass() == Enum.class) ? desc : sdesc, false);</span><br><span class="line">  handles.assign(unshared ? <span class="keyword">null</span> : en);</span><br><span class="line">  writeString(en.name(), <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着再看 Enum 类型的反序列化，<code>ObjectInputStream.readObject()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">readObject</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException, ClassNotFoundException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (enableOverride) &#123;</span><br><span class="line">    <span class="keyword">return</span> readObjectOverride();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if nested read, passHandle contains handle of enclosing object</span></span><br><span class="line">  <span class="keyword">int</span> outerHandle = passHandle;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Object obj = readObject0(<span class="keyword">false</span>);</span><br><span class="line">    handles.markDependency(outerHandle, passHandle);</span><br><span class="line">    ClassNotFoundException ex = handles.lookupException(passHandle);</span><br><span class="line">    <span class="keyword">if</span> (ex != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (depth == <span class="number">0</span>) &#123;</span><br><span class="line">      vlist.doCallbacks();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    passHandle = outerHandle;</span><br><span class="line">    <span class="keyword">if</span> (closed &amp;&amp; depth == <span class="number">0</span>) &#123;</span><br><span class="line">      clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ObjectInputStream.readObject0()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readObject0</span><span class="params">(<span class="keyword">boolean</span> unshared)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (tc) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> TC_ENUM:</span><br><span class="line">        <span class="keyword">return</span> checkResolve(readEnum(unshared));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_OBJECT:</span><br><span class="line">        <span class="keyword">return</span> checkResolve(readOrdinaryObject(unshared));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_EXCEPTION:</span><br><span class="line">        IOException ex = readFatalException();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WriteAbortedException(<span class="string">"writing aborted"</span>, ex);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_BLOCKDATA:</span><br><span class="line">      <span class="keyword">case</span> TC_BLOCKDATALONG:</span><br><span class="line">        <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">          bin.setBlockDataMode(<span class="keyword">true</span>);</span><br><span class="line">          bin.peek();             <span class="comment">// force header read</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> OptionalDataException(</span><br><span class="line">            bin.currentBlockRemaining());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> StreamCorruptedException(</span><br><span class="line">            <span class="string">"unexpected block data"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> TC_ENDBLOCKDATA:</span><br><span class="line">        <span class="keyword">if</span> (oldMode) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> OptionalDataException(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> StreamCorruptedException(</span><br><span class="line">            <span class="string">"unexpected end of block data"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StreamCorruptedException(</span><br><span class="line">          String.format(<span class="string">"invalid type code: %02X"</span>, tc));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    depth--;</span><br><span class="line">    bin.setBlockDataMode(oldMode);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ObjectInputStream.readEnum()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Enum&lt;?&gt; readEnum(<span class="keyword">boolean</span> unshared) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (cl != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">      Enum&lt;?&gt; en = Enum.valueOf((Class)cl, name);</span><br><span class="line">      result = en;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">      <span class="keyword">throw</span> (IOException) <span class="keyword">new</span> InvalidObjectException(</span><br><span class="line">        <span class="string">"enum constant "</span> + name + <span class="string">" does not exist in "</span> +</span><br><span class="line">        cl).initCause(ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!unshared) &#123;</span><br><span class="line">      handles.setObject(enumHandle, result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handles.finish(enumHandle);</span><br><span class="line">  passHandle = enumHandle;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Enum.valueOf()</code> 源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt;&gt; <span class="function">T <span class="title">valueOf</span><span class="params">(Class&lt;T&gt; enumType,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            String name)</span> </span>&#123;</span><br><span class="line">  T result = enumType.enumConstantDirectory().get(name);</span><br><span class="line">  <span class="keyword">if</span> (result != <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  <span class="keyword">if</span> (name == <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"Name is null"</span>);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">    <span class="string">"No enum constant "</span> + enumType.getCanonicalName() + <span class="string">"."</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终是根据 <code>name</code> 在枚举类实力数组里查找，所以返回的实例是已经存在的实例，并不会新建实例。</p>
<p>因此<strong>枚举可以防止反序列化攻击</strong>。</p>
<h5 id="非枚举的防守方法-1"><a href="#非枚举的防守方法-1" class="headerlink" title="非枚举的防守方法"></a>非枚举的防守方法</h5><p>增加 <code>readResolve()</code> 方法返回单例，反序列化时会判断对象是否存在该方法，存在则会调用该方法返回对象。</p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">饿汉模式</th>
<th align="left">懒汉模式</th>
<th align="left">线程安全的懒汉模式</th>
<th align="left">双重校验锁模式</th>
<th align="left">静态内部类单例模式</th>
<th align="left">枚举单例模式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">延迟加载</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">否</td>
</tr>
<tr>
<td align="left">线程安全</td>
<td align="left">是</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">反射攻击 (能否抵御)</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">能</td>
</tr>
<tr>
<td align="left">反序列化攻击 (能否抵御)</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">能</td>
</tr>
</tbody></table>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><blockquote>
<p>《大话设计模式》第2章 商场促销——策略模式</p>
</blockquote>
<h4 id="现金收费抽象类"><a href="#现金收费抽象类" class="headerlink" title="现金收费抽象类"></a>现金收费抽象类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CashSuper</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">acceptCash</span><span class="params">(<span class="keyword">double</span> money)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="正常收费子类"><a href="#正常收费子类" class="headerlink" title="正常收费子类"></a>正常收费子类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CashNormal</span> <span class="keyword">implements</span> <span class="title">CashSuper</span></span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">acceptCash</span><span class="params">(<span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> money;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="打折收费子类"><a href="#打折收费子类" class="headerlink" title="打折收费子类"></a>打折收费子类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CashRebate</span> <span class="keyword">implements</span> <span class="title">CashSuper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> moneyRebate = <span class="number">1</span>d;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CashRebate</span><span class="params">(<span class="keyword">double</span> moneyRebate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.moneyRebate = moneyRebate;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">acceptCash</span><span class="params">(<span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> money * moneyRebate;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="返利收费子类"><a href="#返利收费子类" class="headerlink" title="返利收费子类"></a>返利收费子类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CashReturn</span> <span class="keyword">implements</span> <span class="title">CashSuper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> moneyCondition;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> moneyReturn;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CashReturn</span><span class="params">(<span class="keyword">double</span> moneyCondition, <span class="keyword">double</span> moneyReturn)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.moneyCondition = moneyCondition;</span><br><span class="line">    <span class="keyword">this</span>.moneyReturn = moneyReturn;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">acceptCash</span><span class="params">(<span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (money &gt; moneyCondition) &#123;</span><br><span class="line">      money -= (<span class="keyword">int</span>) (money / moneyCondition) * moneyReturn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> money;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="简单工厂实现"><a href="#简单工厂实现" class="headerlink" title="简单工厂实现"></a>简单工厂实现</h4><h5 id="现金收费工厂类"><a href="#现金收费工厂类" class="headerlink" title="现金收费工厂类"></a>现金收费工厂类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CashFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CashSuper <span class="title">createCashAccept</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    CashSuper cashSuper = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"正常收费"</span>:</span><br><span class="line">        cashSuper = <span class="keyword">new</span> CashNormal();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"满300减100"</span>:</span><br><span class="line">        cashSuper = <span class="keyword">new</span> CashReturn(<span class="number">300</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"打8折"</span>:</span><br><span class="line">        cashSuper = <span class="keyword">new</span> CashRebate(<span class="number">0.8</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cashSuper;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">double</span> MONEY = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    CashSuper cashSuper = CashFactory.createCashAccept(<span class="string">"正常收费"</span>);</span><br><span class="line">    System.out.println(<span class="string">"Primary money="</span>+MONEY+<span class="string">", Final money="</span>+cashSuper.acceptCash(MONEY));</span><br><span class="line"></span><br><span class="line">    CashSuper cashSuper2 = CashFactory.createCashAccept(<span class="string">"满300减100"</span>);</span><br><span class="line">    System.out.println(<span class="string">"Primary money="</span>+MONEY+<span class="string">", Final money="</span>+cashSuper2.acceptCash(MONEY));</span><br><span class="line"></span><br><span class="line">    CashSuper cashSuper3 = CashFactory.createCashAccept(<span class="string">"打8折"</span>);</span><br><span class="line">    System.out.println(<span class="string">"Primary money="</span>+MONEY+<span class="string">", Final money="</span>+cashSuper3.acceptCash(MONEY));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="策略与简单工厂结合"><a href="#策略与简单工厂结合" class="headerlink" title="策略与简单工厂结合"></a>策略与简单工厂结合</h4><h5 id="CashContext类"><a href="#CashContext类" class="headerlink" title="CashContext类"></a>CashContext类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CashContext</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> CashSuper cashSuper;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CashContext</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    CashSuper cashSuper = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"正常收费"</span>:</span><br><span class="line">        cashSuper = <span class="keyword">new</span> CashNormal();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"满300减100"</span>:</span><br><span class="line">        cashSuper = <span class="keyword">new</span> CashReturn(<span class="number">300</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"打8折"</span>:</span><br><span class="line">        cashSuper = <span class="keyword">new</span> CashRebate(<span class="number">0.8</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.cashSuper = cashSuper;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">(<span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> cashSuper.acceptCash(money);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="如何消除switch语句？"><a href="#如何消除switch语句？" class="headerlink" title="如何消除switch语句？"></a>如何消除switch语句？</h6><p>通过反射</p>
<h5 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">double</span> MONEY = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    CashContext cashContext = <span class="keyword">new</span> CashContext(<span class="string">"正常收费"</span>);</span><br><span class="line">    System.out.println(<span class="string">"Primary money="</span> + MONEY + <span class="string">", Final money="</span> + cashContext.getResult(MONEY));</span><br><span class="line"></span><br><span class="line">    CashContext cashContext2 = <span class="keyword">new</span> CashContext(<span class="string">"满300减100"</span>);</span><br><span class="line">    System.out.println(<span class="string">"Primary money="</span> + MONEY + <span class="string">", Final money="</span> + cashContext2.getResult(MONEY));</span><br><span class="line"></span><br><span class="line">    CashContext cashContext3 = <span class="keyword">new</span> CashContext(<span class="string">"打8折"</span>);</span><br><span class="line">    System.out.println(<span class="string">"Primary money="</span> + MONEY + <span class="string">", Final money="</span> + cashContext3.getResult(MONEY));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="简单工厂模式-VS-策略模式与简单工厂结合"><a href="#简单工厂模式-VS-策略模式与简单工厂结合" class="headerlink" title="简单工厂模式 VS 策略模式与简单工厂结合"></a>简单工厂模式 VS 策略模式与简单工厂结合</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//简单工厂模式的用法</span></span><br><span class="line">CashSuper cashSuper = CashFactory.createCashAccept(type);</span><br><span class="line">cashSuper.acceptCash(MONEY);</span><br><span class="line"></span><br><span class="line"><span class="comment">//策略模式与简单工厂结合的用法</span></span><br><span class="line">CashContext cashContext = <span class="keyword">new</span> CashContext(type);</span><br><span class="line">cashContext.getResult(MONEY);</span><br></pre></td></tr></table></figure>

<ol>
<li>简单工厂模式需要让客户端认识两个类，CashSuper和CashFactory，而策略模式与简单工厂结合的用法，客户端就只需要认识一个类CashContext就可以了。耦合更加降低。</li>
<li>策略模式与简单工厂结合的用法在客户端实例化的是CashContext的对象，调用的是CashContext的方法getResult，这使得具体的收费算法彻底地与客户端分离。连算法的父类CashSuper都不让客户端认识了。</li>
</ol>
<h4 id="策略模式的优缺点"><a href="#策略模式的优缺点" class="headerlink" title="策略模式的优缺点"></a>策略模式的优缺点</h4><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ol>
<li><p>低耦合</p>
<p>策略模式是一种定义一系列算法的方法，所有算法完成相同的工作，只是实现不同，它可以以相同的方式调用所有的算法，减少了各种算法类与使用算法类之间的耦合。</p>
</li>
<li><p>简化单元测试</p>
<p>每个算法都有自己的类，可以通过自己的接口单独测试。</p>
</li>
</ol>
<h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ol>
<li>策略类需要对客户端透明：客户端必须知道所有的策略类，并自行决定哪一个策略类，也就是客户端需要理解这些算法的区别以便选择适当的算法</li>
<li>策略类数量多：策略模式会造成系统产生很多具体策略类，任何细小的变化都会导致系统增加一个新的具体策略类</li>
<li>客户端无法使用多个策略类：客户端每次只能使用一个策略类，不支持使用一个策略类完成部分功能后再使用另一个策略类来完成剩下的功能</li>
</ol>
<h4 id="典型应用"><a href="#典型应用" class="headerlink" title="典型应用"></a>典型应用</h4><h5 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h5><h6 id="比较器接口-java-util-Comparator"><a href="#比较器接口-java-util-Comparator" class="headerlink" title="比较器接口 java.util.Comparator"></a>比较器接口 <code>java.util.Comparator</code></h6><p>通过 <code>Collections.sort(List,Comparator)</code> 和 <code>Arrays.sort(Object[],Comparator)</code> 对集合和数组进行排序。</p>
<p><code>Comparator</code> 接口充当了<strong>抽象策略</strong>角色，<code>Collections</code> 和 <code>Arrays</code> 则是<strong>环境</strong>角色。</p>
<h5 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h5><h6 id="实例化策略接口-org-springframework-beans-factory-support-InstantiationStrategy"><a href="#实例化策略接口-org-springframework-beans-factory-support-InstantiationStrategy" class="headerlink" title="实例化策略接口 org.springframework.beans.factory.support.InstantiationStrategy"></a>实例化策略接口 <code>org.springframework.beans.factory.support.InstantiationStrategy</code></h6><p>Spring 在具体实例化Bean的过程中，先通过 <code>ConstructorResolver</code> 找到对应的实例化方法和参数，再通过实例化策略 <code>InstantiationStrategy</code> 进行实例化。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InstantiationStrategy</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 默认构造方法/无参构造方法</span></span><br><span class="line">  <span class="function">Object <span class="title">instantiate</span><span class="params">(RootBeanDefinition beanDefinition, String beanName, BeanFactory owner)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指定构造方法/有参构造方法</span></span><br><span class="line">  <span class="function">Object <span class="title">instantiate</span><span class="params">(RootBeanDefinition beanDefinition, String beanName, BeanFactory owner, Constructor&lt;?&gt; ctor,</span></span></span><br><span class="line"><span class="function"><span class="params">                     Object[] args)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指定工厂方法</span></span><br><span class="line">  <span class="function">Object <span class="title">instantiate</span><span class="params">(RootBeanDefinition beanDefinition, String beanName, BeanFactory owner, Object factoryBean,</span></span></span><br><span class="line"><span class="function"><span class="params">                     Method factoryMethod, Object[] args)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InstantiationStrategy</code> 扮演<strong>抽象策略</strong>角色，有两种具体策略类，分别为 <code>SimpleInstantiationStrategy</code> 和 <code>CglibSubclassingInstantiationStrategy</code></p>
<p><img data-src="http://image.laijianfeng.org/20181018_171946.png" alt="Spring 实例化策略类图"></p>
<p>在 <code>SimpleInstantiationStrategy</code> 中对这三个方法做了简单实现，如果工厂方法实例化直接用反射创建对象，如果是构造方法实例化的则判断是否有 <code>MethodOverrides</code>，如果无 <code>MethodOverrides</code> 也是直接用反射，如果有 <code>MethodOverrides</code> 就需要用 <code>cglib</code> 实例化对象，<code>SimpleInstantiationStrategy</code> 把通过 <code>cglib</code> 实例化的任务交给了它的子类 <code>CglibSubclassingInstantiationStrategy</code>。</p>
<h5 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h5><h6 id="应用世界：不同策略上下架应用"><a href="#应用世界：不同策略上下架应用" class="headerlink" title="应用世界：不同策略上下架应用"></a>应用世界：不同策略上下架应用</h6><p>应用世界中上下架应用有不同的策略：过期时间、点击量、用户量等策略。</p>
<p>过期时间策略在应用到达过期时间时自动下架。</p>
<p>点击量在应用的点击次数到达阀值后自动下架。</p>
<p>用户量在应用的新用户数达到阀值后自动下架。</p>
<h3 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h3><h4 id="模式结构"><a href="#模式结构" class="headerlink" title="模式结构"></a>模式结构</h4><p>责任链模式包含如下角色：</p>
<ul>
<li>处理器抽象类</li>
<li>具体处理器</li>
<li>处理器链维护器(可选)：维护了各个处理器的前后关系。可以由客户端再发送请求前生成链，或者动态地生成链。</li>
<li>客户端</li>
</ul>
<h4 id="伪例"><a href="#伪例" class="headerlink" title="伪例"></a>伪例</h4><p>请假流程</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/10/31/166c90b174855416" alt=""></p>
<p>请假请求类：LeaveRequest</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeaveRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> days;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LeaveRequest</span><span class="params">(<span class="keyword">int</span> days)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.days = days;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理器抽象类：LeaveRequestHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LeaveRequestHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.threshold = threshold;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理器具体类：SupervisorHandler、ManagerHandler、GeneralManagerHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SupervisorHandler</span> <span class="keyword">extends</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SupervisorHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(threshold);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaveRequest.days &lt;= threshold)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Random().nextBoolean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagerHandler</span> <span class="keyword">extends</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ManagerHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(threshold);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaveRequest.days &lt;= threshold)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Random().nextBoolean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneralManagerHandler</span> <span class="keyword">extends</span> <span class="title">LeaveRequestHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">GeneralManagerHandler</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(threshold);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">handle</span><span class="params">(LeaveRequest leaveRequest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leaveRequest.days &lt;= threshold)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Random().nextBoolean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端：Worker</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> days = <span class="number">3</span>;</span><br><span class="line">    Boolean response = requestLeave(days);</span><br><span class="line">    System.out.println(<span class="string">"申请"</span> + days + <span class="string">"天,"</span> + (response ? <span class="string">"申请成功！"</span> : <span class="string">"申请失败！"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Boolean <span class="title">requestLeave</span><span class="params">(<span class="keyword">int</span> days)</span> </span>&#123;</span><br><span class="line">    LeaveRequest leaveRequest = <span class="keyword">new</span> LeaveRequest(days);</span><br><span class="line">    SupervisorHandler supervisorHandler = <span class="keyword">new</span> SupervisorHandler(<span class="number">3</span>);</span><br><span class="line">    ManagerHandler managerHandler = <span class="keyword">new</span> ManagerHandler(<span class="number">7</span>);</span><br><span class="line">    GeneralManagerHandler generalManagerHandler = <span class="keyword">new</span> GeneralManagerHandler(Integer.MAX_VALUE);</span><br><span class="line">    LeaveRequestHandlerChain chain = <span class="keyword">new</span> LeaveRequestHandlerChain();</span><br><span class="line">    chain.addHandler(supervisorHandler);</span><br><span class="line">    chain.addHandler(managerHandler);</span><br><span class="line">    chain.addHandler(generalManagerHandler);</span><br><span class="line">    <span class="keyword">return</span> chain.process(leaveRequest);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="典型应用-1"><a href="#典型应用-1" class="headerlink" title="典型应用"></a>典型应用</h4><h5 id="Tomcat-过滤器中的责任链模式"><a href="#Tomcat-过滤器中的责任链模式" class="headerlink" title="Tomcat 过滤器中的责任链模式"></a>Tomcat 过滤器中的责任链模式</h5><p><code>Servlet</code> 过滤器是可用于 <code>Servlet</code> 编程的 Java 类，可以实现以下目的：在客户端的请求访问后端资源之前，拦截这些请求；在服务器的响应发送回客户端之前，处理这些响应。</p>
<h5 id="Mybatis-中的-Plugin-机制"><a href="#Mybatis-中的-Plugin-机制" class="headerlink" title="Mybatis 中的 Plugin 机制"></a>Mybatis 中的 Plugin 机制</h5><p>Mybatis 中的 Plugin 机制使用了责任链模式，配置各种官方或者自定义的 Plugin，与 Filter 类似，可以在执行 Sql 语句的时候做一些操作。</p>
<h3 id="包装模式-装饰者模式"><a href="#包装模式-装饰者模式" class="headerlink" title="包装模式/装饰者模式"></a>包装模式/装饰者模式</h3><blockquote>
<p>别称：包装模式、装饰器模式、Wrapper、Decorator</p>
</blockquote>
<p>装饰器模式（Decorator Pattern）允许在<strong>不改变其结构</strong>的情况下向一个现有的对象添加新的功能。</p>
<h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><ol>
<li><strong>抽象构件</strong> （Component）</li>
<li><strong>具体构件</strong> （Concrete Component）</li>
<li><strong>抽象装饰类</strong> （Decorator） </li>
<li><strong>具体装饰类</strong> （Concrete Decorators）</li>
</ol>
<h4 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h4><blockquote>
<p><a href="https://www.runoob.com/design-pattern/decorator-pattern.html" target="_blank" rel="noopener">装饰器模式| 菜鸟教程</a></p>
</blockquote>
<p>画图形：图形有长方形、圆形；可以画红色的也可以画绿色的。</p>
<h5 id="抽象构件"><a href="#抽象构件" class="headerlink" title="抽象构件"></a>抽象构件</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="具体构件"><a href="#具体构件" class="headerlink" title="具体构件"></a>具体构件</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.print(<span class="string">"Shape: rectangle\t"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.print(<span class="string">"Shape: circle\t"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="抽象装饰类"><a href="#抽象装饰类" class="headerlink" title="抽象装饰类"></a>抽象装饰类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeDecorator</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> Shape shape;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ShapeDecorator</span><span class="params">(Shape shape)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.shape = shape;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="具体装饰类"><a href="#具体装饰类" class="headerlink" title="具体装饰类"></a>具体装饰类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedShapeDecorator</span> <span class="keyword">extends</span> <span class="title">ShapeDecorator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">RedShapeDecorator</span><span class="params">(Shape shape)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(shape);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    shape.draw();</span><br><span class="line">    System.out.println(<span class="string">"Color: red"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreenShapeDecorator</span> <span class="keyword">extends</span> <span class="title">ShapeDecorator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">GreenShapeDecorator</span><span class="params">(Shape shape)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(shape);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    shape.draw();</span><br><span class="line">    System.out.println(<span class="string">"Color: green"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  Shape shape = <span class="keyword">new</span> RedShapeDecorator(<span class="keyword">new</span> Rectangle());</span><br><span class="line">  shape.draw();</span><br><span class="line"></span><br><span class="line">  shape = <span class="keyword">new</span> GreenShapeDecorator(<span class="keyword">new</span> Rectangle());</span><br><span class="line">  shape.draw();</span><br><span class="line"></span><br><span class="line">  shape = <span class="keyword">new</span> RedShapeDecorator(<span class="keyword">new</span> Circle());</span><br><span class="line">  shape.draw();</span><br><span class="line"></span><br><span class="line">  shape = <span class="keyword">new</span> GreenShapeDecorator(<span class="keyword">new</span> Circle());</span><br><span class="line">  shape.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Shape: rectangle	Color: red</span><br><span class="line">Shape: rectangle	Color: green</span><br><span class="line">Shape: circle	Color: red</span><br><span class="line">Shape: circle	Color: green</span><br></pre></td></tr></table></figure>

<h4 id="典型应用-2"><a href="#典型应用-2" class="headerlink" title="典型应用"></a>典型应用</h4><blockquote>
<p><a href="https://juejin.im/post/6844903681322647566" target="_blank" rel="noopener">设计模式| 装饰者模式及典型应用 - 掘金</a></p>
</blockquote>
<h5 id="Java-I-O"><a href="#Java-I-O" class="headerlink" title="Java I/O"></a>Java I/O</h5><p>抽象构件：<code>java.io.InputStream</code></p>
<p>具体构件：</p>
<ul>
<li><p><code>java.io.FileInputStream</code></p>
</li>
<li><p><code>java.io.ByteArrayInputStream</code></p>
</li>
<li><p><code>java.io.PipedInputStream</code></p>
</li>
</ul>
<p>抽象装饰类：<code>java.io.FilterInputStream</code></p>
<p>具体装饰类：</p>
<ul>
<li><p><code>java.io.BufferedInputStream</code></p>
</li>
<li><p><code>java.io.DataInputStream</code></p>
</li>
<li><p><code>java.io.PushbackInputStream</code></p>
</li>
</ul>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/9/18/165ecd4e160d8682" alt=""></p>
<p>实例化一个具有缓存功能的字节流对象时，只需要在 FileInputStream 对象上再套一层 BufferedInputStream 对象即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(filePath);</span><br><span class="line">BufferedInputStream bufferedInputStream = <span class="keyword">new</span> BufferedInputStream(fileInputStream);</span><br></pre></td></tr></table></figure>

<p>DataInputStream 装饰者提供了对更多数据类型进行输入的操作，比如 int、double 等基本类型。</p>
<h3 id="模版方法模式"><a href="#模版方法模式" class="headerlink" title="模版方法模式"></a>模版方法模式</h3><h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><blockquote>
<p><a href="https://blog.csdn.net/shusheng0007/article/details/80864854" target="_blank" rel="noopener">秒懂Java代理与动态代理模式</a></p>
</blockquote>
<p>用代理对象<strong>代替</strong>目标对象来实现某个目的（服务/主题/功能）。</p>
<h4 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h4><ol>
<li>隐藏目标对象</li>
<li>增强目标对象</li>
</ol>
<h4 id="代理模式结构"><a href="#代理模式结构" class="headerlink" title="代理模式结构"></a>代理模式结构</h4><blockquote>
<p><a href="https://refactoringguru.cn/design-patterns/proxy" target="_blank" rel="noopener">代理模式 | <strong>Refactoring.Guru</strong></a></p>
</blockquote>
<ol>
<li><p>服务接口</p>
<p>声明了服务接口。 代理必须遵循该接口才能伪装成服务对象。</p>
</li>
<li><p>服务类</p>
<p>提供了一些实用的业务逻辑。</p>
</li>
<li><p>代理类</p>
<p>代理类包含一个指向服务对象的引用成员变量。 代理完成其任务 （例如延迟初始化、 记录日志、 访问控制和缓存等） 后会将请求传递给服务对象。 通常情况下， 代理会对其服务对象的整个生命周期进行管理。</p>
</li>
<li><p>客户端</p>
<p>客户端能通过同一接口与服务或代理进行交互，所以你可在一切需要服务对象的代码中使用代理。</p>
</li>
</ol>
<h4 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h4><p>劳动仲裁案例：代理律师代理讨薪员工索要工资。</p>
<h5 id="服务接口"><a href="#服务接口" class="headerlink" title="服务接口"></a>服务接口</h5><blockquote>
<p>代理主题：讨薪</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AskAbility</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="服务类"><a href="#服务类" class="headerlink" title="服务类"></a>服务类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhangSan</span> <span class="keyword">implements</span> <span class="title">AskAbility</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"还钱！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="代理类"><a href="#代理类" class="headerlink" title="代理类"></a>代理类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lawyer</span> <span class="keyword">implements</span> <span class="title">AskAbility</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> ZhangSan zhangSan;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Lawyer</span><span class="params">(ZhangSan zhangSan)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.zhangSan = zhangSan;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    zhangSan.askForPay();</span><br><span class="line">    System.out.println(<span class="string">"如果不还将承担法律责任！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="客户端-2"><a href="#客户端-2" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ZhangSan zhangSan = <span class="keyword">new</span> ZhangSan();</span><br><span class="line">    AskAbility ask = <span class="keyword">new</span> Lawyer(zhangSan);</span><br><span class="line">    ask.askForPay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p>静态代理中代理类在编译期已经存在，一个服务类需要一个代理类与之对应，当服务类增多时，代理类随着增多，导致类数量太多。</p>
<p>动态代理就是为了减少类数量而产生。</p>
<p>动态代理有 JDK(基于接口、反射生成) 和 CGLIB(基于继承、字节码生成) 两种实现方式。</p>
<p>Spring AOP 就是基于动态代理实现的。</p>
<blockquote>
<p><a href="https://blog.csdn.net/javazejian/article/details/56267036" target="_blank" rel="noopener">关于 Spring AOP (AspectJ) 你该知晓的一切</a></p>
<p><a href="https://how2j.cn/k/spring/spring-annotation-ioc-di/1067.html" target="_blank" rel="noopener">Spring系列教材 （三）- 注解方式 IOC/DI</a></p>
</blockquote>
<h5 id="JDK-动态代理"><a href="#JDK-动态代理" class="headerlink" title="JDK 动态代理"></a>JDK 动态代理</h5><p>两个重要的元素：</p>
<ol>
<li><p>InvocationHandler 接口</p>
<p><code>public Object invoke(Object proxy, Method method, Object[] args) throws Throwable;</code></p>
<ul>
<li>proxy：动态代理对象</li>
<li>method：正在执行的方法</li>
<li>args：当前执行方法传入的实参</li>
</ul>
</li>
<li><p>Proxy 类</p>
<p><code>public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException</code></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AskingHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AskingHandler</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.target = target;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    Object invoke = method.invoke(target, args);</span><br><span class="line">    System.out.println(<span class="string">"如果不还将承担法律责任！"</span>);</span><br><span class="line">    <span class="keyword">return</span> invoke;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">    InvocationHandler handler = <span class="keyword">new</span> AskingHandler(employee);</span><br><span class="line">    AskAbility proxy = (AskAbility) Proxy.newProxyInstance(employee.getClass().getClassLoader(), employee.getClass().getInterfaces(), handler);</span><br><span class="line">    proxy.askForPay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="CGLIB-动态代理"><a href="#CGLIB-动态代理" class="headerlink" title="CGLIB 动态代理"></a>CGLIB 动态代理</h5><p>JDK 只能对实现了接口的类做动态代理，而不能对没有实现接口的类做动态代理，所以出现了 cgLib。</p>
<p>CGLib（Code Generation Library）是一个强大、高性能的 Code 生成类库，它可以在程序运行期间动态扩展类或接口，它的底层是使用 <strong>java字节码操作框架</strong> ASM 实现。</p>
<p>CGLIB 两个重要元素：</p>
<ol>
<li><p>MethodInterceptor 方法拦截器</p>
<p><code>Object intercept(Object var1, Method var2, Object[] var3, MethodProxy var4) throws Throwable;</code></p>
</li>
<li><p>Enhancer</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">create</span><span class="params">(Class type, Callback callback)</span> </span>&#123;</span><br><span class="line">  Enhancer e = <span class="keyword">new</span> Enhancer();</span><br><span class="line">  e.setSuperclass(type);</span><br><span class="line">  e.setCallback(callback);</span><br><span class="line">  <span class="keyword">return</span> e.create();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h6 id="服务类-1"><a href="#服务类-1" class="headerlink" title="服务类"></a>服务类</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">askForPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"还钱！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="方法拦截器"><a href="#方法拦截器" class="headerlink" title="方法拦截器"></a>方法拦截器</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AskingMethodInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    Object result = methodProxy.invokeSuper(o, objects);</span><br><span class="line">    <span class="keyword">if</span> (method.getName().equals(<span class="string">"askForPay"</span>))</span><br><span class="line">      System.out.println(<span class="string">"如果不还将承担法律责任！"</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="客户端-3"><a href="#客户端-3" class="headerlink" title="客户端"></a>客户端</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">    Employee proxy = (Employee) Enhancer.create(employee.getClass(), <span class="keyword">new</span> AskingMethodInterceptor());</span><br><span class="line"></span><br><span class="line">    proxy.askForPay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="JDK-动态代理与-CGLIB-动态代理的区别"><a href="#JDK-动态代理与-CGLIB-动态代理的区别" class="headerlink" title="JDK 动态代理与 CGLIB 动态代理的区别"></a>JDK 动态代理与 CGLIB 动态代理的区别</h5><ol>
<li>JDK 动态代理基于接口，CGLIB 动态代理基于继承</li>
<li>JDK 动态代理通过反射生成代理，CGLIB 通过操作字节码生成动态代理</li>
<li>JDK 生成动态代理比CGLIB快</li>
<li>JDK 动态代理执行代理方法时，需要通过反射机制进行回调，CGLIB 对方法的调用和直接调用普通类的方式一致，所以<code>CGLib</code>执行代理方法的效率要高于<code>JDK</code>的动态代理</li>
</ol>
<h3 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h3><blockquote>
<p><a href="http://libo9527.github.io/2020/11/04/Design-Pattern-Iterator/" target="_blank" rel="noopener">Design-Pattern-Iterator | libo9527</a></p>
</blockquote>
<h4 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h4><p>在不暴露集合底层表现形式 （列表、 栈和树等） 的情况下遍历集合中所有的元素。</p>
<h4 id="主要思想"><a href="#主要思想" class="headerlink" title="主要思想"></a>主要思想</h4><p>将集合的遍历行为抽取为单独的迭代器对象。</p>
<h4 id="结构-1"><a href="#结构-1" class="headerlink" title="结构"></a>结构</h4><ol>
<li>抽象迭代器（Iterator）</li>
<li>具体迭代器（Concrete Iterators）</li>
<li>抽象集合（Collection）</li>
<li>具体集合（Concrete Collections）</li>
</ol>
<h4 id="简单示例-1"><a href="#简单示例-1" class="headerlink" title="简单示例"></a>简单示例</h4><p>学生报数</p>
<h5 id="抽象迭代器"><a href="#抽象迭代器" class="headerlink" title="抽象迭代器"></a>抽象迭代器</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentIterator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">hashNext</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">Student <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">getPosition</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="具体迭代器"><a href="#具体迭代器" class="headerlink" title="具体迭代器"></a>具体迭代器</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteStudentIterator</span> <span class="keyword">implements</span> <span class="title">StudentIterator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Student[] students;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> position = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ConcreteStudentIterator</span><span class="params">(Student[] students)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.students = students;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> position;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hashNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> position &lt; students.length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Student <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> students[position++];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="抽象集合"><a href="#抽象集合" class="headerlink" title="抽象集合"></a>抽象集合</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentCollection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">abstract</span> StudentIterator <span class="title">createIterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="具体集合"><a href="#具体集合" class="headerlink" title="具体集合"></a>具体集合</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteStudentCollection</span> <span class="keyword">extends</span> <span class="title">StudentCollection</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Student[] students;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ConcreteStudentCollection</span><span class="params">(Student[] students)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.students = students;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function">StudentIterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ConcreteStudentIterator(students);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="客户端使用-1"><a href="#客户端使用-1" class="headerlink" title="客户端使用"></a>客户端使用</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  StudentCollection studentCollection = <span class="keyword">new</span> ConcreteStudentCollection(<span class="keyword">new</span> Student[]&#123;<span class="keyword">new</span> Student(<span class="string">"张三"</span>), <span class="keyword">new</span> Student(<span class="string">"李四"</span>)&#125;);</span><br><span class="line">  StudentIterator iterator = studentCollection.createIterator();</span><br><span class="line">  <span class="keyword">while</span> (iterator.hashNext()) &#123;</span><br><span class="line">    Student student = iterator.next();</span><br><span class="line">    System.out.println(<span class="string">"我是"</span> + iterator.getPosition() + <span class="string">"号："</span> + student.getName());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">我是1号：张三</span><br><span class="line">我是2号：李四</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h4 id="典型应用-3"><a href="#典型应用-3" class="headerlink" title="典型应用"></a>典型应用</h4><h5 id="Java-集合"><a href="#Java-集合" class="headerlink" title="Java 集合"></a>Java 集合</h5><p><img data-src="../post_image/image_2020_11_04T11_06_19_787Z.png" alt=""></p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="网络分层"><a href="#网络分层" class="headerlink" title="网络分层"></a>网络分层</h3><p>网络分层有三种：</p>
<ol>
<li>OSI 7层协议</li>
<li>TCP/IP 4层协议</li>
<li>中和的5层协议</li>
</ol>
<p><img data-src="https://camo.githubusercontent.com/a24a29536633ebdf6e9326554d357c2b8acfae62026222573eb6cefd653bc5a3/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392f372f2545342542412539342545352542312538322545342542442539332545372542332542422545372542422539332545362539452538342e706e67" alt=""></p>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><h4 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h4><p><img data-src="https://img-blog.csdnimg.cn/20190531123343480.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzM3OTky,size_16,color_FFFFFF,t_70" alt=""></p>
<h5 id="为什么要三次握手？"><a href="#为什么要三次握手？" class="headerlink" title="为什么要三次握手？"></a>为什么要三次握手？</h5><p><strong>三次握手最主要的目的就是双方确认自己与对方的发送与接收是正常的。</strong></p>
<p>第一次握手：Client 什么都不能确认；Server 确认了对方发送正常，自己接收正常</p>
<p>第二次握手：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：对方发送正常，自己接收正常</p>
<p>第三次握手：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：自己发送、接收正常，对方发送、接收正常</p>
<p>所以三次握手就能确认双发收发功能都正常，缺一不可。</p>
<h4 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h4><p><img data-src="https://img-blog.csdnimg.cn/20190531123409366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzM3OTky,size_16,color_FFFFFF,t_70" alt=""></p>
<h5 id="为什么要四次挥手？"><a href="#为什么要四次挥手？" class="headerlink" title="为什么要四次挥手？"></a>为什么要四次挥手？</h5><p>四次挥手是为了连接双方能够断开彼此之间的数据通道。少于四次无法实现这个目的。</p>
<p>假如客户端率先发起断开连接的请求：</p>
<ol>
<li><p>第一次挥手：客户端发送断开连接的请求给服务器</p>
<p>为了实现安全性，需要等待服务器的确认报文。</p>
</li>
<li><p>第二次挥手：服务器发送确认报文给客户端</p>
<p>由于 TCP 是全双工模式，双通道相互独立，故服务器还可以继续发送数据报文给客户端，此时客户端往服务器端的数据通道关闭，TCP 连接处于半关闭状态。</p>
</li>
<li><p>第三次挥手：服务器发送断开连接的请求给客户端</p>
<p>为了安全性，需要等待客户端的确认报文。</p>
</li>
<li><p>第四次挥手：客户端发送确认报文给服务器</p>
<p>当服务器接收到该报文后即可关闭连接，但客户端在发送完该报文后并不能确保服务器是否已收到，需要等待 2MSL 时间后再关闭。</p>
</li>
</ol>
<h5 id="2MSL等待状态"><a href="#2MSL等待状态" class="headerlink" title="2MSL等待状态"></a>2MSL等待状态</h5><p>报文段最大生存时间MSL（Maximum Segment Lifetime），在第四次挥手后主动端之所以还需要等待 2MSL 时间，是因为它无法保证报文是否被接收到，但如果假设报文丢失了，那么被动端会在 2MSL 时间内再发送一次断开连接的请求，此时主动端就可以判定确认报文丢失了，然后重新发送一次确认报文，如果 2MSL 时间内没有收到被动端再一次的断开连接请求，就认为被动端已经收到确认报文了，就可以关闭连接了。</p>
<h4 id="TCP-协议如何保证可靠传输"><a href="#TCP-协议如何保证可靠传输" class="headerlink" title="TCP 协议如何保证可靠传输"></a>TCP 协议如何保证可靠传输</h4><ol>
<li>应用数据被分割成 TCP 认为最适合发送的数据块。</li>
<li>TCP 给发送的每一个包进行编号，接收方对数据包进行排序，把有序数据传送给应用层。</li>
<li><strong>校验和：</strong> TCP 将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。如果收到段的检验和有差错，TCP 将丢弃这个报文段和不确认收到此报文段。</li>
<li>TCP 的接收端会丢弃重复的数据。</li>
<li><strong>流量控制：</strong> TCP 连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区能接纳的数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP 使用的流量控制协议是可变大小的滑动窗口协议。 （TCP 利用滑动窗口实现流量控制）</li>
<li><strong>拥塞控制：</strong> 当网络拥塞时，减少数据的发送。</li>
<li><strong>ARQ协议：</strong> 也是为了实现可靠传输的，它的基本原理就是每发完一个分组就停止发送，等待对方确认。在收到确认后再发下一个分组。</li>
<li><strong>超时重传：</strong> 当 TCP 发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段。</li>
</ol>
<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p>UDP 最大只支持 512 字节的数据。</p>
<h4 id="TCP-与-UDP-的区别"><a href="#TCP-与-UDP-的区别" class="headerlink" title="TCP 与 UDP 的区别"></a>TCP 与 UDP 的区别</h4><ol>
<li>TCP 面向连接，UDP 无连接</li>
<li>TCP 根据流量控制和拥塞控制，以及重传控制和数据校验保证提供可靠的数据传输服务。而 UDP 不保证数据的可靠性。</li>
<li>TCP 的报文段头部占20各字节，比 UDP 的报文段头部多12个字节。消耗的资源更多。由于建立连接有握手的机制，TCP 的使用效率会比 UDP 要低一些。</li>
</ol>
<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><h4 id="常见状态码"><a href="#常见状态码" class="headerlink" title="常见状态码"></a>常见状态码</h4><ul>
<li>200 OK：正常返回信息</li>
<li>400 Bad Request：客户端请求有语法错误，不能被服务器所理解</li>
<li>403 Forbidden：服务器收到请求，但是拒绝提供服务</li>
<li>404 Not Found：请求资源不存在，输入了错误的URL</li>
<li>500 Internal Server Error：服务器发生不可预期错误</li>
<li>503 Server Unavailable：服务器当前不能处理客户端的请求，一段时间后可能恢复正常</li>
</ul>
<h4 id="常见请求头"><a href="#常见请求头" class="headerlink" title="常见请求头"></a>常见请求头</h4><ul>
<li><strong>Accept: text/html</strong> 浏览器可以接受服务器回发的类型为 text/html。</li>
<li><strong>Accept: */*</strong>  代表浏览器可以处理所有类型,(一般浏览器发给服务器都是发这个)。</li>
<li><strong>Connection: keep-alive</strong> 当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。</li>
<li><strong>Connection: close</strong> 代表一个Request完成后，客户端和服务器之间用于传输HTTP数据的TCP连接会关闭， 当客户端再次发送Request，需要重新建立TCP连接。</li>
<li><strong>User-Agent:Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36</strong> 告诉HTTP服务器， 客户端使用的操作系统和浏览器的名称和版本。</li>
</ul>
<h4 id="常见响应头"><a href="#常见响应头" class="headerlink" title="常见响应头"></a>常见响应头</h4><ul>
<li><strong>Content-Type：text/html;charset=UTF-8</strong> 告诉客户端，资源文件的类型，还有字符编码，客户端通过utf-8对资源进行解码，然后对资源进行html解析。通常我们会看到有些网站是乱码的，往往就是服务器端没有返回正确的编码。</li>
<li><strong>Connection：keep-alive</strong> 这个字段作为回应客户端的Connection：keep-alive，告诉客户端服务器的tcp连接也是一个长连接，客户端可以继续使用这个tcp连接发送http请求。</li>
<li><strong>Refresh: 5; url=<a href="http://baidu.com" target="_blank" rel="noopener">http://baidu.com</a></strong> 用于重定向，或者当一个新的资源被创建时。默认会在5秒后刷新重定向。</li>
</ul>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>HTTP 协议是无状态的，主要是为了让 HTTP 协议尽可能简单，使得它能够处理大量事务。HTTP/1.1 引入 Cookie 来保存状态信息。</p>
<p>Cookie 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器之后向同一服务器再次发起请求时被携带上，用于告知服务端两个请求是否来自同一浏览器。</p>
<h5 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h5><ul>
<li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li>
<li>个性化设置（如用户自定义设置、主题等）</li>
<li>浏览器行为跟踪（如跟踪分析用户行为等）</li>
</ul>
<h5 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h5><p>服务器发送的响应报文包含 <code>Set-Cookie</code> 首部字段，客户端得到响应报文后把 Cookie 内容保存到浏览器中。</p>
<p>客户端之后对同一个服务器发送请求时，会从浏览器中取出 Cookie 信息并通过 Cookie 请求首部字段发送给服务器。</p>
<h5 id="浏览器禁用-Cookie"><a href="#浏览器禁用-Cookie" class="headerlink" title="浏览器禁用 Cookie"></a>浏览器禁用 Cookie</h5><p>此时无法使用 Cookie 来保存用户信息，只能使用 Session。除此之外，不能再将 Session ID 存放到 Cookie 中，而是使用 URL 重写技术，将 Session ID 作为 URL 的参数进行传递。</p>
<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p>除了可以将用户信息通过 Cookie 存储在用户浏览器中，也可以利用 Session 存储在服务器端，存储在服务器端的信息更加安全。</p>
<h4 id="浏览器中输入url地址-gt-gt-显示主页的过程"><a href="#浏览器中输入url地址-gt-gt-显示主页的过程" class="headerlink" title="浏览器中输入url地址 -&gt;&gt; 显示主页的过程"></a>浏览器中输入url地址 -&gt;&gt; 显示主页的过程</h4><p><img data-src="https://camo.githubusercontent.com/c757ddcd23ab760aabb28c35adeadb49fe872f47f0dfb3ed5e4144ca9aa704cb/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f75726ce8be93e585a5e588b0e5b195e7a4bae587bae69da5e79a84e8bf87e7a88b2e6a7067" alt=""></p>
<h4 id="HTTP-1-0-与-HTTP-1-1、HTTP-2-0"><a href="#HTTP-1-0-与-HTTP-1-1、HTTP-2-0" class="headerlink" title="HTTP 1.0 与 HTTP 1.1、HTTP 2.0"></a>HTTP 1.0 与 HTTP 1.1、HTTP 2.0</h4><p>在 HTTP/1.0 中默认使用短连接。也就是说，客户端和服务器每进行一次HTTP操作，就建立一次连接，任务结束就中断连接。当客户端浏览器访问的某个HTML或其他类型的Web页中包含有其他的Web资源（如JavaScript文件、图像文件、CSS文件等），每遇到这样一个Web资源，浏览器就会重新建立一个HTTP会话。</p>
<p>而从HTTP/1.1起，默认使用长连接，用以保持连接特性。使用长连接的HTTP协议，会在响应头加入这行代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Connection:keep-alive</span><br></pre></td></tr></table></figure>

<p>在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，客户端再次访问这个服务器时，会继续使用这一条已经建立的连接。Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接需要客户端和服务端都支持长连接。</p>
<p><strong>HTTP协议的长连接和短连接，实质上是TCP协议的长连接和短连接。</strong></p>
<p>HTTP 2.0：</p>
<ol>
<li><p>二进制分帧</p>
<p>HTTP1.x基于文本，HTTP2.0采用二进制格式。</p>
</li>
<li><p>首部压缩</p>
</li>
<li><p>多路复用</p>
</li>
<li><p>服务端推送</p>
<p>在 HTTP 2.0 中，服务器可以对客户端的一个请求发送多个响应。</p>
</li>
</ol>
<h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><blockquote>
<p>SSL: <strong>S</strong>ecure <strong>S</strong>ockets <strong>L</strong>ayer</p>
<p>TLS: <strong>T</strong>ransport <strong>L</strong>ayer <strong>S</strong>ecurity</p>
</blockquote>
<p>HTTPS 是基于 HTTP 的扩展，在 HTTPS 中，原有的 HTTP 协议会得到 TLS（安全传输层协议）或其前身 SSL（安全套接层）的加密。</p>
<p>HTTPS = HTTP + TLS/SSL</p>
<p><img data-src="https://segmentfault.com/img/bVbClUl" alt=""></p>
<p>HTTPS 整个通信过程可以分为两大阶段：证书验证和数据传输，数据传输阶段又可以分为非对称加密和对称加密两个阶段。</p>
<p>具体流程如下：</p>
<ol>
<li><p>浏览器客户端发送 HTTPS 请求。</p>
</li>
<li><p>采用 HTTPS 协议的服务器必须向 CA 机构有偿申请合法的 CA(Certification Authority)证书。CA机构颁发证书时会生成一对公钥和私钥，服务器将私钥自己保存，公钥包含在证书中，可以公开，同时证书本身会附带一个电子签名，这个签名是用来验证证书的完整性和真实性，防止证书被篡改。</p>
</li>
<li><p>服务器将证书传送给浏览器客户端</p>
</li>
<li><p>浏览器客户端解析证书对其进行验证。如果证书不是可信机构颁发的、证书中的域名与实际域名不一致、或者证书已过期，就会向用户显示一个警告，询问是否还要继续通信。</p>
<p>如果证书没有问题，就从证书中取出共钥，然后生成一个随机码，用共钥加密后作为之后对称加密的密钥。</p>
</li>
<li><p>浏览器客户端将对称加密的密钥发送给服务器</p>
</li>
<li><p>服务器收到密钥后会使用自己的私钥解密得到对称加密的密钥。</p>
<p>至此，客户端和服务器就建立好了安全连接，解决了对称加密的密钥泄漏问题。</p>
</li>
<li><p>服务器使用密钥对数据进行对称加密并发送给客户端，客户端使用相同的密钥解密数据。</p>
</li>
<li><p>双方使用对称加密进行数据传输。</p>
</li>
</ol>
<h4 id="HTTP-和-HTTPS-的区别"><a href="#HTTP-和-HTTPS-的区别" class="headerlink" title="HTTP 和 HTTPS 的区别"></a>HTTP 和 HTTPS 的区别</h4><p><img data-src="https://segmentfault.com/img/bVbClUj" alt=""></p>
<ol>
<li><p>端口</p>
<p>HTTP 默认使用端口 80，而 HTTPS 默认使用端口443。</p>
</li>
<li><p>资源消耗</p>
<p>Https 由于加解密处理会消耗更多的CPU和内存资源，所以 HTTP 页面响应速度比 HTTPS 快。</p>
</li>
<li><p>安全性</p>
<p>HTTP 安全性没有 HTTPS 高，但是 HTTPS 比HTTP耗费更多服务器资源。</p>
<ul>
<li>对称加密：密钥只有一个，加密解密为同一个密码，且加解密速度快，典型的对称加密算法有DES、AES等；</li>
<li>非对称加密：密钥成对出现（且根据公钥无法推知私钥，根据私钥也无法推知公钥），加密解密使用不同密钥（公钥加密需要私钥解密，私钥加密需要公钥解密），相对对称加密速度较慢，典型的非对称加密算法有RSA、DSA等。</li>
</ul>
</li>
</ol>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h3><h4 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h4><p>默认使用的B+树的索引模型</p>
<h5 id="MyISAM和InnoDB区别"><a href="#MyISAM和InnoDB区别" class="headerlink" title="MyISAM和InnoDB区别"></a>MyISAM和InnoDB区别</h5><p>MyISAM是MySQL 5.5版之前的默认数据库引擎。5.5版本之后，默认的存储引擎为InnoDB。</p>
<p><strong>两者的对比：</strong></p>
<ol>
<li><strong>是否支持行级锁</strong> : MyISAM 只有表级锁(table-level locking)，而InnoDB 支持行级锁(row-level locking)和表级锁,默认为行级锁。</li>
<li><strong>是否支持事务和崩溃后的安全恢复： MyISAM</strong> 强调的是性能，每次查询具有原子性,其执行速度比InnoDB类型更快，但是不提供事务支持。但是<strong>InnoDB</strong> 提供事务支持，外键等高级数据库功能。 具有事务、回滚和崩溃修复能力的事务安全型表。</li>
<li><strong>是否支持外键：</strong> MyISAM不支持，而InnoDB支持。</li>
<li><strong>是否支持MVCC</strong> ：仅 InnoDB 支持。应对高并发事务, MVCC比单纯的加锁更高效;MVCC只在 <code>READ COMMITTED</code> 和 <code>REPEATABLE READ</code> 两个隔离级别下工作;MVCC可以使用乐观锁和悲观锁来实现;各数据库中MVCC实现并不统一。</li>
</ol>
<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><h5 id="结构-2"><a href="#结构-2" class="headerlink" title="结构"></a>结构</h5><p>MySQL索引使用的数据结构主要有<strong>BTree索引</strong>和<strong>哈希索引</strong>。</p>
<h5 id="主键索引"><a href="#主键索引" class="headerlink" title="主键索引"></a>主键索引</h5><h6 id="回表"><a href="#回表" class="headerlink" title="回表"></a>回表</h6><p>从非主键索引树回到主键索引树的查询的过程叫做回表。</p>
<p>也就是说通过非主键索引的查询需要多扫描一棵索引树，因此需要尽量使用主键索引查询。</p>
<h5 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h5><p>覆盖索引（covering index ，或称为索引覆盖）即从非主键索引中就能查到的记录，而不需要查询主键索引中的记录，避免了回表的产生减少了树的搜索次数，显著提升性能。</p>
<p>例如：存在联合索引（col1，col2），之后根据 col1 查询 col2，此时由于索引结点上包含所需的值，所以不需要回表。</p>
<h5 id="主键索引与非主键索引的区别"><a href="#主键索引与非主键索引的区别" class="headerlink" title="主键索引与非主键索引的区别"></a>主键索引与非主键索引的区别</h5><p>非主键索引的叶子节点存放的是<strong>主键的值</strong>，而主键索引的叶子节点存放的是<strong>整行数据</strong>。非主键索引也被称为<strong>二级索引</strong>，而主键索引也被称为<strong>聚簇索引</strong>。</p>
<p>非主键索引列的查询，则先搜索非主键索引树，得到主键ID值，再到主键索引树搜索一次，这个过程也被称为回表。</p>
<h5 id="非主键索引一定会查询多次吗？"><a href="#非主键索引一定会查询多次吗？" class="headerlink" title="非主键索引一定会查询多次吗？"></a>非主键索引一定会查询多次吗？</h5><p>覆盖索引也可以只查询一次，覆盖索引（covering index）指一个查询语句的执行只用从索引中就能够取得，不必从数据表中读取。也可以称之为实现了索引覆盖。</p>
<h5 id="聚集索引和非聚集索引的区别"><a href="#聚集索引和非聚集索引的区别" class="headerlink" title="聚集索引和非聚集索引的区别"></a>聚集索引和非聚集索引的区别</h5><ol>
<li>聚集索引表示表中存储的数据按照索引的顺序存储，检索效率比非聚集索引高，但对数据更新影响较大。（比如主键索引）</li>
<li>非聚集索引表示数据存储在一个地方，索引存储在另一个地方，索引带有指针指向数据的存储位置。非聚集索引检索效率比聚集索引低，但对数据更新影响较小。</li>
</ol>
<h5 id="B-树索引和Hash索引比较"><a href="#B-树索引和Hash索引比较" class="headerlink" title="B+树索引和Hash索引比较"></a>B+树索引和Hash索引比较</h5><blockquote>
<p>InnoDB 为什么使用B+树而不是hash索引</p>
</blockquote>
<ol>
<li>哈希索引适合等值查询，不适合范围查询</li>
<li>哈希索引没办法利用索引完成排序</li>
<li>哈希索引不支持多列联合索引的最左匹配规则</li>
<li>如果有大量重复键值的情况下，因为哈希碰撞问题，会导致哈希索引的效率大大降低。</li>
</ol>
<h5 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a>联合索引</h5><p>联合索引（A，B，C），但是查询的时候是反过来查的（C=xxx and B=xxx and A=xxx），这种能走索引吗？</p>
<p>where里面的条件顺序在查询之前会被mysql自动优化，变为A，B，C，然后使用联合索引。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)    select * from myTest  where a&#x3D;3 and b&#x3D;5 and c&#x3D;4;   ----  abc顺序</span><br><span class="line">abc三个索引都在where条件里面用到了，而且都发挥了作用</span><br><span class="line"></span><br><span class="line">(2)    select * from myTest  where  c&#x3D;4 and b&#x3D;6 and a&#x3D;3;</span><br><span class="line">where里面的条件顺序在查询之前会被mysql自动优化，效果跟上一句一样</span><br><span class="line"></span><br><span class="line">(3)    select * from myTest  where a&#x3D;3 and c&#x3D;7;</span><br><span class="line">a用到索引，b没有用，所以c是没有用到索引效果的</span><br><span class="line"></span><br><span class="line">(4)    select * from myTest  where a&#x3D;3 and b&gt;7 and c&#x3D;3;     ---- b范围值，断点，阻塞了c的索引</span><br><span class="line">a用到了，b也用到了，c没有用到，这个地方b是范围值，也算断点，只不过自身用到了索引</span><br><span class="line"></span><br><span class="line">(5)    select * from myTest  where b&#x3D;3 and c&#x3D;4;   --- 联合索引必须按照顺序使用，并且需要全部使用</span><br><span class="line">因为a索引没有使用，所以这里 bc都没有用上索引效果</span><br><span class="line"></span><br><span class="line">(6)    select * from myTest  where a&gt;4 and b&#x3D;7 and c&#x3D;9;</span><br><span class="line">a用到了  b没有使用，c没有使用</span><br><span class="line"></span><br><span class="line">(7)    select * from myTest  where a&#x3D;3 order by b;</span><br><span class="line">a用到了索引，b在结果排序中也用到了索引的效果，a下面任意一段的b是排好序的</span><br><span class="line"></span><br><span class="line">(8)    select * from myTest  where a&#x3D;3 order by c;</span><br><span class="line">a用到了索引，但是这个地方c没有发挥排序效果，因为中间断点了，使用 explain 可以看到 filesort</span><br><span class="line"></span><br><span class="line">(9)    select * from mytable where b&#x3D;3 order by a;</span><br><span class="line">b没有用到索引，排序中a也没有发挥索引效果</span><br></pre></td></tr></table></figure>



<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p><strong>事务是逻辑上的一组操作，要么都执行，要么都不执行。</strong></p>
<h5 id="事务的四大特性-ACID"><a href="#事务的四大特性-ACID" class="headerlink" title="事务的四大特性(ACID)"></a>事务的四大特性(ACID)</h5><ol>
<li><strong>原子性（Atomicity）：</strong> 事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部完成，要么完全不起作用；</li>
<li><strong>一致性（Consistency）：</strong> 执行事务后，数据库从一个正确的状态变化到另一个正确的状态；</li>
<li><strong>隔离性（Isolation）：</strong> 并发访问数据库时，一个事务不被其他事务所干扰，各并发事务之间数据库是独立的；</li>
<li><strong>持久性（Durability）：</strong> 一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响。</li>
</ol>
<h5 id="并发事务带来哪些问题"><a href="#并发事务带来哪些问题" class="headerlink" title="并发事务带来哪些问题?"></a>并发事务带来哪些问题?</h5><ul>
<li><strong>脏读（Dirty read）:</strong> 当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。</li>
<li><strong>丢失修改（Lost to modify）:</strong> 指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。</li>
<li><strong>不可重复读（Unrepeatableread）:</strong> 指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</li>
<li><strong>幻读（Phantom read）:</strong> 幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。</li>
</ul>
<p><strong>不可重复读和幻读区别：</strong></p>
<p>不可重复读的重点是修改，比如多次读取一条记录发现其中某些列的值被修改，幻读的重点在于新增或者删除，比如多次读取一条记录发现记录增多或减少了。</p>
<h5 id="事务隔离级别有哪些-MySQL的默认隔离级别是"><a href="#事务隔离级别有哪些-MySQL的默认隔离级别是" class="headerlink" title="事务隔离级别有哪些?MySQL的默认隔离级别是?"></a>事务隔离级别有哪些?MySQL的默认隔离级别是?</h5><p><strong>SQL 标准定义了四个隔离级别：</strong></p>
<ul>
<li><strong>READ-UNCOMMITTED(读取未提交)：</strong> 最低的隔离级别，允许读取尚未提交的数据变更，<strong>可能会导致脏读、幻读或不可重复读</strong>。</li>
<li><strong>READ-COMMITTED(读取已提交)：</strong> 允许读取并发事务已经提交的数据，<strong>可以阻止脏读，但是幻读或不可重复读仍有可能发生</strong>。</li>
<li><strong>REPEATABLE-READ(可重复读)：</strong> 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，<strong>可以阻止脏读和不可重复读，但幻读仍有可能发生</strong>。</li>
<li><strong>SERIALIZABLE(可串行化)：</strong> 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，<strong>该级别可以防止脏读、不可重复读以及幻读</strong>。</li>
</ul>
<hr>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻影读</th>
</tr>
</thead>
<tbody><tr>
<td>READ-UNCOMMITTED</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>READ-COMMITTED</td>
<td>×</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>REPEATABLE-READ</td>
<td>×</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
</tbody></table>
<p>MySQL InnoDB 存储引擎的默认支持的隔离级别是 <strong>REPEATABLE-READ（可重读）</strong>。我们可以通过<code>SELECT @@tx_isolation;</code>命令来查看，MySQL 8.0 该命令改为<code>SELECT @@transaction_isolation;</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure>

<p>这里需要注意的是：与 SQL 标准不同的地方在于 InnoDB 存储引擎在 <strong>REPEATABLE-READ（可重读）</strong> 事务隔离级别下使用的是Next-Key Lock 锁（间隙锁）算法，因此可以避免幻读的产生，这与其他数据库系统(如 SQL Server) 是不同的。所以说InnoDB 存储引擎的默认支持的隔离级别是 <strong>REPEATABLE-READ（可重读）</strong> 已经可以完全保证事务的隔离性要求，即达到了 SQL标准的 <strong>SERIALIZABLE(可串行化)</strong> 隔离级别。因为隔离级别越低，事务请求的锁越少，所以大部分数据库系统的隔离级别都是 <strong>READ-COMMITTED(读取提交内容)</strong> ，但是InnoDB 存储引擎默认使用 <strong>REPEAaTABLE-READ（可重读）</strong> 并不会有任何性能损失。</p>
<h5 id="Next-Key-Lock（间隙锁）"><a href="#Next-Key-Lock（间隙锁）" class="headerlink" title="Next-Key Lock（间隙锁）"></a>Next-Key Lock（间隙锁）</h5><p>举例来说，假如emp表中只有101条记录，其empid的值分别是 1,2,…,100,101，下面的SQL：</p>
<p><code>Select * from  emp where empid &gt; 100 for update;</code></p>
<p>是一个范围条件的检索，InnoDB不仅会对符合条件的empid值为101的记录加锁，也会对empid大于101（这些记录并不存在）的“间隙”加锁。</p>
<p>InnoDB使用间隙锁的目的，一方面是为了防止幻读，以满足相关隔离级别的要求，对于上面的例子，要是不使用间隙锁，如果其他事务插入了empid大于100的任何记录，那么本事务如果再次执行上述语句，就会发生幻读；另外一方面，是为了满足其恢复和复制的需要。</p>
<h4 id="锁-1"><a href="#锁-1" class="headerlink" title="锁"></a>锁</h4><p><strong>InnoDB的行锁是针对索引加的锁，不是针对记录加的锁。并且该索引不能失效，否则都会从行锁升级为表锁</strong></p>
<p>InnoDB行锁是通过给索引上的索引项加锁来实现的，这一点MySQL与Oracle不同，后者是通过在数据块中对相应数据行加锁来实现的。InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁！</p>
<p>由于MySQL的行锁是针对索引加的锁，不是针对记录加的锁，所以虽然是访问不同行的记录，但是如果是使用相同的索引键，是会出现锁冲突的。</p>
<p>如果MySQL认为全表扫描效率更高，比如对一些很小的表，它就不会使用索引，这种情况下InnoDB将使用表锁，而不是行锁。</p>
<h5 id="行锁-VS-表锁"><a href="#行锁-VS-表锁" class="headerlink" title="行锁 VS 表锁"></a>行锁 VS 表锁</h5><ul>
<li>表锁： 开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突概率高，并发度低</li>
<li>行锁： 开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高</li>
</ul>
<h5 id="InnoDB的行锁模式及加锁方法"><a href="#InnoDB的行锁模式及加锁方法" class="headerlink" title="InnoDB的行锁模式及加锁方法"></a>InnoDB的行锁模式及加锁方法</h5><p>InnoDB实现了以下两种类型的行锁。</p>
<ul>
<li><p>共享锁（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。</p>
</li>
<li><p>排他锁（X)：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和排他写锁。另外，为了允许行锁和表锁共存，实现多粒度锁机制，InnoDB还有两种内部使用的意向锁（Intention Locks），这两种意向锁都是表锁。</p>
</li>
<li><p>意向共享锁（IS）：事务打算给数据行加行共享锁，事务在给一个数据行加共享锁前必须先取得该表的IS锁。</p>
</li>
<li><p>意向排他锁（IX）：事务打算给数据行加行排他锁，事务在给一个数据行加排他锁前必须先取得该表的IX锁。</p>
</li>
</ul>
<p>InnoDB行锁模式兼容性列表</p>
<table>
<thead>
<tr>
<th>请求锁模式<br />是否兼容当前锁模式</th>
<th>X</th>
<th>IX</th>
<th>S</th>
<th>IS</th>
</tr>
</thead>
<tbody><tr>
<td>X</td>
<td>冲突</td>
<td>冲突</td>
<td>冲突</td>
<td>冲突</td>
</tr>
<tr>
<td>IX</td>
<td>冲突</td>
<td>兼容</td>
<td>冲突</td>
<td>兼容</td>
</tr>
<tr>
<td>S</td>
<td>冲突</td>
<td>冲突</td>
<td>兼容</td>
<td>兼容</td>
</tr>
<tr>
<td>IS</td>
<td>冲突</td>
<td>兼容</td>
<td>兼容</td>
<td>兼容</td>
</tr>
</tbody></table>
<h4 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h4><ol>
<li>left join （左连接）：返回包括左表中的所有记录和右表中连接字段相等的记录。</li>
<li>right join （右连接）：返回包括右表中的所有记录和左表中连接字段相等的记录。</li>
<li>inner join （等值连接或者叫内连接）：只返回两个表中连接字段相等的行。</li>
<li>full join （全外连接）：返回左右表中所有的记录和左右表中连接字段相等的记录。<strong>MySQL不支持</strong></li>
</ol>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><h5 id="查询数据库的运行情况"><a href="#查询数据库的运行情况" class="headerlink" title="查询数据库的运行情况"></a>查询数据库的运行情况</h5><h6 id="显示数据库运行状态"><a href="#显示数据库运行状态" class="headerlink" title="显示数据库运行状态"></a>显示数据库运行状态</h6><p><code>SHOW STATUS</code></p>
<h6 id="显示数据库运行总时间"><a href="#显示数据库运行总时间" class="headerlink" title="显示数据库运行总时间"></a>显示数据库运行总时间</h6><p><code>SHOW STATUS LIKE &#39;uptime&#39;</code></p>
<h6 id="显示连接的次数"><a href="#显示连接的次数" class="headerlink" title="显示连接的次数"></a>显示连接的次数</h6><p><code>SHOW STATUS LIKE &#39;connections&#39;</code></p>
<h6 id="显示执行CRUD的次数"><a href="#显示执行CRUD的次数" class="headerlink" title="显示执行CRUD的次数"></a>显示执行CRUD的次数</h6><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">STATUS</span> <span class="keyword">LIKE</span> <span class="string">'com_select'</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">STATUS</span> <span class="keyword">LIKE</span> <span class="string">'com_insert'</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">STATUS</span> <span class="keyword">LIKE</span> <span class="string">'com_update'</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">STATUS</span> <span class="keyword">LIKE</span> <span class="string">'com_delete'</span></span><br></pre></td></tr></table></figure>

<h5 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h5><h6 id="慢查询配置"><a href="#慢查询配置" class="headerlink" title="慢查询配置"></a>慢查询配置</h6><p>Linux下修改my.cnf，Windows下修改my.ini。修改后需要重启mysql才会生效。</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#开启慢查询</span></span><br><span class="line"><span class="meta">slow-query-log</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">#慢查询的文件路径</span></span><br><span class="line"><span class="attr">slow_query_log_file</span>=<span class="string">"D:/Program Files/MySQL/Log/mysql-slow.log"</span></span><br><span class="line"><span class="comment">#慢查询时间。默认为10秒</span></span><br><span class="line"><span class="attr">long_query_time</span>=<span class="string">10</span></span><br><span class="line"><span class="comment">#记录没有使用索引的查询</span></span><br><span class="line"><span class="meta">log-queries-not-using-indexes</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure>

<h6 id="定位慢查询SQL"><a href="#定位慢查询SQL" class="headerlink" title="定位慢查询SQL"></a>定位慢查询SQL</h6><p>如果慢查询日志中记录内容较多，则可以使用Mysql自带的慢查询日志分析工具mysqldumpslow来对慢查询日志进行分类汇总。该工具位于/mysql/bin目录下。mysqldumpslow会自动将文本完全一致但变量不同的SQL语句视为同一个语句进行统计，变量值用N来代替。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s r -t 10 &#x2F;data&#x2F;dbdata&#x2F;frem-slow.log</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img2018.cnblogs.com/blog/424830/201907/424830-20190707081744320-989448386.png" alt="img"></p>
<h5 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">explain [要分析的sql]</span><br></pre></td></tr></table></figure>

<p>分析结果中有如下几列：</p>
<ol>
<li>id：查询序号</li>
<li>select_type</li>
<li>table</li>
<li>type</li>
<li>possible_keys</li>
<li>key</li>
<li>key_len</li>
<li>ref</li>
<li>rows</li>
<li>Extra</li>
</ol>
<h6 id="id"><a href="#id" class="headerlink" title="id"></a>id</h6><p>表示 select 查询序列号。<strong>id值越大，越优先执行。\</strong>如果id相同，执行顺序由上至下*<strong>*    **<img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200502220732511-625086303.png" alt="img"></strong></p>
<h6 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h6><p>表示查询类型。主要用于区分普通查询、子查询、联合查询等几种查询情况。</p>
<p>取值：</p>
<ol>
<li>simple</li>
<li>primary</li>
<li>subquery</li>
<li>derived</li>
<li>union</li>
<li>union result</li>
</ol>
<p>①simple：表示简单查询，只有一个select操作，即不使用连接和union。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#只有一个select操作，所以都是简单查询</span><br><span class="line"></span><br><span class="line">select id from emp;</span><br><span class="line"></span><br><span class="line">select id from emp join dept on emp.dept_id&#x3D;dept.id;</span><br></pre></td></tr></table></figure>

<p>②primary：表示主查询。子查询语句中的最外层select，或union操作的第一个select。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#子查询形式：第一个select操作为primary</span><br><span class="line">select * from app_school where id &#x3D; (select id from app_school where id&#x3D;100);</span><br><span class="line"></span><br><span class="line">#union形式：第一个select操作为primary</span><br><span class="line">select * from app_school where id&#x3D;100</span><br><span class="line">union</span><br><span class="line">select * from app_school where id&#x3D;101;</span><br></pre></td></tr></table></figure>

<p>③subquery：表示子查询。子查询语句中的内层select。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#第二个select操作为subquery</span><br><span class="line">select * from app_school where id &#x3D; (select id from app_school where id&#x3D;100);</span><br></pre></td></tr></table></figure>

<p>④derived：表示FROM后跟着的select查询，会被标记为derived(导出表/衍生表)。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#第二个select操作为derived</span><br><span class="line">select * from (select id from app_school) t;</span><br></pre></td></tr></table></figure>

<p>⑤union：表示UNION操作后面的select查询。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#第二个select操作为union</span><br><span class="line">select * from app_school where id&#x3D;100</span><br><span class="line">union</span><br><span class="line">select * from app_school where id&#x3D;101;</span><br></pre></td></tr></table></figure>

<p>⑥union result：表示获取UNION最后结果的查询。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#第一个select操作为primary</span><br><span class="line">#第二个select操作为union</span><br><span class="line">#获取最终结果的操作为union result</span><br><span class="line">select * from app_school where id&#x3D;100</span><br><span class="line">union</span><br><span class="line">select * from app_school where id&#x3D;101;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img2018.cnblogs.com/blog/424830/201907/424830-20190712003515128-554921784.png" alt="img"></p>
<h6 id="table"><a href="#table" class="headerlink" title="table"></a>table</h6><p>表示查询用到的表。</p>
<h6 id="type"><a href="#type" class="headerlink" title="type"></a>type</h6><p>表示找到匹配行用到的访问类型。</p>
<p>最为常见的类型有:</p>
<ol>
<li>NULL</li>
<li>system</li>
<li>const</li>
<li>eq_ref</li>
<li>ref</li>
<li>range</li>
<li>index</li>
<li>All</li>
</ol>
<p>按照性能从高到低顺序如下：NULL–&gt;system–&gt;const–&gt;eq-ref–&gt;ref–&gt;range–&gt;index–&gt;All 。一般来说，要让查询至少达到range级别，最好能达到ref级别。</p>
<p><strong>①</strong>NULL：不用访问表或索引，就可直接得出结果。<br><img data-src="https://img2018.cnblogs.com/blog/424830/201907/424830-20190706164443539-700840263.png" alt="img"></p>
<p><strong>②system</strong>：该表是最多仅有一行的系统表(这是const类型的一个特例)。系统表中的数据通常已经加载到了内存中，所以不需要磁盘IO。<br>例子1：查询系统表<br><img data-src="https://img2018.cnblogs.com/blog/424830/201907/424830-20190706164242606-1185621519.png" alt="img"><br>例子2：内层嵌套(const)返回了一个临时表，外层嵌套从临时表中查询，其扫描类型也是system，也不需要磁盘IO。</p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200502231552124-1649320315.png" alt="img"></p>
<p><strong>③const</strong>：最多只有一个匹配行，所以该行中的其它列的值可以当作常量来处理。例如，根据主键primary key或唯一索引unique index进行查询。<strong>简单地说const就是直接按主键或唯一键取值。</strong>例如在②中介绍system时的举例中user表的访问类型就是const，其通过主键来取值。</p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200502231426915-1946155193.png" alt="img"></p>
<p><strong>④eq_ref</strong>：使用唯一索引，对于每个索引键值，表中只有一条记录匹配。简单说，就是多表连接中使用primary key或unique index作为关联条件。</p>
<p><strong>注意const和eq_ref的区别：简单地说是<code>const</code>是直接按主键或唯一键读取，<code>eq_ref</code>用于联表查询的情况，按联表的主键或唯一键联合查询。</strong></p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503001453929-1612327840.png" alt="img">)<img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503003027609-823944660.png" alt="img"></p>
<p><strong>⑤ref</strong>：使用非唯一索引，或唯一索引的前缀扫描，返回匹配某个单独值的所有行(可能匹配多个行)。</p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503000159947-653574490.png" alt="img">)<img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503000923679-747371819.png" alt="img"></p>
<p>ref还经常出现在join操作中</p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503001210640-1962805550.png" alt="img"></p>
<p><strong>⑥</strong>ref_or_null：与ref类似，区别在于条件中包含对NULL的查询。</p>
<p><strong>⑦</strong>index_merge：索引合并优化。</p>
<p><strong>⑧</strong>unique_subquery：in的后面是一个查询主键字段的子查询。</p>
<p><strong>⑨</strong>index_subquery：与unique subquery类似，区别在于in的后面是查询非唯一索引字段的子查询。</p>
<p><strong>⑩range</strong>：只检索指定范围的行，使用一个索引来选择行。常见于&lt;，&lt;=，&gt;，&gt;=，between或者IN操作符。<br>key列显示使用了哪个索引。key_len包含所使用索引的最长关键元素。</p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503003455696-1174761682.png" alt="img"></p>
<p><strong>11.index</strong>：索引全扫描。遍历整个索引来查询匹配的行。</p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503003823129-1724228939.png" alt="img"></p>
<p><strong>12.ALL</strong>：全表扫描，性能最差。</p>
<p><img data-src="https://img2020.cnblogs.com/blog/424830/202005/424830-20200503003936777-1259627189.png" alt="img"></p>
<h6 id="possible-keys和key"><a href="#possible-keys和key" class="headerlink" title="possible_keys和key"></a>possible_keys和key</h6><p>possible_keys表示查询时可能使用到的索引，而key表示实际使用的索引</p>
<h6 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h6><p>表示使用到的索引字段的长度</p>
<h6 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h6><p>表示该表的索引字段关联了哪张表的哪个字段</p>
<h6 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h6><p>表示扫描行的数量</p>
<h6 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h6><p>表示执行情况的说明和描述。包含不适合在其它列中显示但对执行计划非常重要的额外信息。记录几个重要的：</p>
<ul>
<li><p>Using index ：使用覆盖索引的时候就会出现</p>
</li>
<li><p>Using where：在查找使用索引的情况下，需要回表去查询所需的数据。表示Mysql将对storage engine提取的结果进行过滤，过滤条件字段无索引；</p>
</li>
<li><p>Using index condition：查找使用了索引，但是需要回表查询数据。会先条件过滤索引，过滤完索引后找到所有符合索引条件的数据行，随后用 WHERE 子句中的其他条件去过滤这些数据行；</p>
</li>
<li><p>Using index &amp; using where：查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询数据</p>
</li>
<li><p>Using filesort：使用了文件排序。当查询语句包含ORDER BY时，如果无法使用索引来完成排序，则需要进行额外的排序操作。</p>
</li>
<li><p>Using temporary：使用临时表来保存中间结果</p>
</li>
</ul>
<h3 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h3><h4 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a>索引</h4><p>oracle 默认的索引是 <strong>B+树</strong>索引</p>
<h5 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h5><h6 id="B-树索引"><a href="#B-树索引" class="headerlink" title="B+ 树索引"></a>B+ 树索引</h6><p><img data-src="http://hongyitong.github.io/img/B%E6%A0%91%E7%B4%A2%E5%BC%95.jpg" alt=""></p>
<h6 id="位图索引"><a href="#位图索引" class="headerlink" title="位图索引"></a>位图索引</h6><blockquote>
<p><a href="https://blog.csdn.net/qq_24236769/article/details/75801687" target="_blank" rel="noopener">位图索引:原理（BitMap index）——浅显易懂</a></p>
</blockquote>
<p><img data-src="http://hongyitong.github.io/img/%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95.jpg" alt=""></p>
<p>位图索引适合只有几个<strong>固定值</strong>的列，如性别、婚姻状况、行政区等。</p>
<p>位图可以通过 AND/OR 操作，快速得到查询结果。</p>
<p>此外，位图索引适合<strong>静态</strong>数据，而不适合索引频繁更新的列。</p>
<p>因为位图索引列的修改会将所有该值的行进行加锁。</p>
<h4 id="锁-2"><a href="#锁-2" class="headerlink" title="锁"></a>锁</h4><h3 id="优化-1"><a href="#优化-1" class="headerlink" title="优化"></a>优化</h3><h5 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a>最左前缀原则</h5><p>联合索引的任何前缀索引都会使用到索引查询，(col1, col2, col3) 这个联合索引的所有前缀就是(col1), (col1, col2), (col1, col2, col3) 包含这些列的查询都会启用索引查询，除此之外的查询即时包含了联合索引中的多列也不会启用索引查询。即 (col2), (col3), (col2, col3) 都不会启动(col1, col2, col3) 这个联合索引查询。</p>
<h5 id="禁止使用-SELECT-必须使用-SELECT-lt-字段列表-gt-查询"><a href="#禁止使用-SELECT-必须使用-SELECT-lt-字段列表-gt-查询" class="headerlink" title="禁止使用 SELECT * 必须使用 SELECT &lt;字段列表&gt; 查询"></a>禁止使用 SELECT * 必须使用 SELECT &lt;字段列表&gt; 查询</h5><p><strong>原因：</strong></p>
<ul>
<li>消耗更多的 CPU 和 IO 以网络带宽资源</li>
<li>无法使用覆盖索引</li>
<li>可减少表结构变更带来的影响</li>
</ul>
<h5 id="禁止使用不含字段列表的-INSERT-语句"><a href="#禁止使用不含字段列表的-INSERT-语句" class="headerlink" title="禁止使用不含字段列表的 INSERT 语句"></a>禁止使用不含字段列表的 INSERT 语句</h5><h5 id="禁止对索引列使用函数"><a href="#禁止对索引列使用函数" class="headerlink" title="禁止对索引列使用函数"></a>禁止对索引列使用函数</h5><p>对索引列使用函数会导致索引失效。</p>
<h5 id="将不等于改成-or"><a href="#将不等于改成-or" class="headerlink" title="将不等于改成 or"></a>将不等于改成 or</h5><p>将<code>&lt;&gt;a</code> <code>!=a</code> 改成<code>&lt;a or &gt;a</code>，因为不等于用不到索引。</p>
<h5 id="禁止使用左模糊和全模糊条件查询"><a href="#禁止使用左模糊和全模糊条件查询" class="headerlink" title="禁止使用左模糊和全模糊条件查询"></a>禁止使用左模糊和全模糊条件查询</h5><p>左模糊 <code>%key</code> 和全模糊 <code>%key%</code> 无法使用索引，只有右模糊 <code>key%</code> 才能使用到索引。</p>
<h5 id="避免使用子查询，可以把子查询优化为-join-操作"><a href="#避免使用子查询，可以把子查询优化为-join-操作" class="headerlink" title="避免使用子查询，可以把子查询优化为 join 操作"></a>避免使用子查询，可以把子查询优化为 join 操作</h5><p>通常子查询在 in 子句中，且子查询中为简单 SQL(不包含 union、group by、order by、limit 从句) 时,才可以把子查询转化为关联查询进行优化。</p>
<p><strong>子查询性能差的原因：</strong></p>
<p>子查询的结果集无法使用索引，通常子查询的结果集会被存储到临时表中，不论是内存临时表还是磁盘临时表都不存在索引，所以查询性能会受到一定的影响。特别是对于返回结果集比较大的子查询，其对查询性能的影响也就越大。</p>
<p>由于子查询会产生大量的临时表也没有索引，所以会消耗过多的 CPU 和 IO 资源，产生大量的慢查询。</p>
<h5 id="避免使用-JOIN-关联太多的表"><a href="#避免使用-JOIN-关联太多的表" class="headerlink" title="避免使用 JOIN 关联太多的表"></a>避免使用 JOIN 关联太多的表</h5><p>对于 MySQL 来说，是存在关联缓存的，缓存的大小可以由 join_buffer_size 参数进行设置。</p>
<p>在 MySQL 中，对于同一个 SQL 多关联（join）一个表，就会多分配一个关联缓存，如果在一个 SQL 中关联的表越多，所占用的内存也就越大。</p>
<p>如果程序中大量的使用了多表关联的操作，同时 join_buffer_size 设置的也不合理的情况下，就容易造成服务器内存溢出的情况，就会影响到服务器数据库性能的稳定性。</p>
<p>同时对于关联操作来说，会产生临时表操作，影响查询效率，MySQL 最多允许关联 61 个表，建议不超过 5 个。</p>
<h5 id="对应同一列进行-or-判断时，使用-in-代替-or"><a href="#对应同一列进行-or-判断时，使用-in-代替-or" class="headerlink" title="对应同一列进行 or 判断时，使用 in 代替 or"></a>对应同一列进行 or 判断时，使用 in 代替 or</h5><p>in 的值不要超过 500 个，in 操作可以更有效的利用索引，or 大多数情况下很少能利用到索引。</p>
<h5 id="禁止使用-order-by-rand-进行随机排序"><a href="#禁止使用-order-by-rand-进行随机排序" class="headerlink" title="禁止使用 order by rand() 进行随机排序"></a>禁止使用 order by rand() 进行随机排序</h5><p>order by rand() 会把表中所有符合条件的数据装载到内存中，然后在内存中对所有数据根据随机生成的值进行排序，并且可能会对每一行都生成一个随机值，如果满足条件的数据集非常大，就会消耗大量的 CPU 和 IO 及内存资源。</p>
<p>推荐在程序中获取一个随机值，然后从数据库中获取数据的方式。</p>
<h5 id="在明显不会有重复值时使用-UNION-ALL-而不是-UNION"><a href="#在明显不会有重复值时使用-UNION-ALL-而不是-UNION" class="headerlink" title="在明显不会有重复值时使用 UNION ALL 而不是 UNION"></a>在明显不会有重复值时使用 UNION ALL 而不是 UNION</h5><ul>
<li>UNION 会把两个结果集的所有数据放到临时表中后再进行去重操作</li>
<li>UNION ALL 不会再对结果集进行去重操作</li>
</ul>
<h4 id="执行计划-1"><a href="#执行计划-1" class="headerlink" title="执行计划"></a>执行计划</h4><p>Mysql 使用 Explain + select…</p>
<p>比较重要的字段有：</p>
<ul>
<li>select_type : 查询类型，有简单查询、联合查询、子查询等</li>
<li>key : 使用的索引</li>
<li>rows : 扫描的行数</li>
</ul>
<h3 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h3><p><strong>分库分表是为了解决由于库、表数据量过大，而导致数据库性能持续下降的问题。</strong> 常见的分库分表工具有：<code>sharding-jdbc</code>（当当）、<code>TSharding</code>（蘑菇街）、<code>MyCAT</code>（基于 Cobar）、<code>Cobar</code>（阿里巴巴）…。</p>
<p><strong>推荐使用 <code>sharding-jdbc</code></strong> 。 因为，<code>sharding-jdbc</code> 是一款轻量级 <code>Java</code> 框架，以 <code>jar</code> 包形式提供服务，不要我们做额外的运维工作，并且兼容性也很好。</p>
<ul>
<li><strong>客户端代理：</strong> <strong>分片逻辑在应用端，封装在jar包中，通过修改或者封装JDBC层来实现。</strong> 当当网的 <strong>Sharding-JDBC</strong> 、阿里的TDDL是两种比较常用的实现。</li>
<li><strong>中间件代理：</strong> <strong>在应用和数据中间加了一个代理层。分片逻辑统一维护在中间件服务中。</strong> 我们现在谈的 <strong>Mycat</strong> 、360的Atlas、网易的DDB等等都是这种架构的实现。</li>
</ul>
<h4 id="分库分表之后-id-主键如何处理？"><a href="#分库分表之后-id-主键如何处理？" class="headerlink" title="分库分表之后,id 主键如何处理？"></a>分库分表之后,id 主键如何处理？</h4><ul>
<li><strong>数据库自增 id</strong> : 两台数据库分别设置不同步长，生成不重复ID的策略来实现高可用。这种方式生成的 id 有序，但是需要独立部署数据库实例，成本高，还会有性能瓶颈。</li>
<li><strong>利用 redis 生成 id :</strong> 性能比较好，灵活方便，不依赖于数据库。但是，引入了新的组件造成系统更加复杂，可用性降低，编码更加复杂，增加了系统成本。</li>
<li><strong>Twitter的snowflake算法</strong></li>
<li><strong>美团的<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html" target="_blank" rel="noopener">Leaf</a>分布式ID生成系统</strong> ：Leaf 是美团开源的分布式ID生成器，能保证全局唯一性、趋势递增、单调递增、信息安全，里面也提到了几种分布式方案的对比，但也需要依赖关系数据库、Zookeeper等中间件。</li>
</ul>
<h3 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h3><p>面向集合(<code>Collection</code>)和文档(<code>document</code>)的存储，以JSON格式的文档保存数据。</p>
<h4 id="与关系型数据库术语类比"><a href="#与关系型数据库术语类比" class="headerlink" title="与关系型数据库术语类比"></a>与关系型数据库术语类比</h4><table>
<thead>
<tr>
<th align="left">mongodb</th>
<th>关系型数据库</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Database</td>
<td>Database</td>
</tr>
<tr>
<td align="left">Collection</td>
<td>Table</td>
</tr>
<tr>
<td align="left">Document</td>
<td>Record/Row</td>
</tr>
<tr>
<td align="left">Filed</td>
<td>Column</td>
</tr>
<tr>
<td align="left">Embedded Documents</td>
<td>Table join</td>
</tr>
</tbody></table>
<h4 id="MongoDB的优势有哪些"><a href="#MongoDB的优势有哪些" class="headerlink" title="MongoDB的优势有哪些"></a>MongoDB的优势有哪些</h4><ul>
<li>面向文档的存储：以 BSON 格式的文档保存数据。</li>
<li>任何属性都可以建立索引。</li>
<li>复制以及高可扩展性。</li>
<li>自动分片。</li>
<li>丰富的查询功能。</li>
<li>快速的即时更新。</li>
<li>来自 MongoDB 的专业支持。</li>
</ul>
<h4 id="BSON-VS-JSON"><a href="#BSON-VS-JSON" class="headerlink" title="BSON VS JSON"></a>BSON VS JSON</h4><ol>
<li><p>BSON 有更快的遍历速度</p>
<p>json需要扫字符串，而bson可以直接定位</p>
</li>
<li><p>json是像字符串一样存储的，bson是按结构存储的</p>
</li>
</ol>
<h4 id="如何执行事务-加锁"><a href="#如何执行事务-加锁" class="headerlink" title="如何执行事务/加锁?"></a>如何执行事务/加锁?</h4><p><code>mongodb</code>没有使用传统的锁或者复杂的带回滚的事务,因为它设计的宗旨是轻量,快速以及可预计的高性能</p>
<h4 id="在哪些场景使用MongoDB"><a href="#在哪些场景使用MongoDB" class="headerlink" title="在哪些场景使用MongoDB?"></a>在哪些场景使用<code>MongoDB</code>?</h4><p><strong>规则：</strong> 如果业务中存在大量复杂的事务逻辑操作，则不要用<code>MongoDB</code>数据库；在处理非结构化 / 半结构化的大数据使用<code>MongoDB</code>，操作的数据类型为动态时也使用<code>MongoDB</code>，比如：</p>
<ul>
<li>内容管理系统，切面数据、日志记录</li>
<li>移动端<code>Apps</code>：<code>O2O</code>送快递骑手、快递商家的信息（包含位置信息）</li>
<li>数据管理，监控数据</li>
</ul>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><h4 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h4><p>查看端口对应的进程ID</p>
<p><code>lsof -i:80</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iMacDev110:~ libo$ lsof -i:80</span><br><span class="line">COMMAND     PID USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</span><br><span class="line">Google      596 libo   66u  IPv4 0x71a3fffb3c30abf9      0t0  TCP 192.168.0.158:58179-&gt;sfo07s17-in-f3.1e100.net:http (ESTABLISHED)</span><br></pre></td></tr></table></figure>



<h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><p>查看所有Java进程</p>
<p><code>ps -ef | grep java</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iMacDev110:~ libo$ ps -ef | grep java</span><br><span class="line">  504   584   385   0  91120  ??         6:58.10 /Applications/IntelliJ IDEA.app/Contents/jdk/Contents/Home/jre/bin/java</span><br></pre></td></tr></table></figure>



<h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><p><strong>top命令</strong>可以实时动态地查看系统的整体运行情况。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Processes: 438 total, 2 running, 436 sleeping, 2376 threads            11:18:31</span><br><span class="line">Load Avg: 1.90, 1.72, 1.81  CPU usage: 1.44% user, 3.0% sys, 95.55% idle</span><br><span class="line">SharedLibs: 240M resident, 66M data, 109M linkedit.</span><br><span class="line">MemRegions: 173647 total, 5152M resident, 101M private, 1590M shared.</span><br><span class="line">PhysMem: 15G used (2721M wired), 1106M unused.</span><br><span class="line">VM: 2484G vsize, 1372M framework vsize, 665337(0) swapins, 1212872(0) swapouts.</span><br><span class="line">Networks: packets: 15111834/11G <span class="keyword">in</span>, 13503646/5025M out.</span><br><span class="line">Disks: 5491545/66G <span class="built_in">read</span>, 6948210/98G written.</span><br><span class="line"></span><br><span class="line">PID    COMMAND      %CPU TIME     <span class="comment">#TH   #WQ  #PORTS MEM    PURG   CMPRS  PGRP</span></span><br><span class="line">99644  MTLCompilerS 0.0  00:00.05 2     2    24     6572K  0B     6556K  99644</span><br><span class="line">99642  com.apple.We 0.0  00:02.86 4     1    95     4404K  0B     3160K  99642</span><br><span class="line">99641  com.apple.We 0.0  00:01.17 4     1    117    49M    0B     10M    99641</span><br><span class="line">99640  IINA         0.0  01:14.36 11    2    426    107M   0B     55M    99640</span><br><span class="line">99591  PIPAgent     0.0  00:01.52 2     1    68     2664K  0B     1456K  99591</span><br><span class="line">99558  com.apple.pr 0.0  00:01.86 3     1    317    28M    0B     18M    99558</span><br><span class="line">99551  System Prefe 0.0  00:01.84 3     1    288    28M    0B     14M    99551</span><br><span class="line">99520  MTLCompilerS 0.0  00:00.03 2     2    24     4932K  0B     4920K  99520</span><br><span class="line">99519  IMRemoteURLC 0.0  00:00.19 3     1    71     2864K  0B     1804K  99519</span><br></pre></td></tr></table></figure>

<p>查看某个进程的内存占用情况</p>
<p><code>top -p pid</code></p>
<h4 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h4><p><strong>stat命令</strong>用于显示文件的状态信息。stat命令的输出信息比<a href="http://man.linuxde.net/ls" target="_blank" rel="noopener">ls</a>命令的输出信息要更详细。</p>
<h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><p>日志文件中根据关键词搜索，并加上颜色</p>
<p><code>grep &quot;orderId&quot; info.log --color=auto</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[tomcat8@3f037c3314ba sst-mobile]$ grep <span class="string">"orderId"</span> info.20201117.txt </span><br><span class="line">2020-11-17 00:00:00,854 -- com.sst.service.impl.AutoOrderCombinedServiceImpl            [135] -- Auto order combination <span class="keyword">for</span> user Id:[2],whId:[10],orderId:[217292]</span><br></pre></td></tr></table></figure>





<h4 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h4><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><h4 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h4><h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h4><p><strong>netstat命令</strong>用来打印Linux中网络系统的状态信息，可让你得知整个Linux系统的网络情况。</p>
<h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2><h3 id="Spring-1"><a href="#Spring-1" class="headerlink" title="Spring"></a>Spring</h3><h4 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h4><h5 id="Autowaire-和-Resource-有什么区别？"><a href="#Autowaire-和-Resource-有什么区别？" class="headerlink" title="@Autowaire 和 @Resource 有什么区别？"></a>@Autowaire 和 @Resource 有什么区别？</h5><h5 id="Autowaire-放在成员变量上和放在set方法上的区别是什么？"><a href="#Autowaire-放在成员变量上和放在set方法上的区别是什么？" class="headerlink" title="@Autowaire 放在成员变量上和放在set方法上的区别是什么？"></a>@Autowaire 放在成员变量上和放在set方法上的区别是什么？</h5><p>放在 setter 上可以对注入的 Bean 做其他的操作，除此之外并无其他区别。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaoDemo</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDataSource</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="AOP-1"><a href="#AOP-1" class="headerlink" title="AOP"></a>AOP</h4><h5 id="Spring-AOP和AspectJ是什么关系？"><a href="#Spring-AOP和AspectJ是什么关系？" class="headerlink" title="Spring AOP和AspectJ是什么关系？"></a>Spring AOP和AspectJ是什么关系？</h5><p>其实AOP并不是Spring的专属，AOP最开始是一种编程模型，后来大佬们为了探讨AOP的标准化，统一AOP规范，成立了一个AOP联盟。除了Spring外，AOP的框架有很多，比如AspectJ, AspectWerkz, JBoss-AOP。</p>
<p>最开始，Spring AOP和AspectJ是完全独立的，Spring有自己的实现和使用语法。但是Spring的AOP使用起来太麻烦了，深受大家吐槽。于是Spring支持了广受大家好评的AspectJ语法，通过在配置类上添加<code>@EnableAspectJAutoProxy</code>这个注解来开启对AspectJ的语法。</p>
<p>但Spring<strong>仅仅是支持了AspectJ的部分语法（有些语法是不支持的），但底层实现还是自己的一套东西</strong>。而且两个框架的目标不同，AspectJ是一套完整的AOP解决方案，更为健壮，但使用起来比较复杂，还需要使用特殊的语法和编译器。而Spring的目的是想要把AOP和IoC框架结合起来，让Spring管理的Bean能够很方便地使用AOP的功能。</p>
<p>所以Spring AOP和AspectJ没啥关系，只是Spring借鉴了Aspect的声明语法。</p>
<h4 id="循环依赖-三级缓存"><a href="#循环依赖-三级缓存" class="headerlink" title="循环依赖/三级缓存"></a>循环依赖/三级缓存</h4><p>三级缓存：</p>
<ol>
<li>singletonFactories ： 进入实例化阶段的单例对象工厂的cache （三级缓存）</li>
<li>earlySingletonObjects ：完成实例化但是尚未初始化的，提前暴光的单例对象的Cache （二级缓存）</li>
<li>singletonObjects：完成初始化的单例对象的cache（一级缓存）</li>
</ol>
<p>A，B相互依赖的两个类的创建过程：</p>
<ol>
<li>使用<code>context.getBean(A.class)</code>，旨在获取容器内的单例A(若A不存在，就会走A这个Bean的创建流程)，显然初次获取A是不存在的，因此走<strong>A的创建之路~</strong></li>
<li><code>实例化</code>A（注意此处仅仅是实例化），并将它放进<code>缓存</code>（此时A已经实例化完成，已经可以被引用了）</li>
<li><code>初始化</code>A：<code>@Autowired</code>依赖注入B（此时需要去容器内获取B）</li>
<li>为了完成依赖注入B，会通过<code>getBean(B)</code>去容器内找B。但此时B在容器内不存在，就走向<strong>B的创建之路~</strong></li>
<li><code>实例化</code>B，并将其放入缓存。（此时B也能够被引用了）</li>
<li><code>初始化</code>B，<code>@Autowired</code>依赖注入A（此时需要去容器内获取A）</li>
<li><code>此处重要</code>：初始化B时会调用<code>getBean(A)</code>去容器内找到A，上面我们已经说过了此时候因为A已经实例化完成了并且放进了缓存里，所以这个时候去看缓存里是已经存在A的引用了的，所以<code>getBean(A)</code>能够正常返回</li>
<li><strong>B初始化成功</strong>（此时已经注入A成功了，已成功持有A的引用了），return（注意此处return相当于是返回最上面的<code>getBean(B)</code>这句代码，回到了初始化A的流程中~）。</li>
<li>因为B实例已经成功返回了，因此最终<strong>A也初始化成功</strong></li>
<li><strong>到此，B持有的已经是初始化完成的A，A持有的也是初始化完成的B</strong></li>
</ol>
<h5 id="为什么需要三级缓存，二级缓存不行吗？"><a href="#为什么需要三级缓存，二级缓存不行吗？" class="headerlink" title="为什么需要三级缓存，二级缓存不行吗？"></a>为什么需要三级缓存，二级缓存不行吗？</h5><p>如果没有AOP，其实Spring使用二级缓存就可以解决循环依赖的问题。若使用二级缓存，在AOP情形下，注入到其他Bean的，不是最终的代理对象，而是原始目标对象。</p>
<p>因为Spring对Bean有一个生命周期的定义，而代理对象是在Bean初始化完成后，执行后置处理器的时候生成的。所以不能在二级缓存的时候就直接生成代理对象，放进缓存。</p>
<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><h4 id="Spring-Boot的主要优点"><a href="#Spring-Boot的主要优点" class="headerlink" title="Spring Boot的主要优点"></a>Spring Boot的主要优点</h4><ol>
<li>开发基于 Spring 的应用程序很容易。</li>
<li>Spring Boot 项目所需的开发或工程时间明显减少，通常会提高整体生产力。</li>
<li>Spring Boot不需要编写大量样板代码、XML配置和注释。</li>
<li>Spring引导应用程序可以很容易地与Spring生态系统集成，如Spring JDBC、Spring ORM、Spring Data、Spring Security等。</li>
<li>Spring Boot遵循“固执己见的默认配置”，以减少开发工作（默认配置可以修改）。</li>
<li>Spring Boot 应用程序提供嵌入式HTTP服务器，如Tomcat和Jetty，可以轻松地开发和测试web应用程序。（这点很赞！普通运行Java程序的方式就能运行基于Spring Boot web 项目，省事很多）</li>
<li>Spring Boot提供命令行接口(CLI)工具，用于开发和测试Spring Boot应用程序，如Java或Groovy。</li>
<li>Spring Boot提供了多种插件，可以使用内置工具(如Maven和Gradle)开发和测试Spring Boot应用程序。</li>
</ol>
<h4 id="Spring-Boot-最大的优势是什么？"><a href="#Spring-Boot-最大的优势是什么？" class="headerlink" title="Spring Boot 最大的优势是什么？"></a>Spring Boot 最大的优势是什么？</h4><p>Spring Boot 的最大的优势是“约定优于配置“。“约定优于配置“是一种软件设计范式，开发人员按照约定的方式来进行编程，可以减少软件开发人员需做决定的数量，获得简单的好处，而又不失灵活性。</p>
<h4 id="Spring-Boot-中-“约定优于配置“的具体产品体现在哪里？"><a href="#Spring-Boot-中-“约定优于配置“的具体产品体现在哪里？" class="headerlink" title="Spring Boot 中 “约定优于配置“的具体产品体现在哪里？"></a>Spring Boot 中 “约定优于配置“的具体产品体现在哪里？</h4><p>Spring Boot Starter、Spring Boot Jpa 都是“约定优于配置“的一种体现。都是通过“约定优于配置“的设计思路来设计的，</p>
<p>Spring Boot Starter 在启动的过程中会根据约定的信息对资源进行初始化；Spring Boot Jpa 通过约定的方式来自动生成 Sql ，避免大量无效代码编写。</p>
<h4 id="Spring-Boot-Starter-的工作原理是什么？"><a href="#Spring-Boot-Starter-的工作原理是什么？" class="headerlink" title="Spring Boot Starter 的工作原理是什么？"></a>Spring Boot Starter 的工作原理是什么？</h4><ol>
<li>Spring Boot 在启动时会去依赖的 Starter 包中寻找 resources/META-INF/spring.factories 文件</li>
<li>根据 spring.factories 配置加载 AutoConfigure 类</li>
<li>根据 @Conditional 注解的条件，进行自动配置并将 Bean 注入 Spring Context</li>
</ol>
<p>Spring Boot 在启动的时候，按照约定去读取 Spring Boot Starter 的配置信息，再根据配置信息对资源进行初始化，并注入到 Spring 容器中。这样 Spring Boot 启动完毕后，就已经准备好了一切资源，使用过程中直接注入对应 Bean 资源即可。</p>
<h4 id="Starter"><a href="#Starter" class="headerlink" title="Starter"></a>Starter</h4><h5 id="什么是-Spring-Boot-Starters"><a href="#什么是-Spring-Boot-Starters" class="headerlink" title="什么是 Spring Boot Starters?"></a>什么是 Spring Boot Starters?</h5><p>Spring Boot Starters 是一系列依赖关系的集合，因为它的存在，项目的依赖之间的关系对我们来说变的更加简单了。举个例子：在没有Spring Boot Starters之前，我们开发REST服务或Web应用程序时; 我们需要使用像Spring MVC，Tomcat和Jackson这样的库，这些依赖我们需要手动一个一个添加。但是，有了 Spring Boot Starters 我们只需要一个只需添加一个<strong>spring-boot-starter-web</strong>一个依赖就可以了，这个依赖包含的字依赖中包含了我们开发REST 服务需要的所有依赖。</p>
<p>Spring Boot 的 Starter 有两个作用：</p>
<ol>
<li><p>将某个功能/领域所需的依赖集中到一起，可以认为是一个组合依赖。</p>
<p>例如 <code>spring-boot-starter-web</code> 就组合了<code>spring-web</code>、<code>spring-webmvc</code>、<code>spring-boot-starter-tomcat</code> 等依赖。</p>
</li>
<li><p>提供自动配置类给 Spring 完成自动配置</p>
</li>
</ol>
<h5 id="自定义-Starter"><a href="#自定义-Starter" class="headerlink" title="自定义 Starter"></a>自定义 Starter</h5><blockquote>
<p><a href="https://objcoding.com/2018/02/02/Costom-SpringBoot-Starter/" target="_blank" rel="noopener">实战|如何自定义SpringBoot Starter？</a></p>
</blockquote>
<ol>
<li><p>引入 SpringBoot 自动化配置依赖：</p>
<p><code>spring-boot-autoconfigure</code></p>
</li>
<li><p>创建一个 HelloworldService，并定义 sayHello() 方法打印。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloworldService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String words;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello, "</span> + words;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建属性类，指定配置前缀，读取项目配置文件中的属性。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"helloworld"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloworldProperties</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_WORDS = <span class="string">"world"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String words = DEFAULT_WORDS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建自动化配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 相当于一个普通的 java 配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 当 HelloworldService 在类路径的条件下</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123;HelloworldService<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">// 将 <span class="title">application</span>.<span class="title">properties</span> 的相关的属性字段与该类一一对应，并生成 <span class="title">Bean</span></span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">HelloworldProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">HelloworldAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注入属性类</span></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> HelloworldProperties hellowordProperties;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="comment">// 当容器没有这个 Bean 的时候才创建这个 Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span>(HelloworldService<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">HelloworldService</span> <span class="title">helloworldService</span>() </span>&#123;</span><br><span class="line">    HelloworldService helloworldService = <span class="keyword">new</span> HelloworldService();</span><br><span class="line">    helloworldService.setWords(hellowordProperties.getWords());</span><br><span class="line">    <span class="keyword">return</span> helloworldService;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 META-INF 目录下创建 spring.factories，指定自动配置类。</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Auto Configure</span></span><br><span class="line"><span class="meta">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">com.objcoding.starters.helloworld.HelloworldAutoConfiguration</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<p>引用自定义的 Starter</p>
<p>在主配置文件中配置响应的配置属性。</p>
<p>在需要的地方通过 <code>@Autowired</code> 注入 HelloworldService，然后调用它的 <code>sayHello()</code> 方法。</p>
</li>
</ol>
<h4 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h4><p>Spring Boot 项目启动时会扫描所有所有依赖 jar 包下的 <code>spring.factories</code> 文件，将其中的自动配置类注册到 Spring IoC 容器中。</p>
<p>Spring Boot 项目的启动注解@SpringBootApplication 由下面三个注解组成：</p>
<ul>
<li>@Configuration</li>
<li>@ComponentScan</li>
<li>@EnableAutoConfiguration</li>
</ul>
<p>其中 <code>@EnableAutoConfiguration</code> 是实现自动配置的入口，该注解又通过 <code>@Import</code> 注解导入了<code>AutoConfigurationImportSelector</code>，在该类中 <code>getCandidateConfigurations</code> 方法会通过 <code>SpringFactoriesLoader.loadFactoryNames()</code> 加载所有 <code>spring.factories</code> 文件中指定的自动配置类。</p>
<p>这些自动配置类中会使用 <code>@EnableConfigurationProperties</code> 注解指定相应的配置属性类，配置属性类中通过 <code>@ConfigurationProperties(prefix = &quot;xxx&quot;)</code> 读取主配置文件中相应前缀的配置选项。通过 Conditional 相关注解指定加载相关的服务类(例如 RedisTemplate，RestTemplate)，并将配置类中的配置设置到服务类中，最终通过 <code>@Bean</code> 实例化服务类并注入到容器中。</p>
<h4 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h4><h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p>过滤器的配置比较简单，直接实现<code>Filter</code> 接口即可，也可以通过<code>@WebFilter</code>注解实现对特定<code>URL</code>拦截，看到<code>Filter</code> 接口中定义了三个方法。</p>
<ul>
<li><code>init()</code> ：该方法在容器启动初始化过滤器时被调用，它在 <code>Filter</code> 的整个生命周期只会被调用一次。<strong>注意</strong>：这个方法必须执行成功，否则过滤器会不起作用。</li>
<li><code>doFilter()</code> ：容器中的每一次请求都会调用该方法， <code>FilterChain</code> 用来调用下一个过滤器 <code>Filter</code>。</li>
<li><code>destroy()</code>： 当容器销毁 过滤器实例时调用该方法，一般在方法中销毁或关闭资源，在过滤器 <code>Filter</code> 的整个生命周期也只会被调用一次</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="title">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Filter 前置"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Filter 处理中"</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> destroy() &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Filter 后置"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h5><p>过滤器用<code>@Order</code>注解控制执行顺序，通过<code>@Order</code>控制过滤器的级别，值越小级别越高越先执行。</p>
<h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><p>拦截器它是链式调用，一个应用中可以同时存在多个拦截器<code>Interceptor</code>， 一个请求也可以触发多个拦截器 ，而每个拦截器的调用会依据它的声明顺序依次执行。</p>
<p>首先编写一个简单的拦截器处理类，请求的拦截是通过<code>HandlerInterceptor</code> 来实现，看到<code>HandlerInterceptor</code> 接口中也定义了三个方法。</p>
<ul>
<li><code>preHandle()</code> ：这个方法将在请求处理之前进行调用。<strong>注意</strong>：如果该方法的返回值为<code>false</code> ，将视为当前请求结束，不仅自身的拦截器会失效，还会导致其他的拦截器也不再执行。</li>
<li><code>postHandle()</code>：只有在 <code>preHandle()</code> 方法返回值为<code>true</code> 时才会执行。会在Controller 中的方法调用之后，DispatcherServlet 返回渲染视图之前被调用。 <strong>有意思的是</strong>：<code>postHandle()</code> 方法被调用的顺序跟 <code>preHandle()</code> 是相反的，先声明的拦截器  <code>preHandle()</code> 方法先执行，而<code>postHandle()</code>方法反而会后执行。</li>
<li><code>afterCompletion()</code>：只有在 <code>preHandle()</code> 方法返回值为<code>true</code> 时才会执行。在整个请求结束之后，  DispatcherServlet 渲染了对应的视图之后执行。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="title">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, <span class="built_in">Object</span> handler) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Interceptor 前置"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> postHandle(HttpServletRequest request, HttpServletResponse response, <span class="built_in">Object</span> handler, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Interceptor 处理中"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> afterCompletion(HttpServletRequest request, HttpServletResponse response, <span class="built_in">Object</span> handler, Exception ex) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Interceptor 后置"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将自定义好的拦截器处理类进行注册，并通过<code>addPathPatterns</code>、<code>excludePathPatterns</code>等属性设置需要拦截或需要排除的 <code>URL</code>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="title">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> MyInterceptor()).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> MyInterceptor1()).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="执行顺序-1"><a href="#执行顺序-1" class="headerlink" title="执行顺序"></a>执行顺序</h5><p>拦截器默认的执行顺序，就是它的注册顺序，可以通过<code>order</code>属性手动设置控制，值越小越先执行。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">  registry.addInterceptor(<span class="keyword">new</span> MyInterceptor2()).addPathPatterns(<span class="string">"/**"</span>).order(<span class="number">2</span>);</span><br><span class="line">  registry.addInterceptor(<span class="keyword">new</span> MyInterceptor1()).addPathPatterns(<span class="string">"/**"</span>).order(<span class="number">1</span>);</span><br><span class="line">  registry.addInterceptor(<span class="keyword">new</span> MyInterceptor()).addPathPatterns(<span class="string">"/**"</span>).order(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="过滤器与拦截器的区别"><a href="#过滤器与拦截器的区别" class="headerlink" title="过滤器与拦截器的区别"></a>过滤器与拦截器的区别</h5><ul>
<li>Filter是基于函数回调的，而Interceptor则是基于Java反射的。</li>
<li>Filter依赖于Servlet容器，因此只能在web环境使用，而Interceptor不依赖于Servlet容器。不仅能应用在<code>web</code>程序中，也可以用于<code>Application</code>、<code>Swing</code>等程序中。</li>
<li>Filter对几乎所有的请求起作用，而Interceptor只能对action请求起作用。</li>
<li>Interceptor可以访问Action的上下文，值栈里的对象，而Filter不能。</li>
<li>在action的生命周期里，Interceptor可以被多次调用，而Filter只能在容器初始化时调用一次。</li>
</ul>
<h5 id="过滤器与拦截器的顺序"><a href="#过滤器与拦截器的顺序" class="headerlink" title="过滤器与拦截器的顺序"></a>过滤器与拦截器的顺序</h5><p>过滤前-拦截前-action执行-拦截后-过滤后</p>
<p>过滤器<code>Filter</code>是在请求进入容器后，但在进入<code>servlet</code>之前进行预处理，请求结束是在<code>servlet</code>处理完以后。</p>
<p>拦截器 <code>Interceptor</code> 是在请求进入<code>servlet</code>后，在进入<code>Controller</code>之前进行预处理的，<code>Controller</code> 中渲染了对应的视图之后请求结束。</p>
<h3 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h3><h4 id="和-的区别是什么？"><a href="#和-的区别是什么？" class="headerlink" title="#{}和${}的区别是什么？"></a>#{}和${}的区别是什么？</h4><p><code>#{value}</code> 会将value添加上双引号，而 <code>${}</code> 则是原封不动的插入 sql，会导致 sql 注入问题。</p>
<h4 id="Xml-映射文件中，除了常见的-select-insert-updae-delete-标签之外，还有哪些标签？"><a href="#Xml-映射文件中，除了常见的-select-insert-updae-delete-标签之外，还有哪些标签？" class="headerlink" title="Xml 映射文件中，除了常见的 select|insert|updae|delete 标签之外，还有哪些标签？"></a>Xml 映射文件中，除了常见的 select|insert|updae|delete 标签之外，还有哪些标签？</h4><p><code>&lt;resultMap&gt;</code>、<code>&lt;parameterMap&gt;</code>、<code>&lt;sql&gt;</code>、<code>&lt;include&gt;</code>、<code>&lt;selectKey&gt;</code>，加上动态 sql 的 9 个标签，<code>trim|where|set|foreach|if|choose|when|otherwise|bind</code>等，其中为 sql 片段标签，通过<code>&lt;include&gt;</code>标签引入 sql 片段，<code>&lt;selectKey&gt;</code>为不支持自增的主键生成策略标签。</p>
<h4 id="MyBatis-是否支持延迟加载？如果支持，它的实现原理是什么？"><a href="#MyBatis-是否支持延迟加载？如果支持，它的实现原理是什么？" class="headerlink" title="MyBatis 是否支持延迟加载？如果支持，它的实现原理是什么？"></a>MyBatis 是否支持延迟加载？如果支持，它的实现原理是什么？</h4><p>MyBatis 仅支持 association 关联对象和 collection 关联集合对象的延迟加载，association 指的就是一对一，collection 指的就是一对多查询。在 MyBatis 配置文件中，可以配置是否启用延迟加载 <code>lazyLoadingEnabled=true|false。</code></p>
<p>它的原理是，使用<code>CGLIB</code> 创建目标对象的代理对象，当调用目标方法时，进入拦截器方法，比如调用 <code>a.getB().getName()</code>，拦截器 <code>invoke()</code>方法发现 <code>a.getB()</code>是 null 值，那么就会单独发送事先保存好的查询关联 B 对象的 sql，把 B 查询上来，然后调用 a.setB(b)，于是 a 的对象 b 属性就有值了，接着完成 <code>a.getB().getName()</code>方法的调用。这就是延迟加载的基本原理。</p>
<h4 id="为什么说-MyBatis-是半自动-ORM-映射工具？它与全自动的区别在哪里？"><a href="#为什么说-MyBatis-是半自动-ORM-映射工具？它与全自动的区别在哪里？" class="headerlink" title="为什么说 MyBatis 是半自动 ORM 映射工具？它与全自动的区别在哪里？"></a>为什么说 MyBatis 是半自动 ORM 映射工具？它与全自动的区别在哪里？</h4><p>Hibernate 属于全自动 ORM 映射工具，使用 Hibernate 查询关联对象或者关联集合对象时，可以根据对象关系模型直接获取，所以它是全自动的。而 MyBatis 在查询关联对象或关联集合对象时，需要手动编写 sql 来完成，所以，称之为半自动 ORM 映射工具。</p>
<h3 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h3><h4 id="什么是-Spring-Cloud"><a href="#什么是-Spring-Cloud" class="headerlink" title="什么是 Spring Cloud"></a>什么是 Spring Cloud</h4><blockquote>
<p>Spring Cloud provides tools for developers to quickly build some of the common patterns in distributed systems.</p>
<p>Spring Cloud 为开发人员提供了在分布式系统中快速构建一些常见模式的工具。</p>
</blockquote>
<p>Spring Cloud 就是微服务系统架构的一站式解决方案，在构建微服务的过程中需要做注册中心 、配置中心 、服务网关 、数据监控等等，而 Spring Cloud 为我们提供了一套简易的编程模型，使我们能在 Spring Boot 的基础上轻松地实现微服务项目的构建。</p>
<h4 id="重要组件"><a href="#重要组件" class="headerlink" title="重要组件"></a>重要组件</h4><ul>
<li><code>Eureka</code> 服务发现框架</li>
<li><code>Ribbon</code> 进程内负载均衡器</li>
<li><code>Open Feign</code> 服务调用映射</li>
<li><code>Hystrix</code> 服务降级熔断器</li>
<li><code>Zuul</code> 微服务网关</li>
<li><code>Config</code> 微服务统一配置中心</li>
<li><code>Bus</code> 消息总线</li>
</ul>
<h4 id="服务注册管理中心-Eureka"><a href="#服务注册管理中心-Eureka" class="headerlink" title="服务注册管理中心 Eureka"></a>服务注册管理中心 Eureka</h4><p>Eureka 就是一个服务发现框架。主要提供服务注册和服务发现两大功能。</p>
<p>其实就是服务提供者和服务消费者之间的“桥梁/中介”，服务提供者可以把自己注册到服务中介那里，而服务消费者如需要消费一些服务就可以在服务中介中寻找注册在服务中介的服务提供者。</p>
<h5 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h5><p>当 <code>Eureka</code> 客户端向 <code>Eureka Server</code> 注册时，它提供自身的<strong>元数据</strong>，比如IP地址、端口，运行状况指示符URL，主页等。</p>
<h5 id="心跳连接"><a href="#心跳连接" class="headerlink" title="心跳连接"></a>心跳连接</h5><p>Eureka 客户端默认情况下会每隔30秒发送一次心跳连接。用来告知 Eureka Server 该 Eureka 客户仍然存活，没有出现问题。 </p>
<p>正常情况下，如果 Eureka Server 在90秒没有收到 Eureka 客户的续约，它会将实例从其注册表中删除。</p>
<h5 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h5><p>Eureka 客户端从服务器获取注册表信息，并将其缓存在本地。客户端会使用该信息查找其他服务，从而进行远程调用。该注册列表信息定期（每30秒钟）更新一次。</p>
<h5 id="服务下线"><a href="#服务下线" class="headerlink" title="服务下线"></a>服务下线</h5><p>Eureka 客户端在程序关闭时向Eureka服务器发送取消请求。发送请求后，该客户端实例信息将从服务器的实例注册表中删除。</p>
<p>该下线请求不会自动完成，它需要调用以下内容：<code>DiscoveryManager.getInstance().shutdownComponent();</code></p>
<h5 id="自我保护机制"><a href="#自我保护机制" class="headerlink" title="自我保护机制"></a>自我保护机制</h5><p>如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时：</p>
<ol>
<li>Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务</li>
<li>Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用)</li>
<li>当网络稳定时，当前实例新的注册信息会被同步到其它节点中</li>
</ol>
<h5 id="与-zookeeper-的区别"><a href="#与-zookeeper-的区别" class="headerlink" title="与 zookeeper 的区别"></a>与 zookeeper 的区别</h5><p>CAP 理论指出，一个分布式系统不可能同时满足C(一致性)、A(可用性)和P(分区容错性)。由于分区容错性在是分布式系统中必须要保证的，因此我们只能在A和C之间进行权衡。在此Zookeeper保证的是CP, 而Eureka则是AP。</p>
<blockquote>
<p> CAP:</p>
<ul>
<li>Consistency（一致性）</li>
<li>Availability（可用性）</li>
<li>Partition tolerance（分区容错性）</li>
</ul>
<p>BASE：</p>
<ul>
<li>Basically Available（基本可用）</li>
<li>Soft state（软状态）</li>
<li>Eventually consistent（最终一致性）</li>
</ul>
</blockquote>
<h6 id="Zookeeper保证CP"><a href="#Zookeeper保证CP" class="headerlink" title="Zookeeper保证CP"></a>Zookeeper保证CP</h6><p>zk 会出现这样的情况，当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。</p>
<p>选举leader的时间太长，30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。</p>
<h6 id="Eureka保证AP"><a href="#Eureka保证AP" class="headerlink" title="Eureka保证AP"></a>Eureka保证AP</h6><p>Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。</p>
<p>而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。</p>
<p>除此之外，Eureka还有一种自我保护机制。</p>
<p>因此， Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。</p>
<h4 id="负载均衡器-Ribbon"><a href="#负载均衡器-Ribbon" class="headerlink" title="负载均衡器 Ribbon"></a>负载均衡器 Ribbon</h4><blockquote>
<p><strong><code>RestTemplate</code>是<code>Spring</code>提供的一个访问Http服务的客户端类</strong>，微服务之间的调用是使用的 <code>RestTemplate</code> 。</p>
</blockquote>
<p><code>Ribbon</code> 是一个客户端内的负载均衡器，<strong>运行在消费者端</strong>。</p>
<h6 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h6><ul>
<li><strong><code>RoundRobinRule</code></strong>：轮询策略。<code>Ribbon</code> 默认采用的策略。若经过一轮轮询没有找到可用的 <code>provider</code>，其最多轮询 10 轮。若最终还没有找到，则返回 <code>null</code>。</li>
<li><strong><code>RandomRule</code></strong>: 随机策略，从所有可用的 <code>provider</code> 中随机选择一个。</li>
<li><strong><code>RetryRule</code></strong>: 重试策略。先按照 <code>RoundRobinRule</code> 策略获取 <code>provider</code>，若获取失败，则在指定的时限内重试。默认的时限为 500 毫秒。</li>
</ul>
<h6 id="Nginx-和-Ribbon-的对比"><a href="#Nginx-和-Ribbon-的对比" class="headerlink" title="Nginx 和 Ribbon 的对比"></a>Nginx 和 Ribbon 的对比</h6><p>提到 <strong>负载均衡</strong> 就不得不提到大名鼎鼎的 <code>Nignx</code> 了，而和 <code>Ribbon</code> 不同的是，Nginx 是一种<strong>集中式</strong>的负载均衡器。</p>
<p>何为集中式呢？简单理解就是 <strong>将所有请求都集中起来，然后再进行负载均衡</strong>。</p>
<p>在 <code>Nginx</code> 中请求是先进入负载均衡器，而在 <code>Ribbon</code> 中是先在客户端进行负载均衡才进行请求的。</p>
<h4 id="服务调用-OpenFeign"><a href="#服务调用-OpenFeign" class="headerlink" title="服务调用 OpenFeign"></a>服务调用 OpenFeign</h4><blockquote>
<p><code>OpenFeign</code> 运行在消费者端，使用 <code>Ribbon</code> 进行负载均衡，所以 <code>OpenFeign</code> 直接内置了 <code>Ribbon</code>。</p>
</blockquote>
<p>Spring Cloud OpenFeign 是基于Ribbon和Hystrix的<strong>声明式</strong>服务调用组件，可以动态创建基于Spring MVC注解的接口实现用于服务调用，在Spring Cloud 2.0中已经取代Feign成为了一等公民。</p>
<h4 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h4><p><code>Hystrix</code> 就是一个能进行 <strong>熔断</strong> 和 <strong>降级</strong> 的库，通过使用它能提高整个系统的弹性。</p>
<h5 id="服务熔断"><a href="#服务熔断" class="headerlink" title="服务熔断"></a>服务熔断</h5><p><strong>熔断</strong> 是指的 <code>Hystrix</code> 中的 <strong>断路器模式</strong> ，你可以使用简单的 <code>@HystrixCommand</code> 注解来标注某个服务调用接口，这样 <code>Hystrix</code> 就会使用 <strong>断路器</strong> 来“包装”这个方法，每当调用时间超过指定时间时(默认为1000ms)，断路器将会中断对这个方法的调用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand</span>(</span><br><span class="line">  commandProperties = &#123;<span class="meta">@HystrixProperty</span>(name = <span class="string">"execution.isolation.thread.timeoutInMilliseconds"</span>,value = <span class="string">"1200"</span>)&#125;</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Xxx&gt; <span class="title">getXxxx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...省略代码逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a>服务降级</h5><p><strong>降级是为了更好的用户体验，当一个服务调用异常时，通过执行另一种代码逻辑来给用户友好的回复</strong>。这也就对应着 <code>Hystrix</code> 的 <strong>后备处理</strong> 模式。你可以通过设置 <code>fallbackMethod</code> 来给一个方法设置备用的代码逻辑。</p>
<p>比如有一个热点新闻，大量用户同时访问可能会导致系统崩溃，那么我们就进行 <strong>服务降级</strong> ，一些请求会做一些降级处理比如当前人数太多请稍后查看等等。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 指定了后备方法调用</span></span><br><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"getHystrixNews"</span>)</span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/get/news"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> News <span class="title">getNews</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id) </span>&#123;</span><br><span class="line">  <span class="comment">// 调用新闻系统的获取新闻api 代码逻辑省略</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> News <span class="title">getHystrixNews</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id) </span>&#123;</span><br><span class="line">  <span class="comment">// 做服务降级</span></span><br><span class="line">  <span class="comment">// 返回当前人数太多，请稍后查看</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="服务网关-Zuul"><a href="#服务网关-Zuul" class="headerlink" title="服务网关 Zuul"></a>服务网关 Zuul</h4><p>网关是系统唯一对外的入口，介于客户端与服务器端之间，用于对请求进行<strong>鉴权</strong>、<strong>限流</strong>、 <strong>路由</strong>、<strong>监控</strong>等功能。</p>
<p><code>Zuul</code> 中最关键的就是 <strong>路由和过滤器</strong></p>
<p><code>Zuul</code> 需要向 <code>Eureka</code> 进行注册，然后在启动类上加入 <code>@EnableZuulProxy</code> 注解。</p>
<h5 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h5><h6 id="统一前缀"><a href="#统一前缀" class="headerlink" title="统一前缀"></a>统一前缀</h6><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">/zuul</span></span><br></pre></td></tr></table></figure>

<h6 id="服务别名"><a href="#服务别名" class="headerlink" title="服务别名"></a>服务别名</h6><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="attr">consumer1:</span> <span class="string">/FrancisQ1/**</span></span><br><span class="line">    <span class="attr">consumer2:</span> <span class="string">/FrancisQ2/**</span></span><br></pre></td></tr></table></figure>

<h6 id="服务名屏蔽"><a href="#服务名屏蔽" class="headerlink" title="服务名屏蔽"></a>服务名屏蔽</h6><p>在配置完路由策略之后使用微服务名称还是可以访问的，这个时候需要将服务名屏蔽。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">ignore-services:</span> <span class="string">"*"</span></span><br></pre></td></tr></table></figure>

<h6 id="路径屏蔽"><a href="#路径屏蔽" class="headerlink" title="路径屏蔽"></a>路径屏蔽</h6><p><code>Zuul</code> 还可以指定屏蔽掉的路径 URI，即只要用户请求中包含指定的 URI 路径，那么该请求将无法访问到指定的服务。通过该方式可以限制用户的权限。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">ignore-patterns:</span> <span class="string">**/auto/**</span></span><br></pre></td></tr></table></figure>

<h6 id="敏感请求头屏蔽"><a href="#敏感请求头屏蔽" class="headerlink" title="敏感请求头屏蔽"></a>敏感请求头屏蔽</h6><p>默认情况下，像 <code>Cookie</code>、<code>Set-Cookie</code> 等敏感请求头信息会被 <code>zuul</code> 屏蔽掉，我们可以将这些默认屏蔽去掉，当然，也可以添加要屏蔽的请求头。</p>
<h5 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h5><p>如果说路由功能是 <code>Zuul</code> 的基操的话，那么<strong>过滤器</strong>就是 <code>Zuul</code>的利器了。可以进行各种过滤，这样我们就能实现 <strong>限流</strong>，<strong>灰度发布</strong>，<strong>权限控制</strong> 等等。</p>
<p>要实现自己的 <code>Filter</code> 只需要继承 <code>ZuulFilter</code> 然后将这个过滤器类以 <code>@Component</code> 注解加入 Spring 容器中就行了。</p>
<h6 id="令牌桶限流"><a href="#令牌桶限流" class="headerlink" title="令牌桶限流"></a>令牌桶限流</h6><p>首先会有个令牌桶，如果里面没有满那么就会以一定 <strong>固定的速率</strong> 会往里面放令牌，一个请求过来首先要从桶中获取令牌，如果没有获取到，那么就拒绝，如果获取到那么就放行。</p>
<h4 id="配置中心-Config"><a href="#配置中心-Config" class="headerlink" title="配置中心 Config"></a>配置中心 Config</h4><h5 id="什么是-Spring-Cloud-Config"><a href="#什么是-Spring-Cloud-Config" class="headerlink" title="什么是 Spring Cloud Config"></a>什么是 Spring Cloud Config</h5><blockquote>
<p><code>Spring Cloud Config</code> 为分布式系统中的外部化配置提供服务器和客户端支持。使用 <code>Config</code> 服务器，可以在中心位置管理所有环境中应用程序的外部属性。</p>
</blockquote>
<p><code>Spring Cloud Config</code> 就是能将各个 服务/应用/系统/模块 的配置文件存放到 <strong>统一的地方(e.g. Git)然后进行管理</strong>。</p>
<p>应用只有启动的时候才会进行配置文件的加载，那么我们的 <code>Spring Cloud Config</code> 就暴露出一个接口给启动应用来获取它所想要的配置文件，应用获取到配置文件然后再进行它的初始化工作。</p>
<p>如果应用运行时去更改远程配置仓库(Git)中的对应配置文件，那么依赖于这个配置文件的已启动的应用会不会进行其相应配置的更改呢？答案是不会的。</p>
<p>可以使用 <code>Webhooks</code> ，这是 <code>github</code> 提供的功能，它能确保远程库的配置文件更新后客户端中的配置信息也得到更新。</p>
<p>但是生产环境不会使用。一般会使用 <code>Bus</code> 消息总线 + <code>Spring Cloud Config</code> 进行配置的动态刷新。</p>
<h4 id="消息总线-Bus"><a href="#消息总线-Bus" class="headerlink" title="消息总线 Bus"></a>消息总线 Bus</h4><blockquote>
<p>用于将服务和服务实例与分布式消息系统链接在一起的事件总线。</p>
</blockquote>
<p><code>Spring Cloud Bus</code> 的作用就是<strong>管理和广播分布式系统中的消息</strong>，也就是消息引擎系统中的广播模式。</p>
<h3 id="Spring-Cloud-与-Spring-Cloud-Alibaba-的区别"><a href="#Spring-Cloud-与-Spring-Cloud-Alibaba-的区别" class="headerlink" title="Spring Cloud 与 Spring Cloud Alibaba 的区别"></a>Spring Cloud 与 Spring Cloud Alibaba 的区别</h3><p>我们平常说的 Spring Cloud 其实是指 Spring Cloud 其中的一种实现方式，即 Spring Cloud Netflix，而 Spring Cloud Alibaba 则是另一套实现方式。</p>
<p><img data-src="https://segmentfault.com/img/remote/1460000021497456" alt=""></p>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><h4 id="负载均衡的6种策略"><a href="#负载均衡的6种策略" class="headerlink" title="负载均衡的6种策略"></a>负载均衡的6种策略</h4><ol>
<li><p>轮询（默认）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream backserver &#123;</span><br><span class="line">	server 192.168.0.14;</span><br><span class="line">	server 192.168.0.15;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定权重<br> 指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream backserver &#123;</span><br><span class="line">	server 192.168.0.14 weight&#x3D;8;</span><br><span class="line">	server 192.168.0.15 weight&#x3D;10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>权重越高，访问概率越大。</p>
</li>
<li><p>ip_hash</p>
<p>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session共享问题。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream backserver &#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">	server 192.168.0.14:88;</span><br><span class="line">	server 192.168.0.15:80;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最少连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream item &#123; # item名字可以自定义</span><br><span class="line">	least_conn;</span><br><span class="line">	server 192.168.101.60:81;</span><br><span class="line">	server 192.168.101.77:80;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>fair（第三方）<br>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream backserver &#123;</span><br><span class="line">	server server1;</span><br><span class="line">	server server2;</span><br><span class="line">	fair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>url_hash（第三方）<br> 按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream backserver &#123;</span><br><span class="line">	server squid1:3128;</span><br><span class="line">	server squid2:3128;</span><br><span class="line">	hash $request_uri;</span><br><span class="line">	hash_method crc32;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>最后需要在server.location中指定上面定义的upstream</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	listen: 80</span><br><span class="line">	location: &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;backserver</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="负载均衡参数"><a href="#负载均衡参数" class="headerlink" title="负载均衡参数"></a>负载均衡参数</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">下面的参数可同时配置，使用空格分开即可</span><br><span class="line">&#39;配置方式 server ip:端口 参数&#39;</span><br><span class="line"></span><br><span class="line">- &#39;weight 权重&#39;</span><br><span class="line"># weight &#x3D; 数值 (值越高被选中的概率也就越高)</span><br><span class="line"></span><br><span class="line">- &#39;max_fails 失败多少次踢出队列&#39;</span><br><span class="line"># max_fails &#x3D; 数值</span><br><span class="line"></span><br><span class="line">- &#39;fail_timeout 踢出队列后重新探测时间&#39;</span><br><span class="line"># fail_timeout &#x3D; 60s (s &#x3D; 秒)</span><br><span class="line"></span><br><span class="line">- &#39;max_conns 最大连接数&#39;</span><br><span class="line"># max_conns &#x3D; 800 为防止单机性能过载可以根据实际情况设置</span><br></pre></td></tr></table></figure>

<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><blockquote>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/database/Redis/redis-all.md" target="_blank" rel="noopener">Redis | JavaGuide</a></p>
</blockquote>
<h4 id="数据结构-1"><a href="#数据结构-1" class="headerlink" title="数据结构"></a>数据结构</h4><blockquote>
<p><a href="https://juejin.im/post/6844903644798664712" target="_blank" rel="noopener">通俗易懂的Redis数据结构基础教程</a></p>
</blockquote>
<p>Redis有5个基本数据结构，string、list、hash、set和zset。</p>
<h5 id="string"><a href="#string" class="headerlink" title="string"></a>string</h5><p>Redis的字符串是动态字符串，是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。</p>
<p>当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。</p>
<p>字符串最大长度为512M。</p>
<h6 id="初始化字符串"><a href="#初始化字符串" class="headerlink" title="初始化字符串"></a>初始化字符串</h6><p>需要提供「变量名称」和「变量的内容」</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; set ireader beijing.zhangyue.keji.gufen.youxian.gongsi</span><br><span class="line">OK</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h6 id="获取字符串的内容"><a href="#获取字符串的内容" class="headerlink" title="获取字符串的内容"></a>获取字符串的内容</h6><p>提供「变量名称」</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; get ireader</span><br><span class="line">&quot;beijing.zhangyue.keji.gufen.youxian.gongsi&quot;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h6 id="获取字符串的长度"><a href="#获取字符串的长度" class="headerlink" title="获取字符串的长度"></a>获取字符串的长度</h6><p>提供「变量名称」</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; strlen ireader</span><br><span class="line">(integer) 42</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h6 id="获取子串"><a href="#获取子串" class="headerlink" title="获取子串"></a>获取子串</h6><p>提供「变量名称」以及开始和结束位置[start, end]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; getrange ireader 28 34</span><br><span class="line">&quot;youxian&quot;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h6 id="覆盖子串"><a href="#覆盖子串" class="headerlink" title="覆盖子串"></a>覆盖子串</h6><p>提供「变量名称」以及开始位置和目标子串</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; setrange ireader 28 wooxian</span><br><span class="line">(<span class="built_in">integer</span>) 42  <span class="comment"># 返回长度</span></span><br><span class="line">&gt; get ireader</span><br><span class="line"><span class="string">"beijing.zhangyue.keji.gufen.wooxian.gongsi"</span></span><br></pre></td></tr></table></figure>

<h6 id="追加子串"><a href="#追加子串" class="headerlink" title="追加子串"></a>追加子串</h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; append ireader .hao</span><br><span class="line">(<span class="built_in">integer</span>) 46 <span class="comment"># 返回长度</span></span><br><span class="line">&gt; get ireader</span><br><span class="line"><span class="string">"beijing.zhangyue.keji.gufen.wooxian.gongsi.hao"</span></span><br></pre></td></tr></table></figure>

<p>字符串没有提供子串插入方法和子串删除方法。</p>
<h6 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h6><p>如果字符串的内容是一个整数，那么还可以将字符串当成计数器来使用。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> ireader 42</span><br><span class="line">OK</span><br><span class="line">&gt; get ireader</span><br><span class="line"><span class="string">"42"</span></span><br><span class="line">&gt; incrby ireader 100</span><br><span class="line">(<span class="built_in">integer</span>) 142</span><br><span class="line">&gt; get ireader</span><br><span class="line"><span class="string">"142"</span></span><br><span class="line">&gt; decrby ireader 100</span><br><span class="line">(<span class="built_in">integer</span>) 42</span><br><span class="line">&gt; get ireader</span><br><span class="line"><span class="string">"42"</span></span><br><span class="line">&gt; incr ireader  <span class="comment"># 等价于incrby ireader 1</span></span><br><span class="line">(<span class="built_in">integer</span>) 43</span><br><span class="line">&gt; decr ireader  <span class="comment"># 等价于decrby ireader 1</span></span><br><span class="line">(<span class="built_in">integer</span>) 42</span><br></pre></td></tr></table></figure>

<p>计数器是有范围的，它不能超过Long.Max，不能低于Long.MIN</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> ireader 9223372036854775807</span><br><span class="line">OK</span><br><span class="line">&gt; incr ireader</span><br><span class="line">(error) ERR increment or decrement would overflow</span><br><span class="line">&gt; <span class="built_in">set</span> ireader -9223372036854775808</span><br><span class="line">OK</span><br><span class="line">&gt; decr ireader</span><br><span class="line">(error) ERR increment or decrement would overflow</span><br></pre></td></tr></table></figure>

<h6 id="过期和删除"><a href="#过期和删除" class="headerlink" title="过期和删除"></a>过期和删除</h6><p>字符串可以使用del指令进行主动删除，可以使用expire指令设置过期时间，到点会自动删除，这属于被动删除。可以使用ttl指令获取字符串的寿命。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; expire ireader 60</span><br><span class="line">(<span class="built_in">integer</span>) 1  <span class="comment"># 1表示设置成功，0表示变量ireader不存在</span></span><br><span class="line">&gt; ttl ireader</span><br><span class="line">(<span class="built_in">integer</span>) 50  <span class="comment"># 还有50秒的寿命，返回-2表示变量不存在，-1表示没有设置过期时间</span></span><br><span class="line">&gt; del ireader</span><br><span class="line">(<span class="built_in">integer</span>) 1  <span class="comment"># 删除成功返回1</span></span><br><span class="line">&gt; get ireader</span><br><span class="line">(nil)  <span class="comment"># 变量ireader没有了</span></span><br></pre></td></tr></table></figure>

<h5 id="list"><a href="#list" class="headerlink" title="list"></a>list</h5><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c25d671d13466" alt=""></p>
<p>Redis将列表数据结构命名为list而不是array，是因为列表的存储结构用的是链表而不是数组，而且链表还是双向链表。因为它是链表，所以随机定位性能较弱，首尾插入删除性能较优。</p>
<h6 id="负下标"><a href="#负下标" class="headerlink" title="负下标"></a>负下标</h6><p>链表元素的位置使用自然数<code>0,1,2,....n-1</code>表示，还可以使用负数<code>-1,-2,...-n</code>来表示，<code>-1</code>表示「倒数第一」，<code>-2</code>表示「倒数第二」，那么<code>-n</code>就表示第一个元素，对应的下标为<code>0</code>。</p>
<h6 id="队列／堆栈"><a href="#队列／堆栈" class="headerlink" title="队列／堆栈"></a>队列／堆栈</h6><p>链表可以从表头和表尾追加和移除元素，结合使用 rpush/rpop/lpush/lpop 四条指令，可以将链表作为队列或堆栈使用，左向右向进行都可以。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 右进左出</span></span><br><span class="line">&gt; rpush ireader go</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; rpush ireader java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; lpop ireader</span><br><span class="line"><span class="string">"go"</span></span><br><span class="line">&gt; lpop ireader</span><br><span class="line"><span class="string">"java"</span></span><br><span class="line">&gt; lpop ireader</span><br><span class="line"><span class="string">"python"</span></span><br><span class="line"><span class="comment"># 左进右出</span></span><br><span class="line">&gt; lpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; rpop ireader</span><br><span class="line"><span class="string">"go"</span></span><br><span class="line">...</span><br><span class="line"><span class="comment"># 右进右出</span></span><br><span class="line">&gt; rpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; rpop ireader </span><br><span class="line"><span class="string">"python"</span></span><br><span class="line">...</span><br><span class="line"><span class="comment"># 左进左出</span></span><br><span class="line">&gt; lpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; lpop ireader</span><br><span class="line"><span class="string">"python"</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在日常应用中，列表常用来作为异步队列来使用。</p>
<h6 id="长度"><a href="#长度" class="headerlink" title="长度"></a>长度</h6><p>使用llen指令获取链表长度</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; llen ireader</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<h6 id="随机读"><a href="#随机读" class="headerlink" title="随机读"></a>随机读</h6><p>可以使用 lindex 指令访问指定位置的元素。</p>
<p>使用 lrange 指令来获取链表子元素列表，提供start和end下标参数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; lindex ireader 1</span><br><span class="line"><span class="string">"java"</span></span><br><span class="line">&gt; lrange ireader 0 2</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"java"</span></span><br><span class="line">3) <span class="string">"python"</span></span><br><span class="line">&gt; lrange ireader 0 -1  <span class="comment"># -1表示倒数第一</span></span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"java"</span></span><br><span class="line">3) <span class="string">"python"</span></span><br></pre></td></tr></table></figure>

<h6 id="修改元素"><a href="#修改元素" class="headerlink" title="修改元素"></a>修改元素</h6><p>使用lset指令修改指定位置的元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; lset ireader 1 javascript</span><br><span class="line">OK</span><br><span class="line">&gt; lrange ireader 0 -1</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"javascript"</span></span><br><span class="line">3) <span class="string">"python"</span></span><br></pre></td></tr></table></figure>

<h6 id="插入元素"><a href="#插入元素" class="headerlink" title="插入元素"></a>插入元素</h6><p>使用linsert指令在列表的中间位置插入元素，linsert指令里增加了方向参数before/after来显示指示前置和后置插入。</p>
<p>不过linsert指令并不是通过指定位置来插入，而是通过指定具体的值。这是因为在分布式环境下，列表的元素总是频繁变动的，意味着上一时刻计算的元素下标在下一时刻可能就不是你所期望的下标了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; linsert ireader before java ruby</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">&gt; lrange ireader 0 -1</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"ruby"</span></span><br><span class="line">3) <span class="string">"java"</span></span><br><span class="line">4) <span class="string">"python"</span></span><br></pre></td></tr></table></figure>

<h6 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h6><p>列表的删除操作也不是通过指定下标来确定元素的，你需要指定删除的最大个数以及元素的值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpush ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; lrem ireader 1 java</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; lrange ireader 0 -1</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"python"</span></span><br></pre></td></tr></table></figure>

<h6 id="定长列表"><a href="#定长列表" class="headerlink" title="定长列表"></a>定长列表</h6><p>在实际应用场景中，我们有时候会遇到「定长列表」的需求。比如要以走马灯的形式实时显示中奖用户名列表，因为中奖用户实在太多，能显示的数量一般不超过100条，那么这里就会使用到定长列表。维持定长列表的指令是ltrim，需要提供两个参数start和end，表示需要保留列表的下标范围，范围之外的所有元素都将被移除。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpush ireader go java python javascript ruby erlang rust cpp</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line">&gt; ltrim ireader -3 -1</span><br><span class="line">OK</span><br><span class="line">&gt; lrange ireader 0 -1</span><br><span class="line">1) <span class="string">"erlang"</span></span><br><span class="line">2) <span class="string">"rust"</span></span><br><span class="line">3) <span class="string">"cpp"</span></span><br></pre></td></tr></table></figure>

<p>如果指定参数的end对应的真实下标小于start，其效果等价于del指令，因为这样的参数表示需要需要保留列表元素的下标范围为空。</p>
<h6 id="快速列表"><a href="#快速列表" class="headerlink" title="快速列表"></a>快速列表</h6><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/27/164d91746fbe0442" alt="img"></p>
<p>如果再深入一点，你会发现Redis底层存储的还不是一个简单的linkedlist，而是称之为快速链表quicklist的一个结构。首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。它将所有的元素紧挨着一起存储，分配的是一块连续的内存。当数据量比较多的时候才会改成quicklist。因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。所以Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的冗余空间。</p>
<h5 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h5><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/23/164c4eaf9edf608d" alt="img"></p>
<p>哈希等价于Java语言的HashMap，在实现结构上它使用二维结构，第一维是数组，第二维是链表，hash的内容key和value存放在链表中，数组里存放的是链表的头指针。通过key查找元素时，先计算key的hashcode，然后用hashcode对数组的长度进行取模定位到链表的表头，再对链表进行遍历获取到相应的value值，链表的作用就是用来将产生了「hash碰撞」的元素串起来。Java语言开发者会感到非常熟悉，因为这样的结构和HashMap是没有区别的。哈希的第一维数组的长度也是2^n。</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/7/23/164c4dcd14c00534" alt="img"></p>
<h6 id="增加元素"><a href="#增加元素" class="headerlink" title="增加元素"></a>增加元素</h6><p>可以使用hset一次增加一个键值对，也可以使用hmset一次增加多个键值对</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; hset ireader go fast</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; hmset ireader java fast python slow</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h6 id="获取元素"><a href="#获取元素" class="headerlink" title="获取元素"></a>获取元素</h6><p>可以通过hget定位具体key对应的value，可以通过hmget获取多个key对应的value，可以使用hgetall获取所有的键值对，可以使用hkeys和hvals分别获取所有的key列表和value列表。这些操作和Java语言的Map接口是类似的。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; hmset ireader go fast java fast python slow</span><br><span class="line">OK</span><br><span class="line">&gt; hget ireader go</span><br><span class="line"><span class="string">"fast"</span></span><br><span class="line">&gt; hmget ireader go python</span><br><span class="line">1) <span class="string">"fast"</span></span><br><span class="line">2) <span class="string">"slow"</span></span><br><span class="line">&gt; hgetall ireader</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"fast"</span></span><br><span class="line">3) <span class="string">"java"</span></span><br><span class="line">4) <span class="string">"fast"</span></span><br><span class="line">5) <span class="string">"python"</span></span><br><span class="line">6) <span class="string">"slow"</span></span><br><span class="line">&gt; hkeys ireader</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"java"</span></span><br><span class="line">3) <span class="string">"python"</span></span><br><span class="line">&gt; hvals ireader</span><br><span class="line">1) <span class="string">"fast"</span></span><br><span class="line">2) <span class="string">"fast"</span></span><br><span class="line">3) <span class="string">"slow"</span></span><br></pre></td></tr></table></figure>

<h6 id="删除元素-1"><a href="#删除元素-1" class="headerlink" title="删除元素"></a>删除元素</h6><p>可以使用hdel删除指定key，hdel支持同时删除多个key</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; hmset ireader go fast java fast python slow</span><br><span class="line">OK</span><br><span class="line">&gt; hdel ireader go</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; hdel ireader java python</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h6 id="判断元素是否存在"><a href="#判断元素是否存在" class="headerlink" title="判断元素是否存在"></a>判断元素是否存在</h6><p>通常我们使用hget获得key对应的value是否为空就直到对应的元素是否存在了，不过如果value的字符串长度特别大，通过这种方式来判断元素存在与否就略显浪费，这时可以使用hexists指令。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; hmset ireader go fast java fast python slow</span><br><span class="line">OK</span><br><span class="line">&gt; hexists ireader go</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h6 id="计数器-1"><a href="#计数器-1" class="headerlink" title="计数器"></a>计数器</h6><p>hash结构还可以当成计数器来使用，对于内部的每一个key都可以作为独立的计数器。如果value值不是整数，调用hincrby指令会出错。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; hincrby ireader go 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; hincrby ireader python 4</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">&gt; hincrby ireader java 4</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">&gt; hgetall ireader</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"1"</span></span><br><span class="line">3) <span class="string">"python"</span></span><br><span class="line">4) <span class="string">"4"</span></span><br><span class="line">5) <span class="string">"java"</span></span><br><span class="line">6) <span class="string">"4"</span></span><br><span class="line">&gt; hset ireader rust good</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; hincrby ireader rust 1</span><br><span class="line">(error) ERR <span class="built_in">hash</span> value is not an <span class="built_in">integer</span></span><br></pre></td></tr></table></figure>

<h6 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h6><p>当hash内部的元素比较拥挤时(hash碰撞比较频繁)，就需要进行扩容。扩容需要申请新的两倍大小的数组，然后将所有的键值对重新分配到新的数组下标对应的链表中(rehash)。</p>
<p>如果hash结构很大，比如有上百万个键值对，那么一次完整rehash的过程就会耗时很长。这对于单线程的Redis里来说有点压力山大。所以Redis采用了渐进式rehash的方案。它会同时保留两个新旧hash结构，在后续的定时任务以及hash结构的读写指令中将旧结构的元素逐渐迁移到新的结构中。这样就可以避免因扩容导致的线程卡顿现象。</p>
<h6 id="缩容"><a href="#缩容" class="headerlink" title="缩容"></a>缩容</h6><p>Redis的hash结构不但有扩容还有缩容，从这一点出发，它要比Java的HashMap要厉害一些，Java的HashMap只有扩容。缩容的原理和扩容是一致的，只不过新的数组大小要比旧数组小一倍。</p>
<h5 id="set"><a href="#set" class="headerlink" title="set"></a>set</h5><p>Java 中 HashSet的内部实现使用的是HashMap，只不过所有的value都指向同一个对象。</p>
<p>Redis的set结构也是一样，它的内部也使用hash结构，所有的value都指向同一个内部值。</p>
<h6 id="增加元素-1"><a href="#增加元素-1" class="headerlink" title="增加元素"></a>增加元素</h6><p>可以一次增加多个元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; sadd ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<h6 id="读取元素"><a href="#读取元素" class="headerlink" title="读取元素"></a>读取元素</h6><p>使用smembers列出所有元素，</p>
<p>使用scard获取集合长度，</p>
<p>使用srandmember随机获取count个元素，如果不提供count参数，默认为1</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; sadd ireader go java python</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; smembers ireader</span><br><span class="line">1) <span class="string">"java"</span></span><br><span class="line">2) <span class="string">"python"</span></span><br><span class="line">3) <span class="string">"go"</span></span><br><span class="line">&gt; scard ireader</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; srandmember ireader</span><br><span class="line"><span class="string">"java"</span></span><br></pre></td></tr></table></figure>

<h6 id="删除元素-2"><a href="#删除元素-2" class="headerlink" title="删除元素"></a>删除元素</h6><p>使用srem删除一到多个元素，使用spop随机删除一个元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; sadd ireader go java python rust erlang</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">&gt; srem ireader go java</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; spop ireader</span><br><span class="line"><span class="string">"erlang"</span></span><br></pre></td></tr></table></figure>

<h6 id="判断元素是否存在-1"><a href="#判断元素是否存在-1" class="headerlink" title="判断元素是否存在"></a>判断元素是否存在</h6><p>使用sismember指令，只能接收单个元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; sadd ireader go java python rust erlang</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">&gt; sismember ireader rust</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; sismember ireader javascript</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<h5 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h5><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/23/164c4ec77aac6132" alt="img"></p>
<p>SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构<code>Map&lt;String, Double&gt;</code>，可以给每一个元素value赋予一个权重<code>score</code>，另一方面它又类似于<code>TreeSet</code>，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。</p>
<p>zset底层实现使用了两个数据结构，第一个是hash，第二个是跳跃列表，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。跳跃列表的目的在于给元素value排序，根据score的范围获取元素列表。</p>
<h6 id="增加元素-2"><a href="#增加元素-2" class="headerlink" title="增加元素"></a>增加元素</h6><p>通过zadd指令可以增加一到多个value/score对，score放在前面</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zadd ireader 4.0 python</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; zadd ireader 4.0 java 1.0 go</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h6 id="长度-1"><a href="#长度-1" class="headerlink" title="长度"></a>长度</h6><p>通过指令zcard可以得到zset的元素个数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zcard ireader</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<h6 id="删除元素-3"><a href="#删除元素-3" class="headerlink" title="删除元素"></a>删除元素</h6><p>通过指令zrem可以删除zset中的元素，可以一次删除多个</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zrem ireader go python</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h6 id="计数器-2"><a href="#计数器-2" class="headerlink" title="计数器"></a>计数器</h6><p>同hash结构一样，zset也可以作为计数器使用。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zadd ireader 4.0 python 4.0 java 1.0 go</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">&gt; zincrby ireader 1.0 python</span><br><span class="line"><span class="string">"5"</span></span><br></pre></td></tr></table></figure>

<h6 id="获取排名和分数"><a href="#获取排名和分数" class="headerlink" title="获取排名和分数"></a>获取排名和分数</h6><p>通过zscore指令获取指定元素的权重，通过zrank指令获取指定元素的正向排名，通过zrevrank指令获取指定元素的反向排名[倒数第一名]。正向是由小到大，负向是由大到小。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zscore ireader python</span><br><span class="line"><span class="string">"5"</span></span><br><span class="line">&gt; zrank ireader go  <span class="comment"># 分数低的排名考前，rank值小</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">&gt; zrank ireader java</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">&gt; zrank ireader python</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; zrevrank ireader python</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<h6 id="根据排名范围获取元素列表"><a href="#根据排名范围获取元素列表" class="headerlink" title="根据排名范围获取元素列表"></a>根据排名范围获取元素列表</h6><p>通过zrange指令指定排名范围参数获取对应的元素列表，携带withscores参数可以一并获取元素的权重。</p>
<p>通过zrevrange指令按负向排名获取元素列表。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zrange ireader 0 -1  <span class="comment"># 获取所有元素</span></span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"java"</span></span><br><span class="line">3) <span class="string">"python"</span></span><br><span class="line">&gt; zrange ireader 0 -1 withscores</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"1"</span></span><br><span class="line">3) <span class="string">"java"</span></span><br><span class="line">4) <span class="string">"4"</span></span><br><span class="line">5) <span class="string">"python"</span></span><br><span class="line">6) <span class="string">"5"</span></span><br><span class="line">&gt; zrevrange ireader 0 -1 withscores</span><br><span class="line">1) <span class="string">"python"</span></span><br><span class="line">2) <span class="string">"5"</span></span><br><span class="line">3) <span class="string">"java"</span></span><br><span class="line">4) <span class="string">"4"</span></span><br><span class="line">5) <span class="string">"go"</span></span><br><span class="line">6) <span class="string">"1"</span></span><br></pre></td></tr></table></figure>

<h6 id="根据score范围获取列表"><a href="#根据score范围获取列表" class="headerlink" title="根据score范围获取列表"></a>根据score范围获取列表</h6><p>通过zrangebyscore指令指定score范围获取对应的元素列表。通过zrevrangebyscore指令获取倒排元素列表。</p>
<p>参数<code>-inf</code>表示负无穷，<code>+inf</code>表示正无穷。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zrangebyscore ireader 0 5</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"java"</span></span><br><span class="line">3) <span class="string">"python"</span></span><br><span class="line">&gt; zrangebyscore ireader -inf +inf withscores</span><br><span class="line">1) <span class="string">"go"</span></span><br><span class="line">2) <span class="string">"1"</span></span><br><span class="line">3) <span class="string">"java"</span></span><br><span class="line">4) <span class="string">"4"</span></span><br><span class="line">5) <span class="string">"python"</span></span><br><span class="line">6) <span class="string">"5"</span></span><br><span class="line">&gt; zrevrangebyscore ireader +inf -inf withscores  <span class="comment"># 注意正负反过来了</span></span><br><span class="line">1) <span class="string">"python"</span></span><br><span class="line">2) <span class="string">"5"</span></span><br><span class="line">3) <span class="string">"java"</span></span><br><span class="line">4) <span class="string">"4"</span></span><br><span class="line">5) <span class="string">"go"</span></span><br><span class="line">6) <span class="string">"1"</span></span><br></pre></td></tr></table></figure>

<h6 id="根据范围移除元素列表"><a href="#根据范围移除元素列表" class="headerlink" title="根据范围移除元素列表"></a>根据范围移除元素列表</h6><p>可以通过排名范围，也可以通过score范围来一次性移除多个元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; zremrangebyrank ireader 0 1</span><br><span class="line">(<span class="built_in">integer</span>) 2  <span class="comment"># 删掉了2个元素</span></span><br><span class="line">&gt; zadd ireader 4.0 java 1.0 go</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; zremrangebyscore ireader -inf 4</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">&gt; zrange ireader 0 -1</span><br><span class="line">1) <span class="string">"python"</span></span><br></pre></td></tr></table></figure>

<h6 id="跳跃列表"><a href="#跳跃列表" class="headerlink" title="跳跃列表"></a>跳跃列表</h6><p>zset内部的排序功能是通过「跳跃列表」数据结构来实现的。</p>
<p>因为zset要支持随机的插入和删除，所以它不好使用数组来表示。我们先看一个普通的链表结构。</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/7/23/164c5a90442cd51a" alt="img"></p>
<p>我们需要这个链表按照score值进行排序。这意味着当有新元素需要插入时，需要定位到特定位置的插入点，这样才可以继续保证链表是有序的。通常我们会通过二分查找来找到插入点，但是二分查找的对象必须是数组，只有数组才可以支持快速位置定位，链表做不到，那该怎么办？</p>
<p>跳跃列表就是类似于（公司-部门-组长）这种层级制，最下面一层所有的元素都会串起来。然后每隔几个元素挑选出一个代表来，再将这几个代表使用另外一级指针串起来。然后在这些代表里再挑出二级代表，再串起来。最终就形成了金字塔结构。</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/7/23/164c5bb13c6da230" alt="img"></p>
<p>「跳跃列表」之所以「跳跃」，是因为内部的元素可能「身兼数职」，比如上图中间的这个元素，同时处于L0、L1和L2层，可以快速在不同层次之间进行「跳跃」。</p>
<p>定位插入点时，先在顶层进行定位，然后下潜到下一级定位，一直下潜到最底层找到合适的位置，将新元素插进去。你也许会问那新插入的元素如何才有机会「身兼数职」呢？</p>
<p>跳跃列表采取一个随机策略来决定新元素可以兼职到第几层，首先L0层肯定是100%了，L1层只有50%的概率，L2层只有25%的概率，L3层只有12.5%的概率，一直随机到最顶层L31层。绝大多数元素都过不了几层，只有极少数元素可以深入到顶层。列表中的元素越多，能够深入的层次就越深，能进入到顶层的概率就会越大。</p>
<h4 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h4><p>虽然说 Redis 是单线程模型，但是， 实际上，Redis 在 4.0 之后的版本中就已经加入了对多线程的支持。</p>
<p>不过，Redis 4.0 增加的多线程主要是针对一些<strong>大键值对的删除操作</strong>的命令，使用这些命令就会使用主处理之外的其他线程来“异步处理”。</p>
<p>大体上来说，Redis 6.0 之前主要还是单线程处理。</p>
<p>Redis6.0 引入多线程主要是为了提高<strong>网络 IO</strong> 读写性能，因为这个算是 Redis 中的一个性能瓶颈（Redis 的瓶颈主要受限于内存和网络）。</p>
<h5 id="为什么-Redis-选择单线程模型"><a href="#为什么-Redis-选择单线程模型" class="headerlink" title="为什么 Redis 选择单线程模型"></a>为什么 Redis 选择单线程模型</h5><blockquote>
<p><a href="https://draveness.me/whys-the-design-redis-single-thread/" target="_blank" rel="noopener">为什么 Redis 选择单线程模型</a></p>
</blockquote>
<p>Redis 选择使用单线程模型处理客户端的请求主要还是因为 <strong>CPU 不是 Redis 服务器的瓶颈</strong>，所以<strong>使用多线程模型带来的性能提升并不能抵消它带来的开发成本和维护成本</strong>，系统的性能瓶颈也主要在网络 I/O 操作上；</p>
<p>而 Redis 引入多线程操作也是出于性能上的考虑，对于一些大键值对的删除操作，通过多线程非阻塞地释放内存空间也能减少对 Redis 主线程阻塞的时间，提高执行的效率。</p>
<h5 id="单线程的Redis为什么这么快"><a href="#单线程的Redis为什么这么快" class="headerlink" title="单线程的Redis为什么这么快"></a>单线程的Redis为什么这么快</h5><ol>
<li><p>完全基于内存</p>
</li>
<li><p>采用单线程，避免了不必要的上下文切换。</p>
</li>
<li><p>高效的数据结构</p>
</li>
<li><p>使用I/O多路复用模型，非阻塞IO</p>
<p>I/O多路复用，多路只多个连接，复用指的是复用同一个线程，采用多路 I/O 复用技术可以让单个线程高效的处理多个连接请求。</p>
</li>
</ol>
<h4 id="过期策略"><a href="#过期策略" class="headerlink" title="过期策略"></a>过期策略</h4><h5 id="Redis是如何判断数据是否过期？"><a href="#Redis是如何判断数据是否过期？" class="headerlink" title="Redis是如何判断数据是否过期？"></a>Redis是如何判断数据是否过期？</h5><p>Redis 通过一个叫做<strong>过期字典</strong>（可以看作是hash表）来保存数据过期的时间。过期字典的键指向Redis数据库中的某个key(键)，过期字典的值是一个long long类型的整数，这个整数保存了key所指向的数据库键的过期时间（毫秒精度的UNIX时间戳）。</p>
<h5 id="Redis的过期策略"><a href="#Redis的过期策略" class="headerlink" title="Redis的过期策略"></a>Redis的过期策略</h5><p>过期策略通常有以下三种：</p>
<ul>
<li><p>定时过期</p>
<p>每个设置过期时间的key都需要创建一个定时器，到过期时间就会立即清除。该策略可以立即清除过期的数据，对内存很友好；但是会占用大量的CPU资源去处理过期的数据，从而影响缓存的响应时间和吞吐量。</p>
</li>
<li><p>惰性过期</p>
<p>只有当访问一个key时，才会判断该key是否已过期，过期则清除。该策略可以最大化地节省CPU资源，却对内存非常不友好。极端情况可能出现大量的过期key没有再次被访问，从而不会被清除，占用大量内存。</p>
</li>
<li><p>定期过期</p>
<p>每隔一定的时间，会扫描expires字典中一定数量的key，并清除其中已过期的key。该策略是前两者的一个折中方案。通过调整定时扫描的时间间隔和每次扫描的限定耗时，可以在不同情况下使得CPU和内存资源达到最优的平衡效果。</p>
</li>
</ul>
<p>Redis中同时使用了惰性过期和定期过期两种过期策略。</p>
<p>Redis 每隔 100ms 就随机选择一些设置了过期时间的Key，检查它们是否过期，如果过期的话就删除它们。</p>
<p>每秒 10 次：</p>
<ol>
<li>随机测试 20 个带有过期时间的key</li>
<li>删除已过期的key</li>
<li>如果超过 25% 的key已过期，从步骤 1 重新开始</li>
</ol>
<h4 id="内存淘汰机制"><a href="#内存淘汰机制" class="headerlink" title="内存淘汰机制"></a>内存淘汰机制</h4><p>Redis 提供 6 种数据淘汰策略：</p>
<ol>
<li><p><strong>no-eviction</strong>（默认）</p>
<p>禁止驱逐数据，也就是说当内存不足以容纳新写入数据时，新写入操作会报错。</p>
</li>
<li><p><strong>volatile-lru（least recently used）</strong></p>
<p>从已设置过期时间的数据集中挑选最近最少使用的数据淘汰</p>
<p>Redis使用的是近似LRU算法。近似LRU算法通过随机采样法淘汰数据，每次随机出5（默认）个key，从里面淘汰掉最近最少使用的key。</p>
</li>
<li><p><strong>volatile-ttl</strong></p>
<p>从已设置过期时间的数据集中挑选将要过期的数据淘汰</p>
</li>
<li><p><strong>volatile-random</strong></p>
<p>从已设置过期时间的数据集中任意选择数据淘汰</p>
</li>
<li><p><strong>allkeys-lru（least recently used）</strong></p>
<p>在键空间中，移除最近最少使用的 key（这个是<span style="color: red">最常用</span>的）</p>
</li>
<li><p><strong>allkeys-random</strong></p>
<p>从数据集中任意选择数据淘汰</p>
</li>
</ol>
<p>4.0 版本后增加以下两种：</p>
<ol>
<li><p><strong>volatile-lfu（least frequently used）</strong></p>
<p>从已设置过期时间的数据集中挑选最不经常使用的数据淘汰</p>
</li>
<li><p><strong>allkeys-lfu（least frequently used）</strong></p>
<p>在键空间中，移除最不经常使用的 key</p>
</li>
</ol>
<h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><p>Redis 有两种持久化：RDB（快照）和 AOF（追加文件）</p>
<p>注：4.0之后增加了混合方式，结合了 RDB 和 AOF 的优点。</p>
<p>区别：</p>
<ul>
<li>RDB 是将内存中数据某一时刻的快照写入二进制文件中。</li>
<li>AOF 是将每条导致数据变动的指令追加到 aof 文件中。</li>
</ul>
<p>优缺点：</p>
<table>
<thead>
<tr>
<th></th>
<th>RDB</th>
<th>AOF</th>
</tr>
</thead>
<tbody><tr>
<td>文件大小</td>
<td>小</td>
<td>大</td>
</tr>
<tr>
<td>重启时间</td>
<td>短</td>
<td>长</td>
</tr>
<tr>
<td>数据丢失</td>
<td>多</td>
<td>少</td>
</tr>
</tbody></table>
<h4 id="事务-1"><a href="#事务-1" class="headerlink" title="事务"></a>事务</h4><p>Redis 可以通过 MULTI，EXEC，DISCARD 和 WATCH 等命令来实现事务(transaction)功能。</p>
<p>使用 MULTI命令后可以输入多个命令。Redis不会立即执行这些命令，而是将它们放到队列，当调用了EXEC命令将执行所有命令。</p>
<p>但是，Redis 的事务和我们平时理解的关系型数据库的事务不同。</p>
<p>Redis 是<strong>不支持 roll back</strong> 的，因而不满足原子性的（而且不满足持久性）。</p>
<h4 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h4><h5 id="什么是缓存穿透？"><a href="#什么是缓存穿透？" class="headerlink" title="什么是缓存穿透？"></a>什么是缓存穿透？</h5><p>缓存穿透说简单点就是大量请求的 key 根本不存在于缓存中，导致请求直接到了数据库上，根本没有经过缓存这一层。</p>
<h5 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h5><ol>
<li><p>参数校验</p>
<p>一些不合法的参数请求直接抛出异常信息返回给客户端。</p>
</li>
<li><p>缓存无效 key</p>
<p>如果缓存和数据库都查不到某个 key 的数据就写一个固定值(e.g. null)到 Redis 中去并设置过期时间</p>
</li>
<li><p>布隆过滤器</p>
<p>把所有可能存在的请求的值都存放在布隆过滤器中，当用户请求过来，先判断用户发来的请求的值是否存在于布隆过滤器中。不存在的话，直接返回请求参数错误信息给客户端，存在的话才会继续走下面的流程。</p>
</li>
</ol>
<h4 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h4><h5 id="什么是缓存雪崩？"><a href="#什么是缓存雪崩？" class="headerlink" title="什么是缓存雪崩？"></a>什么是缓存雪崩？</h5><p>缓存在同一时间大面积的失效，后面的请求都直接落到了数据库上，造成数据库短时间内承受大量请求。</p>
<h5 id="解决办法-1"><a href="#解决办法-1" class="headerlink" title="解决办法"></a>解决办法</h5><p><strong>针对 Redis 服务不可用的情况：</strong></p>
<ol>
<li>采用 Redis 集群，避免单机出现问题整个缓存服务都没办法使用。</li>
<li>限流，避免同时处理大量的请求。</li>
</ol>
<p><strong>针对热点缓存失效的情况：</strong></p>
<ol>
<li><p>合理设置缓存过期时间(e.g. 随机)</p>
</li>
<li><p>分布式缓存</p>
<p>为了防止缓存服务器宕机出现的缓存雪崩，可以使用分布式缓存，分布式缓存中每一个节点只缓存部分的数据，当某个节点宕机时可以保证其它节点的缓存仍然可用。</p>
</li>
<li><p>缓存预热</p>
<p>避免在系统刚启动不久由于还未将大量数据进行缓存而导致缓存雪崩。</p>
</li>
</ol>
<h4 id="Redis和数据库双写一致性问题"><a href="#Redis和数据库双写一致性问题" class="headerlink" title="Redis和数据库双写一致性问题"></a>Redis和数据库双写一致性问题</h4><p>采用 <strong>Cache Aside Pattern</strong>：</p>
<ol>
<li>读的时候先读缓存，如果缓存不存在的话就读数据库，取出数据库后更新缓存。</li>
<li>写的时候，先更新数据库，再删除缓存。</li>
</ol>
<h5 id="为什么是删除缓存，而不是更新缓存？"><a href="#为什么是删除缓存，而不是更新缓存？" class="headerlink" title="为什么是删除缓存，而不是更新缓存？"></a>为什么是删除缓存，而不是更新缓存？</h5><ol>
<li>有两个更新请求A、B，A先与B更新的数据库，但由于网络震荡，B先与A更新了缓存，此时缓存的数据就是脏数据。</li>
<li>为了考虑性能。更新了的数据并不一定会立即有新的访问，放在缓存里占内存，还不如直接删除，有新的访问时再放进去就好了，是一种懒加载的思想。</li>
</ol>
<h5 id="如果删除失败了，导致数据不一致怎么办？"><a href="#如果删除失败了，导致数据不一致怎么办？" class="headerlink" title="如果删除失败了，导致数据不一致怎么办？"></a>如果删除失败了，导致数据不一致怎么办？</h5><p>采用延时双删策略，先删除缓存，再更新数据库，更新成功了就延时异步删除缓存。</p>
<h4 id="用-Redis-实现点赞功能"><a href="#用-Redis-实现点赞功能" class="headerlink" title="用 Redis 实现点赞功能"></a>用 Redis 实现点赞功能</h4><h4 id="Redis-做消息队列"><a href="#Redis-做消息队列" class="headerlink" title="Redis 做消息队列"></a>Redis 做消息队列</h4><ul>
<li>基于List的 LPUSH+BRPOP 的实现</li>
<li>PUB/SUB，订阅/发布模式</li>
<li>基于Sorted-Set的实现</li>
<li>基于Stream类型的实现</li>
</ul>
<h4 id="Redis-做分布式锁"><a href="#Redis-做分布式锁" class="headerlink" title="Redis 做分布式锁"></a>Redis 做分布式锁</h4><h5 id="利用-Redis-的-SETNX-和-EXPIRE-命令"><a href="#利用-Redis-的-SETNX-和-EXPIRE-命令" class="headerlink" title="利用 Redis 的 SETNX 和 EXPIRE 命令"></a>利用 Redis 的 SETNX 和 EXPIRE 命令</h5><ul>
<li><p>加锁命令：<code>SETNX key value</code></p>
<p>当键不存在时，对键进行设置操作并返回成功，否则返回失败。KEY 是锁的唯一标识，一般按业务来决定命名。</p>
</li>
<li><p>解锁命令：<code>DEL key</code></p>
<p>通过删除键值对释放锁，以便其他线程可以通过 SETNX 命令来获取锁。</p>
</li>
<li><p>锁超时：<code>EXPIRE key timeout</code></p>
<p>设置 key 的超时时间，以保证即使锁没有被显式释放，锁也可以在一定时间后自动释放，避免资源被永远锁住。</p>
</li>
</ul>
<h6 id="SETNX-和-EXPIRE-非原子性"><a href="#SETNX-和-EXPIRE-非原子性" class="headerlink" title="SETNX 和 EXPIRE 非原子性"></a>SETNX 和 EXPIRE 非原子性</h6><p>如果 SETNX 成功，在设置锁超时时间后，服务器挂掉、重启或网络问题等，导致 EXPIRE 命令没有执行，锁没有设置超时时间变成死锁。</p>
<ol>
<li><p>可以通过使用 lua 脚本保证原子性。</p>
</li>
<li><p>Redis在 2.6.12 版本开始，为 SET 命令增加一系列选项：</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SET key value[EX seconds][PX milliseconds][NX|XX]</span><br></pre></td></tr></table></figure>

<ul>
<li>EX seconds: 设定过期时间，单位为秒</li>
<li>PX milliseconds: 设定过期时间，单位为毫秒</li>
<li>NX: 仅当key不存在时设置值</li>
<li>XX: 仅当key存在时设置值</li>
</ul>
<p>set命令的nx选项，就等同于setnx命令</p>
<h6 id="锁误解除"><a href="#锁误解除" class="headerlink" title="锁误解除"></a>锁误解除</h6><p>如果线程 A 成功获取到了锁，并且设置了过期时间 30 秒，但线程 A 执行时间超过了 30 秒，锁过期自动释放，此时线程 B 获取到了锁；随后 A 执行完成，线程 A 使用 DEL 命令来释放锁，但此时线程 B 加的锁还没有执行完成，线程 A 实际释放的线程 B 加的锁。</p>
<p>通过在 value 中设置当前线程的标识，在删除之前验证 key 对应的 value 判断锁是否是当前线程持有。可生成一个 UUID 标识当前线程，使用 lua 脚本做验证标识和解锁操作。</p>
<h6 id="超时解锁导致并发"><a href="#超时解锁导致并发" class="headerlink" title="超时解锁导致并发"></a>超时解锁导致并发</h6><p>如果线程 A 成功获取锁并设置过期时间 30 秒，但线程 A 执行时间超过了 30 秒，锁过期自动释放，此时线程 B 获取到了锁，线程 A 和线程 B 并发执行。</p>
<p>A、B 两个线程发生并发显然是不被允许的，一般有两种方式解决该问题：</p>
<ul>
<li>将过期时间设置足够长，确保代码逻辑在锁释放之前能够执行完成。</li>
<li>为获取锁的线程增加守护线程，为将要过期但未释放的锁增加有效时间。</li>
</ul>
<h6 id="不可重入"><a href="#不可重入" class="headerlink" title="不可重入"></a>不可重入</h6><p>可通过对锁进行重入计数，加锁时加 1，解锁时减 1，当计数归 0 时释放锁。</p>
<p>在本地记录重入次数，如 Java 中使用 ThreadLocal 进行重入次数统计。</p>
<p>本地记录重入次数虽然高效，但如果考虑到过期时间和本地、Redis 一致性的问题，就会增加代码的复杂性。另一种方式是 Redis hash 数据结构来实现分布式锁，既存锁的标识也对重入次数进行计数。</p>
<h6 id="无法等待锁释放"><a href="#无法等待锁释放" class="headerlink" title="无法等待锁释放"></a>无法等待锁释放</h6><p>上述命令执行都是立即返回的，如果客户端可以等待锁释放就无法使用。</p>
<ul>
<li>可以通过客户端轮询的方式解决该问题，当未获取到锁时，等待一段时间重新获取锁，直到成功获取锁或等待超时。这种方式比较消耗服务器资源，当并发量比较大时，会影响服务器的效率。</li>
<li>另一种方式是使用 Redis 的发布订阅功能，当获取锁失败时，订阅锁释放消息，获取锁成功后释放时，发送锁释放消息。</li>
</ul>
<h6 id="主备切换"><a href="#主备切换" class="headerlink" title="主备切换"></a>主备切换</h6><p>为了保证 Redis 的可用性，一般采用主从方式部署。主从数据同步有异步和同步两种方式，Redis 将指令记录在本地内存 buffer 中，然后异步将 buffer 中的指令同步到从节点，从节点一边执行同步的指令流来达到和主节点一致的状态，一边向主节点反馈同步情况。</p>
<p>在包含主从模式的集群部署方式中，当主节点挂掉时，从节点会取而代之，但客户端无明显感知。当客户端 A 成功加锁，指令还未同步，此时主节点挂掉，从节点提升为主节点，新的主节点没有锁的数据，当客户端 B 加锁时就会成功。</p>
<h6 id="集群脑裂"><a href="#集群脑裂" class="headerlink" title="集群脑裂"></a>集群脑裂</h6><p>集群脑裂指因为网络问题，导致 Redis master 节点跟 slave 节点和 sentinel 集群处于不同的网络分区，因为 sentinel 集群无法感知到 master 的存在，所以将 slave 节点提升为 master 节点，此时存在两个不同的 master 节点。Redis Cluster 集群部署方式同理。</p>
<p>当不同的客户端连接不同的 master 节点时，两个客户端可以同时拥有同一把锁。</p>
<h5 id="Redisson-实现简单分布式锁"><a href="#Redisson-实现简单分布式锁" class="headerlink" title="Redisson 实现简单分布式锁"></a>Redisson 实现简单分布式锁</h5><p>对于Java用户而言，我们经常使用Jedis，Jedis是Redis的Java客户端，除了Jedis之外，Redisson也是Java的客户端，Jedis是阻塞式I/O，而Redisson底层使用Netty可以实现非阻塞I/O，该客户端是封装了锁的，继承了J.U.C的Lock接口，所以我们可以像使用ReentrantLock一样使用Redisson。</p>
<h3 id="Guava-Cache"><a href="#Guava-Cache" class="headerlink" title="Guava Cache"></a>Guava Cache</h3><p>使用 CacheBuilder 就可以构建一个缓存对象，CacheBuilder使用build链式构建。</p>
<h2 id="消息中间件"><a href="#消息中间件" class="headerlink" title="消息中间件"></a>消息中间件</h2><h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><p>生产者将消息发给交换器的时候，一般会指定一个 <strong>RoutingKey(路由键)</strong>，用来指定这个消息的路由规则，而这个 <strong>RoutingKey 需要与交换器类型和绑定键(BindingKey)联合使用才能最终生效</strong>。</p>
<p>RabbitMQ 中通过 <strong>Binding(绑定)</strong> 将 <strong>Exchange(交换器)</strong> 与 <strong>Queue(消息队列)</strong> 关联起来，在绑定的时候一般会指定一个 <strong>BindingKey(绑定建)</strong> ,这样 RabbitMQ 就知道如何正确将消息路由到队列了。</p>
<h4 id="Exchange-Types-交换器类型"><a href="#Exchange-Types-交换器类型" class="headerlink" title="Exchange Types(交换器类型)"></a>Exchange Types(交换器类型)</h4><p>RabbitMQ 常用的 Exchange Type 有 <strong>fanout</strong>、<strong>direct</strong>、<strong>topic</strong>、<strong>headers</strong> 这四种。</p>
<h5 id="fanout"><a href="#fanout" class="headerlink" title="fanout"></a>fanout</h5><p>fanout 类型的Exchange路由规则非常简单，它会把所有发送到该Exchange的消息路由到所有与它绑定的Queue中，不需要做任何判断操作，所以 fanout 类型是所有的交换机类型里面速度最快的。fanout 类型常用来广播消息。</p>
<h5 id="direct"><a href="#direct" class="headerlink" title="direct"></a>direct</h5><p>direct 类型的Exchange路由规则也很简单，它会把消息路由到那些 Bindingkey 与 RoutingKey 完全匹配的 Queue 中。</p>
<h5 id="topic"><a href="#topic" class="headerlink" title="topic"></a>topic</h5><p>topic类型的交换器在匹配规则上进行了扩展，它与 direct 类型的交换器相似，也是将消息路由到 BindingKey 和 RoutingKey 相匹配的队列中，但这里的匹配规则有些不同，它约定：</p>
<ul>
<li>RoutingKey 为一个点号“．”分隔的字符串;</li>
<li>BindingKey 和 RoutingKey 一样也是点号“．”分隔的字符串；</li>
<li>BindingKey 中可以存在两种特殊字符串<code>*</code>和<code>#</code>，用于做模糊匹配，其中<code>*</code>用于匹配一个单词，<code>#</code>用于匹配多个单词(可以是零个)。</li>
</ul>
<h5 id="headers-不推荐"><a href="#headers-不推荐" class="headerlink" title="headers(不推荐)"></a>headers(不推荐)</h5><p>headers 类型的交换器不依赖于路由键的匹配规则来路由消息，而是根据发送的消息内容中的 headers 属性进行匹配。</p>
<h4 id="如何保证消息不丢失？"><a href="#如何保证消息不丢失？" class="headerlink" title="如何保证消息不丢失？"></a>如何保证消息不丢失？</h4><ol>
<li>消费者端通过 confirm 机制，保证消息投递不丢失</li>
<li>rabbitMq端通过持久化保证消息不丢失</li>
<li>消费者端通过手动ack机制保障消息正常消费</li>
</ol>
<h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><h2 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><p><em>Elasticsearch</em> 是一个实时的分布式搜索分析引擎，它能让你以前所未有的速度和规模，去探索你的数据。 它被用作全文检索、结构化搜索、分析以及这三个功能的组合。例如 GitHub 使用 Elasticsearch 对1300亿行代码进行查询。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li><p>日志实时分析</p>
<p>日志分析是 ES 应用最广泛的领域，支持全栈的日志分析</p>
</li>
<li><p>搜索服务</p>
<p>文档的全文检索、电商平台商品的搜索。</p>
</li>
<li><p>数据分析</p>
</li>
</ul>
<h3 id="为什么-Elasticsearch-那么快？"><a href="#为什么-Elasticsearch-那么快？" class="headerlink" title="为什么 Elasticsearch 那么快？"></a>为什么 Elasticsearch 那么快？</h3><p>Elasticsearch 基于 Apache Lucene，Lucene 实现快速搜索的核心就是倒排索引。</p>
<h4 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h4><p>将文档中的单词作为索引，将文档ID作为记录的索引结构称为倒排索引。</p>
<h5 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h5><ul>
<li><p>Term：文档拆分后的单词与文档ID的映射。</p>
</li>
<li><p>Term Dictionary：所有单词组成的二叉排序树，根据 Term Dictionary 可以快速定位到 Term。</p>
</li>
<li><p>Term Index：单词前缀的二叉排序树，根据 Term Index 可以快速定位到 Term Dictionary。</p>
</li>
</ul>
<p>Term Index 以FST（finite state transducers）的形式保存在内存中，FST特点是非常节省内存。</p>
<p>Term dictionary在磁盘上是以分快的方式保存的，一个block内部利用公共前缀压缩，比如都是Ab开头的单词就可以把Ab省去。这样term dictionary可以更节约磁盘空间。</p>
<h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><h4 id="命令-1"><a href="#命令-1" class="headerlink" title="命令"></a>命令</h4><p>在 docker 中执行 bash 命令</p>
<p><code>docker exec -it set-mobile_qa /bin/bash</code></p>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><h3 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h3><h3 id="SSM"><a href="#SSM" class="headerlink" title="SSM"></a>SSM</h3><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><h4 id="服务雪崩"><a href="#服务雪崩" class="headerlink" title="服务雪崩"></a>服务雪崩</h4><p>服务雪崩就是一个服务的不可用导致了整个调用链上的服务集体雪崩。</p>
<h4 id="服务熔断-1"><a href="#服务熔断-1" class="headerlink" title="服务熔断"></a>服务熔断</h4><p>所谓 <strong>熔断</strong> 就是服务雪崩的一种有效解决方案。当指定时间窗内的请求失败率达到设定阈值时，系统将通过 <strong>断路器</strong> 直接将此请求链路断开。</p>
<h4 id="服务降级-1"><a href="#服务降级-1" class="headerlink" title="服务降级"></a>服务降级</h4><h4 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h4><h5 id="RPC-解决了什么问题？"><a href="#RPC-解决了什么问题？" class="headerlink" title="RPC 解决了什么问题？"></a>RPC 解决了什么问题？</h5><p><strong>让分布式或者微服务系统中不同服务之间的调用像本地调用一样简单。</strong></p>
<h5 id="既有-HTTP-为啥用-RPC-进行服务调用"><a href="#既有-HTTP-为啥用-RPC-进行服务调用" class="headerlink" title="既有 HTTP ,为啥用 RPC 进行服务调用?"></a>既有 HTTP ,为啥用 RPC 进行服务调用?</h5><p>RPC 只是一种概念、一种设计，就是为了解决 <strong>不同服务之间的调用问题</strong>, 它一般会包含有 <strong>传输协议</strong> 和 <strong>序列化协议</strong> 这两个。</p>
<p>但是，HTTP 是一种协议，RPC框架可以使用 HTTP 协议作为传输协议或者直接使用TCP 作为传输协议，使用不同的协议一般也是为了适应不同的场景。</p>
<h5 id="REST和RPC"><a href="#REST和RPC" class="headerlink" title="REST和RPC"></a>REST和RPC</h5><h3 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h3><h4 id="分布式、集群、微服务、SOA-之间的区别"><a href="#分布式、集群、微服务、SOA-之间的区别" class="headerlink" title="分布式、集群、微服务、SOA 之间的区别"></a>分布式、集群、微服务、SOA 之间的区别</h4><ul>
<li>分布式<ul>
<li>不同模块部署在不同服务器上，</li>
</ul>
</li>
<li>集群<ul>
<li>多台服务器部署相模块构成集群，通过负载均衡对外提供服务。</li>
</ul>
</li>
<li>SOA<ul>
<li>面向服务的架构（Service Oriented Architecture），把系统按照实际业务，拆分成刚刚好大小的、合适的、独立部署的模块，每个模块之间相互独立。</li>
</ul>
</li>
<li>微服务<ul>
<li>微服务是SOA架构演进的结果。<strong>是一种比较现代化的细粒度的SOA实现方式。</strong></li>
</ul>
</li>
</ul>
<h4 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h4><h4 id="两段式（2PC）"><a href="#两段式（2PC）" class="headerlink" title="两段式（2PC）"></a>两段式（2PC）</h4><h4 id="三段式（3PC）"><a href="#三段式（3PC）" class="headerlink" title="三段式（3PC）"></a>三段式（3PC）</h4><h3 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h3><h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><h3 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h3><h4 id="nextTick"><a href="#nextTick" class="headerlink" title="$nextTick"></a>$nextTick</h4><h2 id="什么是嵌入式服务器？我们为什么要使用嵌入式服务器呢"><a href="#什么是嵌入式服务器？我们为什么要使用嵌入式服务器呢" class="headerlink" title="什么是嵌入式服务器？我们为什么要使用嵌入式服务器呢?"></a>什么是嵌入式服务器？我们为什么要使用嵌入式服务器呢?</h2><p>思考一下在你的虚拟机上部署应用程序需要些什么。</p>
<p>第一步：安装 Java</p>
<p>第二部：安装 Web 或者是应用程序的服务器（Tomat/Wbesphere/Weblogic 等等）</p>
<p>第三部：部署应用程序 war 包</p>
<p>如果我们想简化这些步骤，应该如何做呢？</p>
<p>让我们来思考如何使服务器成为应用程序的一部分？</p>
<p>你只需要一个安装了 Java 的虚拟机，就可以直接在上面部署应用程序了，</p>
<p>是不是很爽？</p>
<p>这个想法是嵌入式服务器的起源。</p>
<p>当我们创建一个可以部署的应用程序的时候，我们将会把服务器（例如，tomcat）嵌入到可部署的服务器中。</p>
<p>例如，对于一个 Spring Boot 应用程序来说，你可以生成一个包含 Embedded Tomcat 的应用程序 jar。你就可以像运行正常 Java 应用程序一样来运行 web 应用程序了。</p>
<p>嵌入式服务器就是我们的可执行单元包含服务器的二进制文件（例如，tomcat.jar）。</p>
<h2 id="3、微服务同时调用多个接口，怎么支持事务的啊？"><a href="#3、微服务同时调用多个接口，怎么支持事务的啊？" class="headerlink" title="3、微服务同时调用多个接口，怎么支持事务的啊？"></a>3、微服务同时调用多个接口，怎么支持事务的啊？</h2><p>支持分布式事务，可以使用Spring Boot集成 Aatomikos来解决，但是我一般不建议这样使用，因为使用分布式事务会增加请求的响应时间，影响系统的TPS。一般在实际工作中，会利用消息的补偿机制来处理分布式的事务。</p>
<h2 id="4、shiro和oauth还有cas他们之间的关系是什么？问下您公司权限是如何设计，还有就是这几个概念的区别。"><a href="#4、shiro和oauth还有cas他们之间的关系是什么？问下您公司权限是如何设计，还有就是这几个概念的区别。" class="headerlink" title="4、shiro和oauth还有cas他们之间的关系是什么？问下您公司权限是如何设计，还有就是这几个概念的区别。"></a>4、shiro和oauth还有cas他们之间的关系是什么？问下您公司权限是如何设计，还有就是这几个概念的区别。</h2><p>cas和oauth是一个解决单点登录的组件，shiro主要是负责权限安全方面的工作，所以功能点不一致。但往往需要单点登陆和权限控制一起来使用，所以就有 cas+shiro或者oauth+shiro这样的组合。</p>
<p>token一般是客户端登录后服务端生成的令牌，每次访问服务端会进行校验，一般保存到内存即可，也可以放到其他介质；redis可以做Session共享，如果前端web服务器有几台负载，但是需要保持用户登录的状态，这场景使用比较常见。</p>
<p>我们公司使用oauth+shiro这样的方式来做后台权限的管理，oauth负责多后台统一登录认证，shiro负责给登录用户赋予不同的访问权限。</p>
<h2 id="5、各服务之间通信，对Restful和Rpc这2种方式如何做选择？"><a href="#5、各服务之间通信，对Restful和Rpc这2种方式如何做选择？" class="headerlink" title="5、各服务之间通信，对Restful和Rpc这2种方式如何做选择？"></a>5、各服务之间通信，对Restful和Rpc这2种方式如何做选择？</h2><p>在传统的SOA治理中，使用rpc的居多；Spring Cloud默认使用restful进行服务之间的通讯。rpc通讯效率会比restful要高一些，但是对于大多数公司来讲，这点效率影响甚微。我建议使用restful这种方式，易于在不同语言实现的服务之间通讯。</p>
<h2 id="6、怎么设计无状态服务？"><a href="#6、怎么设计无状态服务？" class="headerlink" title="6、怎么设计无状态服务？"></a>6、怎么设计无状态服务？</h2><p>对于无状态服务，首先说一下什么是状态：如果一个数据需要被多个服务共享，才能完成一笔交易，那么这个数据被称为状态。进而依赖这个“状态”数据的服务被称为有状态服务，反之称为无状态服务。</p>
<p>那么这个无状态服务原则并不是说在微服务架构里就不允许存在状态，表达的真实意思是要把有状态的业务服务改变为无状态的计算类服务，那么状态数据也就相应的迁移到对应的“有状态数据服务”中。</p>
<p>场景说明：例如我们以前在本地内存中建立的数据缓存、Session缓存，到现在的微服务架构中就应该把这些数据迁移到分布式缓存中存储，让业务服务变成一个无状态的计算节点。迁移后，就可以做到按需动态伸缩，微服务应用在运行时动态增删节点，就不再需要考虑缓存数据如何同步的问题。</p>
<h2 id="7、Spring-Cache-三种常用的缓存注解和意义？"><a href="#7、Spring-Cache-三种常用的缓存注解和意义？" class="headerlink" title="7、Spring Cache 三种常用的缓存注解和意义？"></a>7、Spring Cache 三种常用的缓存注解和意义？</h2><p>@Cacheable ，用来声明方法是可缓存，将结果存储到缓存中以便后续使用相同参数调用时不需执行实际的方法，直接从缓存中取值。</p>
<p>@CachePut，使用 @CachePut 标注的方法在执行前，不会去检查缓存中是否存在之前执行过的结果，而是每次都会执行该方法，并将执行结果以键值对的形式存入指定的缓存中。</p>
<p>@CacheEvict，是用来标注在需要清除缓存元素的方法或类上的，当标记在一个类上时表示其中所有的方法的执行都会触发缓存的清除操作。</p>
<h2 id="8、Spring-Boot-如何设置支持跨域请求？"><a href="#8、Spring-Boot-如何设置支持跨域请求？" class="headerlink" title="8、Spring Boot 如何设置支持跨域请求？"></a>8、Spring Boot 如何设置支持跨域请求？</h2><p>现代浏览器出于安全的考虑， HTTP 请求时必须遵守同源策略，否则就是跨域的 HTTP 请求，默认情况下是被禁止的，IP（域名）不同、或者端口不同、协议不同（比如 HTTP、HTTPS）都会造成跨域问题。</p>
<p>一般前端的解决方案有：</p>
<ul>
<li>① 使用 JSONP 来支持跨域的请求，JSONP 实现跨域请求的原理简单的说，就是动态创建<code>&lt;script&gt;</code>标签，然后利用<code>&lt;script&gt;</code>的 SRC 不受同源策略约束来跨域获取数据。缺点是需要后端配合输出特定的返回信息。</li>
<li>② 利用反应代理的机制来解决跨域的问题，前端请求的时候先将请求发送到同源地址的后端，通过后端请求转发来避免跨域的访问。</li>
</ul>
<p>后来 HTML5 支持了 CORS 协议。CORS 是一个 W3C 标准，全称是”跨域资源共享”（Cross-origin resource sharing），允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。它通过服务器增加一个特殊的 Header[Access-Control-Allow-Origin]来告诉客户端跨域的限制，如果浏览器支持 CORS、并且判断 Origin 通过的话，就会允许 XMLHttpRequest 发起跨域请求。</p>
<p>前端使用了 CORS 协议，就需要后端设置支持非同源的请求，Spring Boot 设置支持非同源的请求有两种方式。</p>
<p>第一，配置 CorsFilter。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class GlobalCorsConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public CorsFilter corsFilter() &#123;</span><br><span class="line">        CorsConfiguration config &#x3D; new CorsConfiguration();</span><br><span class="line">          config.addAllowedOrigin(&quot;*&quot;);</span><br><span class="line">          config.setAllowCredentials(true);</span><br><span class="line">          config.addAllowedMethod(&quot;*&quot;);</span><br><span class="line">          config.addAllowedHeader(&quot;*&quot;);</span><br><span class="line">          config.addExposedHeader(&quot;*&quot;);</span><br><span class="line"></span><br><span class="line">        UrlBasedCorsConfigurationSource configSource &#x3D; new UrlBasedCorsConfigurationSource();</span><br><span class="line">        configSource.registerCorsConfiguration(&quot;&#x2F;**&quot;, config);</span><br><span class="line"></span><br><span class="line">        return new CorsFilter(configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要配置上述的一段代码。第二种方式稍微简单一些。</p>
<p>第二，在启动类上添加：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class Application extends WebMvcConfigurerAdapter &#123;  </span><br><span class="line"></span><br><span class="line">    @Override  </span><br><span class="line">    public void addCorsMappings(CorsRegistry registry) &#123;  </span><br><span class="line"></span><br><span class="line">        registry.addMapping(&quot;&#x2F;**&quot;)  </span><br><span class="line">                .allowCredentials(true)  </span><br><span class="line">                .allowedHeaders(&quot;*&quot;)  </span><br><span class="line">                .allowedOrigins(&quot;*&quot;)  </span><br><span class="line">                .allowedMethods(&quot;*&quot;);  </span><br><span class="line"></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9、JPA-和-Hibernate-有哪些区别？JPA-可以支持动态-SQL-吗？"><a href="#9、JPA-和-Hibernate-有哪些区别？JPA-可以支持动态-SQL-吗？" class="headerlink" title="9、JPA 和 Hibernate 有哪些区别？JPA 可以支持动态 SQL 吗？"></a>9、JPA 和 Hibernate 有哪些区别？JPA 可以支持动态 SQL 吗？</h2><p>JPA本身是一种规范，它的本质是一种ORM规范（不是ORM框架，因为JPA并未提供ORM实现，只是制定了规范）因为JPA是一种规范，所以，只是提供了一些相关的接口，但是接口并不能直接使用，JPA底层需要某种JPA实现，Hibernate 是 JPA 的一个实现集。</p>
<p>JPA 是根据实体类的注解来创建对应的表和字段，如果需要动态创建表或者字段，需要动态构建对应的实体类，再重新调用Jpa刷新整个Entity。动态SQL，mybatis支持的最好，jpa也可以支持，但是没有Mybatis那么灵活。</p>
<h2 id="10、Spring-、Spring-Boot-和-Spring-Cloud-的关系"><a href="#10、Spring-、Spring-Boot-和-Spring-Cloud-的关系" class="headerlink" title="10、Spring 、Spring Boot 和 Spring Cloud 的关系?"></a>10、Spring 、Spring Boot 和 Spring Cloud 的关系?</h2><p>Spring 最初最核心的两大核心功能 Spring Ioc 和 Spring Aop 成就了 Spring，Spring 在这两大核心的功能上不断的发展，才有了 Spring 事务、Spring Mvc 等一系列伟大的产品，最终成就了 Spring 帝国，到了后期 Spring 几乎可以解决企业开发中的所有问题。</p>
<p>Spring Boot 是在强大的 Spring 帝国生态基础上面发展而来，发明 Spring Boot 不是为了取代 Spring ,是为了让人们更容易的使用 Spring 。</p>
<p>Spring Cloud 是一系列框架的有序集合。它利用 Spring Boot 的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用 Spring Boot 的开发风格做到一键启动和部署。</p>
<p>Spring Cloud 是为了解决微服务架构中服务治理而提供的一系列功能的开发框架，并且 Spring Cloud 是完全基于 Spring Boot 而开发，Spring Cloud 利用 Spring Boot 特性整合了开源行业中优秀的组件，整体对外提供了一套在微服务架构中服务治理的解决方案。</p>
<p>用一组不太合理的包含关系来表达它们之间的关系。</p>
<p>Spring ioc/aop &gt; Spring &gt; Spring Boot &gt; Spring Cloud</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="高并发场景"><a href="#高并发场景" class="headerlink" title="高并发场景"></a>高并发场景</h3>]]></content>
  </entry>
</search>
